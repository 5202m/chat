function getMarketpriceCrossDomainIndex(e,t){$.ajax({type:"GET",url:e,dataType:"jsonp",success:function(e){"OK"==e.code&&parseMarketpriceIndex(e,t)},error:function(){}})}function parseMarketpriceIndex(e,t){for(var a=2,r="",n=0,o=0,s=0,i=0;i<e.listResult.length;i++){r=e.listResult[i].symbol,n=e.listResult[i].deltaPrice,s=e.listResult[i].price,o=e.listResult[i].deltaPercent,a="XAGUSD"==r||"USDJPY"==r?3:"EURUSD"==r?3:2;var l=$("#price_"+r);l.html(parseFloat(s).toFixed(a));var c=$("#deltaPercent_"+r);if(c.text((100*o).toFixed(2)+"%"),t)if("studio"==t.from){var d=parseFloat(s).toFixed(a);d=d.toString().substring(0,d.indexOf("."))+"<b>."+d.toString().substring(d.indexOf(".")+1)+"</b>",l.html(d),c.html("<span>"+n+"</span><span>"+(100*o).toFixed(2)+"%</span>"),n>0?c.removeClass(t.fall):c.addClass(t.fall)}else{var d=parseFloat(s).toFixed(a);d=d.toString().substring(0,d.indexOf("."))+"<span>."+d.toString().substring(d.indexOf(".")+1)+"</span>",l.html(d+'<i changeCss="true"></i>');var p=$("#price_"+r+" i");c.text(n+"  "+(100*o).toFixed(2)+"%"),n>0?"true"==p.attr("changeCss")&&(l.removeClass(t.down),c.removeClass(t.down),p.removeClass(t.downCss).addClass(t.upCss)):"true"==p.attr("changeCss")&&(l.addClass(t.down),c.addClass(t.down),p.removeClass(t.upCss).addClass(t.downCss))}else n>0?$("#price_"+r).parent().addClass("up"):$("#price_"+r).parent().removeClass("up"),$("#deltaPrice_"+r).html(parseFloat(n).toFixed(a))}}function getAllMarketpriceIndex(e,t,a,r){try{window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket?pkMarketSocket?pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t):(pkMarketSocket=new ReconnectingWebSocket(e,null,{reconnectInterval:3e3}),pkMarketSocket.onmessage=function(e){var t=JSON.parse(e.data);"OK"==t.code&&parseMarketpriceIndex(t,r)},pkMarketSocket.onopen=function(e){pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t)}):setInterval(function(){getMarketpriceCrossDomainIndex(a,r)},2e3)}catch(n){console.log("get price has error!")}}function getSymbolPriceDatas(e,t,a){$.ajax({url:e,type:"GET",dataType:"jsonp",jsonp:"jsoncallback",jsonpCallback:"_setViewPrice",timeout:5e3,beforeSend:function(){},success:function(e){_setViewPrice(e,t,a)},error:function(e){}})}function _setViewPrice(e,t,a){if(0===e.status){var r=2,n="",o=0,s=0,i=0;$.each(e.data,function(e,l){if(common.isValid(a)&&$.isArray(a)&&$.inArray(e,a)>-1){n=e,o=l.fluctuate,i=l.now,s=l.Percent,r="XAGUSD"==n||"USDJPY"==n||"SILVER"==n?3:"EURUSD"==n?3:2;var c=$("#price_"+n),d=$("#deltaPercent_"+n);if("XAGCNH"==n?(c.html(i),d.text(o+"  "+s+"%")):(c.html(parseFloat(i).toFixed(r)),d.text(o+"  "+s+"%")),t){if("XAGCNH"==n)c.html(i+'<i changeCss="true"></i>');else{var p=parseFloat(i).toFixed(r);p=p.toString().substring(0,p.indexOf("."))+"<span>."+p.toString().substring(p.indexOf(".")+1)+"</span>",c.html(p+'<i changeCss="true"></i>')}var u=$("#price_"+n+" i");d.text(o+"  "+s+"%"),o>0?"true"==u.attr("changeCss")&&(c.removeClass(t.down),d.removeClass(t.down),u.removeClass(t.downCss).addClass(t.upCss)):"true"==u.attr("changeCss")&&(c.addClass(t.down),d.addClass(t.down),u.removeClass(t.upCss).addClass(t.downCss))}else o>0?$("#price_"+n).parent().addClass("up"):$("#price_"+n).parent().removeClass("up"),$("#deltaPrice_"+n).html(parseFloat(o).toFixed(r))}})}}var pkMarketSocket=null,ChartFactory=window.Highcharts?function(){function e(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}function t(){var e=$(window).width();return 540>e?30:e>=540&&1080>e?40:80}var a={realtime:"1min","5min":"5min",hour:"1hour",day:"day"},r={ELEMENT_NOTFOUND:"没有指定画板元素",SERVICE_ERROR:"服务器出现错误",NOT_KEEP_WEBSOCKET_ERROR:"不支持websocket",NO_DATA:"没有数据"},n={line:function(e){for(var t=[],a=0;a<e.length;a++){var r=e[a],n=r.milliseconds,o=parseFloat(r.end);0==o?t.push({x:n,y:null}):t.push({x:n,y:o})}return t},candlestick:function(e){for(var t=[],a=0;a<e.length;a++){var r=e[a],n=r.milliseconds,o=parseFloat(r.high),s=parseFloat(r.low),i=parseFloat(r.end),l=parseFloat(r.begin);t.push([n,l,o,s,i])}return t}},o="",s=2;return null!=document.getElementById("symbol")&&"undefined"!=typeof document.getElementById("symbol")&&(o=document.getElementById("symbol").value),"XAGUSD"==o||"USDJPY"==o?s=3:("EURUSD"==o||"GBPUSD"==o||"AUDUSD"==o||"USDCHF"==o||"USDCAD"==o)&&(s=4),Highcharts.setOptions({global:{useUTC:!1}}),{pkSocket:null,closeSocket:function(){this.pkSocket&&this.pkSocket.close()},create:function(e,t,n){n&&n.show();var o=$.Deferred();if(!e||!e.length)return o.reject(r.ELEMENT_NOTFOUND),o.promise();var s={type:"post",dataType:"jsonp",jsonpCallback:"jsonpCallback",data:{kType:a.realtime}},i=this,l=$.extend(!0,{},s,t);return this.symbol=l.data.symbol,this.loadData(l).done(function(a){if(n&&n.hide(),!a||!a.code)return o.reject(r.SERVICE_ERROR);if("OK"!==a.code)return o.reject(r.SERVICE_ERROR);if(0==a.listResult.length)return o.reject(r.NO_DATA);var s=l.data.dataType,c=i.getChartType(s),a=i.parseData(a.listResult.reverse(),c,l);if(i.createChart(e,c,s,a),o.resolve(),t.wsUrl){if(t.wsParam+="&symbol="+t.data.symbol+"&dataType="+t.data.dataType,console.log("options.wsParam:"+t.wsParam),window.WebSocket||(window.WebSocket=window.MozWebSocket),!window.WebSocket)return o.reject(r.NOT_KEEP_WEBSOCKET_ERROR);try{ChartFactory.pkSocket?ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam):(ChartFactory.pkSocket=new ReconnectingWebSocket(t.wsUrl,null,{reconnectInterval:3e3}),ChartFactory.pkSocket.onmessage=function(a){var r=a.originalEvent?a.originalEvent.data:null;r&&(r=JSON.parse(r),"ok"==r.code.toLowerCase()&&r.condition&&r.condition.symbol==t.data.symbol&&r.condition.dataType==t.data.dataType&&r.listResult.length>0&&ChartFactory.add(e,r.listResult,time))},ChartFactory.pkSocket.onopen=function(e){ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam)})}catch(d){console.log("get kdata price has error!"+d)}}}),o.promise()},add:function(e,t,a){var r=this.getChartType(a);t=this.parseData(t,r),"line"===r?this.addPoint(e,t):this.addPoint(e,t)},parseData:function(e,t,a){var r=a&&a.parser&&a.parser[t]||n[t];return r(e)},getChartType:function(e){return e===a.realtime?"line":"candlestick"},createChart:function(e,t,a,r){"line"===t?this.createLineChart(e,r):"candlestick"==t&&this.createCandlestickChart(e,a,r)},createLineChart:function(e,t){var a={colors:["#b59130"],chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" 1min",position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{line:{dataGrouping:{enabled:!1},cropThreshold:300}},xAxis:{type:"datetime",tickLength:0,tickPixelInterval:70},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(s)}},opposite:!1,showLastLabel:!0,tickLength:0,lineWidth:1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=["<span>"+Highcharts.dateFormat("%Y-%m-%d %H:%M",this.x)+"</span><br/>"];return e.push("<span>价格:<strong>"+this.y+"</strong></span><br/>"),e.join("")}},series:[{name:"价位",type:"line",data:t}]};e.highcharts("StockChart",a)},addPoint:function(e,t){var a=e.highcharts();a.series[0].addPoint(t[0],!1),a.redraw()},createCandlestickChart:function(e,t,r){var n="%Y-%m-%d";t===a["5min"]?n="%Y-%m-%d %H:%M":t===a.hour&&(n="%Y-%m-%d %H:%M");var o={chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" "+t,position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{candlestick:{upColor:"#F00",upLineColor:"#F00",color:"#00a004",lineColor:"#00a004"}},xAxis:{type:"datetime",tickPixelInterval:70,tickLength:0,dateTimeLabelFormats:{day:"%m-%d",week:"%m-%d",month:"%y-%m"}},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(s)}},lineWidth:1,opposite:!1,showLastLabel:!0,endOnTick:!1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=this.points[0].point,t=["<span>"+Highcharts.dateFormat(n,this.x)+"</span><br/>"];return t.push("<span>开盘价:<strong>"+e.open+"</strong></span><br/>"),t.push("<span>最高价:<strong>"+e.high+"</span></span><br/>"),t.push("<span>最低价:<strong>"+e.low+"</strong></span><br/>"),t.push("<span>收盘价:<strong>"+e.close+"</strong></span><br/>"),t.join("")}},series:[{name:"价格",type:"candlestick",data:r}]};t===a.day&&(o.xAxis.datafor=[]),e.highcharts("StockChart",o)},loadData:function(r){var n=t(),o=r.data.dataType;return $.extend(r.data,{startTime:e(new Date),num:o===a.realtime?120:n,flag:0}),$.ajax(r)}}}():null;