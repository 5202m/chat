var jqWindowsEngineZIndex=100;!function(n){n.fn.newWindow=function(t){var i=0,e=0,o={windowTitle:"",content:"",ajaxURL:"",width:200,height:200,posx:50,posy:50,onDragBegin:null,onDragEnd:null,onResizeBegin:null,onResizeEnd:null,onAjaxContentLoaded:null,statusBar:!0,minimizeButton:!0,minimizeIcon:"â€”",maximizeButton:!0,maximizeIcon:"O",closeButton:!0,closeIcon:"X",draggable:!0,resizeable:!0,resizeIcon:"#",windowType:"standard",beforeMinimize:null,beforeClose:null,afterClose:null},t=n.extend(o,t);$windowContainer=n('<div class="window-container" wid="'+n(this).attr("id")+'" '+("hide"==n(this).attr("t")?'style="display:none;"':"")+"></div>"),$windowTitleBar=n('<div class="window-titleBar"></div>'),$windowMinimizeButton=n('<div class="window-minimizeButton"></div>'),$windowMaximizeButton=n('<div class="window-maximizeButton"></div>'),$windowCloseButton=n('<div class="window-closeButton"></div>'),$windowContent=n('<div class="window-content"></div>'),$windowStatusBar=n('<div class="window-statusBar"></div>'),$windowResizeIcon=n('<div class="window-resizeIcon"></div>'),("video"==t.windowType||"iframe"==t.windowType)&&$windowContent.css("overflow","hidden");var a=function(n){n.css("z-index",jqWindowsEngineZIndex++)},d=function(n,i,e){i=parseInt(i),e=parseInt(e),n.attr("lastWidth",i).attr("lastHeight",e),i+="px",e+="px",n.css("width",i).css("height",e),"video"==t.windowType&&(n.children(".window-content").children("embed").css("width",i).css("height",e),n.children(".window-content").children("object").css("width",i).css("height",e),n.children(".window-content").children().children("embed").css("width",i).css("height",e),n.children(".window-content").children().children("object").css("width",i).css("height",e)),"iframe"==t.windowType&&n.children(".window-content").children("iframe").css("width",i).css("height",e)},w=function(n,t,i){t=parseInt(t),i=parseInt(i),n.attr("lastX",t).attr("lastY",i),t+="px",i+="px",n.css("left",t).css("top",i)},s=function(n,o){if(t.draggable){n=n?n:window.event;var a=parseInt(o.css("left"))+(n.clientX-i),d=parseInt(o.css("top"))+(n.clientY-e);i=n.clientX,e=n.clientY,w(o,a,d)}},r=function(n,t){n=n?n:window.event;var o=parseInt(t.css("width")),a=parseInt(t.css("height"));o=100>o?100:o,a=50>a?50:a;var w=o+(n.clientX-i),s=a+(n.clientY-e);i=n.clientX,e=n.clientY,d(t,w,s)};return $windowTitleBar.bind("mousedown",function(o){var d=n(o.target).parent();a(d),"normal"==d.attr("state")&&(o=o?o:window.event,i=o.clientX,e=o.clientY,n(document).bind("mousemove",function(n){s(n,d)}),n(document).bind("mouseup",function(i){null!=t.onDragEnd&&t.onDragEnd(),n(document).unbind("mousemove"),n(document).unbind("mouseup")}),null!=t.onDragBegin&&t.onDragBegin())}),$windowResizeIcon.bind("mousedown",function(o){var d=n(o.target).parent().parent();a(d),"normal"==d.attr("state")&&(o=o?o:window.event,i=o.clientX,e=o.clientY,n(document).bind("mousemove",function(n){r(n,d)}),n(document).bind("mouseup",function(i){null!=t.onResizeEnd&&t.onResizeEnd(),n(document).unbind("mousemove"),n(document).unbind("mouseup")}),null!=t.onResizeBegin&&t.onResizeBegin())}),$windowMinimizeButton.bind("click",function(i){if(null==t.beforeMinimize||t.beforeMinimize(n(i.target).parent().parent())){var e=n(i.target).parent().parent();a(e),"normal"==e.attr("state")&&n(i.target).parent().next().slideToggle("slow")}}),$windowMaximizeButton.bind("click",function(i){var e=n(i.target).parent().parent();if(a(e),"normal"==e.attr("state")){if("standard"==t.windowType)e.animate({top:"5px",left:"5px",width:n(window).width()-15,height:n(window).height()-45},"slow");else{var o=e.attr("lastX"),s=e.attr("lastY"),r=e.attr("lastWidth"),l=e.attr("lastHeight");w(e,5,5),d(e,n(window).width()-15,n(window).height()-45),e.attr("lastX",o),e.attr("lastY",s),e.attr("lastWidth",r),e.attr("lastHeight",l)}e.attr("state","maximized")}else"maximized"==e.attr("state")&&("standard"==t.windowType?e.animate({top:e.attr("lastY"),left:e.attr("lastX"),width:e.attr("lastWidth"),height:e.attr("lastHeight")},"slow"):(d(e,e.attr("lastWidth"),e.attr("lastHeight")),w(e,e.attr("lastX"),e.attr("lastY"))),e.attr("state","normal"))}),$windowCloseButton.bind("click",function(i){(null==t.beforeClose||t.beforeClose())&&(n(i.target).parent().parent().fadeOut(),n(i.target).parent().parent().remove(),null!=t.afterClose&&t.afterClose(t.content))}),$windowContent.click(function(t){a(n(t.target).parent())}),$windowStatusBar.click(function(t){a(n(t.target).parent())}),w($windowContainer,t.posx,t.posy),d($windowContainer,t.width,t.height),$windowContainer.attr("state","normal"),$windowTitleBar.append(t.windowTitle),t.minimizeButton&&$windowTitleBar.append($windowMinimizeButton),t.maximizeButton&&$windowTitleBar.append($windowMaximizeButton),t.closeButton&&$windowTitleBar.append($windowCloseButton),t.resizeable&&$windowStatusBar.append($windowResizeIcon),$windowContainer.append($windowTitleBar),$windowContainer.append($windowContent),t.statusBar&&$windowContainer.append($windowStatusBar),$windowContainer.css("display","none"),this.each(function(i){var e=n(this);$windowMinimizeButton.html(t.minimizeIcon),$windowMaximizeButton.html(t.maximizeIcon),$windowCloseButton.html(t.closeIcon),$windowResizeIcon.html(t.resizeIcon),e.data("window",$windowContainer),n("body").append($windowContainer),e.click(function(i){i.preventDefault(),$window=e.data("window"),""!=t.ajaxURL?n.ajax({type:"GET",url:t.ajaxURL,dataType:"html",success:function(n){$window.children(".window-content").html(n),null!=t.onAjaxContentLoaded&&t.onAjaxContentLoaded()}}):"object"==n.type(t.content)?$window.children(".window-content").get(0).appendChild(t.content):$window.children(".window-content").html(t.content),t.draggable||$window.children(".window-titleBar").css("cursor","default"),a($window),"hide"!=n(this).attr("t")&&$window.fadeIn()})})}}(jQuery);