function UUID(){this.id=this.createUUID()}function openLive800Chat(t){var e="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";t?location.href=e:window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(){var t="http://crm2.qq.com/page/portalpage/wpa.php?uin=800018282&cref=&ref=&f=1&ty=1&ap=&as=";window.open(t,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(t)}function live800Prompt(t){window.onbeforeunload=null;var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",a="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==t)try{UUID.prototype.createUUID();window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(a,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(a)}}function qqPrompt(t){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var a=UUID.prototype.createUUID();getGacookiesTrack(a,"2","1"),window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}function getMarketpriceCrossDomainIndex(t,e){$.ajax({type:"GET",url:t,dataType:"jsonp",success:function(t){"OK"==t.code&&parseMarketpriceIndex(t,e)},error:function(){}})}function parseMarketpriceIndex(t,e){for(var a=2,s="",i=0,n=0,o=0,r=0;r<t.listResult.length;r++){s=t.listResult[r].symbol,i=t.listResult[r].deltaPrice,o=t.listResult[r].price,n=t.listResult[r].deltaPercent,a="XAGUSD"==s||"USDJPY"==s?3:"EURUSD"==s?3:2;var l=$("#price_"+s);l.html(parseFloat(o).toFixed(a));var d=$("#deltaPercent_"+s);if(d.text((100*n).toFixed(2)+"%"),e){var c=parseFloat(o).toFixed(a);c=c.toString().substring(0,c.indexOf("."))+"<span>."+c.toString().substring(c.indexOf(".")+1)+"</span>",l.html(c+'<i changeCss="true"></i>');var u=$("#price_"+s+" i");d.text(i+"  "+(100*n).toFixed(2)+"%"),i>0?"true"==u.attr("changeCss")&&(l.removeClass(e.down),d.removeClass(e.down),u.removeClass(e.downCss).addClass(e.upCss)):"true"==u.attr("changeCss")&&(l.addClass(e.down),d.addClass(e.down),u.removeClass(e.upCss).addClass(e.downCss))}else i>0?$("#price_"+s).parent().addClass("up"):$("#price_"+s).parent().removeClass("up"),$("#deltaPrice_"+s).html(parseFloat(i).toFixed(a))}}function getAllMarketpriceIndex(t,e,a,s){try{window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket?pkMarketSocket?pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(e):(pkMarketSocket=new ReconnectingWebSocket(t,null,{reconnectInterval:3e3}),pkMarketSocket.onmessage=function(t){var e=JSON.parse(t.data);"OK"==e.code&&parseMarketpriceIndex(e,s)},pkMarketSocket.onopen=function(t){pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(e)}):setInterval(function(){getMarketpriceCrossDomainIndex(a,s)},2e3)}catch(i){console.log("get price has error!")}}function getSymbolPriceDatas(t,e,a){$.ajax({url:t,type:"GET",dataType:"jsonp",jsonp:"jsoncallback",jsonpCallback:"_setViewPrice",timeout:5e3,beforeSend:function(){},success:function(t){_setViewPrice(t,e,a)},error:function(t){}})}function _setViewPrice(t,e,a){if(0===t.status){var s=2,i="",n=0,o=0,r=0;$.each(t.data,function(t,l){if(common.isValid(a)&&$.isArray(a)&&$.inArray(t,a)>-1){i=t,n=l.fluctuate,r=l.now,o=l.Percent,s="XAGUSD"==i||"USDJPY"==i||"SILVER"==i?3:"EURUSD"==i?3:2;var d=$("#price_"+i),c=$("#deltaPercent_"+i);if("XAGCNH"==i?(d.html(r),c.text(n+"  "+o+"%")):(d.html(parseFloat(r).toFixed(s)),c.text(n+"  "+o+"%")),e){if("XAGCNH"==i)d.html(r+'<i changeCss="true"></i>');else{var u=parseFloat(r).toFixed(s);u=u.toString().substring(0,u.indexOf("."))+"<span>."+u.toString().substring(u.indexOf(".")+1)+"</span>",d.html(u+'<i changeCss="true"></i>')}var h=$("#price_"+i+" i");c.text(n+"  "+o+"%"),n>0?"true"==h.attr("changeCss")&&(d.removeClass(e.down),c.removeClass(e.down),h.removeClass(e.downCss).addClass(e.upCss)):"true"==h.attr("changeCss")&&(d.addClass(e.down),c.addClass(e.down),h.removeClass(e.upCss).addClass(e.downCss))}else n>0?$("#price_"+i).parent().addClass("up"):$("#price_"+i).parent().removeClass("up"),$("#deltaPrice_"+i).html(parseFloat(n).toFixed(s))}})}}var _gaq=_gaq||[],_hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(t){var e=new Date(1582,10,15,0,0,0,0),a=new Date,s=a.getTime()-e.getTime(),i=UUID.getIntegerBits(s,0,31),n=UUID.getIntegerBits(s,32,47),o=UUID.getIntegerBits(s,48,59)+"1",r=UUID.getIntegerBits(UUID.rand(4095),0,7),l=UUID.getIntegerBits(UUID.rand(4095),0,7),d=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return(t||"")+i+n+o+r+l+d},UUID.getIntegerBits=function(t,e,a){var s=UUID.returnBase(t,16),i=new Array,n="",o=0;for(o=0;o<s.length;o++)i.push(s.substring(o,o+1));for(o=Math.floor(e/4);o<=Math.floor(a/4);o++)n+=i[o]&&""!=i[o]?i[o]:"0";return n},UUID.returnBase=function(t,e){return t.toString(e).toUpperCase()},UUID.rand=function(t){return Math.floor(Math.random()*(t+1))};var chatAnalyze={COOKIE_NAME:"GWAFLGPHONECOOIKETRACK",localHref:window.location.href,utmStore:{ip:"",storeKey:"utmKey_",userId:"",roomId:"",groupType:"",speakCount:0,onlineSTM:(new Date).getTime(),onlineETM:0},isLocalHref:function(){return/^https?:\/\/(\d{1,3}\.){3}\d{1,3}.+/.test(chatAnalyze.localHref)},init:function(){if(!this.isLocalHref()){var t="";-1!=chatAnalyze.localHref.indexOf("/studio")?t="studio":-1!=chatAnalyze.localHref.indexOf("/fxstudio")?t="fxstudio":-1!=chatAnalyze.localHref.indexOf("/hxstudio")&&(t="hxstudio"),""!=t&&(this.initGA(t),this.setGA(),this.setBaidu())}},initGA:function(t){"studio"==t&&(_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"])),"fxstudio"==t&&(_gaq.push(["_setAccount","UA-49389835-1"]),_gaq.push(["_setDomainName","gwfx.com"]),_gaq.push(["_addIgnoredRef","gwfx.com"])),"hxstudio"==t&&(_gaq.push(["_setAccount",""]),_gaq.push(["_setDomainName","handan.hx9999"]),_gaq.push(["_addIgnoredRef","handan.hx9999"])),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"])},setGA:function(){try{var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(a){console.log("Set GA fail!"+a)}},setBaidu:function(){try{var t=document.createElement("script");t.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(a){console.log("Set GA fail!"+a)}},getIp:function(t){$.getJSON("http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_="+Math.random(),function(e){chatAnalyze.utmStore.ip=e.Ip,t&&t()})},setUTM:function(t,e){try{this.getIp(),t?(this.utmStore.roomId=e.groupId,this.utmStore.userId=e.userId,this.utmStore.userTel=e.userTel,this.utmStore.clientGroup=e.clientGroup,this.utmStore.groupType=e.groupType,$(window).unload(function(){chatAnalyze.utmStore.onlineETM=(new Date).getTime(),chatAnalyze.sendUTM(null),window.event.returnValue=!0})):e.speakCount?this.utmStore.speakCount+=e.speakCount:chatAnalyze.utmStore.ip?chatAnalyze.sendUTM(e):this.getIp(function(){chatAnalyze.sendUTM(e)})}catch(a){console.log("Set UTM fail!"+a)}},utmAjax:function(t,e,a){$.ajax({async:a,url:t+"?t="+(new Date).getTime(),cache:!1,dataType:a?"jsonp":"json",data:{data:JSON.stringify(e)},success:function(t){}})},sendUTM:function(t){try{if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e=chatAnalyze.utmStore;if(!e.roomId||!e.groupType)return;if(!e.userTel&&!e.userId){var a=store.get("storeInfo_"+e.groupType);if(!a)return;e.userId=a.userId}var s=e.storeKey+e.groupType,i=-1!=e.groupType.indexOf("fx")?1:2,n=store.get(s);n||(n=UUID.prototype.createUUID(1==i?"":"G"),store.set(s,n));var o={userId:n,customerType:e.clientGroup,ip:e.ip,businessPlatform:i,platformType:common.isMobile()?1:0,roomId:e.roomId};e.userTel?o.operationTel=e.userTel:o.visitorId=e.userId;var r=this.isLocalHref()?"http://testweb.gwfx.com:8088/GwUserTrackingManager_NEW/put/insertChart":"http://das.gwfx.com/put/insertChart";t&&t.courseId?(o.courseId=t.courseId,this.utmAjax(r,o,!0)):(o.startDateTime=e.onlineSTM,o.endDateTime=e.onlineETM,o.speakCount=e.speakCount,navigator.sendBeacon?navigator.sendBeacon(r+"Close",JSON.stringify(o)):this.utmAjax(r,o,!1))}catch(l){console.log("send UTM fail!"+l)}}};$(function(){chatAnalyze.init()});var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(t,e){return isNaN(e)||e>t.length?!1:void t.splice(e,1)},joinSplit:function(t){return",".concat(t).concat(",")},isBlank:function(t){return void 0==t||null==t||"undefined"==t||"null"==t||""==$.trim(t)},isValid:function(t){return!this.isBlank(t)},trim:function(t){return this.isBlank(t)?"":t.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(t){return document.createElement("div").appendChild(document.createTextNode(t)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(t){return this.isBlank(t)?"":t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(t,e){e||(e="-"),t instanceof Date||(t=new Date(t));var a=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate());return a},getHHMMSS:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return e},getMMSS:function(t){return t instanceof Date||(t=new Date(t)),(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},getHHMM:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return e},formatterDateTime:function(t,e){if(e||(e="-"),t instanceof Date||(t=new Date(t)),"Invalid Date"==t)return"";var a=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return a},longMsTimeToDateTime:function(t,e){var a=new Date(t);return this.formatterDateTime(a,e)},showBox:function(t,e){$(t).slideDown(),$(e||".layer-shadow").show()},hideBox:function(t,e){$(t).slideUp(),$(e||".layer-shadow").hide()},containSplitStr:function(t,e){return common.isBlank(t)||common.isBlank(e)?!1:-1!=(","+t+",").indexOf(","+e+",")},getJson:function(t,e,a,s,i){var n=null;return $.ajax({url:t,type:"POST",timeout:1e5,cache:!1,async:void 0!=s?s:!1,dataType:"json",data:e,success:"function"==typeof a?a:function(t){n=t},error:function(t,e){"function"==typeof i?i(e):common.isValid(t.responseText)&&"OK"!=t.statusText?alert(t.responseText):alert("请求超时,请重试!")}}),n},arraySort:function(t,e){return function(a,s){return e?a[t]<s[t]:a[t]>s[t]}},randomNumber:function(t){for(var e="",a=0;t>a;a++)e+=Math.floor(10*Math.random());return e},isMobilePhone:function(t){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(t)},dateTimeWeekCheck:function(t,e,a){if(this.isBlank(t))return!!e;$.isPlainObject(t)||(t=JSON.parse(t));var s=a?new Date(a):new Date,i=!1,n=this.formatterDate(s);if(i=this.isBlank(t.beginDate)||n>=t.beginDate,i&&(i=this.isBlank(t.endDate)||n<=t.endDate),!i)return!1;var o=t.weekTime;if(this.isBlank(o))return i;var r=null,l=null,d=!1;for(var c in o)if(r=o[c],(!this.isValid(r.week)||s.getDay()==parseInt(r.week))&&(l=this.getHHMMSS(s),d=this.isBlank(r.beginTime)||l>=r.beginTime,d&&(d=this.isBlank(r.endTime)||l<=r.endTime),d))break;return d},arrayUnique:function(t){if(!t)return t;for(var e,a=[],s={},i=0;null!=(e=t[i]);i++)s[e]||(a.push(e),s[e]=!0);return a},isWebSocket:function(){return window.WebSocket},getSocket:function(t,e,a){return common.isWebSocket()?(console.log("used websocket!"),t.connect(e.webSocket+"/"+a,{transports:["websocket"]})):t.connect(e.socketIO+"/"+a)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(t){for(var e="",a=0;t>a;a++)e+=Math.floor(10*Math.random());return e},clearMsgHtml:function(t){var t=t.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return t&&(t=$.trim(t)),t},formatToJson:function(t){return this.isBlank(t)?null:JSON.parse(t)},getSyllabusPlan:function(t,e,a,s){if(!t||!t.courses)return null;var i=function(t,e){if(t){var i,n=common.isMobile();"object"!=typeof t&&(t=JSON.parse(t));for(var o in t)if(i=t[o],n){if(1==e&&(!a&&3==i.code||a&&4==i.code))return i.url}else if(s){if(1==e&&3==i.code){var r=i.url||"";return r=r.replace(/^http:/,"rtmps:").replace(/\/playlist\.m3u8$/,"")}}else if(i.code==e)return i.url}},n=function(e,a,s){var n=null,o=e.course;return o&&o.length>a?(n=o[a],0==n.status||common.isBlank(n.lecturerId)?null:(n.studioLink=i(t.studioLink,n.courseType),n.startTime=e.startTime,n.endTime=e.endTime,n.day=r[a].day,n.isNext=s,n)):null},o=null;o=this.isValid(t.courses)&&"object"!=typeof t.courses?JSON.parse(t.courses):t.courses;for(var r=o.days,l=o.timeBuckets,d=new Date(e).getDay(),c=common.getHHMM(e),u=null,h=!1,p=null,m=null,f=0;f<r.length;f++)if(0!=r[f].status)if(r[f].day>d){for(var g in l)if(u=l[g],m=n(u,f,!0))return m}else if(r[f].day==d)for(var g in l){if(u=l[g],u.startTime<=c&&(u.endTime>=c||"00:00"==u.endTime))return h=!0,n(u,f,!1);if(!h&&u.startTime>c)return h=!0,n(u,f,!0)}else if(!p)for(var g=0;g<l.length;g++)if(m=l[g].course,m&&0!=m[f].status&&!common.isBlank(m[f].lecturerId)){p={dayIndex:f,tmIndex:g};break}return!h&&p?n(l[p.tmIndex],p.dayIndex,!0):null},formatSyllabus:function(t,e,a,s){var i={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},n=new Date(e).getDay(),o=this.getHHMM(e),r=$.extend({},i,s),l=function(t,e,a,s){var i=0,l=(t+6)%7,d=(n+6)%7;return i=l>d?2:d>l?0:s?1:o>=a?0:e>o?2:1,r.courseCls[i]},d=[];try{if(t){var c=$.isPlainObject(t)?t:JSON.parse(t),u=c.days?c.days.length:0;if(u>0)if(1===a){var h={0:"文字",1:"视频",2:"oneTV"};d.push('<div class="sy_panel">');var p=e-864e5*((n+6)%7),m=null,f=null,g=null;d.push('<div class="sy_nav">');for(var v=' style="width:'+100/u+'%;"',b=0;u>b;b++)m=new Date(p+(c.days[b].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),g=c.days[b].day==n?' class="active"':"",d.push('<a href="javascript:void(0)" d="'+c.days[b].day+'"'+g+v+">"+r.dayCN[c.days[b].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');d.push("</div>"),d.push('<div class="sy_cont"><div>'),d.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var I=null,x=null,b=0;u>b;b++){if(d.push('<tbody d="'+c.days[b].day+'">'),0==c.days[b].status)x=l(c.days[b].day,null,null,!0),d.push('<tr class="'+x+'" width="100%"><td>休市</td></tr>');else for(var w=0,y=c.timeBuckets.length;y>w;w++)I=c.timeBuckets[w],x=l(c.days[b].day,I.startTime,I.endTime,!1),0==I.course[b].status?(d.push('<tr class="'+x+'">'),d.push('<td width="25%">'+I.startTime+"-"+I.endTime+"</td>"),d.push('<td colspan="2" width="75%">休市</td>'),d.push("</tr>")):I.course[b].lecturer&&(d.push('<tr class="'+x+'">'),d.push('<td width="25%">'+I.startTime+"-"+I.endTime+"【"+h[I.course[b].courseType]+"】</td>"),d.push('<td width="25%">'+I.course[b].lecturer+"</td>"),d.push('<td width="50%">'+I.course[b].title+"</td>"),d.push("</tr>"));d.push("</tbody>")}d.push("</table>"),d.push("</div></div>"),d.push("</div>")}else if(2===a){d.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),d.push("<tr>"),d.push("<th>星期\\节次</th>");for(var y=c.timeBuckets?c.timeBuckets.length:0,I=null,x=null,w=0;y>w;w++)I=c.timeBuckets[w],d.push("<th>"+r.indexCN[w]+"<br><span>("+I.startTime+"-"+I.endTime+")</span></th>");d.push("</tr>");for(var k=null,b=0,S=c.days?c.days.length:0;S>b;b++){if(k=c.days[b],d.push("<tr>"),d.push("<th>"+r.dayCN[k.day]+"</th>"),0==k.status)x=l(k.day,null,null,!0),d.push('<td class="'+x+'" colspan="'+y+'">休市</td>');else for(var w=0;y>w;w++)I=c.timeBuckets[w],x=l(k.day,I.startTime,I.endTime,!1),d.push('<td class="'+x+'">'+(0==I.course[b].status?"休市":I.course[b].lecturer)+"</td>");d.push("</tr>")}d.push("</table>")}else if(3===a){var p=o-864e5*((n+6)%7),m=null,g=null,k=null,v=' style="width:'+100/u+'%;"';d.push("<tr>");for(var b=0;u>b;b++)k=c.days[b],m=new Date(p+(c.days[b].day+6)%7*864e5),g=c.days[b].day==n?' class="active"':"",d.push('<th d="'+c.days[b].day+'"'+g+v+">"+r.dayCN[c.days[b].day]+"<i></i></th>");d.push("</tr>"),d.push('<tr><td class="space" colspan="'+u+'"></td></tr>');for(var I=null,x=null,b=0;u>b;b++){if(k=c.days[b],d.push('<tr d="'+k.day+'"><td colspan="'+u+'">'),0==k.status)x=l(k.day,null,null,!0),d.push('<p class="'+x+'">休市</p>');else for(var w=0,y=c.timeBuckets?c.timeBuckets.length:0;y>w;w++)I=c.timeBuckets[w],I.course[b].lecturer&&(x=l(k.day,I.startTime,I.endTime,!1),d.push('<p class="'+x+'">'),d.push("<span>"+I.startTime+"-"+I.endTime+"</span>"),0==I.course[b].status?d.push("<span>休市</span>"):(d.push("<span>"+r.courseType[I.course[b].courseType]+"</span>"),d.push("<span>"+I.course[b].lecturer+"</span>"),d.push('<span class="item">'+I.course[b].title+"</span>")),d.push("</p>"));d.push("</td></tr>")}}}}catch(T){return console.error("formatSyllabus->"+T),""}return d.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(t,e,a){if(!e)return t;for(var s in t)e.hasOwnProperty(s)&&common.isValid(e[s])&&(t[s]=e[s]);if(a)for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])},isRightName:function(t){return!/^([0-9]{2,20})$/g.test(t)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(t)},randomIndex:function(t){var e=parseInt(Math.round(Math.random()*t));return e==t&&(e=t-1),0>e?0:e},saveToDesktop:function(t,e){try{var a=new ActiveXObject("WScript.Shell"),s=a.CreateShortcut(a.SpecialFolders("Desktop")+"\\"+e+".url");s.TargetPath=t,s.Save()}catch(i){return!1}return!0}};window.console||(console=function(){function t(){}function e(){return null==a&&(a=new t),a}var a=null;return t.prototype={log:function(t){},error:function(t){}},e()}()),$.fn.focusEnd=function(){$(this).focus();var t=$("<span/>").appendTo($(this)),e=t.get(0),a=null,s=null;return document.selection?(a=document.body.createTextRange(),a.moveToElementText(e),a.select()):window.getSelection&&(a=document.createRange(),a.selectNode(e),s=window.getSelection(),s.removeAllRanges(),s.addRange(a)),t.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var t=this,e=0;e<arguments.length;e++)t=t.replace(new RegExp("\\{"+e+"\\}","g"),null==arguments[e]||void 0==arguments[e]?"":arguments[e]);return t};var pkMarketSocket=null,ChartFactory=window.Highcharts?function(){function t(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}function e(){var t=$(window).width();return 540>t?30:t>=540&&1080>t?40:80}var a={realtime:"1min","5min":"5min",hour:"1hour",day:"day"},s={ELEMENT_NOTFOUND:"没有指定画板元素",SERVICE_ERROR:"服务器出现错误",NOT_KEEP_WEBSOCKET_ERROR:"不支持websocket",NO_DATA:"没有数据"},i={line:function(t){for(var e=[],a=0;a<t.length;a++){var s=t[a],i=s.milliseconds,n=parseFloat(s.end);0==n?e.push({x:i,y:null}):e.push({x:i,y:n})}return e},candlestick:function(t){for(var e=[],a=0;a<t.length;a++){var s=t[a],i=s.milliseconds,n=parseFloat(s.high),o=parseFloat(s.low),r=parseFloat(s.end),l=parseFloat(s.begin);e.push([i,l,n,o,r])}return e}},n="",o=2;return null!=document.getElementById("symbol")&&"undefined"!=typeof document.getElementById("symbol")&&(n=document.getElementById("symbol").value),"XAGUSD"==n||"USDJPY"==n?o=3:("EURUSD"==n||"GBPUSD"==n||"AUDUSD"==n||"USDCHF"==n||"USDCAD"==n)&&(o=4),Highcharts.setOptions({global:{useUTC:!1}}),{pkSocket:null,closeSocket:function(){this.pkSocket&&this.pkSocket.close()},create:function(t,e,i){i&&i.show();var n=$.Deferred();if(!t||!t.length)return n.reject(s.ELEMENT_NOTFOUND),n.promise();var o={type:"post",dataType:"jsonp",jsonpCallback:"jsonpCallback",data:{kType:a.realtime}},r=this,l=$.extend(!0,{},o,e);return this.symbol=l.data.symbol,this.loadData(l).done(function(a){if(i&&i.hide(),!a||!a.code)return n.reject(s.SERVICE_ERROR);if("OK"!==a.code)return n.reject(s.SERVICE_ERROR);if(0==a.listResult.length)return n.reject(s.NO_DATA);var o=l.data.dataType,d=r.getChartType(o),a=r.parseData(a.listResult.reverse(),d,l);if(r.createChart(t,d,o,a),n.resolve(),e.wsUrl){if(e.wsParam+="&symbol="+e.data.symbol+"&dataType="+e.data.dataType,console.log("options.wsParam:"+e.wsParam),window.WebSocket||(window.WebSocket=window.MozWebSocket),!window.WebSocket)return n.reject(s.NOT_KEEP_WEBSOCKET_ERROR);try{ChartFactory.pkSocket?ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(e.wsParam):(ChartFactory.pkSocket=new ReconnectingWebSocket(e.wsUrl,null,{reconnectInterval:3e3}),ChartFactory.pkSocket.onmessage=function(a){var s=a.originalEvent?a.originalEvent.data:null;s&&(s=JSON.parse(s),"ok"==s.code.toLowerCase()&&s.condition&&s.condition.symbol==e.data.symbol&&s.condition.dataType==e.data.dataType&&s.listResult.length>0&&ChartFactory.add(t,s.listResult,time))},ChartFactory.pkSocket.onopen=function(t){ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(e.wsParam)})}catch(c){console.log("get kdata price has error!"+c)}}}),n.promise()},add:function(t,e,a){var s=this.getChartType(a);e=this.parseData(e,s),"line"===s?this.addPoint(t,e):this.addPoint(t,e)},parseData:function(t,e,a){var s=a&&a.parser&&a.parser[e]||i[e];return s(t)},getChartType:function(t){return t===a.realtime?"line":"candlestick"},createChart:function(t,e,a,s){"line"===e?this.createLineChart(t,s):"candlestick"==e&&this.createCandlestickChart(t,a,s)},createLineChart:function(t,e){var a={colors:["#b59130"],chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" 1min",position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{line:{dataGrouping:{enabled:!1},cropThreshold:300}},xAxis:{type:"datetime",tickLength:0,tickPixelInterval:70},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},opposite:!1,showLastLabel:!0,tickLength:0,lineWidth:1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var t=["<span>"+Highcharts.dateFormat("%Y-%m-%d %H:%M",this.x)+"</span><br/>"];return t.push("<span>价格:<strong>"+this.y+"</strong></span><br/>"),t.join("")}},series:[{name:"价位",type:"line",data:e}]};t.highcharts("StockChart",a)},addPoint:function(t,e){var a=t.highcharts();a.series[0].addPoint(e[0],!1),a.redraw()},createCandlestickChart:function(t,e,s){var i="%Y-%m-%d";e===a["5min"]?i="%Y-%m-%d %H:%M":e===a.hour&&(i="%Y-%m-%d %H:%M");var n={chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" "+e,position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{candlestick:{upColor:"#F00",upLineColor:"#F00",color:"#00a004",lineColor:"#00a004"}},xAxis:{type:"datetime",tickPixelInterval:70,tickLength:0,dateTimeLabelFormats:{day:"%m-%d",week:"%m-%d",month:"%y-%m"}},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},lineWidth:1,opposite:!1,showLastLabel:!0,endOnTick:!1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var t=this.points[0].point,e=["<span>"+Highcharts.dateFormat(i,this.x)+"</span><br/>"];return e.push("<span>开盘价:<strong>"+t.open+"</strong></span><br/>"),e.push("<span>最高价:<strong>"+t.high+"</span></span><br/>"),e.push("<span>最低价:<strong>"+t.low+"</strong></span><br/>"),e.push("<span>收盘价:<strong>"+t.close+"</strong></span><br/>"),e.join("")}},series:[{name:"价格",type:"candlestick",data:s}]};e===a.day&&(n.xAxis.datafor=[]),t.highcharts("StockChart",n)},loadData:function(s){var i=e(),n=s.data.dataType;return $.extend(s.data,{startTime:t(new Date),num:n===a.realtime?120:i,flag:0}),$.ajax(s)}}}():null;!function(t){t.fn.qqFace=function(e){var a={id:"facebox",path:"face/",assign:"content",zIndex:1e3,tip:""},s=t.extend(a,e),i=t("#"+s.assign),n=s.id,o=s.path,r=s.tip;return i.length<=0?(alert("缺少表情赋值对象。"),!1):void t(this).click(function(e){var a,i;if(t("#"+n).length<=0){if(a='<div id="'+n+'" class="facebox"><i class="arr"></i><div class="facecont">',a+='<table border="0" cellspacing="0" cellpadding="0"><tr>',navigator.userAgent&&/(iphone|ipod|ipad|android)/.test(navigator.userAgent.toLowerCase()))for(var l=1;45>=l;l++)i=o+r+l+".gif",a+='<td><img src="'+o+l+'.gif" tsg="'+s.assign+'" lf="'+i+'"/></td>',l%9==0&&(a+="</tr><tr>");else for(var l=1;75>=l;l++)i=o+r+l+".gif",a+='<td><img src="'+o+l+'.gif" tsg="'+s.assign+'" lf="'+i+'"/></td>',l%15==0&&(a+="</tr><tr>");a+="</tr></table></div></div>",t(this).parent().append(a),t(this).parent().find("img").click(function(){t("#"+t(this).attr("tsg")).insertAtCaret(t(this).attr("lf")),t(this).parents(".facebox").hide()})}else t("#"+n+":visible").length>0?t("#"+n).hide():t("#"+n).show();e.stopPropagation()})}}(jQuery),jQuery.fn.extend({insertAtCaret:function(t){t='<img src="'+t+'"/>';var e=$(this).get(0);e.innerHTML+=t,$(this).focusEnd()}});var indexJS={fromPlatform:null,isNeverLogin:!1,serverTime:0,towMinTime:0,socketUrl:"",userInfo:null,filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,syllabusData:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.setEvent(),this.setAdvertisement()},setEvent:function(){$(".header-right li").hover(function(){if($(this).find(".dropcont").show(),$(this).is(".cursor")){if(1==$(this).attr("ck")||!indexJS.syllabusData)return;indexJS.fillCourse(),_gaq.push(["_trackEvent","fx_studio","header_course","content_top",1,!0])}$(this).is(".notice")&&(indexJS.getArticleList("bulletin_system",indexJS.userInfo.groupId,1,1,1,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){if(t&&0==t.result){var e=t.data;if(e&&e.length>0){var a=e[0].detailList[0];$("#bulletinTab").find("strong").text(a.title),$("#bulletinTab").find("p").html(a.content)}}}),_gaq.push(["_trackEvent","fx_studio","header_bulletin","content_top",1,!0]))},function(){$(this).find(".dropcont").hide()}),0==$(".rooms .rbox").length&&$(".changeroom").hide(),$(".changeroom").click(function(){var t=$(this);if(t.hasClass("open"))t.removeClass("open");else{t.addClass("open");var e=t.attr("tm");if(!(common.isBlank(e)||indexJS.serverTime-Number(e)>=6e4))return;t.attr("tm",indexJS.serverTime);try{$.getJSON("/fxstudio/getRmCourseList",{roomIds:$(".rooms .rbox[rid]").map(function(){return $(this).attr("rid")}).get().join(",")},function(t){if(t&&t.isOK){var e=t.data,a=$(".rooms .rbox[rid]");a.each(function(t){t==a.length-1&&$(this).addClass("last");var s=$(this).attr("rid");if(e.hasOwnProperty(s)){var i=e[s],n=0;"true"==$(this).find(".enterbtn").attr("av")&&i.onlineNum<=200&&(n=i.onlineNum<=10?60:200/i.onlineNum*3+10,n=Math.round(n)),$(this).find(".peo_num label").text(i.onlineNum+n),common.isValid(i.name)&&($(this).find(".info .nk").text(i.name),i.isNext||$(this).addClass("on"),i.day&&$(this).find(".info .st").text(common.daysCN[i.day]+" "+i.startTime+" - "+i.endTime))}})}})}catch(a){console.error("getRmCourseList->"+a),callback(null)}}}),indexJS.setListScroll(".mod_room .cont"),$(document).click(function(t){(!$(t.target).parent().hasClass("roomctrl")&&!$(t.target).parents().parents().hasClass("rbox")||$(t.target).hasClass("enterbtn"))&&$(".changeroom").removeClass("open")}),$(".rooms .rbox[rid] .enterbtn").click(function(){var t=$(this),e=$(this).attr("cgs");return"false"==t.attr("av")&&indexJS.checkClientGroup("visitor")?($("#login_a").trigger("click",{groupId:t.attr("rid")}),!1):common.containSplitStr(e,indexJS.userInfo.clientGroup)?void common.getJson("/fxstudio/checkGroupAuth",{groupId:t.attr("rid")},function(t){t.isOK?indexJS.toRefreshView():indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户才可进入Vip专场，您还不满足条件。如有疑问，请联系老师助理。")},!0,function(t){"success"!=t&&alert("操作失败，请联系客服！")}):(indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户才可进入Vip专场，您还不满足条件。如有疑问，请联系老师助理。"),!1)}),$(".mod_main .tabnav a").click(function(){var t=$(this).index(),e=$(".mod_main .tabcont .main_tab").eq(t);if($(".mod_main .tabnav a").removeClass("on"),$(this).addClass("on"),$(".mod_main .tabcont .main_tab").removeClass("on").eq(t).addClass("on"),1==t){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var a="information_count",s=store.get(a),i={};common.isBlank(s)?i.lastDateTime=null:i=s;var n=$("#newInfoCount").attr("pt");if($.trim(i.lastDateTime)!=$.trim(n))return i.lastDateTime=n,store.set(a,i),void $("#newInfoCount").hide();indexJS.setInformation()}2==t&&indexJS.setTradeStrategy(e.find(".scrollbox")),0==t&&chat.setTalkListScroll(!0)}),$("#qqcs").click(function(){live800Prompt(2,"")}),$("#saveToDesktop").click(function(){common.saveToDesktop(window.location.href,"在线教育-金道贵金属")?box.showMsg("在线教育快捷方式已成功添加到桌面"):window.location.href="/fxstudio/getShortCut?t="+(new Date).getTime()}),$("#modifyAvatar").click(function(){var t=$("#fileForm"),e=t.find("input[type=file]");"true"!=t.attr("hasEv")&&(t.attr("hasEv","true"),e.change(function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var a=e.size;if(a>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var s=new FormData($("#fileForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:s,async:!1,cache:!1,contentType:!1,processData:!1,success:function(e){if(0==e.result){var a=e.data?e.data[0]:null;a&&common.getJson("/fxstudio/modifyAvatar",{avatar:a.fileDomain+a.filePath},function(e){e.isOK?($("#avatarInfoId").attr("src",e.avatar),$("#userListId li .mynk").prev().find("img").attr("src",e.avatar),indexJS.userInfo.avatar=e.avatar,
t.val("")):console.error("上传头像失败，请联系在线客服！")},!0,function(){alert("上传头像失败，请联系在线客服！")})}else alert("上传头像失败，请联系在线客服！")},error:function(t){console.error("error:",t)}})}catch(i){console.error("上传图片失败",i)}})),e.click()}),this.placeholderSupport()},fillCourse:function(){var t=indexJS.syllabusData&&indexJS.syllabusData.courses;if(t){for(var e,a={0:"文字在线",1:"视频在线",2:"oneTV在线"},s=t.days,i=t.timeBuckets,n=$(".course_nav").html(""),o="",r="",l=new Date(indexJS.serverTime).getDay(),d=indexJS.serverTime-864e5*((l+6)%7),c=100/s.length,u=0,h=s.length;h>u;u++){o=0==u?"fir":u==h-1?"last":"nct",r=s[u].day==l?" on":"",e=common.formatterDate(new Date(d+(s[u].day+6)%7*864e5)).substring(5),n.append('<a href="javascript:" class="'+o+r+'" t="'+u+'" style="width:'+c+'%;"><span>'+common.daysCN[s[u].day+""]+"<b>"+e+"</b></span><i></i></a>"),$(".cursor .dropcont .cont").append('<div class="course_tab'+r+'" t="'+u+'" d="'+s[u].day+'"><ul></ul></div>'),o="";var p=$(".cursor .course_tab:last ul"),m=null;if(1!=s[u].status)p.append('<li class="fir"><a href="javascript:"><span><lable>休市</lable></span></a></li>');else{o="fir";for(var f=0,g=i.length;g>f;f++)m=i[f].course[u],0!=m.status&&m.lecturer&&(p.append('<li class="'+o+'"><a href="javascript:" st="'+i[f].startTime+'" et="'+i[f].endTime+'"><i></i><span><lable>'+i[f].startTime+"- "+i[f].endTime+"　</lable><lable>"+a[m.courseType]+"　</lable><lable>"+m.lecturer+"</lable></span><p>"+m.title+"</p></a></li>"),o="")}}$(".course_nav a").click(function(){$(".course_nav a").removeClass("on"),$(".course_tab").removeClass("on"),$(this).addClass("on"),$(".course_tab[t="+$(this).attr("t")+"]").addClass("on")}),$(".header-right li.cursor").attr("ck",1)}},toRefreshView:function(){window.location.reload()},checkClientGroup:function(t){var e=this.userInfo.clientGroup,a=!1;switch(t){case"visitor":a="visitor"==e;break;case"vip":a="vip"==e||"active"==e;break;case"new":a="vip"!=e&&"active"!=e}return a},serverTimeUp:function(){indexJS.fillCourse(),videos.init().clientVideoTask(),indexJS.setInformation(),this.towMinTime=this.serverTime,setInterval(function(){indexJS.serverTime+=1e3,indexJS.serverTime-indexJS.towMinTime>=12e4&&(indexJS.towMinTime=indexJS.serverTime,videos.clientVideoTask(),indexJS.setInformation())},1e3)},refreshNickname:function(t,e){this.userInfo.isSetName=t,this.userInfo.nickname=e,$(".username").text(e),$("#userListId li .mynk").text(e+"【我】")},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfo_"+this.userInfo.groupType,e=store.get(t),a={};if(common.isBlank(e)){var s=common.randomNumber(6);a.clientStoreId=(new Date).getTime()+"_"+s,a.userId="visitor_"+s,a.nickname="游客_"+s,a.userType=-1,store.set(t,a)}else a=e;this.userInfo.clientStoreId=a.clientStoreId,this.userInfo.visitorId=a.userId,this.userInfo.loginId=a.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=a.nickname,this.userInfo.userId=a.userId,this.visitorSpeak||$("#contentText").attr("contenteditable",!1).append('<div class="lgtip">亲，<a href="javascript:box.openLgBox();">登录</a> 后可以发言哦~</div>')):(a.loginId=this.userInfo.userId,store.set(t,a)),this.isNeverLogin=!common.isValid(a.loginId),common.isBlank(this.userInfo.nickname)&&"visitor"!=this.userInfo.clientGroup&&this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12))},setScrollStyle:function(t){t.find(".mCSB_dragger_bar").css({background:"url(/fx/theme1/img/scroll.png) -10px 50% repeat-y",width:"6px","-webkit-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px"})},setListScroll:function(t,e){var a="object"==typeof t?t:$(t);a.hasClass("mCustomScrollbar")?a.mCustomScrollbar("update"):(e=$.extend({scrollButtons:{enable:!1},theme:"light-2",isCustom:!0},e),a.mCustomScrollbar(e),e.isCustom&&this.setScrollStyle(a))},getArticleList:function(t,e,a,s,i,n,o,r){try{$.getJSON("/fxstudio/getArticleList",{authorId:common.trim(o),code:t,platform:e,hasContent:a,pageNo:s,pageSize:i,orderByStr:n},function(t){r(t)})}catch(l){console.error("getArticleList->"+l),r(null)}},getArticleInfo:function(t,e){try{$.getJSON("/fxstudio/getArticleInfo",{id:t},function(t){e(t)})}catch(a){console.error("getArticleInfo->"+a),e(null)}},setAdvertisement:function(){this.getArticleList("advertisement",indexJS.userInfo.groupId,"0",1,5,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){if(t&&0==t.result){var e=t.data;for(var a in e)$(".ban_ul").append('<li class="swiper-slide"><a href="'+(common.isBlank(e[a].linkUrl)?"javascript:":e[a].linkUrl)+'" target="_blank"><img width="100%" alt="" src="'+e[a].mediaUrl+'"></a></li>'),e.length>1&&$("#mod_position").append('<span class="'+(0==parseInt(a)?"p-click":"")+'"></span>');e&&e.length>1&&new Swiper(".mod_banner",{pagination:"#mod_position",paginationClickable:!0,loop:!0,autoplay:5e3,autoplayDisableOnInteraction:!1})}})},setInformation:function(){var t=$(".mod_main .tabcont .main_tab").eq(1).find(".scrollbox"),e=$("#newInfoCount").attr("t");!common.isBlank(e)&&indexJS.serverTime-e<12e4||$.getJSON(indexJS.apiUrl+"/common/getInformation?t="+indexJS.serverTime,null,function(e){if(e&&e.isOK){var a=e.data.news.item.length,s=$("#newInfoCount").attr("pt");common.isBlank(s)||($("#newInfoCount").text(a),$("#newInfoCount").hide());var i=null,n="",o=indexJS.formatHtml("news");$.each(e.data.news.item,function(t,e){s!=e.pubDate||common.isBlank(s)?e.pubDate>s&&t+1==a&&!common.isBlank(s)&&($("#newInfoCount").text(a),$("#newInfoCount").show()):t>0?($("#newInfoCount").text(t),$("#newInfoCount").show()):$("#newInfoCount").hide(),1>t&&(i=e.pubDate),(e.pubDate>s||common.isBlank(s))&&(n+=o.formatStr(e.pubDate.substring(10),e.title))}),common.isValid(n)&&$(".mod_main .message_list .scrollbox ul").prepend(n),s==i&&$("#newInfoCount").hide(),indexJS.setListScroll(t),$("#newInfoCount").attr("pt",i),$(".mod_main .tabcont .main_tab").eq(1).hasClass("on")&&$("#newInfoCount").attr("t",indexJS.serverTime).hide()}})},setTradeStrategy:function(t){this.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var a=e.data,s=null,i="",n=indexJS.formatHtml("tradestrategy");for(var o in a){s=a[o].detailList[0];var r="",l="";if(common.isBlank(s.author))r=s.authorInfo.name,l=s.authorInfo.avatar;else{var d=s.author.split(";");r=d[0],l=d[1]}var c=common.formatterDateTime(a[o].publishStartDate,"-").substring(0,16);i+=n.formatStr(l,r,c,s.tag,s.title,s.content)}$("#guidelist ul").html(i)}else $("#guidelist ul").html("");indexJS.setListScroll(t)})},placeholderSupport:function(){var t="placeholder"in document.createElement("input");t||$(".formcont .in_line input[placeholder]").each(function(){var t=$(this).attr("placeholder");if(t){var e=$(this),a=$('<span class="placeholder">'+t+"</span>");e.before(a),a.bind("click",function(){$(this).hide(),$(this).next().focus()}),e.bind("focus",function(){$(this).prev().hide()}),e.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=e[0].defaultValue&&e.prev().hide(),$(this).attr("placeholder","")}})},formatHtml:function(t){var e=[];switch(t){case"tradestrategy":e.push('<li class="guideli">'),e.push('    <div class="line1 clearfix">'),e.push('        <img class="himg" src="{0}" alt="{1}">'),e.push('        <h4 class="name">{1}<span class="timespan">{2}</span></h4>'),e.push('        <span class="tag"><i></i>{3}</span>'),e.push("    </div>"),e.push('    <h4 class="gtit"><strong><a href="" target="_blank" class="taglink"></a></strong>{4}</h4>'),e.push('    <div class="g_cont">'),e.push("    <p>{5}</p>"),e.push("    </div>"),e.push("</li>");break;case"news":e.push("<li><span><i></i><b>{0} </b>{1}</span></li>")}return e.join("")}};$(function(){indexJS.init()});var videos={blwsPlayer:null,newMarIntervalId:0,init:function(){return this.setEvent(),this.setVideoList(null,!0),this},setVideoList:function(t,e){if(e){var a=$("#teachVideoId").children().map(function(){return $(this).attr("t")}).get();t=a[common.randomIndex(a.length)]}var s=$("#teachVideoId div[t="+t+"] ul");s.find("li").length>0||(s.html(""),indexJS.getArticleList(t,indexJS.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){if(t&&0==t.result){var a=t.data,i=null;for(var n in a)i=a[n].detailList[0],s.append('<li title="'+i.title+'"><a href="javascript:" ct="'+a[n].categoryId+'" id="'+a[n]._id+'" t="'+(common.isValid(a[n].mediaUrl)&&-1!=a[n].mediaUrl.indexOf(".mp4")?"mp4":"")+'" vUrl="'+a[n].mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'fx_studio', 'video_play',$(this).text()]);\"><i></i>"+i.title+"</a></li>");indexJS.setListScroll(s,{isCustom:!1,theme:"minimal-dark"}),$("#teachVideoId li a").click(function(){$("#teachVideoId li a.on").removeClass("on"),$(this).addClass("on"),$(".max_box").show();var t=$(".min_box").attr("vid",this.id).hide();t.find(".v_cate").text($(this).parents(".cate_box").find(".cate_name").text()),t.find(".v_name label").text($(this).text()),videos.setVideo($(this));var e=$(this).attr("id");$("#tvInfoId").attr("tid")!=e&&(indexJS.getArticleInfo(e,function(t){if(t){$("#tvInfoId").attr("tid",t._id);var e=t.detailList[0];$("#tvInfoId p.remark").text(e.remark),$("#tvInfoId p.content").text(e.seoDescription);var a=$("#tvInfoId .te_detail"),s=e.authorInfo;s&&(a.find("strong").attr("uid",s.userId).text(s.name),a.find(".rcont i").text(s.position),a.find("img").attr("src",s.avatar),a.find("img").attr("src",s.avatar))}}),indexJS.setListScroll("#tvInfoId"),chatAnalyze.setUTM(!1,{courseId:e}))})}e&&videos.playVideoByDate(!0)}))},setVdTab:function(t){t?(window.SewisePlayer&&SewisePlayer.doStop(),$("#tvDivId").hide().find("iframe").remove(),$(".listcont .list_tab:first,#vdTabId a:first").addClass("on"),$(".listcont .list_tab:eq(1),#vdTabId a:eq(1)").removeClass("on"),$("#lvDivId").show()):($(".listcont .list_tab:first,#vdTabId a:first").removeClass("on"),$(".listcont .list_tab:eq(1),#vdTabId a:eq(1)").addClass("on"),$("#tvDivId").show(),$("#lvDivId").hide())},playMp4Vd:function(t){var e=$("#teachVideoId a[class=on]");if(t||e.length<=0){var a=$("#teachVideoId li a[t=mp4]"),s=null;a.length<=0?s=$("#teachVideoId li:first a"):(s=$(a.get(common.randomIndex(a.length))),$("#teachVideoId div[t="+s.attr("ct")+"] ul").mCustomScrollbar("scrollTo","#"+s.attr("id"))),s.click(),$("#teachVideoId .cate_box").removeClass("show"),s.parents(".cate_box").addClass("show")}else e.click()},setVdMaxBox:function(){$(".max_box").is(":hidden")||$(".max_box").slideUp(1e3,function(t){$(".min_box").fadeIn("fast")})},setEvent:function(){$(".max_box").hover(function(){},function(){videos.setVdMaxBox()}),$("#vdTabId a").click(function(){$("#vdTabId a").removeClass("on"),$(this).addClass("on");var t=$(this).index();if($(".listcont .list_tab").removeClass("on").eq(t).addClass("on"),2==t)videos.sd.initSD();else{var e=$(".mod_video").hide().eq(t);e.show(),0==t?videos.playVideoByDate(!1):(videos.playMp4Vd(),videos.setVdMaxBox())}}),$("#vdLs_min,#vdLs_max").click(function(){"vdLs_min"==this.id?($(".min_box").hide(),$(".max_box").show()):($(".max_box").hide(),$(".min_box").show())}),$("#tvDivId").hover(function(){$(".max_box").is(":hidden")&&$(".min_box,.v_cate,.v_name").show()},function(){$(".max_box,.min_box").hide()}),$("#teachVideoId .cate_name").click(function(){$("#teachVideoId .cate_box").removeClass("show"),videos.setVideoList($(this).parent().addClass("show").attr("t"))}),videos.sd.setSDEvent(),this.bindEventRollNews()},clientVideoTask:function(){var t=$("#lvDivId embed").attr("src");$("#lvVideoId").is(":visible")&&t&&-1==t.indexOf("yy.com")&&0==$("#lvVideoId").find("object").length&&videos.playVideoByDate(!1)},playVideoByDate:function(t){var e=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);!e||0!=e.courseType&&common.isBlank(e.studioLink)||e.isNext||0==e.courseType?(t?e&&!e.isNext&&0==e.courseType?(this.setVdTab(!0),this.setStudioInfo(e),this.setStudioTip(!0)):(this.setVdTab(!1),this.playMp4Vd(),this.synCourseStyle(null)):this.setStudioInfo(e),this.newsMarquee(!1)):(this.setVdTab(!0),this.setStudioVideoDiv(e.studioLink,e.courseType),this.setStudioInfo(e),this.setStudioTip(2!=e.courseType),this.synCourseStyle(e),this.newsMarquee(1==e.courseType))},synCourseStyle:function(t){$(".course_tab li a").removeClass("on"),t&&$(".course_tab[d="+t.day+"]").find('li a[st="'+t.startTime+'"][et="'+t.endTime+'"]').addClass("on")},setStudioTip:function(t){t?$(".mod_room .titbar > span i").removeClass("off").addClass("on"):$(".mod_room .titbar > span i").removeClass("on").addClass("off")},setNextCourse:function(t,e){if(t){var a="当前暂无在线视频，请关注下节课";t.isNext||0!=t.courseType||(a="文字在线时间"),$("#nextCourse").find(".ntext").text(a),$("#nextCourse .nextbox").show(),$("#nextCourse").find("img").attr("src",e.avatar),$("#nextCourse").find(".t_name").text(e.name),$("#nextCourse").find(".live_name").text(t.title),$("#nextCourse").find(".time").text(common.daysCN[t.day]+" "+t.startTime+" - "+t.endTime)}$("#lvVideoId").hide(),$("#nextCourse").show()},getEmbedDom:function(t){return'<embed src="'+t+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'},setStudioVideoDiv:function(t,e){if($("#nextCourse").hide(),$("#lvVideoId").show().html(""),-1!=t.indexOf("rtmp")){var a=/(.*)\/([0-9]+)$/g.exec(t);if(!a||a.length<3)return;flowplayer("lvVideoId","/base/lib/flowplayer/flowplayer.swf",{clip:{url:a[2],provider:"rtmp",live:!0},plugins:{rtmp:{proxyType:"best",url:"/base/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:"rtmps://5748416443938.streamlock.net/live"}},onError:function(t){}})}else $("#lvVideoId .img-loading").fadeIn(0).delay(2e3).fadeOut(200),$(videos.getEmbedDom(t)).appendTo("#lvVideoId")},bindEventRollNews:function(){$(".mod_scrollnews .newsclose").click(function(){$(".mod_scrollnews .newslist").hide(),$(".mod_scrollnews .newsbtn").show(),clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null}),$(".mod_scrollnews .newsbtn").click(function(){$(this).hide(),$(".mod_scrollnews .newslist").slideDown(),videos.newsMarquee(!0)}),$("#newscont1 a").live("click",function(){return"false"===$(this).attr("url")?($("#popMsgTit").text($(this).attr("title")),$("#popMsgTxt").html($(this).data("content")||"没有内容"),$("#popMsgBox,.blackbg").show(),indexJS.setListScroll(".popMsgBox"),!1):void 0}),$("#newscont2 a").live("click",function(){return"false"===$(this).attr("url")?($("#newscont1 a[tid='"+$(this).attr("tid")+"']").trigger("click"),!1):void 0})},rollNews:function(t){var e=$("#newscont1");if(t["delete"]){var a=t.ids.split(",");if(a.length>0)for(var s=0;s<a.length;s++)e.find('a[tid="'+a[s]+'"]').remove()}else if(t.edit){t.isValid="true"==t.isValid?!0:!1,!t.isValid||indexJS.userInfo.clientGroup&&t.clientGroup&&-1!=$.inArray(indexJS.userInfo.clientGroup,t.clientGroup)||(t.isValid=!1);var i=e.find('a[tid="'+t.id+'"]');if(t.isValid)if(i.size()>0)common.isValid(t.url)?i.attr({title:t.title,href:t.url,url:"true"}).html("<i></i><span>"+t.title+"</span>"):i.attr({title:t.title,url:"false"}).html("<i></i><span>"+t.title+"</span>").data("content",t.content);else{var n=$('<a href="javascript:void(0);" tid="'+t.id+'" title="'+t.title+'" target="_blank"><i></i><span>'+t.title+"</span></a>");common.isValid(t.url)?n.attr({href:t.url,url:"true"}):n.attr({url:"false"}).data("content",t.content),e.append(n)}else i.size()>0&&i.remove()}else if(t.infos){var o=t.infos.length,n=null;if(o>0)for(var s=0;o>s;s++)indexJS.userInfo.clientGroup&&t.infos[s].clientGroup&&$.inArray(indexJS.userInfo.clientGroup,t.infos[s].clientGroup)>-1&&1==t.infos[s].pushType&&t.infos[s].contentId&&t.infos[s].title&&(common.isValid(t.infos[s].url)?n=$('<a href="'+t.infos[s].url+'" url="true" tid="'+t.infos[s].contentId+'" title="'+t.infos[s].title+'" target="_blank"><i></i><span>'+t.infos[s].title+"</span></a>"):(n=$('<a href="javascript:void(0);" url="false" tid="'+t.infos[s].contentId+'" title="'+t.infos[s].title+'" target="_blank"><i></i><span>'+t.infos[s].title+"</span></a>"),n.data("content",t.infos[s].content)),e.append(n))}this.newsMarquee(!0)},newsMarquee:function(t){videos.newMarIntervalId&&(clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null);var e=30,a=$(".mod_scrollnews"),s=$("#scrollnews_demo")[0],i=$("#newscont1"),n=$("#newscont2");if(t&&i.children().size()>0?a.show():a.hide(),n.html(""),$(s).unbind("mouseover mouseout"),t){i.css("width","auto"),n.css("width","auto");var o=a.width()-27;i.width()<o&&(i.css("width",o),n.css("width",o)),n.html(i.html());var r=function(){i.width()-s.scrollLeft<=0?s.scrollLeft-=i.width():s.scrollLeft++};videos.newMarIntervalId=window.setInterval(r,e),$(s).bind("mouseover",function(){window.clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null}).bind("mouseout",function(){videos.newMarIntervalId&&(window.clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null),videos.newMarIntervalId=window.setInterval(r,e)})}},setStudioInfo:function(t){if(!t)return $("#nextCourse").find(".ntext").text("当前暂无在线视频"),void $("#nextCourse .nextbox").hide();var e=$("#lvInfoId").attr("dy"),a=$("#lvInfoId").attr("st"),s=$("#lvInfoId").attr("et");return e==t.day&&a==t.startTime&&s==t.endTime?void((t.isNext||0==t.courseType)&&videos.setNextCourse(null)):($.getJSON("/fxstudio/getCourseInfo",{day:t.day,startTime:t.startTime,endTime:t.endTime,authorId:t.lecturerId},function(e){$("#lvInfoId").attr("dy",t.day).attr("st",t.startTime).attr("et",t.endTime),$("#lvInfoId .intro p").text(e.remark),indexJS.setListScroll("#lvInfoId");var a=$("#lvInfoId .te_list").html(""),s=e.authors,i=null;for(var n in s)i=s[n],a.append('<div class="te_detail" uid="'+i.userId+'"><img src="'+i.avatar+'" alt=""><div class="rcont"><span><strong>'+i.name+"</strong><i>"+i.position+'</i></span> <a href="javascript:" class="support" uid="'+i.userId+'"><label>'+i.praiseNum+"</label><i>+1</i></a> </div> </div>");var o=$(".te_detail .support");"true"!=o.attr("initEvent")&&o.attr("initEvent","true").click(function(){var t=$(this);try{common.getJson("/fxstudio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:t.attr("uid")},function(e){if(e.isOK){t.find("i").fadeIn().delay(400).fadeOut();var a=t.find("label");a.text(common.isValid(a.text())?parseInt(a.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");t.addClass("supported"),t.attr("title","已点赞")},!0)}catch(e){console.error("setPraise->"+e)}}),(t.isNext||0==t.courseType)&&videos.setNextCourse(t,s&&s.length>0?s[0]:{avatar:"",name:""})}),void indexJS.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,1,'{"createDate":"desc"}',"",function(t){if(t&&0==t.result&&t.data&&t.data.length>0){var e=t.data[0],a=e.detailList[0];$("#lvInfoId p.content").html(a.content),indexJS.setListScroll("#lvInfoId")}else $("#lvInfoId p.content").html("亲，老师还未发布观点哦")}))},setVideo:function(t){try{this.setStudioTip(!1),$("#lvVideoId").html("");var e=t.attr("vUrl"),a=t.text();if(-1!=e.indexOf(".html")){window.SewisePlayer&&SewisePlayer.doStop();var s=$("#tVideoId iframe"),i=!0;s.size()>0&&(s.attr("src")==e?i=!1:s.remove()),i&&$("#tVideoId").append('<iframe frameborder=0 width="100%" height="100%" src="'+e+'" allowfullscreen></iframe>')}else if($("#tVideoId iframe").remove(),-1!=e.indexOf("type=blws")){var n=e.split("&");if(n.length>1){var o=n[1].replace(/^vid=/g,"");videos.blwsPlayer?videos.blwsPlayer.changeVid(o):videos.blwsPlayer=polyvObject("#tVideoId").videoPlayer({width:"100%",height:"100%",vid:o,flashvars:{autoplay:"0",setScreen:"fill"},onPlayOver:function(t){}})}}else if(window.SewisePlayer)SewisePlayer.toPlay(e,a,0,!0);else{var r=[];r.push("/base/lib/sewise.player.min.js?server=vod"),r.push("type="+(-1!=e.indexOf(".flv")?"flv":"mp4")),r.push("videourl="+e),r.push("autostart=true"),r.push("title="+a),r.push("buffer=5");var l=r.join("&"),d=document.createElement("script");d.type="text/javascript",d.src=l,$("#tVideoId").get(0).appendChild(d);var c=function(){return window.SewisePlayer?void SewisePlayer.onPause(function(t){if(SewisePlayer.duration()<=SewisePlayer.playTime()){var e=$("#teachVideoId li a.on"),a=e.parent().next().find("a");a.length<=0?videos.playMp4Vd(!0):a.click()}}):void window.setTimeout(c,500)};c()}}catch(u){console.error("setVideo has error:"+u)}},sd:{analyst:null,tradeList:[],loadAll:!1,setSDEvent:function(){$("#sdNoAuthBox .aid_chat span").bind("click",function(){$("#sdNoAuthBox .pop_close").trigger("click");var t=$(this).attr("uid"),e=$("#userListId li[id='"+t+"']");0==e.size()&&(e=$("#userListId li[utype='3']:first")),e.find("em").trigger("click")})},initSD:function(){var t=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);!t||!t.lecturerId||videos.sd.analyst&&-1!=t.lecturerId.indexOf(videos.sd.analyst.userNo)||$.getJSON("/fxstudio/getShowTradeInfo",{userNo:t.lecturerId},function(t){t&&t.analyst&&(videos.sd.analyst=t.analyst,videos.sd.tradeList=t.tradeList||[],videos.sd.loadAll=!1,$("#sdInfoId .nosd_tip").hide(),videos.sd.showPraiseInfo(),videos.sd.showSDInfo())})},showPraiseInfo:function(){$("#sdInfoId .te_info").empty();var t=this.analyst;$("#sdInfoId .te_info").append('<div class="te_detail sd" uid="'+t.userNo+'"><img src="'+t.avatar+'" alt=""><div class="rcont"><span><strong>'+t.userName+'</strong><i class="suc">TA的胜率：<b>'+(t.winRate||"--")+'</b></i></span> <a href="javascript:" class="support" uid="'+t.userNo+'"><label>'+t.praiseNum+"</label><i>+1</i></a> </div> </div>"),$("#sdInfoId .te_detail .support").click(function(){var t=$(this);try{common.getJson("/fxstudio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:t.attr("uid")},function(e){if(e.isOK){t.find("i").fadeIn().delay(400).fadeOut();var a=t.find("label");a.text(common.isValid(a.text())?parseInt(a.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");t.addClass("supported"),t.attr("title","已点赞");var s=$("#lvInfoId .te_detail .support[uid='"+videos.sd.analyst.userNo+"']");s.find("label").text(t.find("label").text()),s.addClass("supported"),s.attr("title","已点赞")},!0)}catch(e){console.error("setPraise->"+e)}})},showSDInfo:function(){this.showWXInfo(),$("#sdInfoId .sd_ul").empty(),this.showTradeList()},showWXInfo:function(){var t=[];this.analyst.wechatCode&&(t.push('<div class="te_wx">'),t.push('<div class="wx-qrcode">'),this.analyst.wechatCodeImg&&t.push('<img src="'+this.analyst.wechatCodeImg+'" alt="'+this.analyst.wechatCode+'">'),t.push("</div>"),t.push('<span class="wx-num">老师微信号: <b>'+this.analyst.wechatCode+"</b></span>"),t.push("</div>"),$("#sdInfoId .te_info").append(t.join("")))},showTradeList:function(){if(videos.sd.loadAll)return!1;for(var t=$("#sdInfoId .sd_ul li").size(),e=videos.sd.tradeList,a=e?e.length:0,s=null,i=[],n=indexJS.checkClientGroup("new"),o=!1,r=t;a>r&&t+6>r;r++)s=e[r],o=!s.profit,i.push('<li><div class="cont">'),i.push('<div class="sd_tit">'),i.push('<span class="dep">'),o?i.push("持仓中"):(i.push("获利："),i.push("<b"+(/^-/.test(s.profit)?' class="fall"':"")+">"+s.profit+"</b>")),i.push("</span>"),i.push('<span class="sdtime">晒单时间: '+common.formatterDateTime(s.showDate).substring(5,16)+"</span>"),i.push("</div>"),n&&o?(i.push('<a href="javascript:videos.sd.showAuthBox()">'),i.push('<img src="/fx/theme1/img/sd_default.png"></a>')):(i.push('<a href="'+s.tradeImg+'" data-lightbox="sd-img" data-title="'+(o?"持仓中":"获利："+s.profit)+'">'),i.push('<img src="'+s.tradeImg+'"></a>')),i.push("<i></i></div></li>");r>=a-1&&(videos.sd.loadAll=!0),$("#sdInfoId .sd_ul").append(i.join("")),indexJS.setListScroll($("#sdInfoId .sd_show"),{callbacks:{onTotalScroll:videos.sd.showTradeList}})},showAuthBox:function(){var t=$("#userListId li[utype='3']:first");0==t.size()?$("#sdNoAuthBox .sdzl").hide():($("#sdNoAuthBox .sdzl").show(),$("#sdNoAuthBox .aid_chat img").attr("src",t.find(".headimg img").attr("src")),$("#sdNoAuthBox .aid_chat span").attr("uid",t.attr("id")).text(t.find(".uname span:first").text())),$("#sdNoAuthBox,.blackbg").show()}}},chat={socket:null,whPushObj:{},whTipInterId:null,pushInfoTimeOutId:null,msgType:{text:"text",img:"img",file:"file"},init:function(){this.setEvent(),this.setUserListIdEmpty(),this.getCSList(),this.setSocket(),this.setTalkListScroll(!0)},setEvent:function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&$("#msgFaceBtn").qqFace({id:"faceId",assign:"contentText",path:indexJS.filePath+"/face/"}),$(document).click(function(t){$("div[id^=faceId]").hide(),$(t.target).hasClass("headimg")||$(t.target).parents().hasClass("headimg")||"header"==$(t.target).parent().attr("t")||$(t.target).hasClass("uname")||$(t.target).parents().hasClass("te_ul")||$(".dialogbtn").hide()}),$(".replybtn").click(function(){var t=$(this);chat.setDialog(t.attr("uId"),$(".sender").html(),t.attr("ts"),t.attr("futype")),$(".mymsg em").show()}),$("#mymsgClose").click(function(){$(".mymsg,.mymsg em").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),chat.setTalkListScroll()}),$(".scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),chat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),chat.showViewSelect($(this).attr("t")),chat.setTalkListScroll(!0))}),$("#contentText").pastableTextarea().on("pasteImage",function(t,e){var a=$(this).find(".text-min-img");a.length>0?(a.attr("href",e.dataURL),a.find("img").attr("src",e.dataURL)):($(this).append('<a class="text-min-img" href="'+e.dataURL+'" data-lightbox="send-img"><img src="'+e.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(t){var e=$(this).html();if(13==t.keyCode)return common.isValid(e)&&($(this).html(e.replace(/<div>|<\/div>/g,"")),$(".ui-autocomplete").is(":hidden")&&$("#sendBtn").click()),!1;if(8==t.keyCode){var a=$(this).find(".txt_dia");if($.trim($(this).text())==a.text())return a.remove(),$(this).html(""),!0}}).autocomplete({source:function(t,e){/^@.*$/g.test(t.term)&&(e(chat.searchUserList(t.term.substring(1,t.term.length))),$(".ui-autocomplete").css("z-index","10000000"))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(t,e){return $("#contentText").html("").append('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e.item.value+'" utype="'+e.item.userType+'">@<label>'+e.item.label+"</label></span>&nbsp;").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(t,e){return $("<li>").attr("data-value",e.label).append("<a>"+e.label+"</a>").appendTo(t)},$("#sendBtn").click(function(){if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();if(indexJS.userInfo.isSetName===!1)return void box.openSetNameBox();var t=chat.getToUser(),e=$("#contentText .text-min-img img");if(e.size()>0){var a=e.attr("src");if(a.length>1048576)alert("发送的图片大小不要超过1MB.");else{chat.setUploadImg(a,t),e.remove();var s=$(".replybtn");t&&t.userId==s.attr("uid")&&t.talkStyle==s.attr("ts")&&$(".mymsg,.mymsg em").hide()}}var i=chat.getSendMsg();if(i!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:i}},s=$(".replybtn");t&&t.userId==s.attr("uid")&&t.talkStyle==s.attr("ts")&&$(".mymsg,.mymsg em").hide(),n.fromUser.toUser=t,chat.socket.emit("sendMsg",n),chat.setContent(n,!0,!1),$("#contentText").html(""),chatAnalyze.setUTM(!1,{speakCount:1})}}),$("#sendImgBtn").click(function(){return FileReader?!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor")?void box.openLgBox():indexJS.userInfo.isSetName===!1?void box.openSetNameBox(!0):void $("#sendImgInp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#sendImgInp").bind("change",function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var a=e.size;if(a>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var s=new FileReader;s.readAsDataURL(e),s.onload=function(t){chat.setUploadImg(t.target.result,chat.getToUser())},s.onprogress=function(t){},s.onloadend=function(t){},$(this).val("")}),$(".pletter_win").css({top:$(window).height()/2-218,left:$(window).width()/2-310}).draggable({handle:".wh_drag",cursor:"move",containment:"document",scroll:!1})},setUploadImg:function(t,e){var a=chat.getUiId(),s={};common.copyObject(s,indexJS.userInfo,!0),s.toUser=e;var i={uiId:a,fromUser:s,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};e&&1==e.talkStyle?this.setWhContent(i,!0,!1):this.setContent(i,!0,!1),i.content.value=t,this.zipImg(i,100,60,function(t,e){if(t.error)return alert(t.error),$("#"+a).remove(),!1;var s=$("#"+t.uiId+" span[contt='a'] a");s.attr("href",e).children("img").attr("src",e).attr("needMax",t.content.needMax),chat.dataUpload(t)})},zipImg:function(t,e,a,s){var i=new Image;i.onload=function(){var n=document.createElement("canvas");n||s({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var o=i.width,r=i.height;if(r>=9*o)return s({error:"该图片高度太高，暂不支持发送！"}),!1;e>0&&(r>e||o>e)&&(t.content.needMax=1,r>e&&e>=o?(o=e/r*o,r=e):(r=e/o*r,o=e),i.height=r,i.width=o);var l=n.getContext("2d");n.width=o,n.height=r,l.clearRect(0,0,n.width,n.height),l.drawImage(i,0,0,o,r),s(t,n.toDataURL("image/jpeg",a/100))},i.src=t.content.value},dataUpload:function(t){var e=new XMLHttpRequest;e.open("POST","/fxstudio/uploadData"),e.addEventListener("progress",function(e){if(e.lengthComputable){var a=(e.loaded/e.total*100|0)+"%";$("#"+t.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+t.uiId+" .shadow-conut").html(a)}},!1),e.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&console.log("dataUpload success!")},t.fromUser.socketId=this.socket.id,e.send(JSON.stringify(t))},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getCSList:function(){var t=LoginAuto.sessionUser.groupType,e=LoginAuto.sessionUser.groupId;try{$.getJSON("/"+t+"/getCS",{groupId:e},function(t){if(t){var e=null;for(var a in t)e=t[a],e.nickname=e.userName,e.userId=e.userNo,e.sequence=3,e.userType=3,e.isFromAjax=!0,0==$("#userListId li[id='"+e.userId+"']").size()&&chat.setOnlineUser(e);chat.setOnlineNum()}})}catch(a){console.error("getCSList->"+a),callback(null)}},getSendImgInfo:function(){var t=$("#contentText .text-min-img");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype")}:null},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getToUser:function(){var t=$("#contentText .txt_dia");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype")}:null},getSendMsg:function(t){var t=t?t:$("#contentText");if(t.text().length+t.find("img").size()>140)return alert("消息内容超过最大长度限制（140字以内）！"),!1;t.find(".txt_dia").length>0&&t.find(".txt_dia").remove();var e=common.clearMsgHtml(t.html());return common.isBlank(e)?(t.html(""),!1):e},setDialog:function(t,e,a,s,i){if(1==a)chat.closeWhTip(t),chat.fillWhBox(null,i,s,t,e,!1,!1);else{if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+s+'">@<label>'+e+"</label></span>&nbsp;").focusEnd()}},showViewSelect:function(t){"analyst"==t?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"me"==t?($("#dialog_list").children("[isme='true']").show(),$("#dialog_list").children("[isme='false']").hide()):"admin"==t?$("#dialog_list").children("[utype!=1]").hide():$("#dialog_list").children().show();
},setContent:function(t,e,a){var s=t.fromUser;if(e&&(s.publishTime=t.uiId),t.isVisitor)return $("#"+t.uiId).remove(),void box.openLgBox();if(a&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" span[contt] em[class=ruleTipStyle]").remove(),void $("#"+s.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",s.publishTime):$("#"+t.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||indexJS.userInfo.userId!=s.userId||!t.serverSuccess){var i=chat.formatContentHtml(t,e,a),n=$("#dialog_list");n.append(i),this.formatMsgToLink(s.publishTime);var o=$(".view_select .selectlist a[class=on]").attr("t");if("all"!=o&&chat.showViewSelect(o),!a){var r=$("#userListId li[id="+s.userId+"]"),l=null;s.avatar&&r.length>0&&s.avatar!=(l=r.find(".headimg img")).attr("src")&&l.attr("src",s.avatar),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}$("#"+s.publishTime+" .headimg").click(function(){chat.openDiaLog($("#"+s.publishTime+" .dialogbtn").attr("avs",$(this).find("img").attr("src")))}),$("#"+s.publishTime+" .txt_dia").click(function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&chat.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+s.publishTime+" .uname").click(function(){var t=$("#"+s.publishTime+" .dialogbtn");t.attr("avs",$(this).parent().parent().find(".headimg img").attr("src")),chat.openDiaLog(t)})}else if($("#"+t.uiId+" .dtime").html(chat.formatPublishTime(s.publishTime)),$("#"+t.uiId).attr("id",s.publishTime),t.content.msgType==chat.msgType.img){chat.removeLoadDom(s.publishTime);var d=$("#"+s.publishTime+' span[contt="a"]>a'),c=t.content.needMax?"/fxstudio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:d.children("img").attr("src");d.attr("href",c)}},openDiaLog:function(t){if($(".dialogbtn").not(t).hide(),!t.is(":hidden"))return t.hide(),!1;var e=t.parent(),a=t.is(".bot");e.next().size()<=0?a||t.addClass("bot"):a&&t.removeClass("bot"),t.show();var s=t.find("a"),i=t.attr("avs");common.isValid(i)?(s.attr("avs",i),t.attr("avs","")):s.attr("avs",""),s.unbind("click"),s.click(function(){var t=$(this).parent();chat.setDialog(t.attr("uid"),t.attr("nk"),$(this).attr("t"),t.attr("utype"),$(this).attr("avs")),t.hide()})},formatPublishTime:function(t,e,a){var s=Number(t.replace(/_.+/g,""));return common.isBlank(t)?"":e?common.formatterDateTime(s,a):common.getHHMM(s)},formatContentHtml:function(t,e,a){var s="dialog ",i="",n="",o="false",r="",l=t.fromUser,d=t.content,c=l.nickname,u="";indexJS.userInfo.userId==l.userId&&e&&(l.publishTime=t.uiId,u='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>');var h=l.toUser,p="";h&&common.isValid(h.userId)&&(p='<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">@<label>'+h.nickname+"</label></span>",indexJS.userInfo.userId==h.userId&&(o="true")),d.msgType==chat.msgType.img?(i=d.needMax?'<a href="/fxstudio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片"/></a>':'<a href="'+(d.value?d.value:"javascript:")+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片" /></a>',i+=u):i=d.value,indexJS.userInfo.userId==l.userId?(s+="mine ",o="true",r='<span class="dtime">'+chat.formatPublishTime(l.publishTime)+'</span><a href="javascript:" class="uname">我</a>'):(3==l.userType&&(c+="&nbsp;（助理）"),r='<a href="javascript:" class="uname">'+c+'</a><span class="dtime">'+chat.formatPublishTime(l.publishTime)+"</span>",n=chat.getDialogHtml(l.userId,c,l.userType),!a&&h&&indexJS.userInfo.userId==h.userId&&($(".mymsg").show(),$(".mymsg em").hide(),$(".replybtn").attr("uid",l.userId),$(".replybtn").attr("ts",h.talkStyle),$(".replybtn").attr("futype",l.userType),$(".sender").html(l.nickname),$(".xcont").html(i)));var m=chat.getAImgOrLevel(l.userId,l.clientGroup,l.userType,l.avatar),f=[];return f.push('<div class="'+s+m.level+'" id="'+l.publishTime+'"  utype="'+l.userType+'" mtype="'+d.msgType+'" isme="'+o+'">'),f.push('<a href="javascript:" class="headimg">'+m.aImg+"<b></b></a>"),f.push('<div class="dialog_top">'+r+"</div>"),f.push("<p><i></i>"),h&&common.isValid(h.question)?(f.push('<span class="dcont">'),f.push('<span uid="'+h.userId+'" utype="'+h.userType+'">'+h.nickname+"</span>提问："),f.push('<span contt="q">'+h.question+"</span>"),f.push('<span class="dialog_reply">回复：<span contt="a">'+i+"</span></span>"),f.push("</span>")):f.push('<span class="dcont" contt="a">'+p+i+"</span>"),f.push("</p>"+n+"</div>"),f.join("")},formatMsgToLink:function(t){$("#"+t+' span[contt]:contains("http:"),#'+t+' span[contt]:contains("https:")').each(function(t,e){var a=$(e).html(),s=a.split(/<img src="\S+">/g),i="";for(var n in s)if(i=s[n],!common.isBlank(i)){var o=i.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+'" target="_blank">'+t+"</a>"});e.innerHTML=e.innerHTML.replace(i,o)}})},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getAImgOrLevel:function(t,e,a,s){var i={aImg:common.isValid(s)?'<img src="'+s+'">':'<img src="/fx/theme1/img/user.png">',level:""};if(common.isValid(a)&&a>0)i.level=2==a?"analyst":"admin";else if("vip"==e)i.level="level4";else if("active"==e||"notActive"==e)i.level="level3";else if("simulate"==e)i.level="level2";else if("register"==e)i.level="level1";else if("visitor"==e||-1==a){t=t||"";var n=parseInt(t.substring(t.length-2),10);isNaN(n)&&(n=100),n=(n+17)%40,i.aImg='<img src="'+indexJS.filePath+"/upload/pic/header/chat/visitor/"+n+'.png">',i.level="visitor"}else i.level="visitor";return i},getDialogHtml:function(t,e,a){if(t&&indexJS.userInfo.userId!=t){var s=$("#roomInfoId"),i="",n=0;return(indexJS.visitorSpeak||-1==indexJS.userInfo.userId.indexOf("visitor_")&&-1==t.indexOf("visitor_"))&&(i+='<a href="javascript:" class="d1" t="0"><b></b><span>@TA</span></a>',n++),"true"==s.attr("aw")&&common.containSplitStr(s.attr("awr"),a)&&(i+='<a href="javascript:"'+(0==n?' class="d1"':"")+' t="1"><b></b><span>私聊</span></a>',n++),'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+e+'" uid="'+t+'" utype="'+a+'">'+i+"</div>"}return'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+e+'" uid="'+t+'" utype="'+a+'"></div>'},setOnlineUser:function(t){$("#userListId li[id='"+t.userId+"']").remove();var e=chat.getDialogHtml(t.userId,t.nickname,t.userType),a="",s="",i=t.sequence,n="";if(indexJS.userInfo.userId==t.userId&&(a="【我】",i="0",n="mynk"),3==t.userType){var o=$("#roomInfoId");"true"==o.attr("aw")&&common.containSplitStr(o.attr("awr"),t.userType)&&(s="<em>私聊</em>"),a="&nbsp;（助理）"}t.isFromAjax===!0&&(n="csoffline");var r=chat.getAImgOrLevel(t.userId,t.clientGroup,t.userType,t.avatar),l=$("#userListId li"),d='<li id="'+t.userId+'" cg="'+(common.isBlank(t.clientGroup)?"":t.clientGroup)+'" t="'+i+'" utype="'+t.userType+'" class="'+r.level+'" >'+e+'<a href="javascript:" t="header" class="uname"><div class="headimg">'+r.aImg+'<b></b></div><span class="'+n+'">'+t.nickname+a+"<i></i></span>"+s+"</a></li>";if("0"==i)l.first().before(d);else{var c=!1,u=0,h="";l.each(function(){if(u=parseInt($(this).attr("t")),t.sequence<u)return $(this).before(d),c=!0,!1;if(t.sequence==u){if(nickCsTmp=$(this).find("span[class='csoffline']").size(),nickCsTmp)return $(this).before(d),c=!0,!1;if(h=$(this).find("a span").text(),t.nickname<=h)return $(this).before(d),c=!0,!1}}),c||$("#userListId").append(d)}common.isValid(e)&&($("#userListId").contextmenu(function(){return!1}),$("#userListId li[id="+t.userId+"] a[t=header]").click(function(t){if("0"==$(this).attr("t"))$(".user_box li").removeClass("zin");else{$(".user_box li").removeClass("zin"),$(this).parent().addClass("zin");var e=$(this).prev();e.attr("avs",$(this).find(".headimg img").attr("src")),chat.openDiaLog(e)}}).dblclick(function(){$(this).find("em").trigger("click")}).find("em").click(function(t){var e=$(this).parents("[utype]"),a=e.attr("id");return chat.closeWhTip(a),chat.fillWhBox(e.attr("cg"),e.find(".headimg img").attr("src"),e.attr("utype"),a,e.find(".uname span").text(),!1,!1),!1}))},leaveRoomTip:function(t,e){if("forcedOut"!=t){if("roomClose"==t)$(".blackbg").children().hide(),box.showTipBox("注意：房间已停用，正自动登出..."),"visitor"==indexJS.userInfo.clientGroup?window.setTimeout(function(){indexJS.toRefreshView()},1200):window.setTimeout(function(){$(".logout").trigger("click")},1200);else if("otherLogin"==t){if("visitor"==indexJS.userInfo.clientGroup)return;chat.socket.disconnect(),$(".blackbg").children().hide(),box.showMsg({closeable:!1,title:"登出提示",msg:"注意：您的账号已在其他地方登陆，被踢出！",btns:[{txt:"重新登录",fn:function(){indexJS.toRefreshView()}},{txt:"注销",fn:function(){$(".logout").trigger("click")}}]})}}else if(e)for(var a in e)$("#userListId li[id='"+e[a]+"']").remove()},setWhOnlineTip:function(t,e){var a=$("#wh_msg_"+t+" .tit strong");if(0!=a.length){var s=$("#wh_msg_"+t+" .tit strong"),i=$(".mult_dialog a[uid="+t+"]").find("img"),n=$("#userListId li[t=3][uid="+t+"] .headimg");e?(s.text("在线"),i.removeClass("have_op"),n.removeClass("have_op")):(s.text("离线"),i.addClass("have_op"),n.addClass("have_op"))}},getWhToUser:function(){var t=$(".mult_dialog a[class=on]"),e=t.attr("uid");return{userId:e,nickname:t.find("label").text(),talkStyle:1,userType:t.attr("utype")}},sendWhMsg:function(t){var e=chat.getWhToUser(),a=t.find(".text-min-img img");if(a.size()>0){var s=a.attr("src");s.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(s,e),a.remove())}var i=chat.getSendMsg(t);if(i!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:i}},o=$(".mult_dialog a[class=on]"),r=o.attr("uid");n.fromUser.toUser={userId:r,nickname:o.find("label").text(),talkStyle:1,userType:o.attr("utype")};var l=$("#wh_msg_"+r+" .dialog:last"),d=l.find(".whblt");d.length>0&&(n.fromUser.toUser.question=d.html(),n.fromUser.toUser.questionId=d.attr("rid"),n.fromUser.toUser.publishTime=l.attr("id")),chat.socket.emit("sendMsg",n),chat.setWhContent(n,!0,!1),t.html("")}},setWhVisitors:function(t,e,a,s,i,n,o){if(0==$(".mult_dialog a[uid="+a+"]").length){var r=this.getAImgOrLevel(a,t?t:$("#userListId li[id='"+a+"']").attr("cg"),e,i);$(".mult_dialog").append('<a href="javascript:" uid="'+a+'" utype="'+e+'" class=""><div class="headimg '+r.level+'">'+r.aImg+"<b></b></div><label>"+s+'</label><i class="num dn" t="0"></i><i class="close"></i></a>');var l=$(".mult_dialog a[uid="+a+"]");if(o){var d=l.find(".num"),c=parseInt(d.attr("t"))+1;d.attr("t",c).text(c).show()}l.find(".close").click(function(){var t=$(this).parent();t.remove(),$("#wh_msg_"+t.attr("uid")).remove(),0==$(".mult_dialog a").length?($(".pletter_win .cont[id]").remove(),$(".pletter_win").hide()):$(".mult_dialog a:last").click()}),l.click(function(){$(".mult_dialog a").removeClass("on"),$(this).addClass("on"),$(this).find(".num").attr("t",0).text("").hide();var t=$(this).attr("uid"),e="wh_msg_"+t,a=$(this).attr("utype");if(chat.closeWhTip(t),$(".pletter_win .cont[id]").hide(),0==$("#"+e).length){var s="whTxt_"+t;$(".pletter_win").append($("#wh_content_tmp").html()),$(".pletter_win .cont:last").attr("id",e).find(".ctextarea").attr("id",s),$("#"+e).find(".facebtn").qqFace({id:"faceId_"+t,zIndex:1e6,assign:s,path:indexJS.filePath+"/face/"}),$("#"+e).find(".imgbtn").click(function(){return FileReader?void $("#"+e).find(".imginp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#"+e).find(".imginp").bind("change",function(){var t=this,e=chat.getWhToUser(),a=t.files[0];if(!a)return!1;if(0!=a.type.indexOf("image")||!a.type||!/\.(?:jpg|png|gif)$/.test(a.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var s=a.size;if(s>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var i=new FileReader;i.readAsDataURL(a),i.onload=function(t){chat.setUploadImg(t.target.result,e)},i.onprogress=function(t){},i.onloadend=function(t){},$(this).val("")}),$("#"+e).find(".ctextarea").pastableTextarea().on("pasteImage",function(t,e){var a=$(this).find(".text-min-img");a.length>0?(a.attr("href",e.dataURL),a.find("img").attr("src",e.dataURL)):($(this).append('<a class="text-min-img" href="'+e.dataURL+'" data-lightbox="whSend-img"><img src="'+e.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(t){return 13==t.keyCode?(chat.sendWhMsg($(this)),!1):void 0}),$("#"+e).find(".sendbtn").click(function(t){chat.sendWhMsg($(this).parents(".cont").find(".ctextarea"))}),$("#"+e).find(".pop_close").click(function(){$(".pletter_win .cont[id],.pletter_win .mult_dialog a[uid]").remove(),$(".pletter_win").hide()}),$("#"+e).find(".pop_small").click(function(){$(".pletter_win").hide()}),chat.socket.emit("getWhMsg",{clientStoreId:indexJS.userInfo.clientStoreId,userType:indexJS.userInfo.userType,groupId:indexJS.userInfo.groupId,groupType:indexJS.userInfo.groupType,userId:indexJS.userInfo.userId,toUser:{userId:t,userType:a}})}$("#"+e).show().find(".wh_nk").text($(this).find("label").text()),$("#"+e).find(".ctextarea").focus(),chat.setTalkListScroll(!0,$("#"+e+" .wh-content"),"dark"),chat.setWhOnlineTip(t,$("#userListId li[id='"+t+"']").length>0)})}},setWhTip:function(t){if($(".pletter_win").is(":hidden")){var e=$("#userListId li[id="+t+"] a.uname span i"),a=0;e.length>0&&(a=e.text(),a=common.isValid(a)?a:0,$("#userListId li[id="+t+"] a.uname span i").text(parseInt(a)+1)),$("#userListId li[id="+t+"]").attr("k",1),this.whTipInterId||(this.whTipInterId=setInterval(function(){$("#userListId li[k=1]").toggleClass("tip_mrg")},1e3))}},closeWhTip:function(t){$("#userListId li[id="+t+"]").attr("k",0).removeClass("tip_mrg").find("a.uname span i").text(""),0==$("#userListId li[k=1]").length&&this.whTipInterId&&(clearInterval(this.whTipInterId),this.whTipInterId=null)},fillWhBox:function(t,e,a,s,i,n,o){var r=$(".mult_dialog a[uid="+s+"]");if(0==r.length)chat.setWhVisitors(t,a,s,i,e,!0,o);else if(o&&!r.hasClass("on")){var l=r.find(".num"),d=parseInt(l.attr("t"))+1;l.attr("t",d).text(d).show()}return n?(this.setWhTip(s),!1):($(".pletter_win").show(),$(".mult_dialog a[uid="+s+"]").click(),!0)},setWhContent:function(t,e,a,s){var i=t.fromUser,n="dialog ",o=t.content,r="";if(t.rule)return void $("#"+t.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+t.value.tip+"</em>");if(a||(i.toWhUserId=i.userId),indexJS.userInfo.userId==i.userId||"0"==indexJS.userInfo.userType&&"-1"==i.userType||"-1"==indexJS.userInfo.userType&&"0"==i.userType){if(e&&(i.publishTime=t.uiId,i.toWhUserId=i.toUser.userId),t.serverSuccess){if($("#"+t.uiId+" .dtime").html(chat.formatPublishTime(i.publishTime)),$("#"+t.uiId).attr("id",i.publishTime),t.content.msgType==chat.msgType.img){chat.removeLoadDom(i.publishTime);var l=$("#"+i.publishTime+' span[contt="a"]>a'),d=t.content.needMax?"/fxstudio/getBigImg?publishTime="+i.publishTime+"&userId="+i.userId:l.children("img").attr("src");l.attr("href",d)}return}n+="mine",r='<span class="dtime">'+chat.formatPublishTime(i.publishTime,a,"/")+'</span><a href="javascript:" class="uname">我</a>'}else{if(!a&&!s){var c=this.fillWhBox(i.clientGroup,i.avatar,i.userType,i.userId,i.nickname,!0,!0);if(c)return}var u="3"==i.userType?"&nbsp;（助理）":"";r='<a href="javascript:" class="uname">'+i.nickname+u+'</a><span class="dtime">'+chat.formatPublishTime(i.publishTime,a,"/")+"</span>"}if(common.isBlank(i.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var h="",p=$("#wh_msg_"+i.toWhUserId+" .dialoglist"),m="";if(o.msgType==chat.msgType.img){h=o.needMax?'<a href="/fxstudio/getBigImg?publishTime='+i.publishTime+"&userId="+i.userId+'" data-lightbox="whimg-"'+i.userId+'><img src="'+o.value+'" alt="图片"/></a>':'<a href="'+o.value+'" data-lightbox="whimg-"'+i.userId+'><img src="'+o.value+'" alt="图片" /></a>';var f=e?'</span><em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>':"";h='<p><i></i><span class="dcont" contt="a">'+h+f+"</p>"}else if(s)h='<div class="whcls"><i></i><div class="whblt" rid="'+o.infoId+'">'+o.value+"</div></div>";else{if(!e&&common.isValid(i.toUser.question)){var g='<a href="javascript:" class="uname">'+i.toUser.nickname+'</a><span class="dtime">'+chat.formatPublishTime(i.publishTime,a,"/")+"</span>";m='<div class="dialog" id="'+i.publishTime+'"><div class="dialog_top">'+g+'</div><div class="whcls"><i></i><div class="whblt">'+i.toUser.question+"</div></div></div>",p.append(m)}h='<p><i></i><span class="dcont" contt="a">'+o.value+"</span></p>"}if(m='<div class="'+n+'" id="'+i.publishTime+'" utype="'+i.userType+'" mType="'+o.msgType+'"><div class="dialog_top">'+r+"</div>"+h+"</div>",p.append(m),this.formatMsgToLink(i.publishTime),!a){var v=p.parents(".wh-content");v.hasClass("mCustomScrollbar")&&chat.setTalkListScroll(!0,v,"dark")}},setOnlineNum:function(){$(".mod_userlist .titbar label").text($("#userListId li").length)},searchUserList:function(t){var e=$("#userListId li[t!=14][t!=0]").map(function(){var e=$(this).find(".uname span").text();return-1!=e.indexOf(t)?{value:$(this).attr("id"),label:e,userType:$(this).attr("utype")}:null}).get();return e},setUserListIdEmpty:function(){$("#userListId").html("")},setSocket:function(){this.socket=common.getSocket(io,indexJS.socketUrl,indexJS.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),indexJS.userInfo.socketId=chat.socket.id;var t=$("#roomInfoId");chat.socket.emit("login",{userInfo:indexJS.userInfo,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:t.attr("awr"),allowWhisper:t.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(t,e){if("true"==$("#roomInfoId").attr("av")&&200>=e)for(var a=0,s=10>=e?60:200/e*3+10,i=0;s>i;i++)a=common.randomNumber(6),t["visitor_"+a]={userId:"visitor_"+a,clientGroup:"visitor",nickname:"游客_"+a,sequence:15,userType:-1};var n=null;for(var i in t)n=t[i],chat.setOnlineUser(n);chat.setOnlineNum(),indexJS.setListScroll(".user_box")}),this.socket.on("disconnect",function(t){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){if(t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle)chat.setWhContent(t,!1,!1);else{if(!t.serverSuccess&&indexJS.userInfo.userId==t.fromUser.userId&&!t.rule)return;chat.setContent(t,!1,!1)}}),this.socket.on("notice",function(t){switch(t.type){case"onlineNum":var e=t.data,a=e.onlineUserInfo;e.online?chat.setOnlineUser(a):indexJS.userInfo.userId!=a.userId&&(3==a.userType?$("#userListId #"+a.userId+" .uname>span").addClass("csoffline"):($("#userListId #"+a.userId).remove(),indexJS.setListScroll(".user_box"))),chat.setOnlineNum(),3==a.userType&&chat.setWhOnlineTip(a.userId,e.online);break;case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),chat.setTalkListScroll();break;case"leaveRoom":chat.leaveRoomTip(t.flag,t.userIds);break;case"pushInfo":var e=t.data;1==e.position?(chat.whPushObj={info:e.content,publishTime:e.publishTime,infoId:e.contentId},chat.pushInfoTimeOutId=window.setTimeout(function(){var t=$("#userListId li[t=3] a .headimg:not(.have_op)");$(t.get(common.randomIndex(t.length))).parent().find("em").click(),$("#main_ad_box .pop_close").click()},60*e.timeOut*1e3)):3==e.position?chat.talkBoxPush.initTBP(e.infos):4==e.position&&videos.rollNews(e);break;case"approvalResult":var e=t.data;if(e.refuseMsg){var s=e.publishTimeArr;for(var i in s)$("#"+s[i]+" span[contt] em[class=ruleTipStyle]").html("已拒绝")}else{for(var i in e)chat.formatUserToContent(e[i]);chat.setTalkListScroll(!0)}break;case"strategyInfo":t.data&&$("#lvInfoId .te_detail").attr("uid")==t.data.authorId&&$("#lvInfoId .info2 p").text(t.data.content)}}),this.socket.on("loadMsg",function(t){$(".img-loading[pf=chatMessage]").hide();var e=t.msgData;if(e&&$.isArray(e)){e.reverse();for(var a in e)chat.formatUserToContent(e[a])}chat.setTalkListScroll(!0)}),this.socket.on("loadWhMsg",function(t){var e=t.data;if("offline"==t.type){if(e&&!$.isEmptyObject(e))for(var a in e)chat.setWhVisitors(e[a].clientGroup,e[a].userType,a,e[a].nickname,$("#userListId li[id='"+a+"']").length>0)}else if(e&&$.isArray(e)){var s=0,i=null;e.reverse();var n=0,o=$(".mult_dialog a[uid="+t.toUserId+"]");for(var r in e)i=e[r],3==i.userType&&chat.setWhPushInfo(o,i.publishTime)&&n++,chat.formatUserToContent(i,!0,t.toUserId),i.content.msgType==chat.msgType.img&&s++;0==n&&chat.setWhPushInfo(o,null),chat.setTalkListScroll(!0,$("#wh_msg_"+t.toUserId+" .wh-content"),"dark")}})},setTalkListScroll:function(t,e,a){var s=e?e:$("#chatMsgContentDiv");s.hasClass("mCustomScrollbar")?(s.mCustomScrollbar("update"),t&&s.mCustomScrollbar("scrollTo","bottom")):(s.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:a?a:"light-2"}),indexJS.setScrollStyle(s),s.mCustomScrollbar("scrollTo","bottom"))},setWhPushInfo:function(t,e){if($.isEmptyObject(chat.whPushObj))return!1;if(e&&e<chat.whPushObj.publishTime)return!1;var a=t.attr("uid"),s=t.find("label").text().replace(/\s（助理）$/,"");if($("#wh_msg_"+a+" div[id="+chat.whPushObj.publishTime+"]").length>0)return!1;var i={fromUser:{publishTime:chat.whPushObj.publishTime,userId:a,nickname:s,userType:3},content:{msgType:chat.msgType.text,value:chat.whPushObj.info,infoId:chat.whPushObj.infoId}};return chat.setWhContent(i,!1,!1,!0),chat.whPushObj={},window.clearTimeout(chat.pushInfoTimeOutId),!0},formatUserToContent:function(t,e,a){var s={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,avatar:t.avatar,position:t.position};e?(s.toWhUserId=a,chat.setWhContent({fromUser:s,content:t.content},!1,!0)):chat.setContent({fromUser:s,content:t.content},!1,!0)},talkBoxPush:{talkPushList:[],talkPushInterval:null,initTBP:function(t){this.clear(),this.talkPushList=t,this.start()},clear:function(){chat.talkBoxPush.talkPushInterval&&(window.clearInterval(chat.talkBoxPush.talkPushInterval),chat.talkBoxPush.talkPushInterval=null);for(var t=chat.talkBoxPush.talkPushList,e=null,a=0,s=t.length;s>a;a++)e=t[a],e.timeoutId&&window.clearTimeout(e.timeoutId),e.intervalId&&window.clearInterval(e.intervalId)},start:function(){var t=chat.talkBoxPush.talkPushList;t&&t.length>0&&(chat.talkBoxPush.talkPushInterval=window.setInterval(function(){chat.talkBoxPush.check()},1e4))},check:function(){for(var t=chat.talkBoxPush.talkPushList,e=null,a=0,s=t.length;s>a;a++)e=t[a],e.startFlag||common.dateTimeWeekCheck(e.pushDate,!1,indexJS.serverTime)&&(e.startFlag=!0,e.timeoutId=window.setTimeout(chat.talkBoxPush.delayStartTask(e),60*(e.onlineMin||0)*1e3))},delayStartTask:function(t){return function(){chat.talkBoxPush.showMsg(t),t.intervalMin&&t.intervalMin>0&&(t.intervalId=window.setInterval(chat.talkBoxPush.startTask(t),60*t.intervalMin*1e3))}},startTask:function(t){return function(){common.dateTimeWeekCheck(t.pushDate,!1,indexJS.serverTime)?chat.talkBoxPush.showMsg(t):(window.clearInterval(t.intervalId),t.startFlag=!1)}},showMsg:function(t){var e=[];e.push('<div class="dialog push">'),e.push(t.content),e.push("</div>"),$("#dialog_list").append(e.join("")),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}}};$(function(){chat.init()});var box={verifyCodeIntId:null,toRoomId:null,enable:!0,storeInfoKey:"storeInfo_VerifyCodeTime",init:function(){this.setEvent()},setEvent:function(){$(".popup_box .pop_close,.formbtn[t=close]").click(function(){$(this).parent().parent().hide(),$(".blackbg").hide(),$(".blackbg form").each(function(){this.reset()})}),this.loginEvent(),this.upgradeEvent(),this.expertMailEvent()},upgradeEvent:function(){$("#tipbtnId").hover(function(){$(".upg_tip").show()},function(){$(".upg_tip").hide()}),$(".upgradebtn").click(function(){try{$(".upgrade,#up_loading").show(),$.getJSON("/fxstudio/getClientGroupList",null,function(t){if($("#up_loading").hide(),t){$("#upg_tbody_id").html("");var e="",a=0,s=null,i="";for(var n in t)t[n].clientGroupId==indexJS.userInfo.clientGroup&&(a=t[n].sequence);for(var o=0;o<t.length;o++)if(s=t[o],i="",s.clientGroupId==indexJS.userInfo.clientGroup?(e="当前级别",i="current"):e="visitor"!=s.clientGroupId&&a<s.sequence?"vip"==s.clientGroupId?"联系客服升级":'<a href="javascript:" t="'+s.clientGroupId+'">升级</a>':"---",!common.isBlank(common.trim(s.remark))){var r=[];r.push('<tr class="'+i+'"><td><p>'+box.getUserLevelShortName(s.clientGroupId)+'</p></td><td><p class="p2">'+common.trim(s.remark)+"</p></td><td><p>"+common.trim(s.authorityDes)+"</p></td><td>"+e+"</td></tr>"),$("#upg_tbody_id").append(r.join(""))}$("#upg_tbody_id a").click(function(){var t=$(this),e=t.attr("t");common.getJson("/fxstudio/upgrade",{clientGroup:e},function(a){if(t.attr("disabled",!1),a.isOK)"active"===a.clientGroup&&"notActive"===e?$("#studioUpgA").show():$("#studioUpgA").hide(),$(".upgrade,.upgrade_result .fail").hide(),$(".upgrade_result,.upgrade_result .succ").show();else{var s="";"active"===e?s="很遗憾，您未激活金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"notActive"===e?s="很遗憾，您未开通金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"simulate"===e&&(s="很遗憾，您未开通金道模拟交易账户，升级失败！<br>如有疑问请联系客服！"),$(".upgrade_result .succ").hide(),$(".upgrade_result,.upgrade_result .fail").show(),$(".upgrade_result .fail>span").html(s)}},!0,function(e){t.attr("disabled",!1)})})}})}catch(t){$("#up_loading").hide(),console.error("getClientGroupList->"+t)}})},loginEvent:function(){$("#login_a").bind("click",function(t,e){e=e||{},box.toRoomId=e.groupId,box.openLgBox(e.closeable),common.isValid($(this).attr("tp"))&&_gaq.push(["_trackEvent","fx_studio","login",$(this).attr("tp"),1,!0])}),indexJS.currStudioAuth||"visitor"!=indexJS.userInfo.clientGroup||$("#login_a").trigger("click",{closeable:!1}),$(".logout").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href="/fxstudio/logout?platform="+indexJS.fromPlatform}),$("#loginForm input[name=mobilePhone],#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").bind("input propertychange",function(){common.isValid(this.value)&&$(".popup_box .error").hide()}),$("#loginForm .rbtn").click(function(){if(!$(this).hasClass("pressed")){var t=$("#loginForm input[name=mobilePhone]").val();if(!common.isMobilePhone(t))return void $("#loginForm .error").html("手机号码有误，请重新输入！").show();$(this).addClass("pressed").html("发送中...");try{$.getJSON("/fxstudio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:t,useType:$(this).attr("ut")},function(t){t&&0==t.result?($("#loginForm .error").hide(),box.setVerifyCodeTime("#loginForm .rbtn")):("1005"==t.errcode?$("#loginForm .error").html("<i></i>"+t.errmsg).show():console.error("提取数据有误！"),box.resetVerifyCode())})}catch(e){box.resetVerifyCode(),console.error("setMobileVerifyCode->"+e)}}}),$("#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").keydown(function(t){return 13==t.keyCode?($(this).parents("form").find(".set_submit").click(),!1):void 0}),$("#logBtnSub").click(function(){if($("#loginForm input[name=clientStoreId]").val(indexJS.userInfo.clientStoreId),box.checkFormInput("#loginForm")){$(this).attr("disabled",!0);var t=this;$("#formBtnLoad").show(),common.getJson("/fxstudio/login",$("#loginForm").serialize(),function(e){return console.log("lgresult",e),$("#loginForm .error").hide(),$(t).attr("disabled",!1),$("#formBtnLoad").hide(),e.isOK?($(".blackbg,#loginBox").hide(),LoginAuto.setAutoLogin($("#autoLogin").prop("checked")),indexJS.userInfo.clientGroup=e.userInfo.clientGroup,indexJS.toRefreshView(),void 0):($("#loginForm .error").html("<i></i>"+e.error.errmsg).show(),!1)},!0,function(e){$(t).attr("disabled",!1),$("#formBtnLoad").hide()})}}),$("#setNkBtn").click(function(){if(box.checkFormInput("#setNkForm")){$(this).prop("disabled",!0);var t=this;$("#setNkLoad").show(),common.getJson("/fxstudio/modifyName",$("#setNkForm").serialize(),function(e){return $("#setNkForm .error").hide(""),$(t).attr("disabled",!1),$("#setNkLoad").hide(),e.isOK?($("#setNkForm").parent().find(".pop_close").click(),indexJS.refreshNickname(!0,e.nickname),$("#sendBtn").click(),void 0):($("#setNkForm .error").html("<i></i>"+(e.msg?e.msg:"修改失败，请联系客服！")).show(),!1)},!0,function(e){$(t).attr("disabled",!1),$("#setNkLoad").hide()})}})},getUserLevelShortName:function(t){var e="";switch(t){case"vip":e="l4";break;case"real":e="l3";break;case"active":e="l3";break;case"notActive":e="l3";break;case"simulate":e="l2";break;case"register":e="l1";break;default:e="l0"}return'<i class="level '+e+'"></i>'},checkFormInput:function(t,e){var a=!0;return e||(e=$(t+" .error")),e.attr("tId","").hide(),$(t+" input").each(function(){return common.isBlank($(this).val())?("mobilePhone"==this.name&&e.attr("tId",this.name).html("<i></i>手机号码不能为空！").show(),"verifyCode"==this.name&&e.attr("tId",this.name).html("<i></i>验证码不能为空！").show(),"nickname"==this.name&&e.attr("tId",this.name).html("<i></i>昵称不能为空！").show(),a=!1):"mobilePhone"!=this.name||($(this).val($.trim($(this).val())),common.isMobilePhone(this.value))?"nickname"!=this.name||common.isRightName(this.value)?void 0:(e.attr("tId",this.name).html("<i></i>昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!").show(),a=!1):(e.attr("tId",this.name).html("<i></i>手机号码输入有误！").show(),a=!1)}),a},setVerifyCodeTime:function(t){var e=parseInt($(t).attr("t"))||120,a=this.storeInfoKey+$("#loginForm input[name=mobilePhone]").val();this.enable&&store.set(a,e-1),this.verifyCodeIntId||(this.verifyCodeIntId=setInterval("box.setVerifyCodeTime('"+t+"')",1e3)),e>1?$(t).attr("t",e-1).html("重新获取("+(e-1)+")"):(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId="",$(t).attr("t",120).html("获取验证码").removeClass("pressed"))},resetVerifyCode:function(){this.verifyCodeIntId&&(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId=""),$("#loginForm .rbtn").attr("t",120).html("获取验证码").removeClass("pressed")},openLgBox:function(t){t===!1?$("#loginBox .pop_close").hide():$("#loginBox .pop_close").show(),$(".popup_box").hide(),$("#loginBox,.blackbg").show()},openSetNameBox:function(){$(".nk_box,.blackbg").show()},refreshVerifyCode:function(){var t=LoginAuto.sessionUser.groupType;$("#verifyCodeId img").attr("src","/"+t+"/getVerifyCode?code=email&v="+Math.random())},expertMailEvent:function(){$(".expert_box .error").hide(),$("#expert").click(function(){box.refreshVerifyCode(),$(".expert,.blackbg").removeClass("dn").show()}),$("#btnSendMail").click(function(){if(common.isBlank($("#mailFrom").val()))$(".expert_box .error").html("<i></i>发件人不能为空！").show();else if(common.isBlank($("#mailContent").val()))$(".expert_box .error").html("<i></i>输入内容有误，请重新输入！").show();else if(common.isBlank($("#mailImgCode").val()))$(".expert_box .error").html("<i></i>验证码不能为空！").show();else{$(".expert_box .error").hide();var t={};t.content=$.trim($("#mailContent").val()),t.email=$.trim($("#mailFrom").val()),t.code=$.trim($("#mailImgCode").val()),common.getJson("/fxstudio/email",{key:"fxstudio",data:JSON.stringify(t)},function(t){t.isOK?(box.showMsg(t.msg),$(".expert,.blackbg").hide(),$("#mailFrom,#mailContent").val("")):$(".expert_box .error").html("<i></i>"+t.msg).show()})}}),$("#btnSendMail").keydown(function(t){return 13==t.keyCode?($("#btnSendMail").click(),!1):void 0}),$("#verifyCodeId img").click(function(){box.refreshVerifyCode()})},hideMsg:function(){$("#popMsgBox").is(":visible")&&$("#popMsgBox").fadeOut("normal","swing",function(){$(".blackbg").hide()})},showMsg:function(t){"string"==typeof t&&(t={msg:t}),t=$.extend({closeable:!0,title:"",msg:"",modal:!0,delay:0,btns:[{txt:"确定",fn:function(){box.hideMsg()}}]},t),$("#popMsgTit").text(t.title||""),$("#popMsgTxt").text(t.msg);var e=$("#popMsgCont");e.find("a.yesbtn").remove();for(var a=null,s=null,i=0,n=t.btns?t.btns.length:0;n>i;i++)a=t.btns[i],s=$('<a class="yesbtn" href="javascript:void(0)">'+a.txt+"</a>"),e.append(s),s.click(a.fn);t.closeable?$("#popMsgClo").show():$("#popMsgClo").hide(),$("#popMsgBox").show(),t.modal&&$(".blackbg").show(),t.delay&&window.setTimeout(function(){box.hideMsg()},t.delay)},showTipBox:function(t){$(".tipsbox").fadeIn().delay(1e3).fadeOut(200).find(".cont").text(t);
},contVerifyCodeTime:function(){var t=$("#loginForm input[name=mobilePhone]").val();if(t&&this.enable){var e=this.storeInfoKey+t,a=store.get(e);if(a>1){var s="#loginForm .rbtn";$(s).attr("t",a).addClass("pressed"),box.setVerifyCodeTime(s)}}}};$(function(){box.init()});var tool={financeShowIntervalId:null,financeHideIntervalId:null,tradeForUser:null,tradeList:[],tradeLoadAll:!1,init:function(){this.setEvent()},setEvent:function(){$(".mod_menu li").hover(function(){$(this).hasClass("entered")||(tool.loadFun($(this).attr("class")),$(".dr3").hasClass("on")&&clearTimeout(tool.financeHideIntervalId)),$(this).addClass("on entered"),$(this).find(".dropcont").show();var t=["tool_market","tool_finance","tool_ppt","tool_gts2","tool_studioMb"],e=$(this).index();t[e]&&_gaq.push(["_trackEvent","fx_studio",t[e],"content_right",1,!0])},function(){$(this).removeClass("on"),$(this).find(".dropcont").hide(),$(".dr3").hasClass("on")||(clearInterval(tool.financeShowIntervalId),tool.financeHideIntervalId=window.setTimeout("tool.clearCls('.dr3','entered')",6e4)),!$(".dr2").hasClass("on")&&pkMarketSocket&&pkMarketSocket.close(),$(".dr9").hasClass("entered")&&$(".dr9").removeClass("entered")}),$(".hqchart .hqtabnav a").click(function(){$(".hqchart .hqtabnav a").removeClass("on"),$(".hqchart .votebox a").removeClass("on"),$(this).addClass("on"),$($(".hqchart .votebox a")[0]).addClass("on");var t=$(this).attr("symbol");tool.setQuotesVote(t,"")}),$(".hqchart .votebox a").click(function(){$(".hqchart .votebox a").removeClass("on"),$(this).addClass("on")}),$(".votebtn").click(function(){var t=$(".hqchart .hqtabnav a.on").attr("symbol"),e=$(".hqchart .votebox a.on").attr("highslows");$(this).attr(t)!=t?tool.quotesVote(t,e):box.showMsg("已投过票了")}),$("#calendarFinance").val(common.formatterDate(indexJS.serverTime,"-")),$("#calendarFinance").change(function(){var t=$(this).val();tool.setFinanceData(t,1)}),$(".dr3 .date_select a").click(function(){$("#calendarFinance").trigger("click")}),$(".calc_box .calc_tabnav a").click(function(){$(this).hasClass("clicked")||tool.setPivotCalc($(this).attr("symbol")),$(".calc_box .calc_tabnav a").removeClass("on"),$(".calc_box .calc_tab").removeClass("on"),$(this).addClass("on clicked"),$($(".calc_box .calc_tab")[$(this).index()]).addClass("on")}),$(".dr9 .dropcont .cont .userad_btnbar .fl").click(function(){if(indexJS.userInfo.isLogin)(common.isBlank(indexJS.userInfo.isSetName)||indexJS.userInfo.isSetName)&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".pop_addsd").removeClass("dn").show();else{var t=t||{};box.openLgBox(t.closeable,t.showTip)}}),$("#myShowTrade").click(function(){if(indexJS.userInfo.isLogin)tool.tradeForUser=indexJS.userInfo.userId,tool.initShowTrade(),$(".dr9 .mysd_list .sdinfo .sdinfo_cont .headimg img").attr("src",$("#avatarInfoId").attr("src")),$(".dr9 .mysd_list .sdinfo .sdinfo_cont span b").text(indexJS.userInfo.nickname),$(".dr9 .allsd_list").addClass("dn"),$(".dr9 .mysd_list").removeClass("dn");else{var t={};box.openLgBox(t.closeable,t.showTip)}}),$("#backShowTrade").click(function(){tool.tradeForUser=null,tool.initShowTrade(),$(".dr9 .allsd_list").removeClass("dn"),$(".dr9 .mysd_list").addClass("dn")}),$("#flTradeImg").change(function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var a=e.size;if(a>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var s=new FormData($("#showTradeForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:s,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var e=t.data?t.data[0]:null;e&&$("#tradeImg").val(e.fileDomain+e.filePath)}else alert("上传图片失败，请联系在线客服！")},error:function(t){console.error("error:",t)}})}catch(i){console.error("上传图片失败",i)}}),$("#tradeSubmit").click(function(){tool.showTrade()}),$("#showTradeAgain").click(function(){$('.pop_addsd input[type="text"],.pop_addsd textarea').val(""),$("#flTradeImg").val(""),indexJS.userInfo.isSetName&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".sd_result").addClass("dn").hide()}),$("#sdResultClose").click(function(){$('.pop_addsd input[type="text"],.pop_addsd textarea').val(""),$("#flTradeImg").val(""),indexJS.userInfo.isSetName&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".sd_result").addClass("dn").hide(),$(".pop_close").click()})},loadFun:function(t){switch(t){case"dropitem dr2":getAllMarketpriceIndex("ws://kdata.gwfx.com:8087/websocket.do","service=HqDataWebSocketService&method=pushMarketprice&symbol=EURUSD|USDJPY|AUDUSD|GBPUSD|USDCAD|NZDUSD|USDCHF|XAUUSD&dataType=simpleMarketPrice","http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getMarkrtPriceDataFromCache",null);break;case"dropitem dr3":tool.initCalendar(function(){tool.setFinanceData("",1),$(".dr3").addClass("initCalendar"),tool.financeShowIntervalId=window.setInterval("tool.setFinanceData('',1)",6e4)});break;case"dropitem dr4":tool.setCftcCot();break;case"dropitem dr5":tool.setPivotCalc("LLG");break;case"dropitem dr6":tool.setDownloadPPT();break;case"dropitem dr9":tool.initShowTrade()}},initEasyPieChart:function(){$(".dr2").hasClass("initEasyPieChart")||LazyLoad.js(["/base/lib/jquery.easy-pie-chart.js"],function(){$(".percentage").easyPieChart({barColor:"#66ab4a",trackColor:"#f15f5f",scaleColor:!1,lineCap:"square",lineWidth:12,animate:1e3,size:114})})},quotesVote:function(t,e){common.getJson("/fxstudio/highsLowsVote",{symbol:t,highslows:e},function(e){var a=0;if(e.isOK){var s=e.data.highs,i=e.data.lows,n=parseInt(s)+parseInt(i);a=Math.round(parseInt(s)/n*100),$("#data_percent_1").attr("data-percent",a),$(".hqchart .datashow .fr").html("看涨<br>"+a+"%"),$(".hqchart .datashow .fl").html("看跌<br>"+Math.round(parseInt(i)/n*100)+"%"),$(".votebtn").attr(t,t)}else $("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%");$(".percentage").data("easyPieChart").update(a)})},setQuotesVote:function(t,e){$.getJSON("/fxstudio/getHighsLowsVote",{symbol:t,highslows:e},function(t){var e=0;if(t.isOK){var a=t.data.highs,s=t.data.lows,i=parseInt(a)+parseInt(s);e=Math.round(parseInt(a)/i*100),common.isBlank(e)||isNaN(e)?($("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%")):($("#data_percent_1").attr("data-percent",e),$(".hqchart .datashow .fr").html("看涨<br>"+e+"%"),$(".hqchart .datashow .fl").html("看跌<br>"+Math.round(parseInt(s)/i*100)+"%"))}else $("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%");$(".percentage").data("easyPieChart").update(e)})},initCalendar:function(t){$(".dr3").hasClass("initCalendar")?t():LazyLoad.js(["/base/lib/pikaday/moment.min.js","/base/lib/pikaday/pikaday.min.js"],function(){var e=tool.currentDate(),a={previousMonth:"上个月",nextMonth:"下个月",months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdays:["周日","周一","周二","周三","周四","周五","周六"],weekdaysShort:["日","一","二","三","四","五","六"]};new Pikaday({field:$("#calendarFinance")[0],firstDay:1,container:$("#calendarContainer")[0],defaultDate:e,i18n:a,minDate:new Date(2e3,0,1),maxDate:new Date(2050,12,31),yearRange:[2e3,2050],onSelect:function(){var t=document.createTextNode(this.getMoment().format("YYYY-MM-DD")+" ");$("#calendarFinance").append(t)}});t()})},setFinanceData:function(t,e){common.isBlank(t)&&(t=tool.currentDate()),common.getJson("/fxstudio/getFinancData",{releaseTime:t,dataTypeCon:e},function(t){if(0==t.result){var e={"德国":"Germany","法国":"France","欧元区":"EUR","加拿大":"CAD","美国":"USD","澳大利亚":"AUD","日本":"JPY","瑞士":"CHF","意大利":"Italy","英国":"GBP","中国":"CNY","新西兰":"NZD","韩国":"SK","香港":"HKD","西班牙":"Spain","台湾":"Taiwan","印度":"INR","新加坡":"Singapore"},a="",s=tool.formatHtml("finance");$.each(t.data.financeData,function(t,i){a+=s.formatStr(i.time.substring(0,5),common.isBlank(e[i.country])?"none":e[i.country],i.country,tool.importanceLevel(i.importanceLevel),i.name,common.isBlank(i.lastValue)?"---":i.lastValue,common.isBlank(i.predictValue)?"---":i.predictValue,common.isBlank(i.value)?"---":i.value)}),$(".dr3 .calendar_ul ul").html(a),indexJS.setListScroll(".calendar_ul.scrollbox2",{isCustom:!1,scrollbarPosition:"outside",theme:"dark-2"})}})},setCftcCot:function(){$.getJSON("/fxstudio/get24kCftc",null,function(t){var e={gold:"纽约期金",silver:"纽约期银",usd:"美元指数",oil:"纽约原油",cu:"纽约期铜"};if(null!=t&&t){var a="",s="",i=tool.formatHtml("cftcperc"),n=tool.formatHtml("cftcdata");$.each(e,function(e,o){var r=t[e]["long"],l=t[e]["short"],d=parseInt(r)+parseInt(l),c=Math.round(parseInt(r)/d*100),u=Math.round(parseInt(l)/d*100);a+=i.formatStr(o,c,u),s+=n.formatStr(o,r,l,t[e].updatetime)}),$(".dr4 .percent_list .perc_table").html(a),$(".dr4 .perc_data .data_table tbody").html(s)}})},getOAUrl:function(){var t=window.location.host;return t=t.indexOf("localhost")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":t.indexOf("testweb1.24k.hk")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":"http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getPivotPointData&symbol="},setPivotCalc:function(t){$.post(tool.getOAUrl()+t,{},function(t){var e=["d","w"];if("true"===t.sucess.toLowerCase())for(var a=t.msg.length,s=0;a>s;s++)$.inArray(t.msg[s].pivotType,e)>-1&&($("#r3_"+t.msg[s].symbol+"_"+t.msg[s].pivotType).text(t.msg[s].resistance3),$("#r2_"+t.msg[s].symbol+"_"+t.msg[s].pivotType).text(t.msg[s].resistance2),$("#r1_"+t.msg[s].symbol+"_"+t.msg[s].pivotType).text(t.msg[s].resistance1),$("#p_"+t.msg[s].symbol+"_"+t.msg[s].pivotType).text(t.msg[s].pivotPoint),$("#s3_"+t.msg[s].symbol+"_"+t.msg[s].pivotType).text(t.msg[s].support3),$("#s2_"+t.msg[s].symbol+"_"+t.msg[s].pivotType).text(t.msg[s].support2),$("#s1_"+t.msg[s].symbol+"_"+t.msg[s].pivotType).text(t.msg[s].support1))},"json")},setDownloadPPT:function(){var t={pptx:"",ppt:"",pdf:' class="pdf"',docx:' class="word"',doc:' class="word"'};indexJS.getArticleList("download",indexJS.userInfo.groupId,1,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var a,s=e.data,i=null,n="",o=tool.formatHtml("download");for(var r in s){a=0==r?' class="fir"':"",i=s[r].detailList[0];var l=s[r].mediaUrl.substring(s[r].mediaUrl.lastIndexOf(".")+1).toLowerCase(),d=i.title+"."+l,c=common.formatterDate(s[r].publishStartDate,"-").replace("-","/").replace("-","/");n+=o.formatStr(a,t[l],i.title,i.authorInfo?i.authorInfo.name:"",c,s[r].mediaUrl,d,"")}$(".dr6 .ppt_list ul").html(n),indexJS.setListScroll(".ppt_list",{isCustom:!1,scrollbarPosition:"outside",theme:"dark-2"})}else $(".dr6 .ppt_list ul").html("")})},initShowTrade:function(){$(".loading_trade").removeClass("dn");var t={groupType:indexJS.userInfo.groupType};common.isValid(tool.tradeForUser)&&(t.userNo=tool.tradeForUser),common.getJson("/fxstudio/getShowTrade",{data:JSON.stringify(t)},function(t){t.isOK&&common.isValid(t.data)?(common.isBlank(tool.tradeForUser)?$(".dr9 .allsd_list .sdlistcont ul").empty():$(".dr9 .mysd_list .sdlistcont ul").empty(),tool.tradeList=t.data.tradeList||[],tool.tradeLoadAll=!1,tool.setShowTrade()):$(".loading_trade").addClass("dn")})},setShowTrade:function(){if(tool.tradeLoadAll)return $(".loading_trade").addClass("dn"),!1;var t=common.isBlank(tool.tradeForUser)?$(".dr9 .allsd_list .usersd_list li").size():$(".dr9 .mysd_list .usersd_list li").size(),e=tool.tradeList,a=null,s=e.length;$("#sdcount").text(common.isValid(tool.tradeForUser)?s:"0");for(var i,n="",o=common.isBlank(tool.tradeForUser)?tool.formatHtml("showTradeAll"):tool.formatHtml("showTradeUser"),r=t;s>r&&t+20>r;r++){switch(a=e[r],a.status){case 1:i="";break;case 0:i=' class="s1"';break;case-1:i=' class="s2"'}var l=common.formatterDateTime(a.showDate,"/").substr(0,16);n+=common.isBlank(tool.tradeForUser)?o.formatStr(a.title,a.user.userName,l,a.tradeImg,a.remark,common.isBlank(a.praise)?0:a.praise,a._id,a.user.userNo,a.user.avatar):o.formatStr(i,a.title,a.tradeImg,a.remark,l,common.isBlank(a.praise)?0:a.praise,a._id)}common.isBlank(tool.tradeForUser)?$(".dr9 .allsd_list .sdlistcont ul").append(n):$(".dr9 .mysd_list .sdlistcont ul").append(n),$(".loading_trade").addClass("dn"),r>=s-1&&(tool.tradeLoadAll=!0),tool.setUserShowTrade(),tool.showTradePraise(),indexJS.setListScroll(".dr9 .sdlistcont",{isCustom:!1,scrollbarPosition:"outside",theme:"dark-2",callbacks:{onTotalScroll:function(){$(".loading_trade").removeClass("dn"),tool.setShowTrade()}}})},setUserShowTrade:function(){$(".dr9 .allsd_list .usersd_list li .sdinfo_bar .fl a").click(function(){tool.tradeForUser=$(this).attr("userId"),tool.initShowTrade(),$(".dr9 .mysd_list .sdinfo .sdinfo_cont .headimg img").attr("src",$(this).attr("avatar")),$(".dr9 .mysd_list .sdinfo .sdinfo_cont span b").text($(this).text()),$(".dr9 .allsd_list").addClass("dn"),$(".dr9 .mysd_list").removeClass("dn")})},showTrade:function(){var t=$("#title").val(),e=$("#userName").val(),a=$("#tradeImg").val(),s=$("#remark").val();if(common.isBlank(t))$("#trade_error").text("请输入标题").show();else if(common.isBlank(e))$("#trade_error").text("请输入晒单人").show();else if(common.isBlank(a))$("#trade_error").text("请上传晒单图片").show();else{var i={groupType:indexJS.userInfo.groupType,userNo:indexJS.userInfo.userId,avatar:$("#avatarInfoId").attr("src"),userName:e,tradeImg:a,remark:s,title:t,tradeType:2};common.getJson("/fxstudio/addShowTrade",{data:JSON.stringify(i)},function(t){t.isOK?($(".sd_result").removeClass("dn").show(),indexJS.userInfo.isSetName||($('#setNkForm input[name="nickname"]').val(e),$("#setNkBtn").click())):box.showMsg(t.msg)})}},showTradePraise:function(){$(".dr9 .sdlistcont ul li .support").click(function(){var t=$(this),e={clientId:indexJS.userInfo.userId,praiseId:$(this).attr("id")};common.getJson("/fxstudio/setTradePraise",{data:JSON.stringify(e)},function(e){if(e.isOK){t.find("i").fadeIn().delay(400).fadeOut();var a=t.find("span");a.text(common.isValid(a.text())?parseInt(a.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");t.addClass("supported"),t.attr("title","已点赞")},!0)})},currentDate:function(){return common.formatterDate(indexJS.serverTime,"-")},clearCls:function(t,e){$(t).removeClass(e)},formatHtml:function(t){var e=[];switch(t){case"finance":e.push("<li>"),e.push('   <table cellpadding="0" cellspacing="0" border="0" width="100%" class="calendar_table">'),e.push("       <tr>"),e.push('           <td width="98"><span class="time">{0}</span></td>'),e.push('           <td><img src="http://www.24k.hk/public/economicCalenda/images/country/{1}.png" width="23">{2}</td>'),e.push('           <td width="80"><div class="stars">{3}</div></td>'),e.push("       </tr>"),e.push("       <tr>"),e.push('           <td colspan="3"><span class="tit">{4}</span></td>'),e.push("       </tr>"),e.push("       <tr>"),e.push("           <td>前值:<strong>{5}</strong></td>"),e.push("           <td>预测值:<strong>{6}</strong></td>"),e.push("           <td>公布值:<strong>{7}</strong></td>"),e.push("       </tr>"),e.push("   </table>"),e.push("</li>");break;case"cftcperc":e.push("<tr>"),e.push('   <td width="53"><strong>{0}</strong></td>'),e.push('   <td width="30">{1}%</td>'),e.push('   <td><div class="perc_box"><b style="width:{1}%"></b></div></td>'),e.push('   <td width="30" class="align_r">{2}%</td>'),e.push("</tr>");break;case"cftcdata":e.push("<tr>"),e.push("   <td>{0}</td>"),e.push('   <td align="right">{1}</td>'),e.push('   <td align="right">{2}</td>'),e.push("   <td></td>"),e.push('   <td align="center">{3}</td>'),e.push("</tr>");break;case"download":e.push("<li{0}>"),e.push("   <i{1}></i>"),e.push('   <div class="detail">'),e.push("       <strong>{2}</strong>"),e.push("       <span>{3}<b>{4}</b></span>"),e.push('       <a href="{5}" target="download" download="{6}" class="downbtn" onclick="_gaq.push([\'_trackEvent\', \'fx_studio\', \'file_download\',$(this).prev().prev().text()]);"><i></i><span>下载<b>{7}</b></span></a>'),e.push("   </div>"),e.push("</li>");break;case"showTradeAll":e.push("<li>"),e.push('    <span class="sd_tit" title="{0}">{0}</span>'),e.push('    <div class="sdinfo_bar">'),e.push('        <span class="fl">晒单人：<a href="javascript:void(0)" userId="{7}" avatar="{8}">{1}</a></span>'),e.push('        <span class="sd_date">{2}</span>'),e.push("    </div>"),e.push('    <a href="{3}" data-rel="usersd" data-title="{0}" class="lightbox" data-lightbox="dialog-img"><img src="{3}" alt="{0}"><i></i></a>'),e.push('    <p class="sd_skill">{4}</p>'),e.push('    <a href="javascript:void(0)" class="support" id="{6}">(<span>{5}</span>)<i>+1</i></a>'),e.push("</li>");break;case"showTradeUser":e.push("<li{0}>"),e.push('    <i class="state"></i>'),e.push('    <span class="sd_tit" title="{1}">{1}</span>'),e.push('    <a href="{2}" data-rel="usersd" data-title="{1}" class="lightbox" data-lightbox="dialog-img"><img src="{2}" alt="{1}"><i></i></a>'),e.push('    <p class="sd_skill">{3}</p>'),e.push('    <div class="sdbotbar">'),e.push('        <span class="sd_date">{4}</span>'),e.push('        <a href="javascript:void(0)" class="support" id="{6}">(<span>{5}</span>)<i>+1</i></a>'),e.push("    </div>"),e.push("</li>")}return e.join("")},importanceLevel:function(t){var e="";switch(t){case 1:e='<span class="bling">★</span><span>★</span><span>★</span><span>★</span><span>★</span>';break;case 2:e='<span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span><span>★</span>';break;case 3:e='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span>';break;case 4:e='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span>';break;case 5:e='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span>';break;default:e="<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>"}return e}};$(function(){tool.init()});