function UUID(){this.id=this.createUUID()}function openLive800Chat(t){var e="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";t?location.href=e:window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(t,e){common.isBlank(e)&&(e="800018282");var i="http://crm2.qq.com/page/portalpage/wpa.php?uin="+e+"&cref=&ref=&f=1&ty=1&ap=&as="+t;window.open(i,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(t)}function live800Prompt(t){window.onbeforeunload=null;var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==t)try{UUID.prototype.createUUID();window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(i)}}function qqPrompt(t){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}var _gaq=_gaq||[],_hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(t){var e=new Date(1582,10,15,0,0,0,0),i=new Date,s=i.getTime()-e.getTime(),o=UUID.getIntegerBits(s,0,31),a=UUID.getIntegerBits(s,32,47),n=UUID.getIntegerBits(s,48,59)+"1",r=UUID.getIntegerBits(UUID.rand(4095),0,7),u=UUID.getIntegerBits(UUID.rand(4095),0,7),l=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return(t||"")+o+a+n+r+u+l},UUID.getIntegerBits=function(t,e,i){var s=UUID.returnBase(t,16),o=new Array,a="",n=0;for(n=0;n<s.length;n++)o.push(s.substring(n,n+1));for(n=Math.floor(e/4);n<=Math.floor(i/4);n++)a+=o[n]&&""!=o[n]?o[n]:"0";return a},UUID.returnBase=function(t,e){return t.toString(e).toUpperCase()},UUID.rand=function(t){return Math.floor(Math.random()*(t+1))};var chatAnalyze={localHref:window.location.href,utmStore:{ip:"",storeKey:"GWAFLGPHONECOOIKETRACK",userId:"",roomId:"",groupType:"",speakCount:0,onlineSTM:(new Date).getTime(),onlineETM:0},isLocalHref:function(){return/^https?:\/\/(\d{1,3}\.){3}\d{1,3}.+/.test(chatAnalyze.localHref)},init:function(){if(!this.isLocalHref()){var t="";-1!=chatAnalyze.localHref.indexOf("/studio")?t="studio":-1!=chatAnalyze.localHref.indexOf("/fxstudio")?t="fxstudio":-1!=chatAnalyze.localHref.indexOf("/hxstudio")&&(t="hxstudio"),""!=t&&(this.initGA(t),this.setGA(),this.setBaidu())}},initGA:function(t){"studio"==t&&(_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"])),"fxstudio"==t&&(_gaq.push(["_setAccount","UA-49389835-1"]),_gaq.push(["_setDomainName","gwfx.com"]),_gaq.push(["_addIgnoredRef","gwfx.com"])),"hxstudio"==t&&(_gaq.push(["_setAccount",""]),_gaq.push(["_setDomainName","handan.hx9999"]),_gaq.push(["_addIgnoredRef","handan.hx9999"])),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"])},setGA:function(){try{var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},setBaidu:function(){try{var t=document.createElement("script");t.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},getIp:function(t){$.getJSON("http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_="+Math.random(),function(e){chatAnalyze.utmStore.ip=e.Ip,t&&t()})},setUTMCookie:function(t,e){if(common.isValid(t)){var i="127.0.0.1";1==e&&(i=".gwfx.com"),2==e&&(i=".24k.hk"),document.cookie=this.utmStore.storeKey+"="+escape(t)+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/;domain="+i}},getUTMCookie:function(){for(var t=document.cookie,e=t.split(/[;&]/),i=0;i<e.length;i++){var s=e[i].split("=");if($.trim(s[0])==this.utmStore.storeKey)return s[1]}return""},setUTM:function(t,e){try{this.getIp(),t?(this.utmStore.roomId=e.groupId,this.utmStore.userId=e.userId,this.utmStore.userTel=e.userTel,this.utmStore.clientGroup=e.clientGroup,this.utmStore.groupType=e.groupType,$(window).unload(function(){chatAnalyze.utmStore.onlineETM=(new Date).getTime(),chatAnalyze.sendUTM(null),window.event.returnValue=!0})):e.speakCount?this.utmStore.speakCount+=e.speakCount:chatAnalyze.utmStore.ip?chatAnalyze.sendUTM(e):this.getIp(function(){chatAnalyze.sendUTM(e)})}catch(i){console.log("Set UTM fail!"+i)}},utmAjax:function(t,e,i){$.ajax({async:i,url:t+"?t="+(new Date).getTime(),cache:!1,dataType:i?"jsonp":"json",data:{data:JSON.stringify(e)},success:function(t){}})},sendUTM:function(t){try{if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e=chatAnalyze.utmStore;if(!e.roomId||!e.groupType)return;if(!e.userTel&&!e.userId){var i=store.get("storeInfo_"+e.groupType);if(!i)return;e.userId=i.userId}var s=-1!=e.groupType.indexOf("fx")?1:2,o=this.getUTMCookie(),a=this.isLocalHref();common.isBlank(o)&&(o=UUID.prototype.createUUID(1==s?"":"G"),this.setUTMCookie(o,a?0:s));var n={userId:o,customerType:e.clientGroup,ip:e.ip,businessPlatform:s,platformType:common.isMobile()?1:0,roomId:e.roomId};e.userTel?n.operationTel=e.userTel:n.visitorId=e.userId;var r=a?"http://testweb.gwfx.com:8088/GwUserTrackingManager_NEW/put/insertChart":"http://das.gwfx.com/put/insertChart";t&&t.courseId?(n.courseId=t.courseId,this.utmAjax(r,n,!0)):(n.startDateTime=e.onlineSTM,n.endDateTime=e.onlineETM,n.speakCount=e.speakCount,navigator.sendBeacon?navigator.sendBeacon(r+"Close",JSON.stringify(n)):this.utmAjax(r,n,!1))}catch(u){console.log("send UTM fail!"+u)}}};$(function(){chatAnalyze.init()});var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(t,e){return isNaN(e)||e>t.length?!1:void t.splice(e,1)},joinSplit:function(t){return",".concat(t).concat(",")},isBlank:function(t){return void 0==t||null==t||"undefined"==t||"null"==t||""==$.trim(t)},isValid:function(t){return!this.isBlank(t)},trim:function(t){return this.isBlank(t)?"":t.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(t){return document.createElement("div").appendChild(document.createTextNode(t)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(t){return this.isBlank(t)?"":t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(t,e){e||(e="-"),t instanceof Date||(t=new Date(t));var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate());return i},getHHMMSS:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return e},getMMSS:function(t){return t instanceof Date||(t=new Date(t)),(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},getHHMM:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return e},formatterDateTime:function(t,e){if(e||(e="-"),t instanceof Date||(t=new Date(t)),"Invalid Date"==t)return"";var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return i},longMsTimeToDateTime:function(t,e){var i=new Date(t);return this.formatterDateTime(i,e)},showBox:function(t,e){$(t).slideDown(),$(e||".layer-shadow").show()},hideBox:function(t,e){$(t).slideUp(),$(e||".layer-shadow").hide()},containSplitStr:function(t,e){return common.isBlank(t)||common.isBlank(e)?!1:-1!=(","+t+",").indexOf(","+e+",")},getJson:function(t,e,i,s,o){var a=null;return $.ajax({url:t,type:"POST",timeout:1e5,cache:!1,async:void 0!=s?s:!1,dataType:"json",data:e,success:"function"==typeof i?i:function(t){a=t},error:function(t,e){"function"==typeof o?o(e):common.isValid(t.responseText)&&"OK"!=t.statusText?alert(t.responseText):alert("请求超时,请重试!")}}),a},arraySort:function(t,e){return function(i,s){return e?i[t]<s[t]:i[t]>s[t]}},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},isMobilePhone:function(t){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(t)},dateTimeWeekCheck:function(t,e,i){if(this.isBlank(t))return!!e;$.isPlainObject(t)||(t=JSON.parse(t));var s=i?new Date(i):new Date,o=!1,a=this.formatterDate(s);if(o=this.isBlank(t.beginDate)||a>=t.beginDate,o&&(o=this.isBlank(t.endDate)||a<=t.endDate),!o)return!1;var n=t.weekTime;if(this.isBlank(n))return o;var r=null,u=null,l=!1;for(var d in n)if(r=n[d],(!this.isValid(r.week)||s.getDay()==parseInt(r.week))&&(u=this.getHHMMSS(s),l=this.isBlank(r.beginTime)||u>=r.beginTime,l&&(l=this.isBlank(r.endTime)||u<=r.endTime),l))break;return l},arrayUnique:function(t){if(!t)return t;for(var e,i=[],s={},o=0;null!=(e=t[o]);o++)s[e]||(i.push(e),s[e]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(t,e,i){return common.isWebSocket()?(console.log("used websocket!"),t.connect(e.webSocket+"/"+i,{transports:["websocket"]})):t.connect(e.socketIO+"/"+i)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},clearMsgHtml:function(t){var t=t.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return t&&(t=$.trim(t)),t},formatToJson:function(t){return this.isBlank(t)?null:JSON.parse(t)},getSyllabusPlan:function(t,e,i,s){if(!t||!t.courses)return null;var o=function(t,e){if(t){var o,a=common.isMobile();"object"!=typeof t&&(t=JSON.parse(t));for(var n in t)if(o=t[n],a){if(1==e&&(!i&&3==o.code||i&&4==o.code))return o.url}else if(s){if(1==e&&3==o.code){var r=o.url||"";return r=r.replace(/^http:/,"rtmps:").replace(/\/playlist\.m3u8$/,"")}}else if(o.code==e)return o.url}},a=function(e,i,s){var a=null,n=e.course;return n&&n.length>i?(a=n[i],0==a.status||common.isBlank(a.lecturerId)?null:(a.studioLink=o(t.studioLink,a.courseType),a.startTime=e.startTime,a.endTime=e.endTime,a.day=r[i].day,a.isNext=s,a)):null},n=null;n=this.isValid(t.courses)&&"object"!=typeof t.courses?JSON.parse(t.courses):t.courses;for(var r=n.days,u=n.timeBuckets,l=new Date(e).getDay(),d=common.getHHMM(e),c=null,h=!1,p=null,f=null,m=0;m<r.length;m++)if(0!=r[m].status)if(r[m].day>l){for(var g in u)if(c=u[g],f=a(c,m,!0))return f}else if(r[m].day==l)for(var g in u){if(c=u[g],c.startTime<=d&&(c.endTime>=d||"00:00"==c.endTime))return h=!0,a(c,m,!1);if(!h&&c.startTime>d)return h=!0,a(c,m,!0)}else if(!p)for(var g=0;g<u.length;g++)if(f=u[g].course,f&&0!=f[m].status&&!common.isBlank(f[m].lecturerId)){p={dayIndex:m,tmIndex:g};break}return!h&&p?a(u[p.tmIndex],p.dayIndex,!0):null},formatSyllabus:function(t,e,i,s){var o={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},a=new Date(e).getDay(),n=this.getHHMM(e),r=$.extend({},o,s),u=function(t,e,i,s){var o=0,u=(t+6)%7,l=(a+6)%7;return o=u>l?2:l>u?0:s?1:n>=i?0:e>n?2:1,r.courseCls[o]},l=[];try{if(t){var d=$.isPlainObject(t)?t:JSON.parse(t),c=d.days?d.days.length:0;if(c>0)if(1===i){var h={0:"文字",1:"视频",2:"oneTV"};l.push('<div class="sy_panel">');var p=e-864e5*((a+6)%7),f=null,m=null,g=null;l.push('<div class="sy_nav">');for(var v=' style="width:'+100/c+'%;"',b=0;c>b;b++)f=new Date(p+(d.days[b].day+6)%7*864e5),m=f.getFullYear()+"-"+(f.getMonth()<9?"0":"")+(f.getMonth()+1)+"-"+(f.getDate()<10?"0":"")+f.getDate(),g=d.days[b].day==a?' class="active"':"",l.push('<a href="javascript:void(0)" d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<br/><span>"+m+'</span><em class="dir">^</em></a>');l.push("</div>"),l.push('<div class="sy_cont"><div>'),l.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var T=null,w=null,b=0;c>b;b++){if(l.push('<tbody d="'+d.days[b].day+'">'),0==d.days[b].status)w=u(d.days[b].day,null,null,!0),l.push('<tr class="'+w+'" width="100%"><td>休市</td></tr>');else for(var C=0,M=d.timeBuckets.length;M>C;C++)T=d.timeBuckets[C],w=u(d.days[b].day,T.startTime,T.endTime,!1),0==T.course[b].status?(l.push('<tr class="'+w+'">'),l.push('<td width="25%">'+T.startTime+"-"+T.endTime+"</td>"),l.push('<td colspan="2" width="75%">休市</td>'),l.push("</tr>")):T.course[b].lecturer&&(l.push('<tr class="'+w+'">'),l.push('<td width="25%">'+T.startTime+"-"+T.endTime+"【"+h[T.course[b].courseType]+"】</td>"),l.push('<td width="25%">'+T.course[b].lecturer+"</td>"),l.push('<td width="50%">'+T.course[b].title+"</td>"),l.push("</tr>"));l.push("</tbody>")}l.push("</table>"),l.push("</div></div>"),l.push("</div>")}else if(2===i){l.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),l.push("<tr>"),l.push("<th>星期\\节次</th>");for(var M=d.timeBuckets?d.timeBuckets.length:0,T=null,w=null,C=0;M>C;C++)T=d.timeBuckets[C],l.push("<th>"+r.indexCN[C]+"<br><span>("+T.startTime+"-"+T.endTime+")</span></th>");l.push("</tr>");for(var y=null,b=0,k=d.days?d.days.length:0;k>b;b++){if(y=d.days[b],l.push("<tr>"),l.push("<th>"+r.dayCN[y.day]+"</th>"),0==y.status)w=u(y.day,null,null,!0),l.push('<td class="'+w+'" colspan="'+M+'">休市</td>');else for(var C=0;M>C;C++)T=d.timeBuckets[C],w=u(y.day,T.startTime,T.endTime,!1),l.push('<td class="'+w+'">'+(0==T.course[b].status?"休市":T.course[b].lecturer)+"</td>");l.push("</tr>")}l.push("</table>")}else if(3===i){var p=n-864e5*((a+6)%7),f=null,g=null,y=null,v=' style="width:'+100/c+'%;"';l.push("<tr>");for(var b=0;c>b;b++)y=d.days[b],f=new Date(p+(d.days[b].day+6)%7*864e5),g=d.days[b].day==a?' class="active"':"",l.push('<th d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<i></i></th>");l.push("</tr>"),l.push('<tr><td class="space" colspan="'+c+'"></td></tr>');for(var T=null,w=null,b=0;c>b;b++){if(y=d.days[b],l.push('<tr d="'+y.day+'"><td colspan="'+c+'">'),0==y.status)w=u(y.day,null,null,!0),l.push('<p class="'+w+'">休市</p>');else for(var C=0,M=d.timeBuckets?d.timeBuckets.length:0;M>C;C++)T=d.timeBuckets[C],T.course[b].lecturer&&(w=u(y.day,T.startTime,T.endTime,!1),l.push('<p class="'+w+'">'),l.push("<span>"+T.startTime+"-"+T.endTime+"</span>"),0==T.course[b].status?l.push("<span>休市</span>"):(l.push("<span>"+r.courseType[T.course[b].courseType]+"</span>"),l.push("<span>"+T.course[b].lecturer+"</span>"),l.push('<span class="item">'+T.course[b].title+"</span>")),l.push("</p>"));l.push("</td></tr>")}}}}catch(I){return console.error("formatSyllabus->"+I),""}return l.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(t,e,i){if(!e)return t;for(var s in t)e.hasOwnProperty(s)&&common.isValid(e[s])&&(t[s]=e[s]);if(i)for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])},isRightName:function(t){return!/^([0-9]{2,20})$/g.test(t)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(t)},randomIndex:function(t){var e=parseInt(Math.round(Math.random()*t));return e==t&&(e=t-1),0>e?0:e},saveToDesktop:function(t,e){try{var i=new ActiveXObject("WScript.Shell"),s=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+e+".url");s.TargetPath=t,s.Save()}catch(o){return!1}return!0}};window.console||(console=function(){function t(){}function e(){return null==i&&(i=new t),i}var i=null;return t.prototype={log:function(t){},error:function(t){}},e()}()),$.fn.focusEnd=function(){$(this).focus();var t=$("<span/>").appendTo($(this)),e=t.get(0),i=null,s=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(e),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e),s=window.getSelection(),s.removeAllRanges(),s.addRange(i)),t.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var t=this,e=0;e<arguments.length;e++)t=t.replace(new RegExp("\\{"+e+"\\}","g"),null==arguments[e]||void 0==arguments[e]?"":arguments[e]);return t};var studioChatMb={initSewise:!1,web24kPath:"",filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,fromPlatform:null,serverTime:0,pushObj:{talkPush:[],talkPushInterval:null},msgType:{text:"text",img:"img",file:"file"},socket:null,socketUrl:"",userInfo:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.whTalk.initWH(),this.setSocket(),this.setEvent(),this.setVideoList(),studioMbPop.load(this.userInfo,this.fromPlatform,{onShow:function(){$("#tVideoDiv video").hide()},onHide:function(){$("#tVideoDiv video").show()}}),this.initRoom()},initRoom:function(){if(this.userInfo.nickname||this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12)),"visitor"==this.userInfo.clientGroup){var t=$("#currStudioInfo").attr("lgt");if(common.isValid(t)&&!isNaN(t))if(this.currStudioAuth)if(studioMbPop.Login.forceLogin())studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform,closeable:!1,showTip:!0});else try{t=parseInt(t),window.setTimeout(function(){"visitor"==studioChatMb.userInfo.clientGroup&&(studioMbPop.Login.forceLogin(!0),studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform,closeable:!1,showTip:!0}))},60*t*1e3)}catch(e){console.error("set login Time has error",e)}else studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform,closeable:!1})}},refreshNickname:function(t,e){this.userInfo.isSetName=t,this.userInfo.nickname=e,$("#header_ui").text(e),studioMbPop.Person.refreshNickname(e)},serverTimeUp:function(){setInterval(function(){studioChatMb.serverTime+=1e3},1e3)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfo_"+this.userInfo.groupType,e=store.get(t),i={};if(common.isBlank(e)){var s=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+s,i.userId="visitor_"+s,i.nickname="游客_"+s,i.userType=-1,store.set(t,i),$(".collect-tip").fadeIn().delay(6e4).fadeOut()}else i=e;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||($("#contentText").attr("contenteditable",!1).append('<span style="margin:15px 5px;">亲，<a id="contentText_login" href="javascript:void(0);" style="text-decoration: underline;color:#3F51B5;cursor: pointer;">登录</a>&nbsp;&nbsp;后可以发言哦~</span>'),$("#contentText_login").click(function(){studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform})}))):(i.loginId=this.userInfo.userId,store.set(t,i)),this.isNeverLogin=!common.isValid(i.loginId)},setSocket:function(){studioMbPop.loadingBlock($("#talkBoxTab")),this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),studioChatMb.userInfo.socketId=studioChatMb.socket.id,studioChatMb.socket.emit("login",{userInfo:studioChatMb.userInfo,lastPublishTime:$("#dialog_list>li:last").attr("id"),fromPlatform:studioChatMb.fromPlatform,allowWhisper:studioChatMb.whTalk.enable},navigator.userAgent)}),this.socket.on("onlineUserList",function(t,e){for(var i in t)studioChatMb.whTalk.enable&&3==t[i].userType&&studioChatMb.whTalk.setCSOnline(t[i].userId,!0),(3==t[i].userType||2==t[i].userType)&&studioChatMb.setFastContact(t[i],!0);studioChatMb.whTalk.enable&&studioChatMb.whTalk.getCSList()}),this.socket.on("disconnect",function(){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){if(t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle)studioChatMb.whTalk.receiveMsg(t,!1,!1);else{if(!t.serverSuccess&&studioChatMb.userInfo.userId==t.fromUser.userId&&!t.rule)return;studioChatMb.setContent(t,!1,!1)}}),this.socket.on("notice",function(t){switch(t.type){case"onlineNum":var e=t.data,i=e.onlineUserInfo;3==i.userType&&studioChatMb.whTalk.enable&&studioChatMb.whTalk.setCSOnline(i.userId,e.online),(3==i.userType||2==i.userType)&&studioChatMb.setFastContact(i,e.online);break;case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),studioChatMb.setTalkListScroll();break;case"leaveRoom":studioChatMb.leaveRoomTip(t.flag);break;case"approvalResult":var e=t.data,s=0;if(e.refuseMsg){var o=e.publishTimeArr;for(s in o)$("#"+o[s]+" .dialog em[class=ruleTipStyle]").html("已拒绝")}else{for(s in e)studioChatMb.formatUserToContent(e[s]);studioChatMb.setTalkListScroll()}break;case"pushInfo":var e=t.data;1==e.position?(studioChatMb.whTalk.pushObj={info:e.content,publishTime:e.publishTime,infoId:e.contentId},window.setTimeout(function(){studioChatMb.whTalk.pushMsg()},60*e.timeOut*1e3)):3==e.position&&studioChatMb.talkBoxPush.initTBP(e.infos);break;case"serverTime":studioChatMb.serverTime=t.data}}),this.socket.on("loadMsg",function(t){var e=t.msgData,i=t.isAdd;if(i||$("#content_ul").html(""),e&&$.isArray(e)){e.reverse();for(var s in e)studioChatMb.formatUserToContent(e[s]);studioMbPop.loadingBlock($("#talkBoxTab"),!0),studioChatMb.setTalkListScroll(),window.setTimeout(function(){studioChatMb.setTalkListScroll()},500)}}),this.socket.on("loadWhMsg",function(t){var e=t.data;if(e&&$.isArray(e))for(var i,s=0,o=e.length;o>s;s++)i=e[s],studioChatMb.formatUserToContent(i,!0,t.toUserId);studioMbPop.loadingBlock($("#whTalkBoxTab"),!0)})},setVideoList:function(){studioMbPop.loadingBlock($("#videosTab")),this.getArticleList("teach_video_base,teach_video_gw,teach_video_expert",this.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){var e=$("#videosTab .boxcont");if(e.html(""),t&&0==t.result){for(var i=t.data,s=[],o=null,a=0,n=i?i.length:0;n>a;a++)a%5==0&&s.push('<ul class="teach-ul">'),o=i[a].detailList[0],s.push('<li><a title="'+o.title+"\" href=\"javascript:void(0)\" onclick=\"_gaq.push(['_trackEvent', 'm_fx_studio', 'teachvideo_"+a+"', 'content_middle',1,true]);\" id=\""+i[a]._id+'" vUrl="'+i[a].mediaUrl+'"><i></i><span>'+o.title+"</span></a></li>"),(a%5==4||a==n-1)&&s.push("</ul>"),e.html(s.join(""));e.find("li a").click(function(){$(this).is(".on")||($("#videosTab .boxcont li a.on").removeClass("on"),$(this).addClass("on")),studioChatMb.video.change(!1,!0),studioChatMb.video.play("studio","mp4",$(this).attr("vUrl"),$(this).text()),chatAnalyze.setUTM(!1,{courseId:$(this).attr("id")})})}studioChatMb.video.start(!1,!0),studioMbPop.loadingBlock($("#videosTab"),!0)})},setEvent:function(){this.setEventCen(),this.video.init(),this.setEventChat(),this.setHeight(),this.browserState.initBrowserState()},setHeight:function(){var t=0;t+=$(".videopart").height(),t+=$(".cen-ulist").is(":hidden")?0:$(".cen-ulist").height(),t+=$("#header").is(":hidden")?0:$("#header").height(),t=$(window).height()-t,$(".cen-pubox .boxcont:gt(1)").height(t),t-=$(".float-box").height(),$(".cen-pubox .boxcont:lt(2)").height(t)},setFastContact:function(t,e){var i=$("#talkViewCtrl");if(e){if(0==i.find("a[uid='"+t.userId+"']").size()){3==t.userType&&(t.nickname=t.nickname+"&nbsp;（助理）");var s=$('<a href="javascript:void(0)" class="" uid="'+t.userId+'">@'+t.nickname+"</a>");s.bind("click",t,function(t){var e=t.data;studioChatMb.setDialog(e.userId,e.nickname,0,e.userType,e.avatar)}),3==t.userType?i.find("a[t='analyst']").before(s):i.prepend(s)}}else i.find("a[uid='"+t.userId+"']").remove()},setEventCen:function(){var t=new Swiper(".cen-qhbox",{loop:!1,autoplay:!1,onSlideChangeStart:function(t){$(".cen-ulist li").eq(t.activeIndex).trigger("click")}});$(".cen-ulist li").click(function(){$(".cen-ulist li.on").removeClass("on"),$(this).addClass("on");var e=$(this).attr("t");"talkBoxTab"==e?(studioChatMb.view.boardCtrl(1),studioChatMb.whTalk.whSwitch(!1)):"whTalkBoxTab"==e?(studioChatMb.whTalk.whSwitch(!0),studioChatMb.view.boardCtrl(1)):(studioChatMb.whTalk.whSwitch(!1),studioChatMb.view.boardCtrl(0),"TradeArticleTab"==e?(_gaq.push(["_trackEvent","m_fx_studio","suggest_tab","content_middle",1,!0]),studioChatMb.setTradeArticle()):"videosTab"==e&&_gaq.push(["_trackEvent","m_fx_studio","teachvideo_tab","content_middle",1,!0]),studioChatMb.setHeight()),t.slideTo($(this).index(),300,!1)}),$("#header_hb").bind("click",function(){window.location.href="/fxstudio/home"}),$("#header_ui").bind("click",function(){studioChatMb.userInfo&&studioChatMb.userInfo.isLogin?studioMbPop.popBox("person"):studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform})})},setEventChat:function(){$("#msgFaceBtn").bind("click",function(){$(this).blur(),2==studioChatMb.view.viewBoard?studioChatMb.view.boardCtrl(1):studioChatMb.view.boardCtrl(2),studioChatMb.face.init($("#facePanel"),$("#contentText"),studioChatMb.filePath+"/face/",!studioChatMb.visitorSpeak&&"visitor"==studioChatMb.userInfo.clientGroup)}),$("#talkBoxTab .view_select").click(function(){var t=$(this);t.is(".dw")?(t.removeClass("dw"),studioChatMb.view.viewSelect=!1):(t.addClass("dw"),studioChatMb.view.viewSelect=!0)}).find(".selectlist a").click(function(){if($(this).is("[t]")&&!$(this).is(".on")){$("#talkBoxTab .view_select .selectlist a").removeClass("on"),$("#talkBoxTab .view_select .selected").text($(this).text()),$(this).addClass("on");var t=$(this).attr("t");_gaq.push(["_trackEvent","m_fx_studio","filter_"+t,"content_left",1,!0]),studioChatMb.showViewSelect(t)}}),$(document).bind("touchstart",function(t){if(studioChatMb.view.viewSelect){var e=$("#talkBoxTab .view_select");e.is(t.target)||0!=e.find(t.target).length||e.trigger("click")}if(studioChatMb.whTalk.viewSelect){var e=$("#whThtalkBoxTab .view_select");e.is(t.target)||0!=e.find(t.target).length||e.trigger("click")}}),$("#contentText").keydown(function(t){var e=$(this).html();return 13==t.keyCode?(common.isValid(e)&&($(this).html(e.replace(/<div>|<\/div>/g,"")),$("#sendBtn").click()),!1):void 0}).keyup(function(t){if(8==t.keyCode){var e=$(this).find(".txt_dia");if($.trim($(this).text())==e.text()&&0==$(this).find("img").length)return e.remove(),$(this).html(""),!0}}).focus(function(){4==studioChatMb.view.viewBoard&&studioChatMb.view.boardCtrl(1)}).blur(function(){}).bind("input",function(){var t=$.trim($(this).text())!=$(this).find(".txt_dia").text()||$(this).find("img").size()>0;t?($("#sendBtn").show(),$("#sendToolBtn").hide(),$("#floatBox").removeClass("send-add")):($("#sendBtn").hide(),$("#sendToolBtn").show(),$("#floatBox").addClass("send-add"))}),$("#sendBtn").click(function(){if($(this).blur(),studioChatMb.view.boardCtrl(1),!studioChatMb.whTalk.tabCheck&&!studioChatMb.visitorSpeak&&"visitor"==studioChatMb.userInfo.clientGroup)return void studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform});if(studioChatMb.userInfo.isSetName===!1)return void studioMbPop.popBox("set",{studioChatObj:studioChatMb});var t=studioChatMb.getToUser(),e=studioChatMb.getSendMsg();if(e!==!1){var i={uiId:studioChatMb.getUiId(),fromUser:studioChatMb.userInfo,content:{msgType:studioChatMb.msgType.text,value:e}};i.fromUser.toUser=t,studioChatMb.whTalk.tabCheck?studioChatMb.whTalk.sendWhMsg(i):(studioChatMb.socket.emit("sendMsg",i),studioChatMb.setContent(i,!0,!1)),$("#contentText").html("").trigger("input"),chatAnalyze.setUTM(!1,{speakCount:1})}}),$("#sendToolBtn").click(function(){4==studioChatMb.view.viewBoard?studioChatMb.view.boardCtrl(1):studioChatMb.view.boardCtrl(4)}),$("#top_msg").click(function(){var t=$(this).find("label");$(this).slideUp(),studioChatMb.setDialog(t.attr("fuserId"),t.attr("fnickname"),0,t.attr("fuType"),null)}),$("#top_msg i").click(function(){return $("#top_msg").slideUp(),!1}),$(".file-img").click(function(){return FileReader?studioChatMb.whTalk.tabCheck||studioChatMb.visitorSpeak||"visitor"!=studioChatMb.userInfo.clientGroup?studioChatMb.userInfo.isSetName===!1?void studioMbPop.popBox("set",{studioChatObj:studioChatMb}):void 0:void studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform}):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$(".file-img").bind("change",function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=e.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var s=new FileReader;s.readAsDataURL(e),s.onload=function(t){studioChatMb.setUploadImg(t.target.result,studioChatMb.getToUser())},s.onprogress=function(t){},s.onloadend=function(t){},studioChatMb.view.boardCtrl(1),$(this).val("")})},setUploadImg:function(t,e){var i=studioChatMb.getUiId(),s={};common.copyObject(s,studioChatMb.userInfo,!0),s.toUser=e;var o={uiId:i,fromUser:s,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};studioChatMb.whTalk.tabCheck?studioChatMb.whTalk.sendWhMsg(o):this.setContent(o,!0,!1),o.content.value=t,this.zipImg(o,100,60,function(t,e){if(t.error)return alert(t.error),$("#"+i).remove(),!1;var s=$("#"+t.uiId+" span[contt='a'] a");s.attr("href",e).children("img").attr("src",e).attr("needMax",t.content.needMax),studioChatMb.dataUpload(t)})},zipImg:function(t,e,i,s){var o=new Image;o.onload=function(){var a=document.createElement("canvas");a||s({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"
});var n=o.width,r=o.height;if(r>=9*n)return s({error:"该图片高度太高，暂不支持发送！"}),!1;e>0&&(r>e||n>e)&&(t.content.needMax=1,r>e&&e>=n?(n=e/r*n,r=e):(r=e/n*r,n=e),o.height=r,o.width=n);var u=a.getContext("2d");a.width=n,a.height=r,u.clearRect(0,0,a.width,a.height),u.drawImage(o,0,0,n,r),s(t,a.toDataURL("image/jpeg",i/100))},o.src=t.content.value},dataUpload:function(t){var e=new XMLHttpRequest;e.open("POST","/fxstudio/uploadData"),e.addEventListener("progress",function(e){if(e.lengthComputable){var i=(e.loaded/e.total*100|0)+"%";$("#"+t.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+t.uiId+" .shadow-conut").html(i)}},!1),e.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&console.log("dataUpload success!")},t.fromUser.socketId=this.socket.id,e.send(JSON.stringify(t))},view:{viewSelect:!1,viewBoard:1,boardCtrl:function(t){if(this.viewBoard!=t){this.viewBoard=t;var e={header:$("#header"),backToLive:$("#backToLive"),floatBox:$("#floatBox"),facePanel:$("#facePanel"),imgBox:$("#sendToolPanel")};switch(t){case 0:e.header.show(),e.backToLive.show(),e.floatBox.hide();break;case 1:e.header.show(),e.backToLive.show(),e.floatBox.show(),e.facePanel.hide(),e.imgBox.hide();break;case 2:e.header.hide(),e.backToLive.hide(),e.floatBox.show(),e.facePanel.show(),e.imgBox.hide();break;case 3:e.header.show(),e.backToLive.hide(),e.floatBox.show(),e.facePanel.hide(),e.imgBox.hide();break;case 4:e.header.hide(),e.backToLive.hide(),e.floatBox.show(),e.facePanel.hide(),e.imgBox.show()}}}},video:{initPlayer:!1,playerType:"",videoType:"",studioType:"",liveUrl:"http://ct.phgsa.cn:1935/live/01/playlist.m3u8",$panel:null,backToLivePos:{x:0,y:0},waveAudio:$("#voiceWaveAudio"),init:function(){navigator.userAgent.match(/Android/i)||-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPod")||-1!=navigator.userAgent.indexOf("iPad")?this.playerType="video":this.playerType="sewise";var t=$(".videopart input:first");t.attr("yc"),t.attr("mc");this.$panel=$("#tVideoDiv"),this.$panel.css({"z-index":"inherit"}).height(.55*$(".videopart").width()),this.setEvent(),makeVideoPlayableInline(this.waveAudio[0])},start:function(t,e){var i=common.getSyllabusPlan(studioChatMb.syllabusData,studioChatMb.serverTime,e);if(!i||i.isNext||0!=i.courseType&&common.isBlank(i.studioLink)||2==i.courseType||0==i.courseType){if(t)return void studioMbPop.showMessage("目前还没有视频，详情请留意课程安排！");i&&!i.isNext&&0==i.courseType?$(".videopart").hide().css({height:"0"}):this.playMp4Vd()}else e?(this.change(!0),this.studioType="yy",this.voiceWave(!1,i.studioLink,i.title)):(this.change(!1),this.play("yy","",i.studioLink,""));studioChatMb.setHeight()},change:function(t,e){t?(this.doPause(),$("#waveDiv").removeClass("dn"),$("#tVideoDiv").addClass("dn"),e||$("#backToLive").removeClass("video").html("<span>视频<br />直播</span>")):(this.voiceWave(!1),$("#waveDiv").addClass("dn"),$("#tVideoDiv").removeClass("dn"),e||$("#backToLive").addClass("video").html("<span>音频<br />直播</span>"))},playMp4Vd:function(){if($("#studioTeachId a[class=on]").length<=0){var t=$("#videosTab li a"),e=$(t.get(common.randomIndex(t.length)));e.click()}},play:function(t,e,i,s){this.studioType=t;var o=$("#backToLive");if($(".videopart").is(":hidden")&&($(".videopart").show().css({height:"auto"}),studioChatMb.setHeight()),"studio"==t?o.data("showVideo",!0).trigger("show"):($("#videosTab li a.on").removeClass("on"),o.data("showVideo",!1).trigger("show")),"video"==this.playerType)if(this.initPlayer){var a=this.$panel.find("video");a.trigger("pause"),a.attr("src",i),a.trigger("play")}else{var n=$("body").attr("fp"),r="webui"!=n&&"app"!=n;this.$panel.append('<video src="'+i+'" webkit-playsinline controls="true" autoplay="'+r+'" style="width: 100%; height: 100%; background-color: rgb(0, 0, 0);"></video>');var u=this.$panel.find("video");r?u.trigger("play"):u.trigger("pause"),this.initPlayer=!0,this.setEventAd()}else if(this.initPlayer)SewisePlayer.toPlay(i,s,0,!0),this.videoType=e;else{var l=[];l.push("/base/lib/sewise.player.min.js?server=vod"),l.push("type="+e),l.push("videourl="+i),l.push("autostart=true"),l.push("logo="),l.push("title="+s),l.push("buffer=5");var d=l.join("&"),c=document.createElement("script");c.type="text/javascript",c.src=d,this.initPlayer=!0,this.videoType=e,this.$panel.get(0).appendChild(c),this.setEventAd()}},setEvent:function(){$(".ctrlblock div.replay a").bind("click",function(){var t=$("#videosTab li a.on");t.trigger("click")}),$(".ctrlblock div.nextbtn a").bind("click",function(){for(var t=$("#videosTab li a"),e=0,i=t.size();i>e;e++)if(t.eq(e).is(".on")){t.eq(i-1>e?e+1:0).trigger("click");break}}),$("#backToLive").css({left:function(){return $(window).width()-$(this).width()-10},top:function(){return $(window).height()-$("#header").height()-70}});var t=function(t,e){return t=Math.max(t,10),Math.min(t,e-10)};util.toucher($("#backToLive")[0]).on("singleTap",function(){studioChatMb.socket.emit("serverTime"),window.setTimeout(function(){var t=$("#backToLive").is(".video");t="studio"==studioChatMb.video.studioType?!t:t,studioChatMb.video.start(!0,t)},1e3)}).on("swipeStart",function(){studioChatMb.video.backToLivePos.x=parseInt(this.style.left)||0,studioChatMb.video.backToLivePos.y=parseInt(this.style.top)||0,this.style.transition="none",this.style.background=" rgba(181,144,48,0.8)"}).on("swipe",function(e){return this.style.left=t(studioChatMb.video.backToLivePos.x+e.moveX,$(window).width()-this.clientWidth)+"px",this.style.top=t(studioChatMb.video.backToLivePos.y+e.moveY,$(window).height()-this.clientHeight)+"px",!1}).on("swipeEnd",function(){return this.style.background=" rgba(181,144,48,.6)",!1}),$("#waveDiv .voice_ctrl .togglebtn").click(function(){var t=$(this),e=$("#waveDiv .voice_wave");e.hasClass("dn")?(t.removeClass("hiding"),e.removeClass("dn")):(t.addClass("hiding"),e.addClass("dn")),studioChatMb.setHeight()}),$("#waveDiv .voice_ctrl .playbtn").click(function(){studioChatMb.video.voiceWave($("#waveDiv").is(".stopped"))}),$("#waveDiv .voice_playbtn").click(function(){studioChatMb.video.voiceWave(!0)})},setEventAd:function(){if("sewise"==this.playerType){var t=function(){return window.SewisePlayer?(SewisePlayer.onPause(function(){"studio"==studioChatMb.video.studioType&&window.setTimeout(function(){SewisePlayer.duration()<=SewisePlayer.playTime()&&$(".ctrlblock").show()},1e3)}),void SewisePlayer.onStart(function(){$(".ctrlblock").hide()})):void window.setTimeout(t,500)};t()}else if("video"==this.playerType){var e=this.$panel.find("video");e.bind("ended",function(){"studio"==studioChatMb.video.studioType&&$(".ctrlblock").show()}).bind("loadstart",function(){$(".ctrlblock").hide()})}},doPlay:function(){"video"==this.playerType?this.$panel.find("video").trigger("play"):"sewise"==this.playerType&&window.SewisePlayer&&SewisePlayer.doPlay()},doPause:function(){"video"==this.playerType?this.$panel.find("video").trigger("pause"):"sewise"==this.playerType&&window.SewisePlayer&&SewisePlayer.doPause()},doFullscreen:function(){if("video"==this.playerType){var t=this.$panel.find("video")[0];t&&(t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.oRequestFullscreen?t.oRequestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullScreen())}},doExitFullscreen:function(){if("video"==this.playerType){var t=this.$panel.find("video")[0];t&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.oRequestFullscreen?document.oCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}},voiceWave:function(t,e,i){var s;common.isValid(e)&&(s=common.randomIndex(5),$("#waveImg").attr("idx",s),$("#voiceWaveAudio").attr("src",e)),common.isValid(i)&&$("#waveDiv .voice_ctrl .tit span").text(i),s=s||$("#waveImg").attr("idx")||"0",t?($("#waveDiv").removeClass("stopped"),$("#waveImg").attr("src","/fx/theme2/img/wave"+s+".gif"),studioChatMb.video.waveAudio.trigger("play")):($("#waveDiv").addClass("stopped"),$("#waveImg").attr("src","/fx/theme2/img/wave"+s+".jpg"),studioChatMb.video.waveAudio.trigger("pause"))}},face:{initFace:!1,init:function(t,e,i,s){this.initFace||(this.build(t,i),new Swiper(t,{pagination:".swiper-pagination",paginationClickable:!0}),t.find("img").bind("click",{panel:t,assign:e,disabled:s},function(t){t.data.disabled||t.data.assign.append($(this).clone()).trigger("input")}),this.initFace=!0)},build:function(t,e){for(var i=[],s=7,o=1;75>=o;o+=21){i.push('<div class="swiper-slide"><table border="0" cellspacing="0" cellpadding="0">');for(var a=o,n=Math.min(o+20,75);n>=a;a++)a%s==1&&i.push("<tr>"),i.push('<td><img src="'+e+a+'.gif"/></td>'),(a%s==0||a==n)&&i.push("</tr>");i.push("</table></div>")}t.find("div.face").html(i.join(""))}},setTalkListScroll:function(){$("#talkPanel").scrollTop($("#talkPanel")[0].scrollHeight)},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getArticleList:function(t,e,i,s,o,a,n,r){try{var u={code:t,platform:e,hasContent:i,pageNo:s,pageSize:o,orderByStr:a};n&&(u.authorId=common.trim(n)),$.getJSON("/fxstudio/getArticleList",u,function(t){r(t)})}catch(l){console.error("getArticleList->"+l),r(null)}},setTradeArticle:function(){studioMbPop.loadingBlock($("#TradeArticleTab")),studioChatMb.getArticleList("trade_strategy_article",studioChatMb.userInfo.groupId,1,1,1,'{"createDate":"desc"}',null,function(t){var e=$("#TradeArticleTab ul:first"),i=[];if(t&&0==t.result){var s=t.data;if(s&&s.length>0)for(var o=null,a=null,n=0,r=s.length;r>n;n++)o=s[n].detailList[0],a=o.authorInfo||{},i.push("<li>"),i.push('<div class="himg"><img src="'+(a.avatar||"")+'"></div>'),i.push('<div class="detail">'),i.push("<h3>"+o.title+"</h3>"),i.push('<div class="subinfo">'),i.push("<span>"+(a.name||"")+"</span>"),i.push("<span>"+(s[n].publishStartDate?common.longMsTimeToDateTime(s[n].publishStartDate):"")+"</span>"),i.push("</div>"),i.push("<p>"+o.content+"</p>"),i.push("</div>")}e.html(i.join("")),$("#TradeArticleTab .detail p span").attr("style",""),studioMbPop.loadingBlock($("#TradeArticleTab"),!0)})},showViewSelect:function(t){var e=$("#dialog_list");"analyst"==t?(e.children("[utype!=2]").hide(),e.children("[utype=2]").show()):"me"==t?(e.children("[isme='false']").hide(),e.children("[isme='true']").show()):e.children().show(),studioChatMb.setTalkListScroll()},getSendMsg:function(t){if(t=t||$("#contentText"),t.text().length+t.find("img").size()>140)return studioMbPop.showMessage("消息内容超过最大长度限制（140字以内）！"),!1;var e=t.html();return e=common.clearMsgHtml(e),common.isBlank(e)?(t.html(""),!1):(t.find(".txt_dia").length>0&&(t.find(".txt_dia").remove(),e=t.html(),e=e.replace(/^(&nbsp;){1,2}/,"")),e)},getToUser:function(){var t=$("#contentText .txt_dia");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype"),avatar:t.attr("avatar")}:null},formatPublishTime:function(t){return common.isBlank(t)?"":common.getHHMM(Number(t.replace(/_.+/g,"")))},setDialog:function(t,e,i,s,o){(studioChatMb.visitorSpeak||"visitor"!=studioChatMb.userInfo.clientGroup)&&($("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+s+'" avatar="'+o+'">@<label>'+e+"</label></span>&nbsp;").focusEnd())},setContent:function(t,e,i){var s=t.fromUser;if(e&&(s.publishTime=t.uiId),t.isVisitor)return void $("#"+t.uiId).remove();if(i&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" .dialog em[class=ruleTipStyle]").remove(),void $("#"+s.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",s.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||studioChatMb.userInfo.userId!=s.userId||!t.serverSuccess){var o=studioChatMb.formatContentHtml(t,e,i,!1),a=$("#dialog_list"),n=$("#talkPanel"),r=n.scrollTop()+n.height()+30>=n.get(0).scrollHeight;a.append(o),r&&!i&&studioChatMb.setTalkListScroll(),this.formatMsgToLink(s.publishTime);var u=$("#talkBoxTab .view_select .selectlist a[class=on]").attr("t");"all"!=u&&studioChatMb.showViewSelect(u),$("#"+s.publishTime+" .c-menu a").click(function(){var t=$(this).parents(".c-menu");studioChatMb.setDialog(t.attr("uid"),t.attr("nk"),$(this).attr("t"),t.attr("utype"))}),$("#"+s.publishTime+" .headimg").click(function(){$("#"+s.publishTime+" .c-menu a[t=0]").trigger("click")}),$("#"+s.publishTime+" .txt_dia").click(function(){studioChatMb.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+s.publishTime+" .uname").click(function(){$("#"+s.publishTime+" .c-menu a[t=0]").trigger("click")})}else if($("#"+t.uiId+" .uname span").html(studioChatMb.formatPublishTime(s.publishTime)),$("#"+t.uiId).attr("id",s.publishTime),t.content.msgType==studioChatMb.msgType.img){studioChatMb.removeLoadDom(s.publishTime);var l=$("#"+s.publishTime+' span[contt="a"] a'),d=t.content.needMax?"/fxstudio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:l.children("img").attr("src");l.attr("href",d)}},formatContentHtml:function(t,e,i,s){var o,a="clearfix ",n="",r="false",u="",l=t.fromUser,d=t.content,c=l.nickname,h=l.toUser,p=[],f="";if(studioChatMb.userInfo.userId==l.userId&&e&&(l.publishTime=t.uiId,f='<em class="img-loading"><i></i></em><span class="shadow-box"></span><s class="shadow-conut"></s>'),d.msgType==studioChatMb.msgType.img){var m=s?"whimg-"+l.userId:"dialog-img";o=d.needMax?'<a href="/fxstudio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="'+m+'"><img src="'+d.value+'" alt="图片"/></a>':'<a href="'+d.value+'" data-lightbox="'+m+'"><img src="'+d.value+'" alt="图片" /></a>',o='<span contt="a">'+o+"</span>"+f}else o='<span contt="a">'+d.value+"</span>";h&&common.isValid(h.userId)?(s?p.push(o):common.isValid(h.question)?(p.push('<p class="question"><em>'),p.push('<strong class="asker" uid="'+h.userId+'" utype="'+h.userType+'">'+h.nickname+"</strong>"),p.push("提问：</em>"),p.push('<span contt="q">'+h.question+"</span>"),p.push("</p>"),p.push('<p class="reply"><span>回复：</span>'),p.push(o),p.push("</p>")):(p.push('<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">'),p.push("@<label>"+h.nickname+"</label>"),p.push("</span>"),p.push(o)),studioChatMb.userInfo.userId==h.userId&&(r="true")):p.push(o),studioChatMb.userInfo.userId==l.userId?(a+="me-li",c="我",r="true",s&&h&&(u=" csid="+h.userId)):(3==l.userType?(c+="&nbsp;（助理）",a+="admin"):2==l.userType?a+="analyst":1==l.userType&&(a+="admin"),s&&(u=" csid="+l.userId),n=s?"":studioChatMb.getDialogHtml(l.userId,c,l.userType),!i&&h&&(studioChatMb.userInfo.userId!=h.userId||s||($("#top_msg label").html(l.nickname+":@"+h.nickname).attr("tId",h.userId).attr("fuType",l.userType).attr("fnickname",l.nickname).attr("fuserId",l.userId),$("#top_msg span").html(d.value),$("#top_msg").slideDown())));var g=[];return g.push('<li class="'+a+'" id="'+l.publishTime+'" isme="'+r+'" utype="'+l.userType+'" mType="'+d.msgType+'" t="header"'+u+">"),g.push('<div class="headimg" uid="'+l.userId+'">'),g.push(studioChatMb.getUserAImgCls(l.userId,l.clientGroup,l.userType,l.avatar)),g.push("</div>"),g.push('<div class="detail">'),g.push('<span class="uname">'),studioChatMb.userInfo.userId==l.userId?(g.push("<span>"+studioChatMb.formatPublishTime(l.publishTime)+"</span>"),g.push("<strong>"+c+"</strong>")):(g.push("<strong>"+c+"</strong>"),g.push("<span>"+studioChatMb.formatPublishTime(l.publishTime)+"</span>")),g.push("</span>"),g.push('<div class="dialog">'+p.join("")+"</div>"),g.push("</div>"),g.push(n),g.push("</li>"),g.join("")},formatMsgToLink:function(t){$("#"+t+' span[contt]:contains("http:"),#'+t+' span[contt]:contains("https:")').each(function(t,e){var i,s=$(e).html(),o=s.split(/<img[^>]*>|<a[^>]*>.*?<\/a>/g);for(var a in o)if(i=o[a],!common.isBlank(i)){var n=i.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+'" target="_blank">'+t+"</a>"});e.innerHTML=e.innerHTML.replace(i,n)}})},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getUserAImgCls:function(t,e,i,s){var o="";if(common.isValid(s))return'<img src="'+s+'">';if("vip"==e)o="user_v";else{if("active"==e){var a=0;return t&&t.length>0&&(a+=t.charCodeAt(0)+t.charCodeAt(t.length-1)),a=(a+15)%40,'<img src="'+studioChatMb.filePath+"/upload/pic/header/chat/visitor/"+a+'.png">'}if("notActive"==e)o="user_r";else if("simulate"==e)o="user_d";else if("register"==e)o="user_m";else{if("visitor"==e||-1==i){t=t||"";var a=parseInt(t.substring(t.length-2),10);return isNaN(a)&&(a=100),a=(a+17)%40,'<img src="'+studioChatMb.filePath+"/upload/pic/header/chat/visitor/"+a+'.png">'}o="user_c"}}return'<img src="/fx/theme2/img/'+o+'.png">'},leaveRoomTip:function(t){if("roomClose"==t)studioMbPop.showMessage("注意：房间已停用，正自动登出..."),"visitor"==studioChatMb.userInfo.clientGroup?window.setTimeout(function(){studioMbPop.reload()},2e3):window.setTimeout(function(){LoginAuto.setAutoLogin(!1),window.location.href="/fxstudio/logout?platform="+studioChatMb.fromPlatform},2e3);else if("otherLogin"==t){if("visitor"==studioChatMb.userInfo.clientGroup)return;studioChatMb.socket.disconnect(),studioMbPop.popBox("msg",{msg:"注意：您的账号已在其他地方登陆，被踢出！",type:"logout"})}},getDialogHtml:function(t,e,i){if(studioChatMb.userInfo.userId!=t){var s=!1,o=$("#studioListId a[class~=ing]"),a='<div class="c-menu" style="display:none;" nk="'+e+'" uid="'+t+'" utype="'+i+'">';return a+="<ul>",(studioChatMb.visitorSpeak||-1==studioChatMb.userInfo.userId.indexOf("visitor_")&&t&&-1==t.indexOf("visitor_"))&&(a+='<li><a href="javascript:void(0)" t="0"><i></i>@TA</a></li>',s=!0),"true"==o.attr("aw")&&common.containSplitStr(o.attr("awr"),i)&&(a+='<li><a href="javascript:void(0)" t="1"><i></i>私信</a></li>',s=!0),a+="</ul>",s?a+"</div>":""}return""},formatUserToContent:function(t,e,i){var s={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,position:t.position};e?(s.toWhUserId=i,studioChatMb.whTalk.receiveMsg({fromUser:s,content:t.content},!1,!0)):studioChatMb.setContent({fromUser:s,content:t.content},!1,!0)},talkBoxPush:{initTBP:function(t){this.clear(),studioChatMb.pushObj.talkPush=t,this.start()},clear:function(){studioChatMb.pushObj.talkPushInterval&&(window.clearInterval(studioChatMb.pushObj.talkPushInterval),studioChatMb.pushObj.talkPushInterval=null);for(var t=studioChatMb.pushObj.talkPush,e=null,i=0,s=t.length;s>i;i++)e=t[i],e.timeoutId&&window.clearTimeout(e.timeoutId),e.intervalId&&window.clearInterval(e.intervalId)},start:function(){var t=studioChatMb.pushObj.talkPush;t&&t.length>0&&window.setInterval(function(){studioChatMb.talkBoxPush.check()},1e4)},check:function(){for(var t=studioChatMb.pushObj.talkPush,e=null,i=0,s=t.length;s>i;i++)e=t[i],e.startFlag||common.dateTimeWeekCheck(e.pushDate,!1,studioChatMb.serverTime)&&(e.startFlag=!0,window.setTimeout(studioChatMb.talkBoxPush.delayStartTask(e),60*(e.onlineMin||0)*1e3))},delayStartTask:function(t){return function(){studioChatMb.talkBoxPush.showMsg(t),t.intervalMin&&t.intervalMin>0&&(t.intervalId=window.setInterval(studioChatMb.talkBoxPush.startTask(t),60*t.intervalMin*1e3))}},startTask:function(t){return function(){common.dateTimeWeekCheck(t.pushDate,!1,studioChatMb.serverTime)?studioChatMb.talkBoxPush.showMsg(t):(window.clearInterval(t.intervalId),t.startFlag=!1)}},showMsg:function(t){var e=[];e.push('<li class="clearfix push">'),e.push(t.content),e.push("</div>");var i=$("#talkPanel"),s=i.scrollTop()+i.height()+30>=i.get(0).scrollHeight;$("#dialog_list").append(e.join("")),s&&studioChatMb.setTalkListScroll()}},browserState:{hiddenProperty:"hidden",visibilityStateProperty:"visibilityState",visibilityEvent:"visibilitychange",getBrowserPrefix:function(){if("hidden"in document)return null;for(var t=["moz","ms","o","webkit"],e=0;e<t.length;e++){var i=t[e]+"Hidden";if(i in document)return t[e]}return null},initBrowserState:function(){var t=this.getBrowserPrefix();t?(this.hiddenProperty=t+"Hidden",this.visibilityStateProperty=t+"VisibilityState",this.visibilityEvent=t+"visibilitychange"):(this.hiddenProperty="hidden",this.visibilityStateProperty="visibilityState",this.visibilityEvent="visibilitychange"),this.setBrowserStateEvent()},setBrowserStateEvent:function(){document.addEventListener(this.visibilityEvent,function(){"visible"===document[studioChatMb.browserState.visibilityStateProperty]&&studioChatMb.socket.emit("serverTime")})}},whTalk:{enable:!1,status:0,tabCheck:!1,CSMap:{},currCS:null,msgCnt:0,pushObj:null,askMsgObj:null,viewSelect:!1,initWH:function(){this.enable="true"==$("#currStudioInfo").attr("aw"),this.refreshTips(),$("#whTalkBoxTab .view_select").click(function(){var t=$(this);t.is(".dw")?(t.removeClass("dw"),studioChatMb.whTalk.viewSelect=!1):(t.addClass("dw"),studioChatMb.whTalk.viewSelect=!0)}).find(".selectlist a").live("click",function(){if(!$(this).is(".on")){var t=$(this).attr("uid");studioChatMb.whTalk.setCurrCS({userId:t})}})},whSwitch:function(t){t?(this.tabCheck=!0,this.msgCnt=0,this.refreshTips(),this.setWHTalkListScroll(),this.pushMsg()):this.tabCheck=!1},loadMsg:function(t){if(this.CSMap.hasOwnProperty(t)&&!this.CSMap[t].load){var e=this.CSMap[t];e.load=!0,studioMbPop.loadingBlock($("#whTalkBoxTab")),studioChatMb.socket.emit("getWhMsg",{clientStoreId:studioChatMb.userInfo.clientStoreId,userType:studioChatMb.userInfo.userType,groupId:studioChatMb.userInfo.groupId,groupType:studioChatMb.userInfo.groupType,userId:studioChatMb.userInfo.userId,toUser:{userId:e.userNo,userType:e.userType}})}},setCurrCS:function(t){var e=null;if(t&&t.userId)this.CSMap.hasOwnProperty(t.userId)?e=this.CSMap[t.userId]:(e={userNo:t.userId,userName:t.userName||t.nickname,online:!0,load:!1,userType:t.userType,avatar:t.avatar},this.CSMap[t.userId]=e);else{var i=null;for(var s in this.CSMap)i=this.CSMap[s],(!e||3!=e.userType&&3==i.userType||e.userType==i.userType&&!e.online&&i.online)&&(e=i)}if(!e)return null;if(e.load||this.loadMsg(e.userNo),e.userNo){this.currCS=e;var o=$("#whTalkBoxTab .view_select"),a=o.find("a[uid="+this.currCS.userNo+"]");return o.find(".selectlist a").removeClass("on"),0==a.size()?(o.find(".selectlist").append('<a href="javascript:void(0)" class="on" uid="'+this.currCS.userNo+'">'+this.currCS.userName+"</a>"),o.find(".selected").text(this.currCS.userName)):(a.addClass("on"),o.find(".selected").text(a.text())),o.find(".selectlist a").size()<=1?o.hide():(o.show(),$("#whDialog_list").children().hide(),$("#whDialog_list").children("[csid="+this.currCS.userNo+"]").show(),this.setWHTalkListScroll()),e}return null},getCSList:function(){try{$.getJSON("/fxstudio/getCS",{groupId:studioChatMb.userInfo.groupId},function(t){if(t&&t.length>0)for(var e,i,s=0,o=t.length;o>s;s++)e=t[s],studioChatMb.whTalk.CSMap.hasOwnProperty(e.userNo)?i=studioChatMb.whTalk.CSMap[e.userNo]:(i={online:!1},studioChatMb.whTalk.CSMap[e.userNo]=i),i.userNo=e.userNo,i.userName=e.userName,i.userType=3,i.avatar=common.isValid(e.avatar)?e.avatar:"/fx/theme2/img/cm.png",i.load=!1})}catch(t){console.error("getCSList->"+t)}},setCSOnline:function(t,e){var i=null;this.CSMap.hasOwnProperty(t)?i=this.CSMap[t]:(i={},this.CSMap[t]=i),i.online=e},refreshTips:function(){studioChatMb.whTalk.msgCnt>0?$(".wh_tips").text(studioChatMb.whTalk.msgCnt).show():$(".wh_tips").hide()},setWHTalkListScroll:function(){$("#whTalkPanel").scrollTop($("#whTalkPanel")[0].scrollHeight)},receiveMsg:function(t,e,i){var s=t.fromUser;if(e&&(s.publishTime=t.uiId),t.isVisitor)return void $("#"+t.uiId).remove();if(i&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" .dialog em.ruleTipStyle").remove(),void $("#"+s.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",s.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||studioChatMb.userInfo.userId!=s.userId||!t.serverSuccess){var o=studioChatMb.formatContentHtml(t,e,i,!0),a=$("#whTalkPanel"),n=a.scrollTop()+a.height()+30>=a.get(0).scrollHeight;if(i?$("#whDialog_list").prepend(o):$("#whDialog_list").append(o),n&&this.tabCheck&&studioChatMb.whTalk.setWHTalkListScroll(),studioChatMb.formatMsgToLink(s.publishTime),studioChatMb.userInfo.userId!=s.userId&&$("#"+s.publishTime+" .uname,#"+s.publishTime+" .headimg").click(function(){var t=$(this).parents("li:first"),e={userId:t.find(".headimg").attr("uid"),nickname:t.find(".uname strong").text(),userType:t.attr("utype"),avatar:t.find(".headimg img").attr("src")};studioChatMb.whTalk.setCurrCS(e)}),this.tabCheck||i||(studioChatMb.whTalk.msgCnt++,this.refreshTips()),i||studioChatMb.userInfo.userId==s.userId||this.setCurrCS(s),i||(this.askMsgObj=null),i&&s.toUser&&common.isValid(s.toUser.question)){var r=this.setCurrCS({userId:s.toUser.userId});this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:s.toUser.question},fromUser:{nickname:r.userName,userId:r.userNo,userType:r.userType,avatar:r.avatar,publishTime:s.toUser.publishTime}},!1,!0)}}else if($("#"+t.uiId+" .uname span").html(studioChatMb.formatPublishTime(s.publishTime)),$("#"+t.uiId).attr("id",s.publishTime),t.content.msgType==studioChatMb.msgType.img){studioChatMb.removeLoadDom(s.publishTime);var u=$("#"+s.publishTime+' span[contt="a"] a'),l=t.content.needMax?"/fxstudio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:u.children("img").attr("src");u.attr("href",l)}},pushMsg:function(){this.currCS||this.setCurrCS(),this.pushObj&&this.currCS&&(this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:this.pushObj.info},fromUser:{nickname:this.currCS.userName,userId:this.currCS.userNo,userType:this.currCS.userType,avatar:this.currCS.avatar,publishTime:this.pushObj.publishTime}},!1,!1),this.askMsgObj=this.pushObj,this.pushObj=null)},sendWhMsg:function(t){return this.currCS||this.setCurrCS(),this.currCS?(t.fromUser.toUser={userId:this.currCS.userNo,nickname:this.currCS.nickname,talkStyle:1,userType:this.currCS.userType},this.askMsgObj&&(t.fromUser.toUser.question=this.askMsgObj.info,t.fromUser.toUser.questionId=this.askMsgObj.infoId,t.fromUser.toUser.publishTime=this.askMsgObj.publishTime),studioChatMb.whTalk.receiveMsg(t,!0,!1),void(t.content.msgType!=studioChatMb.msgType.img&&studioChatMb.socket.emit("sendMsg",t))):void studioMbPop.showMessage("老师助理不在线，暂不可私聊！")}}};