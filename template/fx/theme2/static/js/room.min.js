function UUID(){this.id=this.createUUID()}function openLive800Chat(t){var e="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";t?location.href=e:window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(){var t="http://crm2.qq.com/page/portalpage/wpa.php?uin=800018282&cref=&ref=&f=1&ty=1&ap=&as=";window.open(t,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(t)}function live800Prompt(t){window.onbeforeunload=null;var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==t)try{UUID.prototype.createUUID();window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(i)}}function qqPrompt(t){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}var _gaq=_gaq||[],_hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(){var t=new Date(1582,10,15,0,0,0,0),e=new Date,i=e.getTime()-t.getTime(),s=UUID.getIntegerBits(i,0,31),a=UUID.getIntegerBits(i,32,47),o=UUID.getIntegerBits(i,48,59)+"1",n=UUID.getIntegerBits(UUID.rand(4095),0,7),r=UUID.getIntegerBits(UUID.rand(4095),0,7),u=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return"G"+s+a+o+n+r+u},UUID.getIntegerBits=function(t,e,i){var s=UUID.returnBase(t,16),a=new Array,o="",n=0;for(n=0;n<s.length;n++)a.push(s.substring(n,n+1));for(n=Math.floor(e/4);n<=Math.floor(i/4);n++)o+=a[n]&&""!=a[n]?a[n]:"0";return o},UUID.returnBase=function(t,e){return t.toString(e).toUpperCase()},UUID.rand=function(t){return Math.floor(Math.random()*(t+1))};var chatAnalyze={COOKIE_NAME:"GWAFLGPHONECOOIKETRACK",localHref:window.location.href,init:function(){var t="";-1!=chatAnalyze.localHref.indexOf("pmchat.24k.hk")?t="studio":-1!=chatAnalyze.localHref.indexOf("chat.gwfx.com")?t="fxstudio":-1!=chatAnalyze.localHref.indexOf("handan.hx9999.com")&&(t="hxstudio"),""!=t&&(this.initGA(t),this.setGA(),this.setBaidu())},initGA:function(t){"studio"==t&&(_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"])),"fxstudio"==t&&(_gaq.push(["_setAccount","UA-49389835-1"]),_gaq.push(["_setDomainName","gwfx.com"]),_gaq.push(["_addIgnoredRef","gwfx.com"])),"hxstudio"==t&&(_gaq.push(["_setAccount",""]),_gaq.push(["_setDomainName","handan.hx9999"]),_gaq.push(["_addIgnoredRef","handan.hx9999"])),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"])},setGA:function(){try{var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},setBaidu:function(){try{var t=document.createElement("script");t.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},setUTM:function(t){try{var e=this.getCookie();(null==e||"undefined"==typeof e||""==$.trim(e))&&(e=UUID.prototype.createUUID(),this.setCookie(e));var i=t||"";_gaq.push(function(){$.getJSON("http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_="+Math.random(),function(t){var s={data:[{user_id:e,businessPlatform:"2",visit_time:new Date,behavior_type:6,ip:t.Ip,url:chatAnalyze.localHref,flag:i,gacookiesTrack:""}]},a=-1!=chatAnalyze.localHref.indexOf("pmchat.24k.hk")?"http://utm.gwfx.com/putData/ajax/ajaxTrackData":"http://testweb.gwfx.com:8088/GwUserTrackingManager_NEW/putData/ajax/ajaxTrackData";$.ajax({async:!0,url:a,cache:!1,dataType:"jsonp",data:{data:s},success:function(t){}})})})}catch(s){console.log("Set UTM fail!"+s)}},setCookie:function(t){this.setHC(this.COOKIE_NAME,t)},getCookie:function(){var t=this.getHC(this.COOKIE_NAME);return"undefined"!=typeof t&&null!=t&&""!=t&&this.setCookie(t),t},setHC:function(t,e){"undefined"!=typeof e&&(document.cookie=t+"=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/;domain=.24k.hk",document.cookie=t+"="+escape(e)+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/;domain=.24k.hk")},getHC:function(t){for(var e=document.cookie,i=e.split(/[;&]/),s=0;s<i.length;s++){var a=i[s].split("=");if($.trim(a[0])==$.trim(t))return a[1]}}};$(function(){chatAnalyze.init()});var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(t,e){return isNaN(e)||e>t.length?!1:void t.splice(e,1)},joinSplit:function(t){return",".concat(t).concat(",")},isBlank:function(t){return void 0==t||null==t||"undefined"==t||"null"==t||""==$.trim(t)},isValid:function(t){return!this.isBlank(t)},trim:function(t){return this.isBlank(t)?"":t.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(t){return document.createElement("div").appendChild(document.createTextNode(t)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(t){return this.isBlank(t)?"":t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(t,e){e||(e="-"),t instanceof Date||(t=new Date(t));var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate());return i},getHHMMSS:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return e},getMMSS:function(t){return t instanceof Date||(t=new Date(t)),(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},getHHMM:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return e},formatterDateTime:function(t,e){if(e||(e="-"),t instanceof Date||(t=new Date(t)),"Invalid Date"==t)return"";var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return i},longMsTimeToDateTime:function(t,e){var i=new Date(t);return this.formatterDateTime(i,e)},showBox:function(t,e){$(t).slideDown(),$(e||".layer-shadow").show()},hideBox:function(t,e){$(t).slideUp(),$(e||".layer-shadow").hide()},containSplitStr:function(t,e){return common.isBlank(t)||common.isBlank(e)?!1:-1!=(","+t+",").indexOf(","+e+",")},getJson:function(t,e,i,s,a){var o=null;return $.ajax({url:t,type:"POST",timeout:1e5,cache:!1,async:void 0!=s?s:!1,dataType:"json",data:e,success:"function"==typeof i?i:function(t){o=t},error:function(t,e){"function"==typeof a?a(e):common.isValid(t.responseText)&&"OK"!=t.statusText?alert(t.responseText):alert("请求超时,请重试!")}}),o},arraySort:function(t,e){return function(i,s){return e?i[t]<s[t]:i[t]>s[t]}},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},isMobilePhone:function(t){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(t)},dateTimeWeekCheck:function(t,e,i){if(this.isBlank(t))return!!e;$.isPlainObject(t)||(t=JSON.parse(t));var s=i?new Date(i):new Date,a=!1,o=this.formatterDate(s);if(a=this.isBlank(t.beginDate)||o>=t.beginDate,a&&(a=this.isBlank(t.endDate)||o<=t.endDate),!a)return!1;var n=t.weekTime;if(this.isBlank(n))return a;var r=null,u=null,l=!1;for(var d in n)if(r=n[d],(!this.isValid(r.week)||s.getDay()==parseInt(r.week))&&(u=this.getHHMMSS(s),l=this.isBlank(r.beginTime)||u>=r.beginTime,l&&(l=this.isBlank(r.endTime)||u<=r.endTime),l))break;return l},arrayUnique:function(t){if(!t)return t;for(var e,i=[],s={},a=0;null!=(e=t[a]);a++)s[e]||(i.push(e),s[e]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(t,e,i){return common.isWebSocket()?(console.log("used websocket!"),t.connect(e.webSocket+"/"+i,{transports:["websocket"]})):t.connect(e.socketIO+"/"+i)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},clearMsgHtml:function(t){var t=t.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return t&&(t=$.trim(t)),t},formatToJson:function(t){return this.isBlank(t)?null:JSON.parse(t)},getSyllabusPlan:function(t,e){if(!t||!t.courses)return null;var i=function(t,e){if(t){var i=common.isMobile(),s=null;"object"!=typeof t&&(t=JSON.parse(t));for(var a in t)if(s=t[a],i){if(1==e&&3==s.code)return s.url}else if(s.code==e)return s.url}},s=function(e,s,a){var n=null,r=e.course;return r&&r.length>s?(n=r[s],0==n.status||common.isBlank(n.lecturerId)?null:(n.studioLink=i(t.studioLink,n.courseType),n.startTime=e.startTime,n.endTime=e.endTime,n.day=o[s].day,n.isNext=a,n)):null},a=null;a=this.isValid(t.courses)&&"object"!=typeof t.courses?JSON.parse(t.courses):t.courses;for(var o=a.days,n=a.timeBuckets,r=new Date(e).getDay(),u=common.getHHMM(e),l=null,d=!1,h=null,c=null,p=0;p<o.length;p++)if(0!=o[p].status)if(o[p].day>r){for(var f in n)if(l=n[f],c=s(l,p,!0))return c}else if(o[p].day==r)for(var f in n){if(l=n[f],l.startTime<=u&&(l.endTime>=u||"00:00"==l.endTime))return d=!0,s(l,p,!1);if(!d&&l.startTime>u)return d=!0,s(l,p,!0)}else if(!h)for(var f=0;f<n.length;f++)if(c=n[f].course,c&&0!=c[p].status&&!common.isBlank(c[p].lecturerId)){h={dayIndex:p,tmIndex:f};break}return!d&&h?s(n[h.tmIndex],h.dayIndex,!0):null},formatSyllabus:function(t,e,i,s){var a={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字直播",1:"视频直播",2:"ONE TV"}},o=new Date(e).getDay(),n=this.getHHMM(e),r=$.extend({},a,s),u=function(t,e,i,s){var a=0,u=(t+6)%7,l=(o+6)%7;return a=u>l?2:l>u?0:s?1:n>=i?0:e>n?2:1,r.courseCls[a]},l=[];try{if(t){var d=$.isPlainObject(t)?t:JSON.parse(t),h=d.days?d.days.length:0;if(h>0)if(1===i){var c={0:"文字",1:"视频",2:"oneTV"};l.push('<div class="sy_panel">');var p=e-864e5*((o+6)%7),f=null,g=null,m=null;l.push('<div class="sy_nav">');for(var b=' style="width:'+100/h+'%;"',v=0;h>v;v++)f=new Date(p+(d.days[v].day+6)%7*864e5),g=f.getFullYear()+"-"+(f.getMonth()<9?"0":"")+(f.getMonth()+1)+"-"+(f.getDate()<10?"0":"")+f.getDate(),m=d.days[v].day==o?' class="active"':"",l.push('<a href="javascript:void(0)" d="'+d.days[v].day+'"'+m+b+">"+r.dayCN[d.days[v].day]+"<br/><span>"+g+'</span><em class="dir">^</em></a>');l.push("</div>"),l.push('<div class="sy_cont"><div>'),l.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var w=null,T=null,v=0;h>v;v++){if(l.push('<tbody d="'+d.days[v].day+'">'),0==d.days[v].status)T=u(d.days[v].day,null,null,!0),l.push('<tr class="'+T+'" width="100%"><td>休市</td></tr>');else for(var C=0,k=d.timeBuckets.length;k>C;C++)w=d.timeBuckets[C],T=u(d.days[v].day,w.startTime,w.endTime,!1),0==w.course[v].status?(l.push('<tr class="'+T+'">'),l.push('<td width="25%">'+w.startTime+"-"+w.endTime+"</td>"),l.push('<td colspan="2" width="75%">休市</td>'),l.push("</tr>")):w.course[v].lecturer&&(l.push('<tr class="'+T+'">'),l.push('<td width="25%">'+w.startTime+"-"+w.endTime+"【"+c[w.course[v].courseType]+"】</td>"),l.push('<td width="25%">'+w.course[v].lecturer+"</td>"),l.push('<td width="50%">'+w.course[v].title+"</td>"),l.push("</tr>"));l.push("</tbody>")}l.push("</table>"),l.push("</div></div>"),l.push("</div>")}else if(2===i){l.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),l.push("<tr>"),l.push("<th>星期\\节次</th>");for(var k=d.timeBuckets?d.timeBuckets.length:0,w=null,T=null,C=0;k>C;C++)w=d.timeBuckets[C],l.push("<th>"+r.indexCN[C]+"<br><span>("+w.startTime+"-"+w.endTime+")</span></th>");l.push("</tr>");for(var M=null,v=0,y=d.days?d.days.length:0;y>v;v++){if(M=d.days[v],l.push("<tr>"),l.push("<th>"+r.dayCN[M.day]+"</th>"),0==M.status)T=u(M.day,null,null,!0),l.push('<td class="'+T+'" colspan="'+k+'">休市</td>');else for(var C=0;k>C;C++)w=d.timeBuckets[C],T=u(M.day,w.startTime,w.endTime,!1),l.push('<td class="'+T+'">'+(0==w.course[v].status?"休市":w.course[v].lecturer)+"</td>");l.push("</tr>")}l.push("</table>")}else if(3===i){var p=n-864e5*((o+6)%7),f=null,m=null,M=null,b=' style="width:'+100/h+'%;"';l.push("<tr>");for(var v=0;h>v;v++)M=d.days[v],f=new Date(p+(d.days[v].day+6)%7*864e5),m=d.days[v].day==o?' class="active"':"",l.push('<th d="'+d.days[v].day+'"'+m+b+">"+r.dayCN[d.days[v].day]+"<i></i></th>");l.push("</tr>"),l.push('<tr><td class="space" colspan="'+h+'"></td></tr>');for(var w=null,T=null,v=0;h>v;v++){if(M=d.days[v],l.push('<tr d="'+M.day+'"><td colspan="'+h+'">'),0==M.status)T=u(M.day,null,null,!0),l.push('<p class="'+T+'">休市</p>');else for(var C=0,k=d.timeBuckets?d.timeBuckets.length:0;k>C;C++)w=d.timeBuckets[C],w.course[v].lecturer&&(T=u(M.day,w.startTime,w.endTime,!1),l.push('<p class="'+T+'">'),l.push("<span>"+w.startTime+"-"+w.endTime+"</span>"),0==w.course[v].status?l.push("<span>休市</span>"):(l.push("<span>"+r.courseType[w.course[v].courseType]+"</span>"),l.push("<span>"+w.course[v].lecturer+"</span>"),l.push('<span class="item">'+w.course[v].title+"</span>")),l.push("</p>"));l.push("</td></tr>")}}}}catch(I){return console.error("formatSyllabus->"+I),""}return l.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},copyObject:function(t,e,i){if(!e)return t;for(var s in t)e.hasOwnProperty(s)&&common.isValid(e[s])&&(t[s]=e[s]);if(i)for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])},isRightName:function(t){return!/^([0-9]{2,20})$/g.test(t)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(t)},randomIndex:function(t){var e=parseInt(Math.round(Math.random()*t));return e==t&&(e=t-1),0>e?0:e},saveToDesktop:function(t,e){try{var i=new ActiveXObject("WScript.Shell"),s=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+e+".url");s.TargetPath=t,s.Save()}catch(a){return!1}return!0}};window.console||(console=function(){function t(){}function e(){return null==i&&(i=new t),i}var i=null;return t.prototype={log:function(t){},error:function(t){}},e()}()),$.fn.focusEnd=function(){$(this).focus();var t=$("<span/>").appendTo($(this)),e=t.get(0),i=null,s=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(e),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e),s=window.getSelection(),s.removeAllRanges(),s.addRange(i)),t.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var t=this,e=0;e<arguments.length;e++)t=t.replace(new RegExp("\\{"+e+"\\}","g"),arguments[e]);return t};var studioChatMb={initSewise:!1,web24kPath:"",filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,fromPlatform:null,serverTime:0,pushObj:{talkPush:[],talkPushInterval:null},msgType:{text:"text",img:"img",file:"file"},socket:null,socketUrl:"",userInfo:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.whTalk.initWH(),this.setSocket(),this.setEvent(),this.setVideoList(),studioMbPop.load(this.userInfo,this.fromPlatform,{onShow:function(){$("#tVideoDiv video").hide()},onHide:function(){$("#tVideoDiv video").show()}}),this.initRoom()},initRoom:function(){this.userInfo.nickname||this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12)),this.currStudioAuth||"visitor"!=this.userInfo.clientGroup||studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform,closeable:!1})},refreshNickname:function(t,e){this.userInfo.isSetName=t,this.userInfo.nickname=e,$("#header_ui").text(e),studioMbPop.Person.refreshNickname(e)},serverTimeUp:function(){setInterval(function(){studioChatMb.serverTime+=1e3},1e3)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfo_"+this.userInfo.groupType,e=store.get(t),i={};if(common.isBlank(e)){var s=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+s,i.userId="visitor_"+s,i.nickname="游客_"+s,i.userType=-1,store.set(t,i),$(".collect-tip").fadeIn().delay(6e4).fadeOut()}else i=e;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||($("#contentText").attr("contenteditable",!1).append('<span style="margin:15px 5px;">亲，<a id="contentText_login" href="javascript:void(0);" style="text-decoration: underline;color:#3F51B5;cursor: pointer;">登录</a>&nbsp;&nbsp;后可以发言哦~</span>'),$("#contentText_login").click(function(){studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform})}))):(i.loginId=this.userInfo.userId,store.set(t,i)),this.isNeverLogin=!common.isValid(i.loginId)},setSocket:function(){studioMbPop.loadingBlock($("#talkBoxTab")),this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),studioChatMb.userInfo.socketId=studioChatMb.socket.id,studioChatMb.socket.emit("login",{userInfo:studioChatMb.userInfo,lastPublishTime:$("#dialog_list>li:last").attr("id"),fromPlatform:studioChatMb.fromPlatform,allowWhisper:studioChatMb.whTalk.enable},navigator.userAgent)}),this.socket.on("onlineUserList",function(t,e){if(studioChatMb.whTalk.enable){for(var i in t)3==t[i].userType&&studioChatMb.whTalk.setCSOnline(t[i].userId,!0);studioChatMb.whTalk.getCSList()}}),this.socket.on("disconnect",function(){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle?studioChatMb.whTalk.receiveMsg(t,!1,!1):studioChatMb.setContent(t,!1,!1)}),this.socket.on("notice",function(t){switch(t.type){case"onlineNum":var e=t.data,i=e.onlineUserInfo;3==i.userType&&studioChatMb.whTalk.enable&&studioChatMb.whTalk.setCSOnline(i.userId,e.online);break;case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),studioChatMb.setTalkListScroll();break;case"leaveRoom":studioChatMb.leaveRoomTip(t.flag);break;case"approvalResult":var e=t.data,s=0;if(e.refuseMsg){var a=e.publishTimeArr;for(s in a)$("#"+a[s]+" .dialog em[class=ruleTipStyle]").html("已拒绝")}else{for(s in e)studioChatMb.formatUserToContent(e[s]);studioChatMb.setTalkListScroll()}break;case"pushInfo":var e=t.data;1==e.position?(studioChatMb.whTalk.pushObj={info:e.content,publishTime:e.publishTime,infoId:e.contentId},window.setTimeout(function(){studioChatMb.whTalk.pushMsg()},60*e.timeOut*1e3)):3==e.position&&studioChatMb.talkBoxPush.initTBP(e.infos);break;case"serverTime":studioChatMb.serverTime=t.data}}),this.socket.on("loadMsg",function(t){var e=t.msgData,i=t.isAdd;if(i||$("#content_ul").html(""),e&&$.isArray(e)){e.reverse();for(var s in e)studioChatMb.formatUserToContent(e[s]);studioMbPop.loadingBlock($("#talkBoxTab"),!0),studioChatMb.setTalkListScroll(),window.setTimeout(function(){studioChatMb.setTalkListScroll()},500)}}),this.socket.on("loadWhMsg",function(t){var e=t.data;if(e&&$.isArray(e))for(var i,s=0,a=e.length;a>s;s++)i=e[s],studioChatMb.formatUserToContent(i,!0,t.toUserId);studioMbPop.loadingBlock($("#whTalkBoxTab"),!0)})},setVideoList:function(){studioMbPop.loadingBlock($("#videosTab")),this.getArticleList("teach_video_base,teach_video_gw,teach_video_expert",this.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){var e=$("#videosTab .boxcont");if(e.html(""),t&&0==t.result){for(var i=t.data,s=[],a=null,o=0,n=i?i.length:0;n>o;o++)o%5==0&&s.push('<ul class="teach-ul">'),a=i[o].detailList[0],s.push('<li><a title="'+a.title+"\" href=\"javascript:void(0)\" onclick=\"_gaq.push(['_trackEvent', 'm_fx_studio', 'teachvideo_"+o+"', 'content_middle',1,true]);\" id=\""+i[o]._id+'" vUrl="'+i[o].mediaUrl+'"><i></i><span>'+a.title+"</span></a></li>"),(o%5==4||o==n-1)&&s.push("</ul>"),e.html(s.join(""));e.find("li a").click(function(){$(this).is(".on")||($("#videosTab .boxcont li a.on").removeClass("on"),$(this).addClass("on")),studioChatMb.video.play("studio","mp4",$(this).attr("vUrl"),$(this).text())})}studioChatMb.video.start(),studioMbPop.loadingBlock($("#videosTab"),!0)})},setEvent:function(){this.setEventCen(),this.video.init(),this.setEventChat(),this.setHeight(),this.browserState.initBrowserState()},setHeight:function(){var t=0;t+=$(".videopart").is(":hidden")?0:$(".videopart").height(),t+=$(".cen-ulist").is(":hidden")?0:$(".cen-ulist").height(),t+=$("#header").is(":hidden")?0:$("#header").height(),t=$(window).height()-t,$(".cen-pubox .boxcont:gt(1)").height(t),t-=$(".float-box").height(),$(".cen-pubox .boxcont:lt(2)").height(t)},setEventCen:function(){var t=new Swiper(".cen-qhbox",{loop:!1,autoplay:!1,onSlideChangeStart:function(t){$(".cen-ulist li").eq(t.activeIndex).trigger("click")}});$(".cen-ulist li").click(function(){$(".cen-ulist li.on").removeClass("on"),$(this).addClass("on");var e=$(this).attr("t");"talkBoxTab"==e?(studioChatMb.view.boardCtrl(1),studioChatMb.whTalk.whSwitch(!1)):"whTalkBoxTab"==e?(studioChatMb.whTalk.whSwitch(!0),studioChatMb.view.boardCtrl($.trim($("#contentText").html())?1:4)):(studioChatMb.whTalk.whSwitch(!1),studioChatMb.view.boardCtrl(0),"TradeArticleTab"==e?(_gaq.push(["_trackEvent","m_fx_studio","suggest_tab","content_middle",1,!0]),studioChatMb.setTradeArticle()):"videosTab"==e&&_gaq.push(["_trackEvent","m_fx_studio","teachvideo_tab","content_middle",1,!0])),t.slideTo($(this).index(),300,!1)}),$("#header_hb").bind("click",function(){window.location.href="/fxstudio/home"}),$("#header_ui").bind("click",function(){studioChatMb.userInfo&&studioChatMb.userInfo.isLogin?studioMbPop.popBox("person"):studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientGroup:studioChatMb.userInfo.clientGroup,clientStoreId:studioChatMb.userInfo.clientStoreId,platform:studioChatMb.fromPlatform})})},setEventChat:function(){$("#msgFaceBtn").bind("click",function(){$(this).blur(),"whTalkBoxTab"==$("ul.cen-ulist>li.on").attr("t")?(studioChatMb.view.boardCtrl($("#facePanel").is(":hidden")?6:4),$.trim($("#contentText").html())&&studioChatMb.view.boardCtrl(2)):$("#facePanel").is(":hidden")?studioChatMb.view.boardCtrl(2):studioChatMb.view.boardCtrl(1),studioChatMb.face.init($("#facePanel"),$("#contentText"),studioChatMb.filePath+"/face/",!studioChatMb.visitorSpeak&&"visitor"==studioChatMb.userInfo.clientGroup)}),$("#talkBoxTab .view_select").click(function(){var t=$(this);t.is(".dw")?(t.removeClass("dw"),studioChatMb.view.viewSelect=!1):(t.addClass("dw"),studioChatMb.view.viewSelect=!0)}).find(".selectlist a").click(function(){if(!$(this).is(".on")){$("#talkBoxTab .view_select .selectlist a").removeClass("on"),$("#talkBoxTab .view_select .selected").text($(this).text()),$(this).addClass("on");var t=$(this).attr("t");_gaq.push(["_trackEvent","m_fx_studio","filter_"+t,"content_left",1,!0]),studioChatMb.showViewSelect(t)}}),$(document).bind("touchstart",function(t){if(studioChatMb.view.viewSelect){var e=$("#talkBoxTab .view_select");e.is(t.target)||0!=e.find(t.target).length||e.trigger("click")}if(studioChatMb.whTalk.viewSelect){var e=$("#whThtalkBoxTab .view_select");e.is(t.target)||0!=e.find(t.target).length||e.trigger("click")}2==studioChatMb.view.viewBoard&&0==$(".float-box").find(t.target).length&&$("#contentText").trigger("blur")}),$("#contentText").keydown(function(t){var e=$(this).html();return 13==t.keyCode?(common.isValid(e)&&($(this).html(e.replace(/<div>|<\/div>/g,"")),$("#sendBtn").click()),!1):void 0}).keyup(function(t){if(8==t.keyCode){var e=$(this).find(".txt_dia");if($.trim($(this).text())==e.text()&&0==$(this).find("img").length)return e.remove(),$(this).html(""),!0}}).focus(function(){}).blur(function(){}).bind("input",function(){var t=(studioChatMb.visitorSpeak||"visitor"!=studioChatMb.userInfo.clientGroup)&&($.trim($(this).text())!=$(this).find(".txt_dia").text()||$(this).find("img").size()>0);"whTalkBoxTab"==$("ul.cen-ulist>li.on").attr("t")&&studioChatMb.view.boardCtrl(t?$("#facePanel").is(":hidden")===!0?1:2:4),t?$("#sendBtn").addClass("pressed"):$("#sendBtn").removeClass("pressed")}),$("#sendBtn").click(function(){if($(this).blur(),studioChatMb.view.boardCtrl(1),studioChatMb.visitorSpeak||"visitor"!=studioChatMb.userInfo.clientGroup){if(studioChatMb.userInfo.isSetName===!1)return void studioMbPop.popBox("set",{studioChatObj:studioChatMb});var t=studioChatMb.getToUser(),e=studioChatMb.getSendMsg();if(e!==!1){var i={uiId:studioChatMb.getUiId(),fromUser:studioChatMb.userInfo,content:{msgType:studioChatMb.msgType.text,value:e}};i.fromUser.toUser=t,studioChatMb.whTalk.tabCheck?studioChatMb.whTalk.sendWhMsg(i):(studioChatMb.socket.emit("sendMsg",i),studioChatMb.setContent(i,!0,!1)),$("#contentText").html("").trigger("input")}}}),$(".addpic-btn").click(function(){$(".add-img").is(":hidden")?studioChatMb.view.boardCtrl(5):studioChatMb.view.boardCtrl(4)}),$("#top_msg").click(function(){var t=$(this).find("label");$(this).slideUp(),studioChatMb.setDialog(t.attr("fuserId"),t.attr("fnickname"),0,t.attr("fuType"),null)}),$("#top_msg i").click(function(){return $("#top_msg").slideUp(),!1}),$(".file-img").click(function(){return FileReader?void 0:void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$(".file-img").bind("change",function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=e.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var s=new FileReader;s.readAsDataURL(e),s.onload=function(t){studioChatMb.setUploadImg(t.target.result,studioChatMb.getToUser())},s.onprogress=function(t){},s.onloadend=function(t){},$(this).val("")})},setUploadImg:function(t,e){var i=studioChatMb.getUiId(),s={};common.copyObject(s,studioChatMb.userInfo,!0),s.toUser=e;var a={uiId:i,fromUser:s,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};studioChatMb.whTalk.tabCheck?studioChatMb.whTalk.sendWhMsg(a):this.setContent(a,!0,!1),a.content.value=t,this.zipImg(a,100,60,function(t,e){if(t.error)return alert(t.error),$("#"+i).remove(),!1;var s=$("#"+t.uiId+" span[contt='a'] a");s.attr("href",e).children("img").attr("src",e).attr("needMax",t.content.needMax),studioChatMb.dataUpload(t)})},zipImg:function(t,e,i,s){var a=new Image;a.onload=function(){var o=document.createElement("canvas");o||s({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var n=a.width,r=a.height;if(r>=9*n)return s({error:"该图片高度太高，暂不支持发送！"}),!1;e>0&&(r>e||n>e)&&(t.content.needMax=1,r>e&&e>=n?(n=e/r*n,r=e):(r=e/n*r,n=e),a.height=r,a.width=n);var u=o.getContext("2d");o.width=n,o.height=r,u.clearRect(0,0,o.width,o.height),u.drawImage(a,0,0,n,r),s(t,o.toDataURL("image/jpeg",i/100))},a.src=t.content.value},dataUpload:function(t){var e=new XMLHttpRequest;e.open("POST","/studio/uploadData"),e.addEventListener("progress",function(e){if(e.lengthComputable){var i=(e.loaded/e.total*100|0)+"%";$("#"+t.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+t.uiId+" .shadow-conut").html(i)}},!1),e.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&console.log("dataUpload success!")},t.fromUser.socketId=this.socket.id,e.send(JSON.stringify(t))},view:{viewSelect:!1,viewBoard:1,boardCtrl:function(t){if(this.viewBoard!=t){this.viewBoard=t;var e={header:$("#header"),backToLive:$("#backToLive"),facePanel:$("#facePanel"),floatBox:$(".float-box"),publicChat:$(".public_chat"),privateChat:$(".private_chat"),imgBox:$(".add-img")};switch(t){case 0:e.header.show(),e.backToLive.data("showBoard",!0).trigger("show"),e.floatBox.hide();break;case 1:e.header.show(),e.backToLive.data("showBoard",!0).trigger("show"),e.floatBox.show(),e.facePanel.hide(),e.privateChat.hide(),e.publicChat.show(),e.imgBox.hide();break;case 2:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.show(),e.privateChat.hide(),e.publicChat.show(),e.imgBox.hide();break;case 3:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.hide(),e.privateChat.hide(),e.publicChat.show(),e.imgBox.hide();break;case 4:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.hide(),e.privateChat.show(),e.publicChat.hide(),e.imgBox.hide();break;case 5:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.hide(),e.privateChat.show(),e.publicChat.hide(),e.imgBox.show();break;case 6:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.show(),e.privateChat.show(),e.publicChat.hide(),e.imgBox.hide()}e.privateChat.is(":hidden")===!1?$(".float-box").addClass("private"):$(".float-box").removeClass("private")}}},video:{initPlayer:!1,playerType:"",videoType:"",studioType:"",liveUrl:"http://ct.phgsa.cn:1935/live/01/playlist.m3u8",$panel:null,backToLivePos:{x:0,y:0},init:function(){navigator.userAgent.match(/Android/i)||-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPod")||-1!=navigator.userAgent.indexOf("iPad")?this.playerType="video":this.playerType="sewise";var t=$(".videopart input:first");t.attr("yc"),t.attr("mc");this.$panel=$("#tVideoDiv"),this.$panel.css({"z-index":"inherit"}).height(.55*this.$panel.width()),this.setEvent()},start:function(t){var e=common.getSyllabusPlan(studioChatMb.syllabusData,studioChatMb.serverTime);!e||e.isNext||0!=e.courseType&&common.isBlank(e.studioLink)||2==e.courseType||0==e.courseType?t?studioMbPop.showMessage("目前还没有视频直播，详情请留意直播间的课程安排！"):e&&!e.isNext&&0==e.courseType?($(".videopart").hide(),studioChatMb.setHeight()):this.playMp4Vd():this.play("yy","",e.studioLink,"")},playMp4Vd:function(){if($("#studioTeachId a[class=on]").length<=0){var t=$("#videosTab li a"),e=$(t.get(common.randomIndex(t.length)));
e.click()}},play:function(t,e,i,s){this.studioType=t;var a=$("#backToLive");if($(".videopart").is(":hidden")&&($(".videopart").show(),studioChatMb.setHeight()),"studio"==t?a.data("showVideo",!0).trigger("show"):($("#videosTab li a.on").removeClass("on"),a.data("showVideo",!1).trigger("show")),"video"==this.playerType)if(this.initPlayer){var o=this.$panel.find("video");o[0].pause(),o.attr("src",i),o[0].play()}else{var n=$("body").attr("fp"),r="webui"!=n&&"app"!=n;this.$panel.append('<video src="'+i+'" controls="true" autoplay="'+r+'" style="width: 100%; height: 100%; background-color: rgb(0, 0, 0);"></video>'),r||this.$panel.find("video")[0].pause(),this.initPlayer=!0,this.setEventAd()}else if(this.initPlayer)SewisePlayer.toPlay(i,s,0,!0),this.videoType=e;else{var u=[];u.push("/base/lib/sewise.player.min.js?server=vod"),u.push("type="+e),u.push("videourl="+i),u.push("autostart=true"),u.push("logo="),u.push("title="+s),u.push("buffer=5");var l=u.join("&"),d=document.createElement("script");d.type="text/javascript",d.src=l,this.initPlayer=!0,this.videoType=e,this.$panel.get(0).appendChild(d),this.setEventAd()}},setEvent:function(){$(".ctrlblock div.replay a").bind("click",function(){var t=$("#videosTab li a.on");t.trigger("click")}),$(".ctrlblock div.nextbtn a").bind("click",function(){for(var t=$("#videosTab li a"),e=0,i=t.size();i>e;e++)if(t.eq(e).is(".on")){t.eq(i-1>e?e+1:0).trigger("click");break}}),$("#backToLive").css({left:function(){return $(window).width()-$(this).width()-10},top:function(){return $(window).height()-$("#header").height()-70}}).data("showBoard",!0).data("showVideo",!0).bind("show",function(){var t=$(this);t.data("showBoard")&&t.data("showVideo")?t.show():t.hide()});var t=function(t,e){return t=Math.max(t,10),Math.min(t,e-10)};util.toucher($("#backToLive")[0]).on("singleTap",function(){studioChatMb.socket.emit("serverTime"),window.setTimeout(function(){studioChatMb.video.start(!0)},1e3)}).on("swipeStart",function(){studioChatMb.video.backToLivePos.x=parseInt(this.style.left)||0,studioChatMb.video.backToLivePos.y=parseInt(this.style.top)||0,this.style.transition="none",this.style.background=" rgba(181,144,48,0.8)"}).on("swipe",function(e){return this.style.left=t(studioChatMb.video.backToLivePos.x+e.moveX,$(window).width()-this.clientWidth)+"px",this.style.top=t(studioChatMb.video.backToLivePos.y+e.moveY,$(window).height()-this.clientHeight)+"px",!1}).on("swipeEnd",function(){return this.style.background=" rgba(181,144,48,.6)",!1})},setEventAd:function(){if("sewise"==this.playerType){var t=function(){return window.SewisePlayer?(SewisePlayer.onPause(function(){"studio"==studioChatMb.video.studioType&&window.setTimeout(function(){SewisePlayer.duration()<=SewisePlayer.playTime()&&$(".ctrlblock").show()},1e3)}),void SewisePlayer.onStart(function(){$(".ctrlblock").hide()})):void window.setTimeout(t,500)};t()}else if("video"==this.playerType){var e=this.$panel.find("video");e.bind("ended",function(){"studio"==studioChatMb.video.studioType&&$(".ctrlblock").show()}).bind("loadstart",function(){$(".ctrlblock").hide()})}}},face:{initFace:!1,init:function(t,e,i,s){this.initFace||(this.build(t,i),new Swiper(t,{pagination:".swiper-pagination",paginationClickable:!0}),t.find("img").bind("click",{panel:t,assign:e,disabled:s},function(t){t.data.disabled||t.data.assign.append($(this).clone()).trigger("input")}),this.initFace=!0)},build:function(t,e){for(var i=[],s=7,a=1;75>=a;a+=21){i.push('<div class="swiper-slide"><table border="0" cellspacing="0" cellpadding="0">');for(var o=a,n=Math.min(a+20,75);n>=o;o++)o%s==1&&i.push("<tr>"),i.push('<td><img src="'+e+o+'.gif"/></td>'),(o%s==0||o==n)&&i.push("</tr>");i.push("</table></div>")}t.find("div.face").html(i.join(""))}},setTalkListScroll:function(){$("#talkPanel").scrollTop($("#talkPanel")[0].scrollHeight)},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getArticleList:function(t,e,i,s,a,o,n,r){try{var u={code:t,platform:e,hasContent:i,pageNo:s,pageSize:a,orderByStr:o};n&&(u.authorId=common.trim(n)),$.getJSON("/fxstudio/getArticleList",u,function(t){r(t)})}catch(l){console.error("getArticleList->"+l),r(null)}},setTradeArticle:function(){studioMbPop.loadingBlock($("#TradeArticleTab")),studioChatMb.getArticleList("trade_strategy_article",studioChatMb.userInfo.groupId,1,1,1,'{"createDate":"desc"}',null,function(t){var e=$("#TradeArticleTab ul:first"),i=[];if(t&&0==t.result){var s=t.data;if(s&&s.length>0)for(var a=null,o=null,n=0,r=s.length;r>n;n++)a=s[n].detailList[0],o=a.authorInfo||{},i.push("<li>"),i.push('<div class="himg"><img src="'+(o.avatar||"")+'"></div>'),i.push('<div class="detail">'),i.push("<h3>"+a.title+"</h3>"),i.push('<div class="subinfo">'),i.push("<span>"+(o.name||"")+"</span>"),i.push("<span>"+(s[n].publishStartDate?common.longMsTimeToDateTime(s[n].publishStartDate):"")+"</span>"),i.push("</div>"),i.push("<p>"+a.content+"</p>"),i.push("</div>")}e.html(i.join("")),$("#TradeArticleTab .detail p span").attr("style",""),studioMbPop.loadingBlock($("#TradeArticleTab"),!0)})},showViewSelect:function(t){var e=$("#dialog_list");"analyst"==t?(e.children("[utype!=2]").hide(),e.children("[utype=2]").show()):"me"==t?(e.children("[isme='false']").hide(),e.children("[isme='true']").show()):e.children().show(),studioChatMb.setTalkListScroll()},getSendMsg:function(t){if(t=t||$("#contentText"),t.text().length+t.find("img").size()>140)return studioMbPop.showMessage("消息内容超过最大长度限制（140字以内）！"),!1;var e=t.html();return e=common.clearMsgHtml(e),common.isBlank(e)?(t.html(""),!1):(t.find(".txt_dia").length>0&&(t.find(".txt_dia").remove(),e=t.html(),e=e.replace(/^(&nbsp;){1,2}/,"")),e)},getToUser:function(){var t=$("#contentText .txt_dia");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype"),avatar:t.attr("avatar")}:null},formatPublishTime:function(t){return common.isBlank(t)?"":common.getHHMM(Number(t.replace(/_.+/g,"")))},setDialog:function(t,e,i,s,a){(studioChatMb.visitorSpeak||"visitor"!=studioChatMb.userInfo.clientGroup)&&($("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+s+'" avatar="'+a+'">@<label>'+e+"</label></span>&nbsp;").focusEnd())},setContent:function(t,e,i){var s=t.fromUser;if(e&&(s.publishTime=t.uiId),t.isVisitor)return void $("#"+t.uiId).remove();if(i&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" .dialog em[class=ruleTipStyle]").remove(),void $("#"+s.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",s.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||studioChatMb.userInfo.userId!=s.userId||!t.serverSuccess){var a=studioChatMb.formatContentHtml(t,e,i,!1),o=$("#dialog_list"),n=$("#talkPanel"),r=n.scrollTop()+n.height()+30>=n.get(0).scrollHeight;o.append(a),r&&!i&&studioChatMb.setTalkListScroll(),this.formatMsgToLink(s.publishTime);var u=$("#talkBoxTab .view_select .selectlist a[class=on]").attr("t");"all"!=u&&studioChatMb.showViewSelect(u),$("#"+s.publishTime+" .c-menu a").click(function(){var t=$(this).parents(".c-menu");studioChatMb.setDialog(t.attr("uid"),t.attr("nk"),$(this).attr("t"),t.attr("utype"))}),$("#"+s.publishTime+" .headimg").click(function(){$("#"+s.publishTime+" .c-menu a[t=0]").trigger("click")}),$("#"+s.publishTime+" .txt_dia").click(function(){studioChatMb.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+s.publishTime+" .uname").click(function(){$("#"+s.publishTime+" .c-menu a[t=0]").trigger("click")})}else if($("#"+t.uiId+" .uname span").html(studioChatMb.formatPublishTime(s.publishTime)),$("#"+t.uiId).attr("id",s.publishTime),t.content.msgType==studioChatMb.msgType.img){studioChatMb.removeLoadDom(s.publishTime);var l=$("#"+s.publishTime+' .dialog[contt="a"]>a'),d=t.content.needMax?"/studio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:l.children("img").attr("src");l.attr("href",d)}},formatContentHtml:function(t,e,i,s){var a,o="clearfix ",n="",r="false",u="",l=t.fromUser,d=t.content,h=l.nickname,c=l.toUser,p=[],f="";if(studioChatMb.userInfo.userId==l.userId&&e&&(l.publishTime=t.uiId,f='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>'),d.msgType==studioChatMb.msgType.img){var g=s?"whimg-"+l.userId:"dialog-img";a=d.needMax?'<a href="/studio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="'+g+'"><img src="'+d.value+'" alt="图片"/></a>':'<a href="'+d.value+'" data-lightbox="'+g+'"><img src="'+d.value+'" alt="图片" /></a>',a='<span contt="a">'+a+"</span>"+f}else a='<span contt="a">'+d.value+"</span>";c&&common.isValid(c.userId)?(s?p.push(a):common.isValid(c.question)?(p.push('<p class="question"><em>'),p.push('<strong class="asker" uid="'+c.userId+'" utype="'+c.userType+'">'+c.nickname+"</strong>"),p.push("提问：</em>"),p.push('<span contt="q">'+c.question+"</span>"),p.push("</p>"),p.push('<p class="reply"><span>回复：</span>'),p.push(a),p.push("</p>")):(p.push('<span class="txt_dia" uid="'+c.userId+'" utype="'+c.userType+'">'),p.push("@<label>"+c.nickname+"</label>"),p.push("</span>"),p.push(a)),studioChatMb.userInfo.userId==c.userId&&(r="true")):p.push(a),studioChatMb.userInfo.userId==l.userId?(o+="me-li",h="我",r="true",s&&c&&(u=" csid="+c.userId)):(3==l.userType?(h+="&nbsp;（助理）",o+="admin"):2==l.userType?o+="analyst":1==l.userType&&(o+="admin"),s&&(u=" csid="+l.userId),n=s?"":studioChatMb.getDialogHtml(l.userId,h,l.userType),!i&&c&&(studioChatMb.userInfo.userId!=c.userId||s||($("#top_msg label").html(l.nickname+":@"+c.nickname).attr("tId",c.userId).attr("fuType",l.userType).attr("fnickname",l.nickname).attr("fuserId",l.userId),$("#top_msg span").html(d.value),$("#top_msg").slideDown())));var m=[];return m.push('<li class="'+o+'" id="'+l.publishTime+'" isme="'+r+'" utype="'+l.userType+'" mType="'+d.msgType+'" t="header"'+u+">"),m.push('<div class="headimg" uid="'+l.userId+'">'),m.push(studioChatMb.getUserAImgCls(l.userId,l.clientGroup,l.userType,l.avatar)),m.push("</div>"),m.push('<div class="detail">'),m.push('<span class="uname">'),studioChatMb.userInfo.userId==l.userId?(m.push("<span>"+studioChatMb.formatPublishTime(l.publishTime)+"</span>"),m.push("<strong>"+h+"</strong>")):(m.push("<strong>"+h+"</strong>"),m.push("<span>"+studioChatMb.formatPublishTime(l.publishTime)+"</span>")),m.push("</span>"),m.push('<div class="dialog">'+p.join("")+"</div>"),m.push("</div>"),m.push(n),m.push("</li>"),m.join("")},formatMsgToLink:function(t){$("#"+t+' span[contt]:contains("http:"),#'+t+' span[contt]:contains("https:")').each(function(t,e){var i,s=$(e).html(),a=s.split(/<img src="\S+">/g);for(var o in a)if(i=a[o],!common.isBlank(i)){var n=i.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+'" target="_blank">'+t+"</a>"});e.innerHTML=e.innerHTML.replace(i,n)}})},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getUserAImgCls:function(t,e,i,s){var a="";if(common.isValid(s))return'<img src="'+s+'">';if("vip"==e)a="user_v";else{if("active"==e){var o=0;return t&&t.length>0&&(o+=t.charCodeAt(0)+t.charCodeAt(t.length-1)),o=(o+15)%40,'<img src="'+studioChatMb.filePath+"/upload/pic/header/chat/visitor/"+o+'.png">'}if("notActive"==e)a="user_r";else if("simulate"==e)a="user_d";else if("register"==e)a="user_m";else{if("visitor"==e||-1==i){t=t||"";var o=parseInt(t.substring(t.length-2),10);return isNaN(o)&&(o=100),o=(o+17)%40,'<img src="'+studioChatMb.filePath+"/upload/pic/header/chat/visitor/"+o+'.png">'}a="user_c"}}return'<img src="/fx/theme2/img/'+a+'.png">'},leaveRoomTip:function(t){if("roomClose"==t)studioMbPop.showMessage("注意：房间已停用，正自动登出..."),"visitor"==studioChatMb.userInfo.clientGroup?window.setTimeout(function(){studioMbPop.reload()},2e3):window.setTimeout(function(){LoginAuto.setAutoLogin(!1),window.location.href="/fxstudio/logout?platform="+studioChatMb.fromPlatform},2e3);else if("otherLogin"==t){if("visitor"==studioChatMb.userInfo.clientGroup)return;studioChatMb.socket.disconnect(),studioMbPop.popBox("msg",{msg:"注意：您的账号已在其他地方登陆，被踢出！",type:"logout"})}},getDialogHtml:function(t,e,i){if(studioChatMb.userInfo.userId!=t){var s=!1,a=$("#studioListId a[class~=ing]"),o='<div class="c-menu" style="display:none;" nk="'+e+'" uid="'+t+'" utype="'+i+'">';return o+="<ul>",(studioChatMb.visitorSpeak||-1==studioChatMb.userInfo.userId.indexOf("visitor_")&&t&&-1==t.indexOf("visitor_"))&&(o+='<li><a href="javascript:void(0)" t="0"><i></i>@TA</a></li>',s=!0),"true"==a.attr("aw")&&common.containSplitStr(a.attr("awr"),i)&&(o+='<li><a href="javascript:void(0)" t="1"><i></i>私信</a></li>',s=!0),o+="</ul>",s?o+"</div>":""}return""},formatUserToContent:function(t,e,i){var s={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,position:t.position};e?(s.toWhUserId=i,studioChatMb.whTalk.receiveMsg({fromUser:s,content:t.content},!1,!0)):studioChatMb.setContent({fromUser:s,content:t.content},!1,!0)},talkBoxPush:{initTBP:function(t){this.clear(),studioChatMb.pushObj.talkPush=t,this.start()},clear:function(){studioChatMb.pushObj.talkPushInterval&&(window.clearInterval(studioChatMb.pushObj.talkPushInterval),studioChatMb.pushObj.talkPushInterval=null);for(var t=studioChatMb.pushObj.talkPush,e=null,i=0,s=t.length;s>i;i++)e=t[i],e.timeoutId&&window.clearTimeout(e.timeoutId),e.intervalId&&window.clearInterval(e.intervalId)},start:function(){var t=studioChatMb.pushObj.talkPush;t&&t.length>0&&window.setInterval(function(){studioChatMb.talkBoxPush.check()},1e4)},check:function(){for(var t=studioChatMb.pushObj.talkPush,e=null,i=0,s=t.length;s>i;i++)e=t[i],e.startFlag||common.dateTimeWeekCheck(e.pushDate,!1,studioChatMb.serverTime)&&(e.startFlag=!0,window.setTimeout(studioChatMb.talkBoxPush.delayStartTask(e),60*(e.onlineMin||0)*1e3))},delayStartTask:function(t){return function(){studioChatMb.talkBoxPush.showMsg(t),t.intervalMin&&t.intervalMin>0&&(t.intervalId=window.setInterval(studioChatMb.talkBoxPush.startTask(t),60*t.intervalMin*1e3))}},startTask:function(t){return function(){common.dateTimeWeekCheck(t.pushDate,!1,studioChatMb.serverTime)?studioChatMb.talkBoxPush.showMsg(t):(window.clearInterval(t.intervalId),t.startFlag=!1)}},showMsg:function(t){var e=[];e.push('<li class="clearfix push">'),e.push(t.content),e.push("</div>");var i=$("#talkPanel"),s=i.scrollTop()+i.height()+30>=i.get(0).scrollHeight;$("#dialog_list").append(e.join("")),s&&studioChatMb.setTalkListScroll()}},browserState:{hiddenProperty:"hidden",visibilityStateProperty:"visibilityState",visibilityEvent:"visibilitychange",getBrowserPrefix:function(){if("hidden"in document)return null;for(var t=["moz","ms","o","webkit"],e=0;e<t.length;e++){var i=t[e]+"Hidden";if(i in document)return t[e]}return null},initBrowserState:function(){var t=this.getBrowserPrefix();t?(this.hiddenProperty=t+"Hidden",this.visibilityStateProperty=t+"VisibilityState",this.visibilityEvent=t+"visibilitychange"):(this.hiddenProperty="hidden",this.visibilityStateProperty="visibilityState",this.visibilityEvent="visibilitychange"),this.setBrowserStateEvent()},setBrowserStateEvent:function(){document.addEventListener(this.visibilityEvent,function(){"visible"===document[studioChatMb.browserState.visibilityStateProperty]&&studioChatMb.socket.emit("serverTime")})}},whTalk:{enable:!1,status:0,tabCheck:!1,CSMap:{},currCS:null,msgCnt:0,pushObj:null,askMsgObj:null,viewSelect:!1,initWH:function(){this.enable="true"==$("#currStudioInfo").attr("aw"),this.refreshTips(),$("#whTalkBoxTab .view_select").click(function(){var t=$(this);t.is(".dw")?(t.removeClass("dw"),studioChatMb.whTalk.viewSelect=!1):(t.addClass("dw"),studioChatMb.whTalk.viewSelect=!0)}).find(".selectlist a").live("click",function(){if(!$(this).is(".on")){var t=$(this).attr("uid");studioChatMb.whTalk.setCurrCS({userId:t})}})},whSwitch:function(t){t?(this.tabCheck=!0,this.msgCnt=0,this.refreshTips(),this.setWHTalkListScroll(),this.pushMsg()):this.tabCheck=!1},loadMsg:function(t){if(this.CSMap.hasOwnProperty(t)&&!this.CSMap[t].load){var e=this.CSMap[t];e.load=!0,studioMbPop.loadingBlock($("#whTalkBoxTab")),studioChatMb.socket.emit("getWhMsg",{clientStoreId:studioChatMb.userInfo.clientStoreId,userType:studioChatMb.userInfo.userType,groupId:studioChatMb.userInfo.groupId,groupType:studioChatMb.userInfo.groupType,userId:studioChatMb.userInfo.userId,toUser:{userId:e.userNo,userType:e.userType}})}},setCurrCS:function(t){var e=null;if(t&&t.userId)this.CSMap.hasOwnProperty(t.userId)?e=this.CSMap[t.userId]:(e={userNo:t.userId,userName:t.userName||t.nickname,online:!0,load:!1,userType:t.userType,avatar:t.avatar},this.CSMap[t.userId]=e);else{var i=null;for(var s in this.CSMap)i=this.CSMap[s],(!e||3!=e.userType&&3==i.userType||e.userType==i.userType&&!e.online&&i.online)&&(e=i)}if(!e)return null;if(e.load||this.loadMsg(e.userNo),e.userNo){this.currCS=e;var a=$("#whTalkBoxTab .view_select"),o=a.find("a[uid="+this.currCS.userNo+"]");return a.find(".selectlist a").removeClass("on"),0==o.size()?(a.find(".selectlist").append('<a href="javascript:void(0)" class="on" uid="'+this.currCS.userNo+'">'+this.currCS.userName+"</a>"),a.find(".selected").text(this.currCS.userName)):(o.addClass("on"),a.find(".selected").text(o.text())),a.find(".selectlist a").size()<=1?a.hide():(a.show(),$("#whDialog_list").children().hide(),$("#whDialog_list").children("[csid="+this.currCS.userNo+"]").show(),this.setWHTalkListScroll()),e}return null},getCSList:function(){try{$.getJSON("/fxstudio/getCS",{groupId:studioChatMb.userInfo.groupId},function(t){if(t&&t.length>0)for(var e,i,s=0,a=t.length;a>s;s++)e=t[s],studioChatMb.whTalk.CSMap.hasOwnProperty(e.userNo)?i=studioChatMb.whTalk.CSMap[e.userNo]:(i={online:!1},studioChatMb.whTalk.CSMap[e.userNo]=i),i.userNo=e.userNo,i.userName=e.userName,i.userType=3,i.avatar=common.isValid(e.avatar)?e.avatar:"/fx/theme2/img/cm.png",i.load=!1})}catch(t){console.error("getCSList->"+t)}},setCSOnline:function(t,e){var i=null;this.CSMap.hasOwnProperty(t)?i=this.CSMap[t]:(i={},this.CSMap[t]=i),i.online=e},refreshTips:function(){studioChatMb.whTalk.msgCnt>0?$(".wh_tips").text(studioChatMb.whTalk.msgCnt).show():$(".wh_tips").hide()},setWHTalkListScroll:function(){$("#whTalkPanel").scrollTop($("#whTalkPanel")[0].scrollHeight)},receiveMsg:function(t,e,i){var s=t.fromUser;if(e&&(s.publishTime=t.uiId),t.isVisitor)return void $("#"+t.uiId).remove();if(i&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" .dialog em.ruleTipStyle").remove(),void $("#"+s.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",s.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||studioChatMb.userInfo.userId!=s.userId||!t.serverSuccess){var a=studioChatMb.formatContentHtml(t,e,i,!0),o=$("#whTalkPanel"),n=o.scrollTop()+o.height()+30>=o.get(0).scrollHeight;if(i?$("#whDialog_list").prepend(a):$("#whDialog_list").append(a),n&&this.tabCheck&&studioChatMb.whTalk.setWHTalkListScroll(),studioChatMb.formatMsgToLink(s.publishTime),studioChatMb.userInfo.userId!=s.userId&&$("#"+s.publishTime+" .uname,#"+s.publishTime+" .headimg").click(function(){var t=$(this).parents("li:first"),e={userId:t.find(".headimg").attr("uid"),nickname:t.find(".uname strong").text(),userType:t.attr("utype"),avatar:t.find(".headimg img").attr("src")};studioChatMb.whTalk.setCurrCS(e)}),this.tabCheck||i||(studioChatMb.whTalk.msgCnt++,this.refreshTips()),i||studioChatMb.userInfo.userId==s.userId||this.setCurrCS(s),i||(this.askMsgObj=null),i&&s.toUser&&common.isValid(s.toUser.question)){var r=this.setCurrCS({userId:s.toUser.userId});this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:s.toUser.question},fromUser:{nickname:r.userName,userId:r.userNo,userType:r.userType,avatar:r.avatar,publishTime:s.toUser.publishTime}},!1,!0)}}else if($("#"+t.uiId+" .uname span").html(studioChatMb.formatPublishTime(s.publishTime)),$("#"+t.uiId).attr("id",s.publishTime),t.content.msgType==studioChatMb.msgType.img){studioChatMb.removeLoadDom(s.publishTime);var u=$("#"+s.publishTime+' .dialog[contt="a"]>a'),l=t.content.needMax?"/studio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:u.children("img").attr("src");u.attr("href",l)}},pushMsg:function(){this.currCS||this.setCurrCS(),this.pushObj&&this.currCS&&(this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:this.pushObj.info},fromUser:{nickname:this.currCS.userName,userId:this.currCS.userNo,userType:this.currCS.userType,avatar:this.currCS.avatar,publishTime:this.pushObj.publishTime}},!1,!1),this.askMsgObj=this.pushObj,this.pushObj=null)},sendWhMsg:function(t){return this.currCS||this.setCurrCS(),this.currCS?(t.fromUser.toUser={userId:this.currCS.userNo,nickname:this.currCS.nickname,talkStyle:1,userType:this.currCS.userType},this.askMsgObj&&(t.fromUser.toUser.question=this.askMsgObj.info,t.fromUser.toUser.questionId=this.askMsgObj.infoId,t.fromUser.toUser.publishTime=this.askMsgObj.publishTime),studioChatMb.whTalk.receiveMsg(t,!0,!1),void studioChatMb.socket.emit("sendMsg",t)):void studioMbPop.showMessage("老师助理不在线，暂不可私聊！")}}};