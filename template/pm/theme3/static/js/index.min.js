function openLive800Chat(e){var t="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";e?location.href=t:window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(){var e="http://crm2.qq.com/page/portalpage/wpa.php?uin=800018282&cref=&ref=&f=1&ty=1&ap=&as=";window.open(e,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(e)}function live800Prompt(e){window.onbeforeunload=null;var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==e)try{UUID.prototype.createUUID();window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(n){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(n){window.open(i)}}function qqPrompt(e){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(n){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(e,t){return isNaN(t)||t>e.length?!1:void e.splice(t,1)},joinSplit:function(e){return",".concat(e).concat(",")},isBlank:function(e){return void 0==e||null==e||"undefined"==e||"null"==e||""==$.trim(e)},isValid:function(e){return!this.isBlank(e)},trim:function(e){return this.isBlank(e)?"":e.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(e){return document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(e){return this.isBlank(e)?"":e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(e,t){t||(t="-"),e instanceof Date||(e=new Date(e));var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate());return i},getHHMMSS:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return t},getMMSS:function(e){return e instanceof Date||(e=new Date(e)),(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getHHMM:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());return t},formatterDateTime:function(e,t){if(t||(t="-"),e instanceof Date||(e=new Date(e)),"Invalid Date"==e)return"";var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return i},longMsTimeToDateTime:function(e,t){var i=new Date(e);return this.formatterDateTime(i,t)},showBox:function(e,t){$(e).slideDown(),$(t||".layer-shadow").show()},hideBox:function(e,t){$(e).slideUp(),$(t||".layer-shadow").hide()},containSplitStr:function(e,t){return common.isBlank(e)||common.isBlank(t)?!1:-1!=(","+e+",").indexOf(","+t+",")},getJson:function(e,t,i,n,o){var a=null;return $.ajax({url:e,type:"POST",timeout:1e5,cache:!1,async:void 0!=n?n:!1,dataType:"json",data:t,success:"function"==typeof i?i:function(e){a=e},error:function(e,t){"function"==typeof o?o(t):common.isValid(e.responseText)&&"OK"!=e.statusText?alert(e.responseText):alert("请求超时,请重试!")}}),a},arraySort:function(e,t){return function(i,n){return t?i[e]<n[e]:i[e]>n[e]}},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},isMobilePhone:function(e){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(e)},dateTimeWeekCheck:function(e,t,i){if(this.isBlank(e))return!!t;$.isPlainObject(e)||(e=JSON.parse(e));var n=i?new Date(i):new Date,o=!1,a=this.formatterDate(n);if(o=this.isBlank(e.beginDate)||a>=e.beginDate,o&&(o=this.isBlank(e.endDate)||a<=e.endDate),!o)return!1;var s=e.weekTime;if(this.isBlank(s))return o;var r=null,u=null,l=!1;for(var d in s)if(r=s[d],(!this.isValid(r.week)||n.getDay()==parseInt(r.week))&&(u=this.getHHMMSS(n),l=this.isBlank(r.beginTime)||u>=r.beginTime,l&&(l=this.isBlank(r.endTime)||u<=r.endTime),l))break;return l},arrayUnique:function(e){if(!e)return e;for(var t,i=[],n={},o=0;null!=(t=e[o]);o++)n[t]||(i.push(t),n[t]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(e,t,i){return common.isWebSocket()?(console.log("used websocket!"),e.connect(t.webSocket+"/"+i,{transports:["websocket"]})):e.connect(t.socketIO+"/"+i)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},clearMsgHtml:function(e){var e=e.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return e&&(e=$.trim(e)),e},formatToJson:function(e){return this.isBlank(e)?null:JSON.parse(e)},getSyllabusPlan:function(e,t){if(!e||!e.courses)return null;var i=function(e,t){if(e){var i=common.isMobile(),n=null;"object"!=typeof e&&(e=JSON.parse(e));for(var o in e)if(n=e[o],i){if(1==t&&3==n.code)return n.url}else if(n.code==t)return n.url}},n=function(t,n,o){var s=null,r=t.course;return r&&r.length>n?(s=r[n],0==s.status||common.isBlank(s.lecturerId)?null:(s.studioLink=i(e.studioLink,s.courseType),s.startTime=t.startTime,s.endTime=t.endTime,s.day=a[n].day,s.isNext=o,s)):null},o=null;o=this.isValid(e.courses)&&"object"!=typeof e.courses?JSON.parse(e.courses):e.courses;for(var a=o.days,s=o.timeBuckets,r=new Date(t).getDay(),u=common.getHHMM(t),l=null,d=!1,c=null,h=null,p=0;p<a.length;p++)if(0!=a[p].status)if(a[p].day>r){for(var m in s)if(l=s[m],h=n(l,p,!0))return h}else if(a[p].day==r)for(var m in s){if(l=s[m],l.startTime<=u&&(l.endTime>=u||"00:00"==l.endTime))return d=!0,n(l,p,!1);if(!d&&l.startTime>u)return d=!0,n(l,p,!0)}else if(!c)for(var m=0;m<s.length;m++)if(h=s[m].course,h&&0!=h[p].status&&!common.isBlank(h[p].lecturerId)){c={dayIndex:p,tmIndex:m};break}return!d&&c?n(s[c.tmIndex],c.dayIndex,!0):null},formatSyllabus:function(e,t,i,n){var o={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},a=new Date(t).getDay(),s=this.getHHMM(t),r=$.extend({},o,n),u=function(e,t,i,n){var o=0,u=(e+6)%7,l=(a+6)%7;return o=u>l?2:l>u?0:n?1:s>=i?0:t>s?2:1,r.courseCls[o]},l=[];try{if(e){var d=$.isPlainObject(e)?e:JSON.parse(e),c=d.days?d.days.length:0;if(c>0)if(1===i){var h={0:"文字",1:"视频",2:"oneTV"};l.push('<div class="sy_panel">');var p=t-864e5*((a+6)%7),m=null,f=null,v=null;l.push('<div class="sy_nav">');for(var g=' style="width:'+100/c+'%;"',y=0;c>y;y++)m=new Date(p+(d.days[y].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),v=d.days[y].day==a?' class="active"':"",l.push('<a href="javascript:void(0)" d="'+d.days[y].day+'"'+v+g+">"+r.dayCN[d.days[y].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');l.push("</div>"),l.push('<div class="sy_cont"><div>'),l.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var w=null,b=null,y=0;c>y;y++){if(l.push('<tbody d="'+d.days[y].day+'">'),0==d.days[y].status)b=u(d.days[y].day,null,null,!0),l.push('<tr class="'+b+'" width="100%"><td>休市</td></tr>');else for(var S=0,M=d.timeBuckets.length;M>S;S++)w=d.timeBuckets[S],b=u(d.days[y].day,w.startTime,w.endTime,!1),0==w.course[y].status?(l.push('<tr class="'+b+'">'),l.push('<td width="25%">'+w.startTime+"-"+w.endTime+"</td>"),l.push('<td colspan="2" width="75%">休市</td>'),l.push("</tr>")):w.course[y].lecturer&&(l.push('<tr class="'+b+'">'),l.push('<td width="25%">'+w.startTime+"-"+w.endTime+"【"+h[w.course[y].courseType]+"】</td>"),l.push('<td width="25%">'+w.course[y].lecturer+"</td>"),l.push('<td width="50%">'+w.course[y].title+"</td>"),l.push("</tr>"));l.push("</tbody>")}l.push("</table>"),l.push("</div></div>"),l.push("</div>")}else if(2===i){l.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),l.push("<tr>"),l.push("<th>星期\\节次</th>");for(var M=d.timeBuckets?d.timeBuckets.length:0,w=null,b=null,S=0;M>S;S++)w=d.timeBuckets[S],l.push("<th>"+r.indexCN[S]+"<br><span>("+w.startTime+"-"+w.endTime+")</span></th>");l.push("</tr>");for(var T=null,y=0,k=d.days?d.days.length:0;k>y;y++){if(T=d.days[y],l.push("<tr>"),l.push("<th>"+r.dayCN[T.day]+"</th>"),0==T.status)b=u(T.day,null,null,!0),l.push('<td class="'+b+'" colspan="'+M+'">休市</td>');else for(var S=0;M>S;S++)w=d.timeBuckets[S],b=u(T.day,w.startTime,w.endTime,!1),l.push('<td class="'+b+'">'+(0==w.course[y].status?"休市":w.course[y].lecturer)+"</td>");l.push("</tr>")}l.push("</table>")}else if(3===i){var p=s-864e5*((a+6)%7),m=null,v=null,T=null,g=' style="width:'+100/c+'%;"';l.push("<tr>");for(var y=0;c>y;y++)T=d.days[y],m=new Date(p+(d.days[y].day+6)%7*864e5),v=d.days[y].day==a?' class="active"':"",l.push('<th d="'+d.days[y].day+'"'+v+g+">"+r.dayCN[d.days[y].day]+"<i></i></th>");l.push("</tr>"),l.push('<tr><td class="space" colspan="'+c+'"></td></tr>');for(var w=null,b=null,y=0;c>y;y++){if(T=d.days[y],l.push('<tr d="'+T.day+'"><td colspan="'+c+'">'),0==T.status)b=u(T.day,null,null,!0),l.push('<p class="'+b+'">休市</p>');else for(var S=0,M=d.timeBuckets?d.timeBuckets.length:0;M>S;S++)w=d.timeBuckets[S],w.course[y].lecturer&&(b=u(T.day,w.startTime,w.endTime,!1),l.push('<p class="'+b+'">'),l.push("<span>"+w.startTime+"-"+w.endTime+"</span>"),0==w.course[y].status?l.push("<span>休市</span>"):(l.push("<span>"+r.courseType[w.course[y].courseType]+"</span>"),l.push("<span>"+w.course[y].lecturer+"</span>"),l.push('<span class="item">'+w.course[y].title+"</span>")),l.push("</p>"));l.push("</td></tr>")}}}}catch(C){return console.error("formatSyllabus->"+C),""}return l.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},copyObject:function(e,t,i){if(!t)return e;for(var n in e)t.hasOwnProperty(n)&&common.isValid(t[n])&&(e[n]=t[n]);if(i)for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])},isRightName:function(e){return!/^([0-9]{2,20})$/g.test(e)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(e)},randomIndex:function(e){var t=parseInt(Math.round(Math.random()*e));return t==e&&(t=e-1),0>t?0:t},saveToDesktop:function(e,t){try{var i=new ActiveXObject("WScript.Shell"),n=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+t+".url");n.TargetPath=e,n.Save()}catch(o){return!1}return!0}};window.console||(console=function(){function e(){}function t(){return null==i&&(i=new e),i}var i=null;return e.prototype={log:function(e){},error:function(e){}},t()}()),$.fn.focusEnd=function(){$(this).focus();var e=$("<span/>").appendTo($(this)),t=e.get(0),i=null,n=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(t),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t),n=window.getSelection(),n.removeAllRanges(),n.addRange(i)),e.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var e=this,t=0;t<arguments.length;t++)e=e.replace(new RegExp("\\{"+t+"\\}","g"),null==arguments[t]||void 0==arguments[t]?"":arguments[t]);return e};var StudioChatMini={apiUrl:"",filePath:"",currStudioAuth:!1,fromPlatform:null,blwsPlayer:null,syllabusData:null,serverTime:0,pushObj:{whPush:{},talkPush:[],talkPushInterval:null},msgType:{text:"text",img:"img",file:"file"},socket:null,socketUrl:"",userInfo:null,initStudio:!1,video:{type:"mp4",list:[],listMp4Index:[],index:-1},courses:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.setSocket(),this.setVideoList(),this.setEvent()},serverTimeUp:function(){StudioChatMini.clientVideoTask(),setInterval(function(){StudioChatMini.serverTime+=1e3,StudioChatMini.clientVideoTask()},1e3)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e="storeInfo_"+this.userInfo.groupType,t=store.get(e),i={};if(common.isBlank(t)){var n=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+n,i.userId="visitor_"+n,i.nickname="游客_"+n,i.userType=-1,store.set(e,i)}else i=t;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId):(i.loginId=this.userInfo.userId,store.set(e,i))},clientVideoTask:function(){var e=common.getSyllabusPlan(this.syllabusData,this.serverTime),t=e&&0!=e.status&&common.isValid(e.studioLink)&&1==e.courseType&&!e.isNext;$("#studioVideoDiv embed").size()<1&&t&&$("#vbackbtn_live").show()},playVideo:function(e,t){if(StudioChatMini.video.type=e,"mp4"==e||"video"==e)StudioChatMini.setVideo(StudioChatMini.changeVideoIndex(e));else{var i=common.getSyllabusPlan(this.syllabusData,this.serverTime);!i||0!=i.courseType&&common.isBlank(i.studioLink)||i.isNext||0==i.courseType||2==i.courseType?t?alert("目前还没有视频直播，详情请留意直播间的课程安排！"):(StudioChatMini.playVideo("mp4"),i&&!i.isNext&&0==i.courseType&&setTimeout(function(){window.SewisePlayer&&SewisePlayer.doStop()},1500)):($("#vbackbtn_live").hide(),this.setStudioVideoDiv(i.studioLink,i.title))}},changeVideoIndex:function(e){var t=-1,i=StudioChatMini.video.listMp4Index.length;return"mp4"!=e||0==i?(i=StudioChatMini.video.list.length,0==i?t=-1:1==i?t=0:-1==StudioChatMini.video.index?t=common.randomIndex(i):(t=common.randomIndex(i-1),t>=StudioChatMini.video.index&&t++)):1==i?t=StudioChatMini.video.listMp4Index[0]:(-1==StudioChatMini.video.index?t=common.randomIndex(i):(t=common.randomIndex(i-1),StudioChatMini.video.listMp4Index[t]>=StudioChatMini.video.index&&t++),t=StudioChatMini.video.listMp4Index[t]),StudioChatMini.video.index=t,-1==t?null:StudioChatMini.video.list[t]},getEmbedDom:function(e){return'<embed src="'+e+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'},setStudioVideoDiv:function(e,t){if(window.SewisePlayer&&(SewisePlayer.doStop(),$("#tvDivId").hide(),$("#studioTeachId a").removeClass("on")),$("#tVideoDiv iframe").remove(),-1!=e.indexOf("rtmp")){var i='<div style="position: relative; width: 100%; height: 100%; left: 0px; top: 0px;"><object type="application/x-shockwave-flash" id="sewise_player" name="sewise_player" data="/base/lib/flash/SewisePlayer.swf" width="100%" height="100%"><param name="allowfullscreen" value="true"><param name="wmode" value="transparent"><param name="allowscriptaccess" value="always"><param name="flashvars" value="autoStart=true&amp;programId=&amp;shiftTime=&amp;lang=zh_CN&amp;type=rtmp&amp;serverApi=ServerApi.execute&amp;skin=/base/lib/flash/skins/liveOrange.swf&amp;title=&amp;draggable=true&amp;published=0&amp;streamUrl='+e+'&amp;duration=3600&amp;poster=&amp;flagDatas=&amp;videosJsonUrl=&amp;adsJsonData=&amp;statistics=&amp;customDatas=&amp;playerName=Sewise Player&amp;clarityButton=enable&amp;timeDisplay=disable&amp;controlBarDisplay=enable&amp;topBarDisplay=disable&amp;customStrings=&amp;volume=0.6&amp;key=&amp;trackCallback="></object></div>';$("#studioVideoDiv").html(i)}else{if($("#stVideoDiv:visible").length>0&&$("#studioVideoDiv embed").attr("src")==e)return;$("#stVideoDiv .img-loading").fadeIn(0).delay(2e3).fadeOut(200),$("#studioVideoDiv embed").remove(),$(StudioChatMini.getEmbedDom(e)).appendTo("#studioVideoDiv")}$("#stVideoDiv").show(),$("#stVideoDiv .vtitle span").text(t),StudioChatMini.initStudio=!0},setVideo:function(e){try{$("#tvDivId").show(),$("#stVideoDiv").hide(),$("#studioVideoDiv embed").remove(),$("#tVideoDiv .img-loading").fadeIn(0).delay(2e3).fadeOut(200);var t=e.url,i=e.title;if($("#tvDivId .vtitle span").text(i),-1!=t.indexOf(".html")){window.SewisePlayer&&(SewisePlayer.doStop(),$("#tVideoDiv div").hide());var n=$("#tVideoDiv iframe"),o=!0;n.size()>0&&(n.attr("src")==t?o=!1:n.remove()),o&&$("#tVideoDiv").append('<iframe frameborder=0 width="100%" height="100%" src="'+t+'" allowfullscreen></iframe>')}else if($("#tVideoDiv iframe").remove(),$("#tVideoDiv div").show(),-1!=t.indexOf("type=blws")){var a=t.split("&");if(a.length>1){var s=a[1].replace(/^vid=/g,"");StudioChatMini.blwsPlayer?StudioChatMini.blwsPlayer.changeVid(s):StudioChatMini.blwsPlayer=polyvObject("#tVideoDiv").videoPlayer({width:"100%",height:"100%",vid:s,flashvars:{autoplay:"0",setScreen:"fill"},onPlayOver:function(e){StudioChatMini.playVideo(StudioChatMini.video.type)}})}}else if(window.SewisePlayer)SewisePlayer.toPlay(t,i,0,!0);else{var r=[];r.push("/base/lib/sewise.player.min.js?server=vod"),r.push("type="+(-1!=t.indexOf(".flv")?"flv":"mp4")),r.push("videourl="+t),r.push("autostart=true"),r.push("logo="),r.push("title=VodVideo"),r.push("buffer=5");var u=r.join("&"),l=document.createElement("script");l.type="text/javascript",l.src=u,$("#tVideoDiv").get(0).appendChild(l);var d=function(){return window.SewisePlayer?void SewisePlayer.onPause(function(e){window.setTimeout(function(){SewisePlayer.duration()<=SewisePlayer.playTime()&&StudioChatMini.playVideo(StudioChatMini.video.type)},1e3)}):void window.setTimeout(d,500)};d()}}catch(c){console.error("setVideo has error:"+c)}},getArticleList:function(e,t,i,n,o,a,s,r){try{$.getJSON("/studio/getArticleList",{authorId:common.trim(s),code:e,platform:t,hasContent:i,pageNo:n,pageSize:o,orderByStr:a},function(e){r(e)})}catch(u){console.error("getArticleList->"+u),r(null)}},setVideoList:function(){this.getArticleList("teach_video",this.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var t=e.data,i=null,n=null;for(var o in t)i=t[o],i.mediaUrl&&(n={title:i.detailList[0].title,id:i._id,type:common.isValid(i.mediaUrl)&&-1!=i.mediaUrl.indexOf(".mp4")?"mp4":"",url:i.mediaUrl},StudioChatMini.video.list.push(n),"mp4"===n.type&&StudioChatMini.video.listMp4Index.push(o))}StudioChatMini.playVideo("live")})},setEvent:function(){$("#vbackbtn_live").click(function(){StudioChatMini.playVideo("live",!0)}),$("#vbackbtn_chg").click(function(){StudioChatMini.playVideo("video")}),$("#vbackbtn_video").click(function(){StudioChatMini.playVideo("mp4")})},setTalkListScroll:function(e){var t=$("#chatMsgContentDiv");t.hasClass("mCustomScrollbar")?(t.mCustomScrollbar("update"),e&&t.mCustomScrollbar("scrollTo","bottom")):(t.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:"light-2"}),t.mCustomScrollbar("scrollTo","bottom"))},formatPublishTime:function(e,t,i){var n=Number(e.replace(/_.+/g,""));return common.isBlank(e)?"":t?common.formatterDateTime(n,i):common.getHHMM(n)},setContent:function(e,t,i){var n=e.fromUser;if(t&&(n.publishTime=e.uiId),!e.isVisitor){if(i&&$("#"+n.publishTime).length>0)return $("#"+n.publishTime+" span[contt] em[class=ruleTipStyle]").remove(),void $("#"+n.publishTime+" input").remove();if(e.rule)return void(e.value&&e.value.needApproval?$("#"+e.uiId).attr("id",n.publishTime):$("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>"));if(!t&&StudioChatMini.userInfo.userId==n.userId&&e.serverSuccess)return $("#"+e.uiId+" .dtime").html(StudioChatMini.formatPublishTime(n.publishTime)),void $("#"+e.uiId).attr("id",n.publishTime);var o=StudioChatMini.formatContentHtml(e,t,i),a=$("#dialog_list");a.append(o),this.formatMsgToLink(n.publishTime),i||StudioChatMini.setTalkListScroll(!0)}},formatContentHtml:function(e,t,i){var n,o="dialog ",a="uname ",s="false",r=e.fromUser,u=e.content,l=r.nickname,d=r.toUser,c="";d&&common.isValid(d.userId)&&(c='<span class="txt_dia" uid="'+d.userId+'" utype="'+d.userType+'">@<label>'+d.nickname+"</label></span>",StudioChatMini.userInfo.userId==d.userId&&(s="true")),n=u.msgType==StudioChatMini.msgType.img?u.needMax?'<a href="/studio/getBigImg?publishTime='+r.publishTime+"&userId="+r.userId+'" data-lightbox="dialog-img"><img src="'+u.value+'" alt="图片"/></a>':'<a href="'+(u.value?u.value:"javascript:")+'" data-lightbox="dialog-img"><img src="'+u.value+'" alt="图片" /></a>':u.value,StudioChatMini.userInfo.userId==r.userId?(o+="mine",l="我",s="true"):3==r.userType?l+="&nbsp;（助理）":2==r.userType?o+="analyst":1==r.userType&&(o+="admin");var h=[];return h.push('<div class="'+o+'" id="'+r.publishTime+'" isMe="'+s+'" utype="'+r.userType+'" mType="'+u.msgType+'" t="header">'),h.push('<a href="javascript:" class="headimg" uid="'+r.userId+'">'+StudioChatMini.getUserAImgCls(r.userId,r.clientGroup,r.userType,r.avatar)+"</a>"),h.push('<div class="duser">'),"true"==s?(h.push('<span class="dtime">'+StudioChatMini.formatPublishTime(r.publishTime)+"</span>"),h.push('<a href="javascript:"  class="'+a+'">'+l+"</a>")):(h.push('<a href="javascript:"  class="'+a+'">'+l+"</a>"),h.push('<span class="dtime">'+StudioChatMini.formatPublishTime(r.publishTime)+"</span>")),h.push("</div><p>"),d&&common.isValid(d.question)?(h.push('<span class="dcont">'),h.push('<span uid="'+d.userId+'" utype="'+d.userType+'">'+d.nickname+"</span>提问："),h.push('<span contt="q">'+d.question+"</span>"),h.push('<span class="dialog_reply">回复：<span contt="a">'+n+"</span></span>"),h.push("</span>")):h.push('<span class="dcont" contt="a">'+c+n+"</span>"),h.push("</p></div>"),h.join("")},formatMsgToLink:function(e){$("#"+e+' span[contt]:contains("http:"),#'+e+' span[contt]:contains("https:")').each(function(e,t){var i=$(t).html(),n=i.split(/<img src="\S+">/g),o="";for(var a in n)if(o=n[a],!common.isBlank(o)){var s=o.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"});t.innerHTML=t.innerHTML.replace(o,s)}})},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},getUserAImgCls:function(e,t,i,n){var o="";if(i&&0!=i&&common.isValid(n))return'<img src="'+n+'">';if("vip"==t)o="user_v";else if("active"==t||"notActive"==t)o="user_r";else if("simulate"==t)o="user_d";else if("register"==t)o="user_m";else{if("visitor"==t||-1==i){e=e||"";var a=parseInt(e.substring(e.length-2),10);return isNaN(a)&&(a=100),a=(a+17)%40,'<img src="'+StudioChatMini.filePath+"/upload/pic/header/chat/visitor/"+a+'.png">'}o="user_c"}return'<img src="/pm/theme3/img/'+o+'.png">'},setSocket:function(){this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),StudioChatMini.userInfo.socketId=StudioChatMini.socket.id;var e=$("#studioListId a[class~=ing]");StudioChatMini.socket.emit("login",{userInfo:StudioChatMini.userInfo,fromPlatform:StudioChatMini.fromPlatform,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:e.attr("awr"),allowWhisper:e.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("disconnect",function(e){console.log("disconnect")}),this.socket.on("error",function(e){console.error("e:"+e)}),this.socket.on("sendMsg",function(e){e.fromUser.toUser&&1==e.fromUser.toUser.talkStyle||StudioChatMini.setContent(e,!1,!1)}),this.socket.on("notice",function(e){switch(e.type){case"removeMsg":$("#"+e.data.replace(/,/g,",#")).remove(),StudioChatMini.setTalkListScroll(!1);break;case"pushInfo":var t=e.data;3==t.position&&StudioChatMini.talkBoxPush.initTBP(t.infos)}}),this.socket.on("loadMsg",function(e){$(".img-loading[pf=chatMessage]").hide();var t=e.msgData,i=e.isAdd;if(i||$("#content_ul").html(""),t&&$.isArray(t)){t.reverse();for(var n in t)StudioChatMini.formatUserToContent(t[n])}StudioChatMini.setTalkListScroll(!0)})},formatUserToContent:function(e){var t={userId:e.userId,nickname:e.nickname,avatar:e.avatar,userType:e.userType,groupId:e.groupId,clientGroup:e.clientGroup,publishTime:e.publishTime,toUser:e.toUser,avatar:e.avatar,position:e.position};StudioChatMini.setContent({fromUser:t,content:e.content},!1,!0)},talkBoxPush:{initTBP:function(e){this.clear(),StudioChatMini.pushObj.talkPush=e,this.start()},clear:function(){StudioChatMini.pushObj.talkPushInterval&&(window.clearInterval(StudioChatMini.pushObj.talkPushInterval),StudioChatMini.pushObj.talkPushInterval=null);for(var e=StudioChatMini.pushObj.talkPush,t=null,i=0,n=e.length;n>i;i++)t=e[i],t.timeoutId&&window.clearTimeout(t.timeoutId),t.intervalId&&window.clearInterval(t.intervalId)},start:function(){var e=StudioChatMini.pushObj.talkPush;e&&e.length>0&&window.setInterval(function(){StudioChatMini.talkBoxPush.check()},1e4)},check:function(){for(var e=StudioChatMini.pushObj.talkPush,t=null,i=0,n=e.length;n>i;i++)t=e[i],t.startFlag||common.dateTimeWeekCheck(t.pushDate,!1,StudioChatMini.serverTime)&&(t.startFlag=!0,window.setTimeout(StudioChatMini.talkBoxPush.delayStartTask(t),60*(t.onlineMin||0)*1e3))},delayStartTask:function(e){return function(){StudioChatMini.talkBoxPush.showMsg(e),e.intervalMin&&e.intervalMin>0&&(e.intervalId=window.setInterval(StudioChatMini.talkBoxPush.startTask(e),60*e.intervalMin*1e3))}},startTask:function(e){return function(){common.dateTimeWeekCheck(e.pushDate,!1,StudioChatMini.serverTime)?StudioChatMini.talkBoxPush.showMsg(e):(window.clearInterval(e.intervalId),e.startFlag=!1)}},showMsg:function(e){var t=[];t.push('<div class="dialog push">'),t.push(e.content),t.push("</div>"),$("#dialog_list").append(t.join("")),StudioChatMini.setTalkListScroll(!0)}}};$(function(){StudioChatMini.init()});