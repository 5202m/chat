var studioMbPerson={load:function(o,i){o&&o.isLogin&&(this.refreshNickname(o.nickname),$("#person_hp").attr("src",studioMbPerson.getUserLevelIco(o.clientGroup,o.avatar)),$("#upg_tbody_id").html(""),studioMbPop.loadingBlock($("#upg_tbody_id")),$.getJSON("/studio/getClientGroupList",null,function(i){if(studioMbPop.loadingBlock($("#upg_tbody_id"),!0),i){var t="",e=0,n=null;for(var s in i)i[s].clientGroupId==o.clientGroup&&(e=i[s].sequence);var d,r=[];for(var p in i)n=i[p],d="",n.clientGroupId==o.clientGroup?(d=' class="on"',t="当前级别"):t="visitor"!=n.clientGroupId&&e<n.sequence?"vip"==n.clientGroupId?"联系客服升级":'<a href="javascript:void(0)" t="'+n.clientGroupId+'">升级</a>':"---",r.push("<tr"+d+'><td width="17%"><img src="'+studioMbPerson.getUserLevelIco(n.clientGroupId)+'"></td>'),r.push('<td width="20%"><b>'+common.trim(n.remark)+"</b></td>"),r.push('<td width="43%">'+common.trim(n.authorityDes)+"</td>"),r.push('<td width="20%">'+t+"</td></tr>");$("#upg_tbody_id").append(r.join("")),$("#upg_tbody_id a").click(function(){var o=$(this).attr("t");studioMbPop.loadingBlock($("#personPop")),common.getJson("/studio/upgrade",{clientGroup:o},function(i){if(studioMbPop.loadingBlock($("#personPop"),!0),i.isOK){var t="升级成功！刷新页面后，您可享用更多直播间权限。";"active"===i.clientGroup&&"notActive"===o&&(t+="<br/>注：你已经激活真实交易账户，直接为你升级到A级别。"),studioMbPop.popBox("msg",{msg:t,type:"upg"})}else"active"===o?studioMbPop.showMessage("很遗憾，您未激活金道真实交易账户，升级失败！如有疑问请联系客服！"):"notActive"===o?studioMbPop.showMessage("很遗憾，您未开通金道真实交易账户，升级失败！如有疑问请联系客服！"):"simulate"===o&&studioMbPop.showMessage("很遗憾，您未开通金道模拟交易账户，升级失败！如有疑问请联系客服！")},!0,function(){studioMbPop.loadingBlock($("#personPop"),!0)})})}}),$(".logoutbtn").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href="/studio/logout"}),$("#personPop_repwd").bind("click",{clientStoreId:o.clientStoreId,groupId:o.groupId,platform:i.platform},function(o){studioMbPop.popBox("pwd1",o.data)}))},init:function(){},getUserLevelIco:function(o,i){if(common.isValid(i))return i;var t="/pm/theme2/img/user_c.png";switch(o){case"vip":t="/pm/theme2/img/user_v.png";break;case"active":t="/pm/theme2/img/user_r.png";break;case"notActive":t="/pm/theme2/img/user_r.png";break;case"simulate":t="/pm/theme2/img/user_d.png";break;case"register":t="/pm/theme2/img/user_m.png"}return t},refreshNickname:function(o){$("#person_nn").html(o)}},studioMbVC={defaultTime:120,verifyCodeMap:{},init:function(o,i,t,e){studioMbVC.verifyCodeMap[o]||(studioMbVC.verifyCodeMap[o]={useType:i,$btn:t,$input:e,intervalId:null,time:studioMbVC.defaultTime},e.bind("input propertychange",o,function(o){var i=studioMbVC.verifyCodeMap[o.data];i&&!i.intervalId&&(common.isMobilePhone(this.value)?i.$btn.addClass("pressed"):i.$btn.removeClass("pressed"))}),t.bind("click",o,function(o){var i=o.data,t=studioMbVC.verifyCodeMap[i];if(t&&$(this).hasClass("pressed")){$(this).removeClass("pressed").text("发送中...");var e=t.$input.val(),n=t.useType;try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:e,useType:n},function(o){o&&0==o.result?studioMbVC.setVerifyCodeTime(i):("1005"==o.errcode?studioMbPop.showMessage(o.errmsg):console.error("提取数据有误！"),studioMbVC.resetVerifyCode(i))})}catch(o){studioMbVC.resetVerifyCode(),console.error("getMobileVerifyCode->"+o)}}}))},resetVerifyCode:function(o){if(studioMbVC.verifyCodeMap[o]){var i=studioMbVC.verifyCodeMap[o];i.intervalId&&(clearInterval(i.intervalId),i.intervalId=null),i.time=studioMbVC.defaultTime,i.$btn.text("获取验证码"),i.$input.trigger("input")}},setVerifyCodeTime:function(o){if(studioMbVC.verifyCodeMap[o]){var i=studioMbVC.verifyCodeMap[o];i.intervalId||(i.intervalId=window.setInterval('studioMbVC.setVerifyCodeTime("'+o+'")',1e3)),i.time>1?(i.time--,i.$btn.text("重新获取("+(i.time-1)+")")):studioMbVC.resetVerifyCode(o)}}},studioMbLogin={verifyCodeIntervalId:0,groupId:null,clientStoreId:null,clientGroup:null,platform:null,load:function(){this.setEvent()},init:function(o,i,t,e,n,s){this.platform=o,this.groupId=i,this.clientStoreId=t,this.clientGroup=e,this.resetFormInput(),$("#loginForm_csi").val(t),n?$("#loginPop .pop-close").show():$("#loginPop .pop-close").hide(),s?$("#login_tip").show().text($("#setlogintip").text()):$("#login_tip").hide(),"wechat"==o&&$("#loginForm .auto_login").hide()},setEvent:function(){$("#loginForm_sub").bind("click",function(){studioMbLogin.checkFormInput()&&(studioMbPop.loadingBlock($("#loginPop")),common.getJson("/studio/login",$("#loginForm").serialize(),function(o){return o.isOK?(studioMbLogin.clientGroup=o.userInfo.clientGroup,void(studioMbLogin.groupId?common.getJson("/studio/checkGroupAuth",{groupId:studioMbLogin.groupId},function(o){o.isOK?(studioMbPop.loadingBlock($("#loginPop"),!0),studioMbPop.reload()):o.error&&"1000"===o.error.errcode?studioMbPop.showMessage("您长时间未操作，请刷新页面后重试！"):studioMbLogin.checkClientGroup("vip")?studioMbPop.showMessage("该房间仅对新客户开放。"):studioMbPop.showMessage("已有真实账户并激活的客户方可进入【特别专场】，您还不满足条件。")},!0,function(o){studioMbPop.loadingBlock($("#loginPop"),!0),"success"!=o&&studioMbPop.showMessage("操作失败，请联系客服！")}):(studioMbPop.loadingBlock($("#loginPop"),!0),LoginAuto.setAutoLogin($("#loginForm_al").prop("checked")),studioMbPop.onWelcome&&studioMbPop.onWelcome(o.userInfo.clientGroup),studioMbPop.reload()))):(studioMbPop.loadingBlock($("#loginPop"),!0),studioMbPop.showMessage(o.error.errmsg),!1)},!0,function(){studioMbLogin.resetFormInput(),studioMbPop.loadingBlock($("#loginPop"),!0)}))}),$("#loginForm_tab li").bind("click",function(){var o=$(this).attr("lt");$("#loginForm_tab li.li-on").removeClass("li-on"),$(this).addClass("li-on"),$("#loginForm .inp[lt]").hide(),$("#loginForm .inp[lt='"+o+"']").show(),$("#loginForm .fr[lt]").hide(),$("#loginForm .fr[lt='"+o+"']").show(),$("#loginForm_lt").val(o)}),$("#loginForm_alBtn").bind("click",function(){var o=$("#loginForm_al").prop("checked");$("#loginForm_al").prop("checked",!o),o?$(this).children("s").removeClass("sel-on"):$(this).children("s").addClass("sel-on")}),$("#loginForm_pwdBtn").bind("click",function(){studioMbPop.popBox("pwd2",{groupId:studioMbLogin.groupId,clientStoreId:studioMbLogin.clientStoreId,platform:studioMbLogin.platform})}),$("#loginForm_reg").bind("click",function(){studioMbPop.popBox("reg",{groupId:studioMbLogin.groupId,clientStoreId:studioMbLogin.clientStoreId,platform:studioMbLogin.platform})}),studioMbVC.init("login","studio_login",$("#loginForm_vcb"),$("#loginForm_mb"))},resetFormInput:function(){$("#loginForm_mb").val("").trigger("input"),$("#loginForm_vc").val("")},checkFormInput:function(){var o=!0,i="",t={loginType:$("#loginForm_lt").val(),mobilePhone:$("#loginForm_mb").val(),verifyCode:$("#loginForm_vc").val(),password:$("#loginForm_pwd").val()};return common.isBlank(t.mobilePhone)?(o=!1,i="手机号码不能为空！"):common.isMobilePhone(t.mobilePhone)?"verify"==t.verifyCode&&common.isBlank(t.verifyCode)?(o=!1,i="手机验证码不能为空！"):"pwd"==t.verifyCode&&common.isBlank(t.password)&&(o=!1,i="密码不能为空！"):(o=!1,i="手机号码输入有误！"),studioMbPop.showMessage(i),o},checkClientGroup:function(o){var i=!1;switch(o){case"visitor":i="visitor"==this.clientGroup;break;case"vip":i="vip"==this.clientGroup||"active"==this.clientGroup;break;case"new":i="vip"!=this.clientGroup&&"active"!=this.clientGroup}return i},forceLogin:function(o){var i=LoginAuto.get();return"boolean"!=typeof o?i&&1==i.forceLogin:i?(i.forceLogin=o,LoginAuto.set(i)&&o):!1}},studioMbMsg={type:null,load:function(){$("#resultForm_sub").bind("click",function(){"logout"==studioMbMsg.type?studioMbPop.reload():studioMbPop.popHide()})},init:function(o,i){this.type=o,$("#resultForm_msg").html(i),"logout"==studioMbMsg.type?($("#resultPop .pop-close, #resultForm i").hide(),$("#resultForm_sub").val("重新登录")):($("#resultPop .pop-close, #resultForm i").show(),$("#resultForm_sub").val("确认"))}},studioMbSet={studioChatObj:null,load:function(){this.setEvent()},init:function(o){this.studioChatObj=o,$("#setForm").trigger("reset")},setEvent:function(){$("#setForm_sub").bind("click",function(){studioMbSet.checkFormInput()&&(studioMbPop.loadingBlock($("#setPop")),common.getJson("/studio/modifyName",$("#setForm").serialize(),function(o){return studioMbPop.loadingBlock($("#setPop"),!0),o.isOK?($("#setPop .pop_close").trigger("click"),studioMbSet.studioChatObj.refreshNickname(!0,o.nickname),$("#sendBtn").trigger("click"),void 0):(studioMbPop.showMessage(o.msg?o.msg:"修改失败，请联系客服！"),!1)},!0,function(){studioMbPop.loadingBlock($("#setPop"),!0)}))})},checkFormInput:function(){var o=!0,i="",t=$("#setForm_nn").val();return common.isBlank(t)?(o=!1,i="昵称不能为空！"):common.isRightName(t)||(o=!1,i="昵称为2至10位字符(数字、英文、中文、下划线),不能全是数字"),studioMbPop.showMessage(i),o}},studioMbReg={groupId:null,clientStoreId:null,platform:null,load:function(){this.setEvent()},init:function(o,i,t){this.groupId=o,this.clientStoreId=i,this.platform=t,$("#regForm").trigger("reset"),$("#regForm_mb").trigger("input")},setEvent:function(){$("#regForm_sub").bind("click",function(){studioMbReg.checkFormInput()&&(studioMbPop.loadingBlock($("#regPop")),common.getJson("/studio/reg",$("#regForm").serialize(),function(o){return studioMbPop.loadingBlock($("#regPop"),!0),o.isOK?(studioMbPop.showMessage("注册成功"),$("#reg1Form_lpBtn").attr("href","http://www.24k.hk/activity/studioLottery/index.html?userId="+o.userId+"#ba"),studioMbPop.popShow($("#reg1Pop")),void 0):(studioMbPop.showMessage(o.msg?o.msg:"注册失败，请联系客服！"),!1)},!0,function(){studioMbPop.loadingBlock($("#setPop"),!0)}))}),$("#regForm_login").bind("click",function(){studioMbPop.popBox("login",{groupId:studioMbReg.groupId,clientStoreId:studioMbReg.clientStoreId,platform:studioMbReg.platform})}),$("#reg1Pop .pop-close, #reg1Form_sub").bind("click",function(){studioMbPop.reload()}),studioMbVC.init("reg","studio_reg",$("#regForm_vcb"),$("#regForm_mb"))},checkFormInput:function(){var o=!0,i="",t={mobilePhone:$("#regForm_mb").val(),password:$("#regForm_pwd").val(),password1:$("#regForm_pwd1").val(),verifyCode:$("#regForm_vc").val()};return common.isBlank(t.mobilePhone)?(o=!1,i="手机号码不能为空！"):common.isBlank(t.password)?(o=!1,i="密码不能为空！"):common.isBlank(t.password1)?(o=!1,i="确认密码不能为空！"):common.isBlank(t.verifyCode)?(o=!1,i="验证码不能为空！"):common.isMobilePhone(t.mobilePhone)?/^.{6,20}$/.test(t.password)?t.password!=t.password1&&(o=!1,i="两次密码输入不一致！"):(o=!1,i="密码由6至20数字、字母、符号组成！"):(o=!1,i="手机号码输入有误！"),studioMbPop.showMessage(i),o}},studioMbPwd1={groupId:null,clientStoreId:null,platform:null,load:function(){this.setEvent()},init:function(o,i,t){this.groupId=o,this.clientStoreId=i,this.platform=t,$("#pwd1Form input[type='password']").val("")},setEvent:function(){$("#pwd1Form_sub").bind("click",function(){studioMbPwd1.checkFormInput()&&(studioMbPop.loadingBlock($("#pwd1Pop")),common.getJson("/studio/resetPwd",$("#pwd1Form").serialize(),function(o){return studioMbPop.loadingBlock($("#pwd1Pop"),!0),o.isOK?(studioMbPop.showMessage("修改密码成功，请使用新密码登录！"),void studioMbPop.popBox("login",{groupId:studioMbPwd1.groupId,clientStoreId:studioMbPwd1.clientStoreId,platform:studioMbPwd1.platform})):(studioMbPop.showMessage(o.msg?o.msg:"修改密码失败，请联系客服！"),!1)},!0,function(){studioMbPop.loadingBlock($("#pwd1Pop"),!0)}))}),$("#pwd1Form_pwdBtn").bind("click",function(){studioMbPop.popBox("pwd2",{groupId:studioMbPwd1.groupId,clientStoreId:studioMbPwd1.clientStoreId,platform:studioMbPwd1.platform})})},checkFormInput:function(){var o=!0,i="",t={password0:$("#pwd1Form_pwd0").val(),password:$("#pwd1Form_pwd").val(),password1:$("#pwd1Form_pwd1").val()};return common.isBlank(t.password0)?(o=!1,i="原始密码不能为空！"):common.isBlank(t.password)?(o=!1,i="新的密码不能为空！"):common.isBlank(t.password1)?(o=!1,i="确认密码不能为空！"):/^.{6,20}$/.test(t.password)?t.password!=t.password1&&(o=!1,i="两次密码输入不一致！"):(o=!1,i="密码由6至20数字、字母、符号组成！"),studioMbPop.showMessage(i),o}},studioMbPwd2={groupId:null,clientStoreId:null,platform:null,load:function(){this.setEvent()},init:function(o,i,t){this.groupId=o,this.clientStoreId=i,this.platform=t,$("#pwd2Form input[type='text']").val(""),$("#pwd2Form_mb").trigger("input")},setEvent:function(){$("#pwd2Form_sub").bind("click",function(){studioMbPwd2.checkFormInput()&&(studioMbPop.loadingBlock($("#pwd2Pop")),common.getJson("/studio/resetPwd",$("#pwd2Form").serialize(),function(o){return studioMbPop.loadingBlock($("#pwd2Pop"),!0),o.isOK?void studioMbPop.popBox("pwd3",{groupId:studioMbPwd2.groupId,clientStoreId:studioMbPwd2.clientStoreId,platform:studioMbPwd2.platform,mobilePhone:o.mobilePhone}):(studioMbPop.showMessage(o.msg?o.msg:"验证手机号失败，请联系客服！"),!1)},!0,function(){studioMbPop.loadingBlock($("#pwd2Pop"),!0)}))}),studioMbVC.init("pwd","studio_resetPWD",$("#pwd2Form_vcb"),$("#pwd2Form_mb"))},checkFormInput:function(){var o=!0,i="",t={mobilePhone:$("#pwd2Form_mb").val(),verifyCode:$("#pwd2Form_vc").val()};return common.isBlank(t.mobilePhone)?(o=!1,i="手机号码不能为空！"):common.isBlank(t.verifyCode)?(o=!1,i="验证码不能为空！"):common.isMobilePhone(t.mobilePhone)||(o=!1,i="手机号码输入有误！"),studioMbPop.showMessage(i),o}},studioMbPwd3={groupId:null,clientStoreId:null,platform:null,load:function(){this.setEvent()},init:function(o,i,t,e){this.groupId=o,this.clientStoreId=i,this.platform=t,$("#pwd3Form_mb").val(e),$("#pwd3Form input[type='password']").val("")},setEvent:function(){$("#pwd3Form_sub").bind("click",function(){studioMbPwd3.checkFormInput()&&(studioMbPop.loadingBlock($("#pwd3Pop")),common.getJson("/studio/resetPwd",$("#pwd3Form").serialize(),function(o){return studioMbPop.loadingBlock($("#pwd3Pop"),!0),o.isOK?(studioMbPop.showMessage("重置密码成功，请使用新密码登录！"),void studioMbPop.popBox("login",{groupId:studioMbPwd3.groupId,clientStoreId:studioMbPwd3.clientStoreId,platform:studioMbPwd3.platform})):(studioMbPop.showMessage(o.msg?o.msg:"重置密码失败，请联系客服！"),!1)},!0,function(){studioMbPop.loadingBlock($("#pwd3Pop"),!0)}))})},checkFormInput:function(){var o=!0,i="",t={password:$("#pwd3Form_pwd").val(),password1:$("#pwd3Form_pwd1").val()};return common.isBlank(t.password)?(o=!1,i="密码不能为空！"):common.isBlank(t.password1)?(o=!1,i="确认密码不能为空！"):/^.{6,20}$/.test(t.password)?t.password!=t.password1&&(o=!1,i="两次密码输入不一致！"):(o=!1,i="密码由6至20数字、字母、符号组成！"),studioMbPop.showMessage(i),o}},studioMbPop={Person:studioMbPerson,Login:studioMbLogin,Set:studioMbSet,Reg:studioMbReg,Pwd1:studioMbPwd1,Pwd2:studioMbPwd2,Pwd3:studioMbPwd3,Msg:studioMbMsg,onShow:null,onHide:null,onWelcome:null,showMessage:function(o){if(o){var i=$(".errorbox");i.hide().find("div").html(o),i.fadeIn().delay(2e3).fadeOut(200)}},loadingBlock:function(o,i){i?o.children("div.img-loading").remove():o.append('<div class="img-loading"><i></i></div>')},popShow:function(o){$(".popupbg").is(":hidden")&&$(".popupbg").fadeIn(),$(".popupbox").hide(),this.onShow&&this.onShow.call(null),o.show()},popHide:function(){$(".popupbox").hide(),this.onHide&&this.onHide.call(null),$(".popupbg").fadeOut()},reload:function(){var o=window.location.href,i="ko=1&t="+(new Date).getTime();-1==o.indexOf("?")?o=o+"?"+i:(o=o.replace(/&(t|ko)=\d*(?=&|$)/g,""),o=/\?(t|ko)=\d*(?=&|$)/.test(o)?o.replace(/\?(t|ko)=\d*(?=&|$)/,"?"+i):o+"&"+i),window.location.href=o},load:function(o,i,t){t&&(this.onShow="function"==typeof t.onShow?t.onShow:null,this.onHide="function"==typeof t.onHide?t.onHide:null,this.onWelcome="function"==typeof t.onWelcome?t.onWelcome:null),this.Person.load(o,i),this.Login.load(),this.Set.load(),this.Reg.load(),this.Pwd1.load(),this.Pwd2.load(),this.Pwd3.load(),this.Msg.load(),$(".pop-close").click(function(){studioMbPop.popHide()})},popBox:function(o,i){switch(o){case"person":this.popShow($("#personPop")),this.Person.init();break;case"login":this.popShow($("#loginPop")),this.Login.init(i.platform,i.groupId,i.clientStoreId,i.clientGroup,i.closeable!==!1,i.showTip);break;case"set":this.popShow($("#setPop")),this.Set.init(i.studioChatObj);break;case"reg":this.popShow($("#regPop")),this.Reg.init(i.groupId,i.clientStoreId,i.platform);break;case"pwd1":this.popShow($("#pwd1Pop")),this.Pwd1.init(i.groupId,i.clientStoreId,i.platform);break;case"pwd2":this.popShow($("#pwd2Pop")),this.Pwd2.init(i.groupId,i.clientStoreId,i.platform);break;case"pwd3":this.popShow($("#pwd3Pop")),this.Pwd3.init(i.groupId,i.clientStoreId,i.platform,i.mobilePhone);break;case"msg":this.popShow($("#resultPop")),this.Msg.init(i.type,i.msg)}}};