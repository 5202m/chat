function UUID(){this.id=this.createUUID()}function openLive800Chat(e){var t="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";e?location.href=t:window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(e,t){common.isBlank(t)&&(t="800018282");var i="http://crm2.qq.com/page/portalpage/wpa.php?uin="+t+"&cref=&ref=&f=1&ty=1&ap=&as="+e;window.open(i,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(e)}function live800Prompt(e){window.onbeforeunload=null;var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==e)try{UUID.prototype.createUUID();window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(i)}}function qqPrompt(e){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}function getMarketpriceCrossDomainIndex(e,t){$.ajax({type:"GET",url:e,dataType:"jsonp",success:function(e){"OK"==e.code&&parseMarketpriceIndex(e,t)},error:function(){}})}function parseMarketpriceIndex(e,t){for(var i=2,s="",a=0,n=0,o=0,r=0;r<e.listResult.length;r++){s=e.listResult[r].symbol,a=e.listResult[r].deltaPrice,o=e.listResult[r].price,n=e.listResult[r].deltaPercent,i="XAGUSD"==s||"USDJPY"==s?3:"EURUSD"==s?3:2;var l=$("#price_"+s);l.html(parseFloat(o).toFixed(i));var d=$("#deltaPercent_"+s);if(d.text((100*n).toFixed(2)+"%"),t){var c=parseFloat(o).toFixed(i);c=c.toString().substring(0,c.indexOf("."))+"<span>."+c.toString().substring(c.indexOf(".")+1)+"</span>",l.html(c+'<i changeCss="true"></i>');var u=$("#price_"+s+" i");d.text(a+"  "+(100*n).toFixed(2)+"%"),a>0?"true"==u.attr("changeCss")&&(l.removeClass(t.down),d.removeClass(t.down),u.removeClass(t.downCss).addClass(t.upCss)):"true"==u.attr("changeCss")&&(l.addClass(t.down),d.addClass(t.down),u.removeClass(t.upCss).addClass(t.downCss))}else a>0?$("#price_"+s).parent().addClass("up"):$("#price_"+s).parent().removeClass("up"),$("#deltaPrice_"+s).html(parseFloat(a).toFixed(i))}}function getAllMarketpriceIndex(e,t,i,s){try{window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket?pkMarketSocket?pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t):(pkMarketSocket=new ReconnectingWebSocket(e,null,{reconnectInterval:3e3}),pkMarketSocket.onmessage=function(e){var t=JSON.parse(e.data);"OK"==t.code&&parseMarketpriceIndex(t,s)},pkMarketSocket.onopen=function(e){pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t)}):setInterval(function(){getMarketpriceCrossDomainIndex(i,s)},2e3)}catch(a){console.log("get price has error!")}}function getSymbolPriceDatas(e,t,i){$.ajax({url:e,type:"GET",dataType:"jsonp",jsonp:"jsoncallback",jsonpCallback:"_setViewPrice",timeout:5e3,beforeSend:function(){},success:function(e){_setViewPrice(e,t,i)},error:function(e){}})}function _setViewPrice(e,t,i){if(0===e.status){var s=2,a="",n=0,o=0,r=0;$.each(e.data,function(e,l){if(common.isValid(i)&&$.isArray(i)&&$.inArray(e,i)>-1){a=e,n=l.fluctuate,r=l.now,o=l.Percent,s="XAGUSD"==a||"USDJPY"==a||"SILVER"==a?3:"EURUSD"==a?3:2;var d=$("#price_"+a),c=$("#deltaPercent_"+a);if("XAGCNH"==a?(d.html(r),c.text(n+"  "+o+"%")):(d.html(parseFloat(r).toFixed(s)),c.text(n+"  "+o+"%")),t){if("XAGCNH"==a)d.html(r+'<i changeCss="true"></i>');else{var u=parseFloat(r).toFixed(s);u=u.toString().substring(0,u.indexOf("."))+"<span>."+u.toString().substring(u.indexOf(".")+1)+"</span>",d.html(u+'<i changeCss="true"></i>')}var p=$("#price_"+a+" i");c.text(n+"  "+o+"%"),n>0?"true"==p.attr("changeCss")&&(d.removeClass(t.down),c.removeClass(t.down),p.removeClass(t.downCss).addClass(t.upCss)):"true"==p.attr("changeCss")&&(d.addClass(t.down),c.addClass(t.down),p.removeClass(t.upCss).addClass(t.downCss))}else n>0?$("#price_"+a).parent().addClass("up"):$("#price_"+a).parent().removeClass("up"),$("#deltaPrice_"+a).html(parseFloat(n).toFixed(s))}})}}var _gaq=_gaq||[],_hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(e){var t=new Date(1582,10,15,0,0,0,0),i=new Date,s=i.getTime()-t.getTime(),a=UUID.getIntegerBits(s,0,31),n=UUID.getIntegerBits(s,32,47),o=UUID.getIntegerBits(s,48,59)+"1",r=UUID.getIntegerBits(UUID.rand(4095),0,7),l=UUID.getIntegerBits(UUID.rand(4095),0,7),d=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return(e||"")+a+n+o+r+l+d},UUID.getIntegerBits=function(e,t,i){var s=UUID.returnBase(e,16),a=new Array,n="",o=0;for(o=0;o<s.length;o++)a.push(s.substring(o,o+1));for(o=Math.floor(t/4);o<=Math.floor(i/4);o++)n+=a[o]&&""!=a[o]?a[o]:"0";return n},UUID.returnBase=function(e,t){return e.toString(t).toUpperCase()},UUID.rand=function(e){return Math.floor(Math.random()*(e+1))};var chatAnalyze={localHref:window.location.href,utmStore:{ip:"",storeKey:"GWAFLGPHONECOOIKETRACK",userId:"",roomId:"",groupType:"",speakCount:0,onlineSTM:(new Date).getTime(),onlineETM:0},isLocalHref:function(){return/^https?:\/\/(\d{1,3}\.){3}\d{1,3}.+/.test(chatAnalyze.localHref)},init:function(){if(!this.isLocalHref()){var e="";-1!=chatAnalyze.localHref.indexOf("/studio")?e="studio":-1!=chatAnalyze.localHref.indexOf("/fxstudio")?e="fxstudio":-1!=chatAnalyze.localHref.indexOf("/hxstudio")&&(e="hxstudio"),""!=e&&(this.initGA(e),this.setGA(),this.setBaidu(),window.setTimeout(chatAnalyze.sendUTM(),1e4))}},initGA:function(e){"studio"==e&&(_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"])),"fxstudio"==e&&(_gaq.push(["_setAccount","UA-49389835-1"]),_gaq.push(["_setDomainName","gwfx.com"]),_gaq.push(["_addIgnoredRef","gwfx.com"])),"hxstudio"==e&&(_gaq.push(["_setAccount",""]),_gaq.push(["_setDomainName","handan.hx9999"]),_gaq.push(["_addIgnoredRef","handan.hx9999"])),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"])},setGA:function(){try{var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}catch(i){console.log("Set GA fail!"+i)}},setBaidu:function(){try{var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}catch(i){console.log("Set GA fail!"+i)}},getIp:function(e){$.getJSON("http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_="+Math.random(),function(t){chatAnalyze.utmStore.ip=t.Ip,e&&e()})},getUTMCookie:function(){for(var e=document.cookie,t=e.split(/[;&]/),i=0;i<t.length;i++){var s=t[i].split("=");if($.trim(s[0])==this.utmStore.storeKey)return s[1]}var a="127.0.0.1";-1!=chatAnalyze.localHref.indexOf("/studio")?a=".24k.hk":-1!=chatAnalyze.localHref.indexOf("/fxstudio")&&(a=".gwfx.com");var n=UUID.prototype.createUUID(-1!=a.indexOf("gwfx")?"":"G");return document.cookie=this.utmStore.storeKey+"="+escape(n)+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/;domain="+a,n},setUTM:function(e,t){try{this.getIp(),e?(this.utmStore.roomId=t.groupId,this.utmStore.userId=t.userId,this.utmStore.userTel=t.userTel,this.utmStore.clientGroup=t.clientGroup,this.utmStore.groupType=t.groupType,$(window).unload(function(){chatAnalyze.utmStore.onlineETM=(new Date).getTime(),chatAnalyze.sendUTM(null),window.event.returnValue=!0})):t.speakCount?this.utmStore.speakCount+=t.speakCount:chatAnalyze.utmStore.ip?chatAnalyze.sendUTM(t):this.getIp(function(){chatAnalyze.sendUTM(t)})}catch(i){console.log("Set UTM fail!"+i)}},utmAjax:function(e,t,i){$.ajax({async:i,url:e+"?t="+(new Date).getTime(),cache:!1,dataType:i?"jsonp":"json",data:{data:JSON.stringify(t)},success:function(e){}})},sendUTM:function(e){try{if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t=chatAnalyze.utmStore;if(!t.roomId||!t.groupType)return;if(!t.userTel&&!t.userId){var i=store.get("storeInfo_"+t.groupType);if(!i)return;t.userId=i.userId}var s=-1!=t.groupType.indexOf("fx")?1:2,a=this.getUTMCookie(),n=this.isLocalHref(),o={userId:a,customerType:t.clientGroup,ip:t.ip,businessPlatform:s,platformType:common.isMobile()?1:0,roomId:t.roomId};t.userTel?o.operationTel=t.userTel:o.visitorId=t.userId;var r=n?"http://testweb.gwfx.com:8088/GwUserTrackingManager_NEW/put/insertChart":"http://das.gwfx.com/put/insertChart";e&&e.courseId?(o.courseId=e.courseId,this.utmAjax(r,o,!0)):(o.startDateTime=t.onlineSTM,o.endDateTime=t.onlineETM,o.speakCount=t.speakCount,navigator.sendBeacon?navigator.sendBeacon(r+"Close",JSON.stringify(o)):this.utmAjax(r,o,!1))}catch(l){console.log("send UTM fail!"+l)}}};$(function(){chatAnalyze.init()});var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(e,t){return isNaN(t)||t>e.length?!1:void e.splice(t,1)},joinSplit:function(e){return",".concat(e).concat(",")},isBlank:function(e){return void 0==e||null==e||"undefined"==e||"null"==e||""==$.trim(e)},isValid:function(e){return!this.isBlank(e)},trim:function(e){return this.isBlank(e)?"":e.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(e){return document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(e){return this.isBlank(e)?"":e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(e,t){t||(t="-"),e instanceof Date||(e=new Date(e));var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate());return i},getHHMMSS:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return t},getMMSS:function(e){return e instanceof Date||(e=new Date(e)),(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getHHMM:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());return t},formatterDateTime:function(e,t){if(t||(t="-"),e instanceof Date||(e=new Date(e)),"Invalid Date"==e)return"";var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return i},longMsTimeToDateTime:function(e,t){var i=new Date(e);return this.formatterDateTime(i,t)},showBox:function(e,t){$(e).slideDown(),$(t||".layer-shadow").show()},hideBox:function(e,t){$(e).slideUp(),$(t||".layer-shadow").hide()},containSplitStr:function(e,t){return common.isBlank(e)||common.isBlank(t)?!1:-1!=(","+e+",").indexOf(","+t+",")},getJson:function(e,t,i,s,a){var n=null;return $.ajax({url:e,type:"POST",timeout:1e5,cache:!1,async:void 0!=s?s:!1,dataType:"json",data:t,success:"function"==typeof i?i:function(e){n=e},error:function(e,t){"function"==typeof a?a(t):common.isValid(e.responseText)&&"OK"!=e.statusText?alert(e.responseText):alert("请求超时,请重试!")}}),n},arraySort:function(e,t){return function(i,s){return t?i[e]<s[e]:i[e]>s[e]}},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},isMobilePhone:function(e){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(e)},dateTimeWeekCheck:function(e,t,i){if(this.isBlank(e))return!!t;$.isPlainObject(e)||(e=JSON.parse(e));var s=i?new Date(i):new Date,a=!1,n=this.formatterDate(s);if(a=this.isBlank(e.beginDate)||n>=e.beginDate,a&&(a=this.isBlank(e.endDate)||n<=e.endDate),!a)return!1;var o=e.weekTime;if(this.isBlank(o))return a;var r=null,l=null,d=!1;for(var c in o)if(r=o[c],(!this.isValid(r.week)||s.getDay()==parseInt(r.week))&&(l=this.getHHMMSS(s),d=this.isBlank(r.beginTime)||l>=r.beginTime,d&&(d=this.isBlank(r.endTime)||l<=r.endTime),d))break;return d},arrayUnique:function(e){if(!e)return e;for(var t,i=[],s={},a=0;null!=(t=e[a]);a++)s[t]||(i.push(t),s[t]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(e,t,i){return common.isWebSocket()?(console.log("used websocket!"),e.connect(t.webSocket+"/"+i,{transports:["websocket"]})):e.connect(t.socketIO+"/"+i)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},clearMsgHtml:function(e){var e=e.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return e&&(e=$.trim(e)),e},formatToJson:function(e){return this.isBlank(e)?null:JSON.parse(e)},getSyllabusPlan:function(e,t,i,s){if(!e||!e.courses)return null;var a=function(e,t){if(e){var a,n=common.isMobile();"object"!=typeof e&&(e=JSON.parse(e));for(var o in e)if(a=e[o],n){if(1==t&&(!i&&3==a.code||i&&4==a.code))return a.url}else if(s){if(1==t&&3==a.code){var r=a.url||"";return common.isHTTPS()&&(r=r.replace(/^rtmp:/,"rtmps:")),r}}else if(a.code==t)return a.url}},n=function(t,i,s){var n=null,o=t.course;return o&&o.length>i?(n=o[i],0==n.status||common.isBlank(n.lecturerId)?null:(n.studioLink=a(e.studioLink,n.courseType),n.startTime=t.startTime,n.endTime=t.endTime,n.day=l[i].day,n.isNext=s,n)):null},o=null;o=this.isValid(e.courses)&&"object"!=typeof e.courses?JSON.parse(e.courses):e.courses;for(var r,l=o.days,d=o.timeBuckets,c=(new Date(t).getDay()+6)%7,u=common.getHHMM(t),p=null,h=null,m=0;m<l.length;m++)if(0!=l[m].status)if(r=(l[m].day+6)%7,r>c){for(var f in d)if(p=d[f],h=n(p,m,!0))return h}else if(r==c)for(var f in d)if(p=d[f],p.startTime<=u&&(p.endTime>=u||"00:00"==p.endTime)?h=n(p,m,!1):p.startTime>u&&(h=n(p,m,!0)),h)return h;if(!e.publishEnd)return null;for(var m=0;m<l.length;m++)if(0!=l[m].status&&(r=(l[m].day+6)%7,!(e.publishEnd<864e5*(r+7-c)+t)))for(var f=0;f<d.length;f++)if(h=n(d[f],m,!0))return h;return null},formatSyllabus:function(e,t,i,s){var a={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},n=new Date(t).getDay(),o=this.getHHMM(t),r=$.extend({},a,s),l=function(e,t,i,s){var a=0,l=(e+6)%7,d=(n+6)%7;return a=l>d?2:d>l?0:s?1:o>=i?0:t>o?2:1,r.courseCls[a]},d=[];try{if(e){var c=$.isPlainObject(e)?e:JSON.parse(e),u=c.days?c.days.length:0;if(u>0)if(1===i){var p={0:"文字",1:"视频",2:"oneTV"};d.push('<div class="sy_panel">');var h=t-864e5*((n+6)%7),m=null,f=null,g=null;d.push('<div class="sy_nav">');for(var v=' style="width:'+100/u+'%;"',b=0;u>b;b++)m=new Date(h+(c.days[b].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),g=c.days[b].day==n?' class="active"':"",d.push('<a href="javascript:void(0)" d="'+c.days[b].day+'"'+g+v+">"+r.dayCN[c.days[b].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');d.push("</div>"),d.push('<div class="sy_cont"><div>'),d.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var x=null,w=null,b=0;u>b;b++){if(d.push('<tbody d="'+c.days[b].day+'">'),0==c.days[b].status)w=l(c.days[b].day,null,null,!0),d.push('<tr class="'+w+'" width="100%"><td>休市</td></tr>');else for(var I=0,y=c.timeBuckets.length;y>I;I++)x=c.timeBuckets[I],w=l(c.days[b].day,x.startTime,x.endTime,!1),0==x.course[b].status?(d.push('<tr class="'+w+'">'),d.push('<td width="25%">'+x.startTime+"-"+x.endTime+"</td>"),d.push('<td colspan="2" width="75%">休市</td>'),d.push("</tr>")):x.course[b].lecturer&&(d.push('<tr class="'+w+'">'),d.push('<td width="25%">'+x.startTime+"-"+x.endTime+"【"+p[x.course[b].courseType]+"】</td>"),d.push('<td width="25%">'+x.course[b].lecturer+"</td>"),d.push('<td width="50%">'+x.course[b].title+"</td>"),d.push("</tr>"));d.push("</tbody>")}d.push("</table>"),d.push("</div></div>"),d.push("</div>")}else if(2===i){d.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),d.push("<tr>"),d.push("<th>星期\\节次</th>");for(var y=c.timeBuckets?c.timeBuckets.length:0,x=null,w=null,I=0;y>I;I++)x=c.timeBuckets[I],d.push("<th>"+r.indexCN[I]+"<br><span>("+x.startTime+"-"+x.endTime+")</span></th>");d.push("</tr>");for(var k=null,b=0,S=c.days?c.days.length:0;S>b;b++){if(k=c.days[b],d.push("<tr>"),d.push("<th>"+r.dayCN[k.day]+"</th>"),0==k.status)w=l(k.day,null,null,!0),d.push('<td class="'+w+'" colspan="'+y+'">休市</td>');else for(var I=0;y>I;I++)x=c.timeBuckets[I],w=l(k.day,x.startTime,x.endTime,!1),d.push('<td class="'+w+'">'+(0==x.course[b].status?"休市":x.course[b].lecturer)+"</td>");d.push("</tr>")}d.push("</table>")}else if(3===i){var h=o-864e5*((n+6)%7),m=null,g=null,k=null,v=' style="width:'+100/u+'%;"';d.push("<tr>");for(var b=0;u>b;b++)k=c.days[b],m=new Date(h+(c.days[b].day+6)%7*864e5),g=c.days[b].day==n?' class="active"':"",d.push('<th d="'+c.days[b].day+'"'+g+v+">"+r.dayCN[c.days[b].day]+"<i></i></th>");d.push("</tr>"),d.push('<tr><td class="space" colspan="'+u+'"></td></tr>');for(var x=null,w=null,b=0;u>b;b++){if(k=c.days[b],d.push('<tr d="'+k.day+'"><td colspan="'+u+'">'),0==k.status)w=l(k.day,null,null,!0),d.push('<p class="'+w+'">休市</p>');else for(var I=0,y=c.timeBuckets?c.timeBuckets.length:0;y>I;I++)x=c.timeBuckets[I],x.course[b].lecturer&&(w=l(k.day,x.startTime,x.endTime,!1),d.push('<p class="'+w+'">'),d.push("<span>"+x.startTime+"-"+x.endTime+"</span>"),0==x.course[b].status?d.push("<span>休市</span>"):(d.push("<span>"+r.courseType[x.course[b].courseType]+"</span>"),d.push("<span>"+x.course[b].lecturer+"</span>"),d.push('<span class="item">'+x.course[b].title+"</span>")),d.push("</p>"));d.push("</td></tr>")}}}}catch(T){return console.error("formatSyllabus->"+T),""}return d.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(e,t,i){if(!t)return e;for(var s in e)t.hasOwnProperty(s)&&common.isValid(t[s])&&(e[s]=t[s]);if(i)for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])},isRightName:function(e){return!/^([0-9]{2,20})$/g.test(e)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(e)},randomIndex:function(e){var t=parseInt(Math.round(Math.random()*e));return t==e&&(t=e-1),0>t?0:t},saveToDesktop:function(e,t){try{var i=new ActiveXObject("WScript.Shell"),s=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+t+".url");s.TargetPath=e,s.Save()}catch(a){return!1}return!0}};window.console||(console=function(){function e(){}function t(){return null==i&&(i=new e),i}var i=null;return e.prototype={log:function(e){},error:function(e){}},t()}()),$.fn.focusEnd=function(){$(this).focus();var e=$("<span/>").appendTo($(this)),t=e.get(0),i=null,s=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(t),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t),s=window.getSelection(),s.removeAllRanges(),s.addRange(i)),e.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var e=this,t=0;t<arguments.length;t++)e=e.replace(new RegExp("\\{"+t+"\\}","g"),null==arguments[t]||void 0==arguments[t]?"":arguments[t]);return e};var pkMarketSocket=null,ChartFactory=window.Highcharts?function(){function e(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}function t(){var e=$(window).width();return 540>e?30:e>=540&&1080>e?40:80}var i={realtime:"1min","5min":"5min",hour:"1hour",day:"day"},s={ELEMENT_NOTFOUND:"没有指定画板元素",SERVICE_ERROR:"服务器出现错误",NOT_KEEP_WEBSOCKET_ERROR:"不支持websocket",NO_DATA:"没有数据"},a={line:function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i],a=s.milliseconds,n=parseFloat(s.end);0==n?t.push({x:a,y:null}):t.push({x:a,y:n})}return t},candlestick:function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i],a=s.milliseconds,n=parseFloat(s.high),o=parseFloat(s.low),r=parseFloat(s.end),l=parseFloat(s.begin);t.push([a,l,n,o,r])}return t}},n="",o=2;return null!=document.getElementById("symbol")&&"undefined"!=typeof document.getElementById("symbol")&&(n=document.getElementById("symbol").value),"XAGUSD"==n||"USDJPY"==n?o=3:("EURUSD"==n||"GBPUSD"==n||"AUDUSD"==n||"USDCHF"==n||"USDCAD"==n)&&(o=4),Highcharts.setOptions({global:{useUTC:!1}}),{pkSocket:null,closeSocket:function(){this.pkSocket&&this.pkSocket.close()},create:function(e,t,a){a&&a.show();var n=$.Deferred();if(!e||!e.length)return n.reject(s.ELEMENT_NOTFOUND),n.promise();var o={type:"post",dataType:"jsonp",jsonpCallback:"jsonpCallback",data:{kType:i.realtime}},r=this,l=$.extend(!0,{},o,t);return this.symbol=l.data.symbol,this.loadData(l).done(function(i){if(a&&a.hide(),!i||!i.code)return n.reject(s.SERVICE_ERROR);if("OK"!==i.code)return n.reject(s.SERVICE_ERROR);if(0==i.listResult.length)return n.reject(s.NO_DATA);var o=l.data.dataType,d=r.getChartType(o),i=r.parseData(i.listResult.reverse(),d,l);if(r.createChart(e,d,o,i),n.resolve(),t.wsUrl){if(t.wsParam+="&symbol="+t.data.symbol+"&dataType="+t.data.dataType,console.log("options.wsParam:"+t.wsParam),window.WebSocket||(window.WebSocket=window.MozWebSocket),!window.WebSocket)return n.reject(s.NOT_KEEP_WEBSOCKET_ERROR);try{ChartFactory.pkSocket?ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam):(ChartFactory.pkSocket=new ReconnectingWebSocket(t.wsUrl,null,{reconnectInterval:3e3}),ChartFactory.pkSocket.onmessage=function(i){var s=i.originalEvent?i.originalEvent.data:null;s&&(s=JSON.parse(s),"ok"==s.code.toLowerCase()&&s.condition&&s.condition.symbol==t.data.symbol&&s.condition.dataType==t.data.dataType&&s.listResult.length>0&&ChartFactory.add(e,s.listResult,time))},ChartFactory.pkSocket.onopen=function(e){ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam)})}catch(c){console.log("get kdata price has error!"+c)}}}),n.promise()},add:function(e,t,i){var s=this.getChartType(i);t=this.parseData(t,s),"line"===s?this.addPoint(e,t):this.addPoint(e,t)},parseData:function(e,t,i){var s=i&&i.parser&&i.parser[t]||a[t];return s(e)},getChartType:function(e){return e===i.realtime?"line":"candlestick"},createChart:function(e,t,i,s){"line"===t?this.createLineChart(e,s):"candlestick"==t&&this.createCandlestickChart(e,i,s)},createLineChart:function(e,t){var i={colors:["#b59130"],chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" 1min",position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{line:{dataGrouping:{enabled:!1},cropThreshold:300}},xAxis:{type:"datetime",tickLength:0,tickPixelInterval:70},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},opposite:!1,showLastLabel:!0,tickLength:0,lineWidth:1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=["<span>"+Highcharts.dateFormat("%Y-%m-%d %H:%M",this.x)+"</span><br/>"];return e.push("<span>价格:<strong>"+this.y+"</strong></span><br/>"),e.join("")}},series:[{name:"价位",type:"line",data:t}]};e.highcharts("StockChart",i)},addPoint:function(e,t){var i=e.highcharts();i.series[0].addPoint(t[0],!1),i.redraw()},createCandlestickChart:function(e,t,s){var a="%Y-%m-%d";t===i["5min"]?a="%Y-%m-%d %H:%M":t===i.hour&&(a="%Y-%m-%d %H:%M");var n={chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" "+t,position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{candlestick:{upColor:"#F00",upLineColor:"#F00",color:"#00a004",lineColor:"#00a004"}},xAxis:{type:"datetime",tickPixelInterval:70,tickLength:0,dateTimeLabelFormats:{day:"%m-%d",week:"%m-%d",month:"%y-%m"}},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},lineWidth:1,opposite:!1,showLastLabel:!0,endOnTick:!1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=this.points[0].point,t=["<span>"+Highcharts.dateFormat(a,this.x)+"</span><br/>"];return t.push("<span>开盘价:<strong>"+e.open+"</strong></span><br/>"),t.push("<span>最高价:<strong>"+e.high+"</span></span><br/>"),t.push("<span>最低价:<strong>"+e.low+"</strong></span><br/>"),t.push("<span>收盘价:<strong>"+e.close+"</strong></span><br/>"),t.join("")}},series:[{name:"价格",type:"candlestick",data:s}]};t===i.day&&(n.xAxis.datafor=[]),e.highcharts("StockChart",n)},loadData:function(s){var a=t(),n=s.data.dataType;return $.extend(s.data,{startTime:e(new Date),num:n===i.realtime?120:a,flag:0}),$.ajax(s)}}}():null;!function(e){e.fn.qqFace=function(t){var i={id:"facebox",path:"face/",assign:"content",zIndex:1e3,tip:""},s=e.extend(i,t),a=e("#"+s.assign),n=s.id,o=s.path,r=s.tip;return a.length<=0?(alert("缺少表情赋值对象。"),!1):void e(this).click(function(t){var i,a;if(e("#"+n).length<=0){if(i='<div id="'+n+'" class="facebox"><i class="arr"></i><div class="facecont">',i+='<table border="0" cellspacing="0" cellpadding="0"><tr>',navigator.userAgent&&/(iphone|ipod|ipad|android)/.test(navigator.userAgent.toLowerCase()))for(var l=1;45>=l;l++)a=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+s.assign+'" lf="'+a+'"/></td>',l%9==0&&(i+="</tr><tr>");else for(var l=1;75>=l;l++)a=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+s.assign+'" lf="'+a+'"/></td>',l%15==0&&(i+="</tr><tr>");i+="</tr></table></div></div>",e(this).parent().append(i),e(this).parent().find("img").click(function(){e("#"+e(this).attr("tsg")).insertAtCaret(e(this).attr("lf")),e(this).parents(".facebox").hide()})}else e("#"+n+":visible").length>0?e("#"+n).hide():e("#"+n).show();t.stopPropagation()})}}(jQuery),jQuery.fn.extend({insertAtCaret:function(e){e='<img src="'+e+'"/>';var t=$(this).get(0);t.innerHTML+=e,$(this).focusEnd()}});var indexJS={options:null,isNeverLogin:!1,serverTime:0,towMinTime:0,socketUrl:"",userInfo:null,filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,syllabusData:null,infoNewCount:0,init:function(){this.serverTimeUp(),this.setVisitStore(),this.setEvent(),this.setTradeStrategyNote(null,!0),this.setAdvertisement()},setEvent:function(){var e=$(".rooms .rname:contains('专场')");if(1==e.size()){$(".roomctrl i").addClass("hot"),$(".roomctrl span").text(e.text());var t=e.siblings(".enterbtn").attr("rid"),i=$("#VIPRoomLink");i.show(),i.bind("click",t,function(e){$(".rooms .enterbtn[rid='"+e.data+"']").trigger("click")})}$(".header-right li").hover(function(){if($(this).find(".dropcont").show(),$(this).is(".cursor")){if(_gaq.push(["_trackEvent","pmchat_studio","header_course","content_top",1,!0]),1==$(this).attr("ck"))return;indexJS.fillCourse()}$(this).is(".notice")&&(indexJS.getArticleList("bulletin_system",indexJS.userInfo.groupId,1,1,1,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var t=e.data;if(t&&t.length>0){var i=t[0].detailList[0];$("#bulletinTab").find("strong").text(i.title),$("#bulletinTab").find("p").html(i.content)}}}),_gaq.push(["_trackEvent","pmchat_studio","header_bulletin","content_top",1,!0]))},function(){$(this).find(".dropcont").hide()}),0==$(".rooms .rbox").length&&$(".changeroom").hide(),$(".changeroom").click(function(){var e=$(this);if(e.hasClass("open"))e.removeClass("open");else{e.addClass("open");var t=e.attr("tm");if(!(common.isBlank(t)||indexJS.serverTime-Number(t)>=6e4))return;e.attr("tm",indexJS.serverTime);try{$.getJSON("/studio/getRmCourseList",{roomIds:$(".rooms .rbox[rid]").map(function(){return $(this).attr("rid")}).get().join(",")},function(e){if(e&&e.isOK){var t=e.data,i=$(".rooms .rbox[rid]");i.each(function(e){e==i.length-1&&$(this).addClass("last");var s=$(this).attr("rid");if(t.hasOwnProperty(s)){var a=t[s],n=0;"true"==$(this).find(".enterbtn").attr("av")&&(a.onlineNum>100?n=Math.ceil(50*Math.random())+275:(n=a.onlineNum<=10?60:200/a.onlineNum*3+10,n=Math.round(n))),$(this).find(".peo_num label").text(a.onlineNum+n),common.isValid(a.name)&&($(this).find(".info .nk").text(a.name),a.isNext||$(this).addClass("on"),a.day&&$(this).find(".info .st").text(common.daysCN[a.day]+" "+a.startTime+" - "+a.endTime))}})}})}catch(i){console.error("getRmCourseList->"+i),callback(null)}}}),indexJS.setListScroll(".mod_room .cont"),$(document).click(function(e){(!$(e.target).parent().hasClass("roomctrl")&&!$(e.target).parents().parents().hasClass("rbox")||$(e.target).hasClass("enterbtn"))&&$(".changeroom").removeClass("open")}),$(".rooms .rbox[rid] .enterbtn").click(function(){var e=$(this),t=$(this).attr("cgs");return"false"==e.attr("av")&&indexJS.checkClientGroup("visitor")?($("#login_a").trigger("click",{groupId:e.attr("rid")}),!1):common.containSplitStr(t,indexJS.userInfo.clientGroup)?void common.getJson("/studio/checkGroupAuth",{groupId:e.attr("rid")},function(e){e.isOK?indexJS.toRefreshView():indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户方可进入【特别专场】，您还不满足条件。如有疑问，请联系老师助理。")},!0,function(e){"success"!=e&&alert("操作失败，请联系客服！")}):(indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户方可进入【特别专场】，您还不满足条件。如有疑问，请联系老师助理。"),!1)}),$(".mod_main .tabnav a").click(function(){var e=$(this).index(),t=$(".mod_main .tabcont .main_tab").eq(e);$(".mod_main .tabnav a").removeClass("on"),$(this).addClass("on"),$(".mod_main .tabcont .main_tab").removeClass("on").eq(e).addClass("on"),0==e?$("#textLiveCount").data("cnt",0).html("").hide():1==e?(chat.showChatMsgNumTip(!0),chat.setTalkListScroll(!0)):2==e?indexJS.setInformation():3==e&&indexJS.setTradeStrategy(t.find(".scrollbox"))}),$("#textliveMore").bind("click",function(){if(!$(this).is(".all")){var e=$("#textlivePanel li[aid]:last").attr("aid");indexJS.setTradeStrategyNote(e,!1)}}),$("#qqcs").click(function(){openQQChatByCommonv3("","800018282")}),$("#saveToDesktop").click(function(){common.saveToDesktop(window.location.href,"视频直播间-金道贵金属")?box.showMsg("直播间快捷方式已成功添加到桌面"):window.location.href="/studio/getShortCut?t="+(new Date).getTime()}),$("#modifyAvatar").click(function(){var e=$("#fileForm"),t=e.find("input[type=file]");"true"!=e.attr("hasEv")&&(e.attr("hasEv","true"),
t.change(function(){var e=$(this),t=this.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var s=new FormData($("#fileForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:s,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var i=t.data?t.data[0]:null;i&&common.getJson("/studio/modifyAvatar",{avatar:i.fileDomain+i.filePath},function(t){t.isOK?($("#avatarInfoId").attr("src",t.avatar),$("#userListId li .mynk").prev().find("img").attr("src",t.avatar),indexJS.userInfo.avatar=t.avatar,e.val("")):console.error("上传头像失败，请联系在线客服！")},!0,function(){alert("上传头像失败，请联系在线客服！")})}else alert("上传头像失败，请联系在线客服！")},error:function(e){console.error("error:",e)}})}catch(a){console.error("上传图片失败",a)}})),t.click()}),$("#resetPasswordBtn").bind("click",function(){box.openSettingBox("password1")}),this.placeholderSupport()},showWelcomeMsg:function(){var e=$(".rooms .rname:contains('专场')");if(1==e.size()){var t=e.siblings(".enterbtn").attr("cgs"),i=e.text();common.containSplitStr(t,indexJS.userInfo.clientGroup)&&alert("您已具备进入“"+i+"”的条件，请关注"+i+"的课程安排。")}},fillCourse:function(){var e=indexJS.syllabusData&&indexJS.syllabusData.courses;if(e){for(var t,i={0:"文字直播",1:"视频直播",2:"oneTV直播"},s=e.days,a=e.timeBuckets,n=$(".course_nav").html(""),o="",r="",l=new Date(indexJS.serverTime).getDay(),d=indexJS.serverTime-864e5*((l+6)%7),c=100/s.length,u=0,p=s.length;p>u;u++){o=0==u?"fir":u==p-1?"last":"nct",r=s[u].day==l?" on":"",t=common.formatterDate(new Date(d+(s[u].day+6)%7*864e5)).substring(5),n.append('<a href="javascript:" class="'+o+r+'" t="'+u+'" d="'+s[u].day+'" style="width:'+c+'%;"><span>'+common.daysCN[s[u].day+""]+"<b>"+t+"</b></span><i></i></a>"),$(".cursor .dropcont .cont").append('<div class="course_tab'+r+'" t="'+u+'" d="'+s[u].day+'"><ul></ul></div>'),o="";var h=$(".cursor .course_tab:last ul"),m=null;if(1!=s[u].status)h.append('<li class="fir"><a href="javascript:"><span><lable>休市</lable></span></a></li>');else{o="fir";for(var f=0,g=a.length;g>f;f++)m=a[f].course[u],0!=m.status&&m.lecturer&&(h.append('<li class="'+o+'"><a href="javascript:" st="'+a[f].startTime+'" et="'+a[f].endTime+'"><i></i><span><lable>'+a[f].startTime+"- "+a[f].endTime+"　</lable><lable>"+i[m.courseType]+"　</lable><lable>"+m.lecturer+"</lable></span><p>"+m.title+"</p></a></li>"),o="")}}$(".course_nav a").click(function(){$(".course_nav a").removeClass("on"),$(".course_tab").removeClass("on"),$(this).addClass("on"),$(".course_tab[t="+$(this).attr("t")+"]").addClass("on")}),$(".header-right li.cursor").attr("ck",1)}},toRefreshView:function(){window.location.reload()},checkClientGroup:function(e){var t=this.userInfo.clientGroup,i=!1;switch(e){case"visitor":i="visitor"==t;break;case"vip":i="vip"==t||"active"==t;break;case"new":i="vip"!=t&&"active"!=t}return i},serverTimeUp:function(){indexJS.fillCourse(),indexJS.courseTick.tick(),videos.init().clientVideoTask(),indexJS.setInformation(),this.towMinTime=this.serverTime,setInterval(function(){indexJS.serverTime+=1e3,indexJS.serverTime-indexJS.towMinTime>=12e4&&(indexJS.towMinTime=indexJS.serverTime,indexJS.setInformation()),chat.setPushInfo(),indexJS.courseTick.tick()},1e3)},refreshNickname:function(e,t){this.userInfo.isSetName=e,this.userInfo.nickname=t,$(".username").text(t),$("#userListId li .mynk").text(t+"【我】")},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e="storeInfo_"+this.userInfo.groupType,t=store.get(e),i={};if(common.isBlank(t)){var s=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+s,i.userId="visitor_"+s,i.nickname="游客_"+s,i.userType=-1,store.set(e,i)}else i=t;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||$("#contentText").attr("contenteditable",!1).append('<div class="lgtip">亲，<a href="javascript:box.openLgBox();">登录</a> 后可以发言哦~</div>')):(i.loginId=this.userInfo.userId,store.set(e,i)),this.isNeverLogin=!common.isValid(i.loginId),common.isBlank(this.userInfo.nickname)&&"visitor"!=this.userInfo.clientGroup&&this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12))},setScrollStyle:function(e){e.find(".mCSB_dragger_bar").css({background:"url(/pm/theme1/img/scroll.png) -10px 50% repeat-y",width:"6px","-webkit-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px"})},setListScroll:function(e,t){var i="object"==typeof e?e:$(e);i.hasClass("mCustomScrollbar")?i.mCustomScrollbar("update"):(t=$.extend({scrollButtons:{enable:!1},theme:"light-2",isCustom:!0},t),i.mCustomScrollbar(t),t.isCustom&&this.setScrollStyle(i))},getArticleList:function(e,t,i,s,a,n,o,r){o=o||{};try{$.getJSON("/studio/getArticleList",{authorId:common.trim(o.authorId),code:e,platform:t,hasContent:i,pageNo:s,pageKey:common.trim(o.pageKey),pageLess:common.trim(o.pageLess),isAll:common.trim(o.isAll),pageSize:a,orderByStr:n},function(e){r(e)})}catch(l){console.error("getArticleList->"+l),r(null)}},getArticleInfo:function(e,t){try{$.getJSON("/studio/getArticleInfo",{id:e},function(e){t(e)})}catch(i){console.error("getArticleInfo->"+i),t(null)}},setAdvertisement:function(){this.getArticleList("advertisement",indexJS.userInfo.groupId,"0",1,5,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var t=e.data;for(var i in t)$(".ban_ul").append('<li class="swiper-slide"><a href="'+(common.isBlank(t[i].linkUrl)?"javascript:":t[i].linkUrl)+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'banner_img', '"+t[i].detailList[0].title+'\']);" target="_blank"><img width="100%" alt="" src="'+t[i].mediaUrl+'"></a></li>'),t.length>1&&$("#mod_position").append('<span class="'+(0==parseInt(i)?"p-click":"")+'"></span>');t&&t.length>1&&new Swiper(".mod_banner",{pagination:"#mod_position",paginationClickable:!0,loop:!0,autoplay:5e3,autoplayDisableOnInteraction:!1})}})},setInformation:function(){var e=$(".mod_main .tabcont .main_tab:eq(2)").find(".scrollbox"),t=$("#newInfoCount").attr("t");!common.isBlank(t)&&indexJS.serverTime-t<12e4||$.getJSON(indexJS.apiUrl+"/common/getInformation?t="+indexJS.serverTime,null,function(t){if(t&&t.isOK){var i=$("#newInfoCount").attr("pt"),s=null,a="",n=indexJS.formatHtml("news");$.each(t.data.news.item,function(e,t){i==t.pubDate&&common.isValid(i)&&(indexJS.infoNewCount++,$("#newInfoCount").text(indexJS.infoNewCount).show()),1>e&&(s=t.pubDate),(t.pubDate>i||common.isBlank(i))&&(a+=n.formatStr(t.pubDate.substring(10),t.title))}),common.isValid(a)&&$(".mod_main .message_list .scrollbox ul").prepend(a),common.isBlank(i)&&$("#newInfoCount").attr("pt",s),indexJS.setListScroll(e),$("#newInfoCount").attr("pt",s),$(".mod_main .tabcont .main_tab:eq(2)").hasClass("on")&&(indexJS.infoNewCount=0,$("#newInfoCount").attr({pt:s,t:indexJS.serverTime}).text(indexJS.infoNewCount).hide())}})},setTradeStrategyNote:function(e,t){if(!t||!$("#textlivePanel").data("loaded")){t&&($("#textlivePanel").data("loaded",!0),e||(e=$("#textlivePanel li[aid]:last").attr("aid")));var i={isAll:1,pageKey:e||"",pageLess:1};this.getArticleList("class_note",indexJS.userInfo.groupId,1,1,30,'{"publishStartDate":"desc","createDate":"desc"}',i,function(e){if(e&&0==e.result){var t=e.data;for(var i in t)indexJS.appendTradeStrategyNote(t[i],!1,!1);t.length<e.pageSize&&$("#textliveMore").addClass("all").html("已加载全部")}indexJS.setListScroll($(".textlivelist>.scrollbox"))})}},appendTradeStrategyNote:function(e,t,i){var s,a,n,o,r,l,d=$("#textlivePanel"),c=indexJS.formatHtml("tradestrategynote1"),u=indexJS.formatHtml("tradestrategynote2"),p=indexJS.formatHtml("tradestrategynote3"),h=/<img\s+[^>]*src=['"]([^'"]+)['"][^>]*>/;s=e.detailList&&e.detailList[0],a=new Date(e.publishStartDate).getTime();var m=e._id||e.id;if(!(d.find("li[aid='"+m+"']").size()>0)){if(n=d.find(".textlive[pt='"+a+"']>ul"),0==n.size()){var f="",g="";s.authorInfo&&(f=s.authorInfo.name||"",g=s.authorInfo.avatar||"",g=g.replace(/,.*$/,""));var v=common.formatterDateTime(a,"-").substring(0,16)+"-"+common.formatterDateTime(e.publishEndDate,"-").substring(11,16),b=s.title?"":" dn";o=c.formatStr(a,g,f,v,b,s.title||""),t?d.prepend(o):d.append(o),n=d.find(".textlive[pt='"+a+"']>ul")}for(o=s.content,l=h.exec(o);l;)o=o.replace(h,p.formatStr(l[1])),l=h.exec(o);if(v=common.formatterDateTime(e.createDate,"-").substring(11),r=$(u.formatStr(m,v,o)),r.find(".picpart>.imgdiv").each(function(){$(this).children("img").attr("src",$(this).attr("url")),$(this).bind("click",function(){$(this).parent().toggleClass("zoom")})}),t?n.prepend(r):n.append(r),i){var x=$("#textLiveCount");if(!x.parent().is(".on")){var w=(x.data("cnt")||0)+1;x.data("cnt",w).html(w).show()}}}},setTradeStrategy:function(e){this.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"sequence":"asc","createDate":"desc"}',null,function(t){if(t&&0==t.result){var i=t.data,s=null,a="",n=indexJS.formatHtml("tradestrategy");for(var o in i){s=i[o].detailList[0];var r="",l="";if(common.isBlank(s.author))r=s.authorInfo.name,l=s.authorInfo.avatar;else{var d=s.author.split(";");r=d[0],l=d[1]}var c=common.formatterDateTime(i[o].publishStartDate,"-").substring(0,16);a+=n.formatStr(l,r,c,s.tag,s.title,s.content)}$("#guidelist ul").html(a)}else $("#guidelist ul").html("");indexJS.setListScroll(e)})},placeholderSupport:function(){var e="placeholder"in document.createElement("input");e||$(".formcont .in_line input[placeholder]").each(function(){var e=$(this).attr("placeholder");if(e){var t=$(this),i=$('<span class="placeholder">'+e+"</span>");t.before(i),i.bind("click",function(){$(this).hide(),$(this).next().focus()}),t.bind("focus",function(){$(this).prev().hide()}),t.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=t[0].defaultValue&&t.prev().hide(),$(this).attr("placeholder","")}})},formatHtml:function(e){var t=[];switch(e){case"tradestrategynote1":t.push('<div class="textlive" pt="{0}">'),t.push('<div class="liveinfo">'),t.push('<div class="himg"><img src="{1}" alt="{2}"></div>'),t.push('<div class="infocont">'),t.push('<span class="tname">{2}</span>'),t.push('<span class="livetime">{3}</span>'),t.push('<p class="livetit{4}">直播主题 - {5}</p>'),t.push("</div>"),t.push("</div>"),t.push("<ul></ul>"),t.push("</div>");break;case"tradestrategynote2":t.push('<li aid="{0}">'),t.push('<div class="cont">'),t.push('<i class="dot"></i>'),t.push("<b>{1}</b>"),t.push("<span>{2}</span>"),t.push("</div>"),t.push("</li>");break;case"tradestrategynote3":t.push('<div class="picpart">'),t.push('<div class="imgdiv" url="{0}"><i></i><img alt="">'),t.push("</div>"),t.push('<a href="{0}" data-lightbox="liveinfo-img">点击查看大图</a>'),t.push("</div>");break;case"tradestrategy":t.push('<li class="guideli">'),t.push('    <div class="line1 clearfix">'),t.push('        <img class="himg" src="{0}" alt="{1}">'),t.push('        <h4 class="name">{1}<span class="timespan">{2}</span></h4>'),t.push('        <span class="tag"><i></i>{3}</span>'),t.push("    </div>"),t.push('    <h4 class="gtit"><strong><a href="" target="_blank" class="taglink"></a></strong>{4}</h4>'),t.push('    <div class="g_cont">'),t.push("    <p>{5}</p>"),t.push("    </div>"),t.push("</li>");break;case"news":t.push("<li><span><i></i><b>{0} </b>{1}</span></li>")}return t.join("")},courseTick:{course:null,nextTickTime:0,tick:function(){if(!(indexJS.serverTime<=this.nextTickTime)){var currCourse=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);if(currCourse){var nextTime=0;nextTime=currCourse.isNext?6e4*eval(currCourse.startTime.replace(":","*60+"))+indexJS.serverTime-indexJS.serverTime%864e5-288e5:6e4*eval(currCourse.endTime.replace(":","*60+"))+indexJS.serverTime-indexJS.serverTime%864e5-288e5+6e4,this.course=currCourse,this.nextTickTime=nextTime,this.chgSyllabusCls(currCourse),videos.clientVideoTask(),videos.sd.initSD()}}},chgSyllabusCls:function(e){$(".course_tab li a.on").removeClass("on"),e.isNext||($(".course_nav a[d='"+e.day+"']").trigger("click"),$(".course_tab[d="+e.day+"]").find('li a[st="'+e.startTime+'"][et="'+e.endTime+'"]').addClass("on"))}}};$(function(){indexJS.init()});var videos={blwsPlayer:null,newMarIntervalId:0,init:function(){return this.setEvent(),this.setVideoList(null,!0),this},setVideoList:function(e,t){if(t){var i=$("#teachVideoId").children().map(function(){return $(this).attr("t")}).get();e=i[common.randomIndex(i.length)]}var s=$("#teachVideoId div[t="+e+"] ul");s.find("li").length>0||(s.html(""),indexJS.getArticleList(e,indexJS.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var i=e.data,a=null;for(var n in i)a=i[n].detailList[0],s.append('<li title="'+a.title+'"><a href="javascript:" ct="'+i[n].categoryId+'" id="'+i[n]._id+'" t="'+(common.isValid(i[n].mediaUrl)&&-1!=i[n].mediaUrl.indexOf(".mp4")?"mp4":"")+'" vUrl="'+i[n].mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'video_play',$(this).text()]);\"><i></i>"+a.title+"</a></li>");indexJS.setListScroll(s,{isCustom:!1,theme:"minimal-dark"}),$("#teachVideoId li a").click(function(){$("#teachVideoId li a.on").removeClass("on"),$(this).addClass("on"),$(".max_box").show();var e=$(".min_box").attr("vid",this.id).hide();e.find(".v_cate").text($(this).parents(".cate_box").find(".cate_name").text()),e.find(".v_name label").text($(this).text()),videos.setVideo($(this));var t=$(this).attr("id");$("#tvInfoId").attr("tid")!=t&&(indexJS.getArticleInfo(t,function(e){if(e){$("#tvInfoId").attr("tid",e._id);var t=e.detailList[0];$("#tvInfoId p.remark").text(t.remark),$("#tvInfoId p.content").text(t.seoDescription);var i=$("#tvInfoId .te_detail"),s=t.authorInfo;s&&(i.find("strong").attr("uid",s.userId).text(s.name),i.find(".rcont i").text(s.position),i.find("img").attr("src",s.avatar),i.find("img").attr("src",s.avatar))}}),indexJS.setListScroll("#tvInfoId"),chatAnalyze.setUTM(!1,{courseId:t}))})}t&&videos.playVideoByDate(!0)}))},setVdTab:function(e){e?(window.SewisePlayer&&SewisePlayer.doStop(),$("#tvDivId").hide().find("iframe").remove(),$("#vdTabId a:eq(1)").is(".on")&&($(".listcont .list_tab:first,#vdTabId a:first").addClass("on"),$(".listcont .list_tab:eq(1),#vdTabId a:eq(1)").removeClass("on")),$("#lvDivId").show()):($("#vdTabId a:first").is(".on")&&($(".listcont .list_tab:first,#vdTabId a:first").removeClass("on"),$(".listcont .list_tab:eq(1),#vdTabId a:eq(1)").addClass("on")),$("#tvDivId").show(),$("#lvDivId").hide())},playMp4Vd:function(e){var t=$("#teachVideoId a[class=on]");if(e||t.length<=0){var i=$("#teachVideoId li a[t=mp4]"),s=null;i.length<=0?s=$("#teachVideoId li:first a"):(s=$(i.get(common.randomIndex(i.length))),$("#teachVideoId div[t="+s.attr("ct")+"] ul").mCustomScrollbar("scrollTo","#"+s.attr("id"))),s.click(),$("#teachVideoId .cate_box").removeClass("show"),s.parents(".cate_box").addClass("show")}else t.click()},setVdMaxBox:function(){$(".max_box").is(":hidden")||$(".max_box").slideUp(1e3,function(e){$(".min_box").fadeIn("fast")})},setEvent:function(){$(".max_box").hover(function(){},function(){videos.setVdMaxBox()}),$("#vdTabId a").click(function(){$("#vdTabId a").removeClass("on"),$(this).addClass("on");var e=$(this).index();if($(".listcont .list_tab").removeClass("on").eq(e).addClass("on"),2!=e){var t=$(".mod_video").hide().eq(e);t.show(),0==e?videos.playVideoByDate(!1):(videos.playMp4Vd(),videos.setVdMaxBox())}}),$("#vdLs_min,#vdLs_max").click(function(){"vdLs_min"==this.id?($(".min_box").hide(),$(".max_box").show()):($(".max_box").hide(),$(".min_box").show())}),$("#tvDivId").hover(function(){$(".max_box").is(":hidden")&&$(".min_box,.v_cate,.v_name").show()},function(){$(".max_box,.min_box").hide()}),$("#teachVideoId .cate_name").click(function(){$("#teachVideoId .cate_box").removeClass("show"),videos.setVideoList($(this).parent().addClass("show").attr("t"))}),videos.sd.setSDEvent(),this.bindEventRollNews(),$(".video_ad .ad_closebtn").click(function(){$(".video_ad").hide()})},clientVideoTask:function(){var e=$("#lvDivId embed").attr("src");($("#nextCourse").is(":visible")||$("#lvVideoId").is(":visible")&&e&&-1==e.indexOf("yy.com")&&0==$("#lvVideoId").find("object").length)&&videos.playVideoByDate(!1)},playVideoByDate:function(e){var t=indexJS.courseTick.course;!t||0!=t.courseType&&common.isBlank(t.studioLink)||t.isNext||0==t.courseType?(e?t&&!t.isNext&&0==t.courseType?(this.setVdTab(!0),this.setStudioInfo(t),this.setStudioTip(!0)):(this.setVdTab(!1),this.playMp4Vd()):this.setStudioInfo(t),this.newsMarquee(!1)):(this.setVdTab(!0),this.setStudioVideoDiv(t.studioLink,t.courseType),this.setStudioInfo(t),this.setStudioTip(2!=t.courseType),this.newsMarquee(1==t.courseType))},setStudioTip:function(e){e?$(".mod_room .titbar > span i").removeClass("off").addClass("on"):$(".mod_room .titbar > span i").removeClass("on").addClass("off")},setNextCourse:function(e,t){if(e){var i="当前暂无直播，请关注下节课";e.isNext||0!=e.courseType||(i="当前正在文字直播"),$("#nextCourse").find(".ntext").text(i),$("#nextCourse .nextbox").show(),$("#nextCourse").find("img").attr("src",t.avatar),$("#nextCourse").find(".t_name").text(t.name),$("#nextCourse").find(".live_name").text(e.title),$("#nextCourse").find(".time").text(common.daysCN[e.day]+" "+e.startTime+" - "+e.endTime)}$("#lvVideoId").hide(),$("#nextCourse").show()},getEmbedDom:function(e){return'<embed src="'+e+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'},setStudioVideoDiv:function(e,t){if(!$("#lvVideoId").is(":visible")||$("#lvVideoId").data("url")!=e)if($("#nextCourse").hide(),$("#lvVideoId").show().data("url",e).html(""),-1!=e.indexOf("rtmp")){var i=/(.*)\/([0-9]+)$/g.exec(e);if(!i||i.length<3)return;flowplayer("lvVideoId","/base/lib/flowplayer/flowplayer.swf",{clip:{url:i[2],provider:"rtmp",live:!0},plugins:{rtmp:{proxyType:"best",url:"/base/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:i[1]}},onError:function(e){}})}else $("#lvVideoId .img-loading").fadeIn(0).delay(2e3).fadeOut(200),$(videos.getEmbedDom(e)).appendTo("#lvVideoId")},bindEventRollNews:function(){$(".mod_scrollnews .newsclose").click(function(){$(".mod_scrollnews .newslist").hide(),$(".mod_scrollnews .newsbtn").show(),clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null}),$(".mod_scrollnews .newsbtn").click(function(){$(this).hide(),$(".mod_scrollnews .newslist").slideDown(),videos.newsMarquee(!0)}),$("#newscont1 a").live("click",function(){return"false"===$(this).attr("url")?($("#popMsgTit").text($(this).attr("title")),$("#popMsgTxt").html($(this).data("content")||"没有内容"),$("#popMsgBox,.blackbg").show(),indexJS.setListScroll(".popMsgBox"),!1):void 0}),$("#newscont2 a").live("click",function(){return"false"===$(this).attr("url")?($("#newscont1 a[tid='"+$(this).attr("tid")+"']").trigger("click"),!1):void 0})},rollNews:function(e){var t=$("#newscont1");if(e["delete"]){var i=e.ids.split(",");if(i.length>0)for(var s=0;s<i.length;s++)t.find('a[tid="'+i[s]+'"]').remove()}else if(e.edit){e.isValid="true"==e.isValid?!0:!1,!e.isValid||indexJS.userInfo.clientGroup&&e.clientGroup&&-1!=$.inArray(indexJS.userInfo.clientGroup,e.clientGroup)||(e.isValid=!1);var a=t.find('a[tid="'+e.id+'"]');if(e.isValid)if(a.size()>0)common.isValid(e.url)?a.attr({title:e.title,href:e.url,url:"true"}).html("<i></i><span>"+e.title+"</span>"):a.attr({title:e.title,url:"false"}).html("<i></i><span>"+e.title+"</span>").data("content",e.content);else{var n=$('<a href="javascript:void(0);" tid="'+e.id+'" title="'+e.title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'zimu_txt', '"+e.title+"']);\"><i></i><span>"+e.title+"</span></a>");common.isValid(e.url)?n.attr({href:e.url,url:"true"}):n.attr({url:"false"}).data("content",e.content),t.append(n)}else a.size()>0&&a.remove()}else if(e.infos){var o=e.infos.length,n=null;if(o>0)for(var s=0;o>s;s++)indexJS.userInfo.clientGroup&&e.infos[s].clientGroup&&$.inArray(indexJS.userInfo.clientGroup,e.infos[s].clientGroup)>-1&&1==e.infos[s].pushType&&e.infos[s].contentId&&e.infos[s].title&&(common.isValid(e.infos[s].url)?n=$('<a href="'+e.infos[s].url+'" url="true" tid="'+e.infos[s].contentId+'" title="'+e.infos[s].title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'zimu_txt', '"+e.infos[s].title+"']);\"><i></i><span>"+e.infos[s].title+"</span></a>"):(n=$('<a href="javascript:void(0);" url="false" tid="'+e.infos[s].contentId+'" title="'+e.infos[s].title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'zimu_txt', '"+e.infos[s].title+"']);\"><i></i><span>"+e.infos[s].title+"</span></a>"),n.data("content",e.infos[s].content)),t.append(n))}this.newsMarquee(!0)},newsMarquee:function(e){videos.newMarIntervalId&&(clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null);var t=30,i=$(".mod_scrollnews"),s=$("#scrollnews_demo")[0],a=$("#newscont1"),n=$("#newscont2");if(e&&a.children().size()>0?i.show():i.hide(),n.html(""),$(s).unbind("mouseover mouseout"),e){a.css("width","auto"),n.css("width","auto");var o=i.width()-27;a.width()<o&&(a.css("width",o),n.css("width",o)),n.html(a.html());var r=function(){a.width()-s.scrollLeft<=0?s.scrollLeft-=a.width():s.scrollLeft++};videos.newMarIntervalId=window.setInterval(r,t),$(s).bind("mouseover",function(){window.clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null}).bind("mouseout",function(){videos.newMarIntervalId&&(window.clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null),videos.newMarIntervalId=window.setInterval(r,t)})}},getEmbedDom:function(e){return'<embed src="'+e+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'},setStudioInfo:function(e){if(!e)return $("#nextCourse").find(".ntext").text("当前暂无直播"),void $("#nextCourse .nextbox").hide();var t=$("#lvInfoId").attr("dy"),i=$("#lvInfoId").attr("st"),s=$("#lvInfoId").attr("et");return t==e.day&&i==e.startTime&&s==e.endTime?void((e.isNext||0==e.courseType)&&videos.setNextCourse(null)):($.getJSON("/studio/getCourseInfo",{day:e.day,startTime:e.startTime,endTime:e.endTime,authorId:e.lecturerId},function(t){$("#lvInfoId").attr("dy",e.day).attr("st",e.startTime).attr("et",e.endTime),$("#lvInfoId .intro p").text(t.remark),indexJS.setListScroll("#lvInfoId");var i=$("#lvInfoId .te_list").html(""),s=t.authors,a=null;for(var n in s)a=s[n],i.append('<div class="te_detail" uid="'+a.userId+'"><img src="'+a.avatar+'" alt=""><div class="rcont"><span><strong>'+a.name+"</strong><i>"+a.position+'</i></span> <a href="javascript:" class="support" uid="'+a.userId+'"><label>'+a.praiseNum+"</label><i>+1</i></a> </div> </div>");var o=$(".te_detail .support");"true"!=o.attr("initEvent")&&o.attr("initEvent","true").click(function(){var e=$(this);try{common.getJson("/studio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:e.attr("uid")},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)}catch(t){console.error("setPraise->"+t)}}),(e.isNext||0==e.courseType)&&videos.setNextCourse(e,s&&s.length>0?s[0]:{avatar:"",name:""})}),void indexJS.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,1,'{"createDate":"desc"}',null,function(e){if(e&&0==e.result&&e.data&&e.data.length>0){var t=e.data[0],i=t.detailList[0];$("#lvInfoId p.content").html(i.content),indexJS.setListScroll("#lvInfoId")}else $("#lvInfoId p.content").html("亲，老师还未发布观点哦")}))},setVideo:function(e){try{this.setStudioTip(!1),$("#lvVideoId").html("");var t=e.attr("vUrl"),i=e.text();if(-1!=t.indexOf(".html")){window.SewisePlayer&&SewisePlayer.doStop();var s=$("#tVideoId iframe"),a=!0;s.size()>0&&(s.attr("src")==t?a=!1:s.remove()),a&&$("#tVideoId").append('<iframe frameborder=0 width="100%" height="100%" src="'+t+'" allowfullscreen></iframe>')}else if($("#tVideoId iframe").remove(),-1!=t.indexOf("type=blws")){var n=t.split("&");if(n.length>1){var o=n[1].replace(/^vid=/g,"");videos.blwsPlayer?videos.blwsPlayer.changeVid(o):videos.blwsPlayer=polyvObject("#tVideoId").videoPlayer({width:"100%",height:"100%",vid:o,flashvars:{autoplay:"0",setScreen:"fill"},onPlayOver:function(e){}})}}else if(window.SewisePlayer)SewisePlayer.toPlay(t,i,0,!0);else{var r=[];r.push("/base/lib/sewise.player.min.js?server=vod"),r.push("type="+(-1!=t.indexOf(".flv")?"flv":"mp4")),r.push("videourl="+t),r.push("autostart=true"),r.push("title="+i),r.push("buffer=5");var l=r.join("&"),d=document.createElement("script");d.type="text/javascript",d.src=l,$("#tVideoId").get(0).appendChild(d);var c=function(){return window.SewisePlayer?void SewisePlayer.onPause(function(e){if(SewisePlayer.duration()<=SewisePlayer.playTime()){var t=$("#teachVideoId li a.on"),i=t.parent().next().find("a");i.length<=0?videos.playMp4Vd(!0):i.click()}}):void window.setTimeout(c,500)};c()}}catch(u){console.error("setVideo has error:"+u)}},sd:{analyst:null,tradeList:[],loadAll:!1,setSDEvent:function(){$("#sdNoAuthBox .aid_chat span").bind("click",function(){$("#sdNoAuthBox .pop_close").trigger("click");var e=$(this).attr("uid"),t=$("#userListId li[id='"+e+"']");0==t.size()&&(t=$("#userListId li[utype='3']:first")),t.find("em").trigger("click")})},initSD:function(){var e=indexJS.courseTick.course;!e||!e.lecturerId||videos.sd.analyst&&-1!=e.lecturerId.indexOf(videos.sd.analyst.userNo)||$.getJSON("/studio/getShowTradeInfo",{userNo:e.lecturerId},function(e){e&&e.analyst?(videos.sd.analyst=e.analyst,videos.sd.tradeList=e.tradeList||[],videos.sd.loadAll=!1,$("#sdInfoId .nosd_tip").hide(),videos.sd.showPraiseInfo(),videos.sd.showSDInfo()):($("#sdInfoId .nosd_tip").show(),$("#sdInfoId .te_info").empty(),$("#sdInfoId .sd_show .sd_ul").empty())})},showPraiseInfo:function(){$("#sdInfoId .te_info").empty();var e=this.analyst;$("#sdInfoId .te_info").append('<div class="te_detail sd" uid="'+e.userNo+'"><img src="'+e.avatar+'" alt=""><div class="rcont"><span><strong>'+e.userName+'</strong><i class="suc">TA的胜率：<b>'+(e.winRate||"--")+'</b></i></span> <a href="javascript:" class="support" uid="'+e.userNo+'"><label>'+e.praiseNum+"</label><i>+1</i></a> </div> </div>"),$("#sdInfoId .te_detail .support").click(function(){var e=$(this);try{common.getJson("/studio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:e.attr("uid")},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞");var s=$("#lvInfoId .te_detail .support[uid='"+videos.sd.analyst.userNo+"']");s.find("label").text(e.find("label").text()),s.addClass("supported"),s.attr("title","已点赞")},!0)}catch(t){console.error("setPraise->"+t)}})},showSDInfo:function(){this.showWXInfo(),$("#sdInfoId .sd_ul").empty(),this.showTradeList()},showWXInfo:function(){var e=[];this.analyst.wechatCode&&(e.push('<div class="te_wx">'),e.push('<div class="wx-qrcode">'),this.analyst.wechatCodeImg&&e.push('<img src="'+this.analyst.wechatCodeImg+'" alt="'+this.analyst.wechatCode+'">'),e.push("</div>"),e.push('<span class="wx-num">老师微信号: <b>'+this.analyst.wechatCode+"</b></span>"),e.push("</div>"),$("#sdInfoId .te_info").append(e.join("")))},showTradeList:function(){if(videos.sd.loadAll)return!1;for(var e=$("#sdInfoId .sd_ul li").size(),t=videos.sd.tradeList,i=t?t.length:0,s=null,a=[],n=indexJS.checkClientGroup("new"),o=!1,r=e;i>r&&e+6>r;r++)s=t[r],o=!s.profit,a.push('<li><div class="cont">'),a.push('<div class="sd_tit">'),a.push('<span class="dep">'),o?a.push("持仓中"):(a.push("获利："),a.push("<b"+(/^-/.test(s.profit)?' class="fall"':"")+">"+s.profit+"</b>")),a.push("</span>"),a.push('<span class="sdtime">晒单时间: '+common.formatterDateTime(s.showDate).substring(5,16)+"</span>"),a.push("</div>"),n&&o?(a.push('<a href="javascript:videos.sd.showAuthBox()">'),a.push('<img src="/pm/theme1/img/sd_default.png"></a>')):(a.push('<a href="'+s.tradeImg+'" data-lightbox="sd-img" data-title="'+(o?"持仓中":"获利："+s.profit)+'">'),a.push('<img src="'+s.tradeImg+'"></a>')),a.push("<i></i></div></li>");r>=i-1&&(videos.sd.loadAll=!0),$("#sdInfoId .sd_ul").append(a.join("")),indexJS.setListScroll($("#sdInfoId .sd_show"),{callbacks:{onTotalScroll:videos.sd.showTradeList}})},showAuthBox:function(){var e=$("#userListId li[utype='3']:first");0==e.size()?$("#sdNoAuthBox .sdzl").hide():($("#sdNoAuthBox .sdzl").show(),$("#sdNoAuthBox .aid_chat img").attr("src",e.find(".headimg img").attr("src")),$("#sdNoAuthBox .aid_chat span").attr("uid",e.attr("id")).text(e.find(".uname span:first").text())),$("#sdNoAuthBox,.blackbg").show()}}},chat={socket:null,msgPushObj:{pbInfos:[],whInfos:[],whInfo:{}},whTipInterId:null,pushInfoTimeOutId:null,initUserList:!1,msgType:{text:"text",img:"img",file:"file"},init:function(){this.setEvent(),this.setUserListIdEmpty(),this.getCSList(),this.setSocket(),this.setTalkListScroll(!0)},setEvent:function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&$("#msgFaceBtn").qqFace({id:"faceId",assign:"contentText",path:indexJS.filePath+"/face/"}),$(document).click(function(e){$("div[id^=faceId]").hide(),$(e.target).hasClass("headimg")||$(e.target).parents().hasClass("headimg")||"header"==$(e.target).parent().attr("t")||$(e.target).hasClass("uname")||$(e.target).parents().hasClass("te_ul")||$(".dialogbtn").hide()}),$(".replybtn").click(function(){var e=$(this);chat.setDialog(e.attr("uId"),$(".sender").html(),e.attr("ts"),e.attr("futype")),$(".mymsg em").show()}),$("#mymsgClose").click(function(){$(".mymsg,.mymsg em").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),chat.setTalkListScroll()}),$(".scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),chat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),chat.showViewSelect($(this).attr("t")),chat.setTalkListScroll(!0))}),$("#contentText").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="send-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){var t=$(this).html();if(13==e.keyCode)return common.isValid(t)&&($(this).html(t.replace(/<div>|<\/div>/g,"")),$(".ui-autocomplete").is(":hidden")&&$("#sendBtn").click()),!1;if(8==e.keyCode){var i=$(this).find(".txt_dia");if($.trim($(this).text())==i.text())return i.remove(),$(this).html(""),!0}}).autocomplete({source:function(e,t){/^@.*$/g.test(e.term)&&(t(chat.searchUserList(e.term.substring(1,e.term.length))),$(".ui-autocomplete").css("z-index","10000000"))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(e,t){return $("#contentText").html("").append('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t.item.value+'" utype="'+t.item.userType+'">@<label>'+t.item.label+"</label></span>&nbsp;").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(e,t){return $("<li>").attr("data-value",t.label).append("<a>"+t.label+"</a>").appendTo(e)},$("#sendBtn").click(function(){if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();
if(indexJS.userInfo.isSetName===!1)return void box.openSettingBox("nickname");var e=chat.getToUser(),t=$("#contentText .text-min-img img");if(t.size()>0){var i=t.attr("src");if(i.length>1048576)alert("发送的图片大小不要超过1MB.");else{chat.setUploadImg(i,e),t.remove();var s=$(".replybtn");e&&e.userId==s.attr("uid")&&e.talkStyle==s.attr("ts")&&$(".mymsg,.mymsg em").hide()}}var a=chat.getSendMsg();if(a!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:a}},s=$(".replybtn");e&&e.userId==s.attr("uid")&&e.talkStyle==s.attr("ts")&&$(".mymsg,.mymsg em").hide(),n.fromUser.toUser=e,chat.socket.emit("sendMsg",n),chat.setContent(n,!0,!1),$("#contentText").html(""),chatAnalyze.setUTM(!1,{speakCount:1})}}),$("#sendImgBtn").click(function(){return FileReader?!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor")?void box.openLgBox():indexJS.userInfo.isSetName===!1?void box.openSettingBox("nickname"):void $("#sendImgInp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#sendImgInp").bind("change",function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var s=new FileReader;s.readAsDataURL(t),s.onload=function(e){chat.setUploadImg(e.target.result,chat.getToUser())},s.onprogress=function(e){},s.onloadend=function(e){},$(this).val("")}),$(".pletter_win").css({top:$(window).height()/2-218,left:$(window).width()/2-310}).draggable({handle:".wh_drag",cursor:"move",containment:"document",scroll:!1})},setUploadImg:function(e,t){var i=chat.getUiId(),s={};common.copyObject(s,indexJS.userInfo,!0),s.toUser=t;var a={uiId:i,fromUser:s,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};t&&1==t.talkStyle?this.setWhContent(a,!0,!1):this.setContent(a,!0,!1),a.content.value=e,this.zipImg(a,100,60,function(e,t){if(e.error)return alert(e.error),$("#"+i).remove(),!1;var s=$("#"+e.uiId+" span[contt='a'] a");s.attr("href",t).children("img").attr("src",t).attr("needMax",e.content.needMax),chat.dataUpload(e)})},zipImg:function(e,t,i,s){var a=new Image;a.onload=function(){var n=document.createElement("canvas");n||s({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var o=a.width,r=a.height;if(r>=9*o)return s({error:"该图片高度太高，暂不支持发送！"}),!1;t>0&&(r>t||o>t)&&(e.content.needMax=1,r>t&&t>=o?(o=t/r*o,r=t):(r=t/o*r,o=t),a.height=r,a.width=o);var l=n.getContext("2d");n.width=o,n.height=r,l.clearRect(0,0,n.width,n.height),l.drawImage(a,0,0,o,r),s(e,n.toDataURL("image/jpeg",i/100))},a.src=e.content.value},dataUpload:function(e){var t=new XMLHttpRequest;t.open("POST","/studio/uploadData"),t.addEventListener("progress",function(t){if(t.lengthComputable){var i=(t.loaded/t.total*100|0)+"%";$("#"+e.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+e.uiId+" .shadow-conut").html(i)}},!1),t.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&console.log("dataUpload success!")},e.fromUser.socketId=this.socket.id,t.send(JSON.stringify(e))},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},getCSList:function(){var e=LoginAuto.sessionUser.groupType,t=LoginAuto.sessionUser.groupId;try{$.getJSON("/"+e+"/getCS",{groupId:t},function(e){if(e){var t=null;for(var i in e)t=e[i],t.nickname=t.userName,t.userId=t.userNo,t.sequence=3,t.userType=3,t.isFromAjax=!0,0==$("#userListId li[id='"+t.userId+"']").size()&&chat.setOnlineUser(t);chat.setOnlineNum()}})}catch(i){console.error("getCSList->"+i),callback(null)}},getSendImgInfo:function(){var e=$("#contentText .text-min-img");return e.length>0?{userId:e.attr("uid"),nickname:e.find("label").text(),talkStyle:0,userType:e.attr("utype")}:null},getUiId:function(){var e=new Date;return e.getTime()+"_ms"},getToUser:function(){var e=$("#contentText .txt_dia");return e.length>0?{userId:e.attr("uid"),nickname:e.find("label").text(),talkStyle:0,userType:e.attr("utype")}:null},getSendMsg:function(e){var e=e?e:$("#contentText");if(e.text().length+e.find("img").size()>140)return alert("消息内容超过最大长度限制（140字以内）！"),!1;e.find(".txt_dia").length>0&&e.find(".txt_dia").remove();var t=common.clearMsgHtml(e.html());return common.isBlank(t)?(e.html(""),!1):t},setDialog:function(e,t,i,s,a){if(1==i)chat.closeWhTip(e),chat.fillWhBox(null,a,s,e,t,!1,!1);else{if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e+'" utype="'+s+'">@<label>'+t+"</label></span>&nbsp;").focusEnd()}},showViewSelect:function(e){"analyst"==e?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"me"==e?($("#dialog_list").children("[isme='true']").show(),$("#dialog_list").children("[isme='false']").hide()):"admin"==e?$("#dialog_list").children("[utype!=1]").hide():$("#dialog_list").children().show()},setContent:function(e,t,i){var s=e.fromUser;if(t&&(s.publishTime=e.uiId),e.isVisitor)return $("#"+e.uiId).remove(),void box.openLgBox();if(i&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" span[contt] em[class=ruleTipStyle]").remove(),void $("#"+s.publishTime+" input").remove();if(e.rule)return void(e.value&&e.value.needApproval?$("#"+e.uiId).attr("id",s.publishTime):$("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>"));if(t||indexJS.userInfo.userId!=s.userId||!e.serverSuccess){var a=chat.formatContentHtml(e,t,i),n=$("#dialog_list");n.append(a),this.formatMsgToLink(s.publishTime);var o=$(".view_select .selectlist a[class=on]").attr("t");if("all"!=o&&chat.showViewSelect(o),!i){var r=$("#userListId li[id="+s.userId+"]"),l=null;s.avatar&&r.length>0&&s.avatar!=(l=r.find(".headimg img")).attr("src")&&l.attr("src",s.avatar),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0),chat.showChatMsgNumTip(!1)}$("#"+s.publishTime+" .headimg").click(function(){chat.openDiaLog($("#"+s.publishTime+" .dialogbtn").attr("avs",$(this).find("img").attr("src")))}),$("#"+s.publishTime+" .txt_dia").click(function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&chat.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+s.publishTime+" .uname").click(function(){var e=$("#"+s.publishTime+" .dialogbtn");e.attr("avs",$(this).parent().parent().find(".headimg img").attr("src")),chat.openDiaLog(e)})}else if($("#"+e.uiId+" .dtime").html(chat.formatPublishTime(s.publishTime)),$("#"+e.uiId).attr("id",s.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(s.publishTime);var d=$("#"+s.publishTime+' span[contt="a"]>a'),c=e.content.needMax?"/studio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:d.children("img").attr("src");d.attr("href",c)}},showChatMsgNumTip:function(e){var t=$("#chatMsgCount");if(e)t.data("cnt",0).html("").hide();else if(!t.parent().is(".on")){var i=(t.data("cnt")||0)+1;t.data("cnt",i).html(i).show()}},openDiaLog:function(e){if($(".dialogbtn").not(e).hide(),!e.is(":hidden"))return e.hide(),!1;var t=e.parent(),i=e.is(".bot");t.next().size()<=0?i||e.addClass("bot"):i&&e.removeClass("bot"),e.show();var s=e.find("a"),a=e.attr("avs");common.isValid(a)?(s.attr("avs",a),e.attr("avs","")):s.attr("avs",""),s.unbind("click"),s.click(function(){var e=$(this).parent();chat.setDialog(e.attr("uid"),e.attr("nk"),$(this).attr("t"),e.attr("utype"),$(this).attr("avs")),e.hide()})},formatPublishTime:function(e,t,i){var s=Number(e.replace(/_.+/g,""));return common.isBlank(e)?"":t?common.formatterDateTime(s,i):common.getHHMM(s)},formatContentHtml:function(e,t,i){var s="dialog ",a="",n="",o="false",r="",l=e.fromUser,d=e.content,c=l.nickname,u="";indexJS.userInfo.userId==l.userId&&t&&(l.publishTime=e.uiId,u='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>');var p=l.toUser,h="";p&&common.isValid(p.userId)&&(h='<span class="txt_dia" uid="'+p.userId+'" utype="'+p.userType+'">@<label>'+p.nickname+"</label></span>",indexJS.userInfo.userId==p.userId&&(o="true")),d.msgType==chat.msgType.img?(a=d.needMax?'<a href="/studio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片"/></a>':'<a href="'+(d.value?d.value:"javascript:")+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片" /></a>',a+=u):a=d.value,indexJS.userInfo.userId==l.userId?(s+="mine ",o="true",r='<span class="dtime">'+chat.formatPublishTime(l.publishTime)+'</span><a href="javascript:" class="uname">我</a>'):(3==l.userType&&(c+="&nbsp;（助理）"),r='<a href="javascript:" class="uname">'+c+'</a><span class="dtime">'+chat.formatPublishTime(l.publishTime)+"</span>",n=chat.getDialogHtml(l.userId,c,l.userType),!i&&p&&indexJS.userInfo.userId==p.userId&&($(".mymsg").show(),$(".mymsg em").hide(),$(".replybtn").attr("uid",l.userId),$(".replybtn").attr("ts",p.talkStyle),$(".replybtn").attr("futype",l.userType),$(".sender").html(l.nickname),$(".xcont").html(a)));var m=chat.getAImgOrLevel(l.userId,l.clientGroup,l.userType,l.avatar),f=[];return f.push('<div class="'+s+m.level+'" id="'+l.publishTime+'"  utype="'+l.userType+'" mtype="'+d.msgType+'" isme="'+o+'">'),f.push('<a href="javascript:" class="headimg">'+m.aImg+"<b></b></a>"),f.push('<div class="dialog_top">'+r+"</div>"),f.push("<p><i></i>"),p&&common.isValid(p.question)?(f.push('<span class="dcont">'),f.push('<span uid="'+p.userId+'" utype="'+p.userType+'">'+p.nickname+"</span>提问："),f.push('<span contt="q">'+p.question+"</span>"),f.push('<span class="dialog_reply">回复：<span contt="a">'+a+"</span></span>"),f.push("</span>")):f.push('<span class="dcont" contt="a">'+h+a+"</span>"),f.push("</p>"+n+"</div>"),f.join("")},formatMsgToLink:function(e){$("#"+e+' span[contt]:contains("http:"),#'+e+' span[contt]:contains("https:")').each(function(e,t){var i=$(t).html(),s=i.split(/<img[^>]*>|<a[^>]*>.*?<\/a>/g),a="";for(var n in s)if(a=s[n],!common.isBlank(a)){var o=a.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"});t.innerHTML=t.innerHTML.replace(a,o)}})},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},getAImgOrLevel:function(e,t,i,s){var a={aImg:common.isValid(s)?'<img src="'+s+'">':'<img src="/pm/theme1/img/user.png">',level:""};if(common.isValid(i)&&i>0)a.level=2==i?"analyst":"admin";else if("vip"==t)a.level="level4";else if("active"==t||"notActive"==t)a.level="level3";else if("simulate"==t)a.level="level2";else if("register"==t)a.level="level1";else if("visitor"==t||-1==i){e=e||"";var n=parseInt(e.substring(e.length-2),10);isNaN(n)&&(n=100),n=(n+17)%40,a.aImg='<img src="'+indexJS.filePath+"/upload/pic/header/chat/visitor/"+n+'.png">',a.level="visitor"}else a.level="visitor";return a},getDialogHtml:function(e,t,i){if(e&&indexJS.userInfo.userId!=e){var s=$("#roomInfoId"),a="",n=0;return(indexJS.visitorSpeak||-1==indexJS.userInfo.userId.indexOf("visitor_")&&-1==e.indexOf("visitor_"))&&(a+='<a href="javascript:" class="d1" t="0"><b></b><span>@TA</span></a>',n++),"true"==s.attr("aw")&&common.containSplitStr(s.attr("awr"),i)&&(a+='<a href="javascript:"'+(0==n?' class="d1"':"")+' t="1"><b></b><span>私聊</span></a>',n++),'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'">'+a+"</div>"}return'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'"></div>'},setOnlineUser:function(e){$("#userListId li[id='"+e.userId+"']").remove();var t=chat.getDialogHtml(e.userId,e.nickname,e.userType),i="",s="",a=e.sequence,n="";if(indexJS.userInfo.userId==e.userId&&(i="【我】",a="0",n="mynk"),3==e.userType){var o=$("#roomInfoId");"true"==o.attr("aw")&&common.containSplitStr(o.attr("awr"),e.userType)&&(s="<em>私聊</em>"),i="&nbsp;（助理）"}e.isFromAjax===!0&&(n="csoffline");var r=chat.getAImgOrLevel(e.userId,e.clientGroup,e.userType,e.avatar),l=$("#userListId li"),d='<li id="'+e.userId+'" cg="'+(common.isBlank(e.clientGroup)?"":e.clientGroup)+'" t="'+a+'" utype="'+e.userType+'" class="'+r.level+'" >'+t+'<a href="javascript:" t="header" class="uname"><div class="headimg">'+r.aImg+'<b></b></div><span class="'+n+'">'+e.nickname+i+"<i></i></span>"+s+"</a></li>";if("0"==a)l.first().before(d);else{var c=!1,u=0,p="";l.each(function(){if(u=parseInt($(this).attr("t")),e.sequence<u)return $(this).before(d),c=!0,!1;if(e.sequence==u){if(nickCsTmp=$(this).find("span[class='csoffline']").size(),nickCsTmp)return $(this).before(d),c=!0,!1;if(p=$(this).find("a span").text(),e.nickname<=p)return $(this).before(d),c=!0,!1}}),c||$("#userListId").append(d)}common.isValid(t)&&($("#userListId").contextmenu(function(){return!1}),$("#userListId li[id="+e.userId+"] a[t=header]").click(function(e){if("0"==$(this).attr("t"))$(".user_box li").removeClass("zin");else{$(".user_box li").removeClass("zin"),$(this).parent().addClass("zin");var t=$(this).prev();t.attr("avs",$(this).find(".headimg img").attr("src")),chat.openDiaLog(t)}}).dblclick(function(){$(this).find("em").trigger("click")}).find("em").click(function(e){var t=$(this).parents("[utype]"),i=t.attr("id");return chat.closeWhTip(i),chat.fillWhBox(t.attr("cg"),t.find(".headimg img").attr("src"),t.attr("utype"),i,t.find(".uname span").text(),!1,!1),!1}))},leaveRoomTip:function(e,t){if("forcedOut"!=e){if("roomClose"==e)$(".blackbg").children().hide(),box.showTipBox("注意：房间已停用，正自动登出..."),"visitor"==indexJS.userInfo.clientGroup?window.setTimeout(function(){indexJS.toRefreshView()},1200):window.setTimeout(function(){$(".logout").trigger("click")},1200);else if("otherLogin"==e){if("visitor"==indexJS.userInfo.clientGroup)return;chat.socket.disconnect(),$(".blackbg").children().hide(),box.showMsg({closeable:!1,title:"登出提示",msg:"注意：您的账号已在其他地方登陆，被踢出！",btns:[{txt:"重新登录",fn:function(){indexJS.toRefreshView()}},{txt:"注销",fn:function(){$(".logout").trigger("click")}}]})}}else if(t)for(var i in t)$("#userListId li[id='"+t[i]+"']").remove()},setWhOnlineTip:function(e,t){var i=$("#wh_msg_"+e+" .tit strong");if(0!=i.length){var s=$("#wh_msg_"+e+" .tit strong"),a=$(".mult_dialog a[uid="+e+"]").find("img"),n=$("#userListId li[t=3][uid="+e+"] .headimg");t?(s.text("在线"),a.removeClass("have_op"),n.removeClass("have_op")):(s.text("离线"),a.addClass("have_op"),n.addClass("have_op"))}},getWhToUser:function(){var e=$(".mult_dialog a[class=on]"),t=e.attr("uid");return{userId:t,nickname:e.find("label").text(),talkStyle:1,userType:e.attr("utype")}},sendWhMsg:function(e){var t=chat.getWhToUser(),i=e.find(".text-min-img img");if(i.size()>0){var s=i.attr("src");s.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(s,t),i.remove())}var a=chat.getSendMsg(e);if(a!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:a}},o=$(".mult_dialog a[class=on]"),r=o.attr("uid");n.fromUser.toUser={userId:r,nickname:o.find("label").text(),talkStyle:1,userType:o.attr("utype")};var l=$("#wh_msg_"+r+" .dialog:last"),d=l.find(".whblt");d.length>0&&(n.fromUser.toUser.question=d.html(),n.fromUser.toUser.questionId=d.attr("rid"),n.fromUser.toUser.publishTime=l.attr("id")),chat.socket.emit("sendMsg",n),chat.setWhContent(n,!0,!1),e.html("")}},setWhVisitors:function(e,t,i,s,a,n,o){if(0==$(".mult_dialog a[uid="+i+"]").length){var r=this.getAImgOrLevel(i,e?e:$("#userListId li[id='"+i+"']").attr("cg"),t,a);$(".mult_dialog").append('<a href="javascript:" uid="'+i+'" utype="'+t+'" class=""><div class="headimg '+r.level+'">'+r.aImg+"<b></b></div><label>"+s+'</label><i class="num dn" t="0"></i><i class="close"></i></a>');var l=$(".mult_dialog a[uid="+i+"]");if(o){var d=l.find(".num"),c=parseInt(d.attr("t"))+1;d.attr("t",c).text(c).show()}l.find(".close").click(function(){var e=$(this).parent();e.remove(),$("#wh_msg_"+e.attr("uid")).remove(),0==$(".mult_dialog a").length?($(".pletter_win .cont[id]").remove(),$(".pletter_win").hide()):$(".mult_dialog a:last").click()}),l.click(function(){$(".mult_dialog a").removeClass("on"),$(this).addClass("on"),$(this).find(".num").attr("t",0).text("").hide();var e=$(this).attr("uid"),t="wh_msg_"+e,i=$(this).attr("utype");if(chat.closeWhTip(e),$(".pletter_win .cont[id]").hide(),0==$("#"+t).length){var s="whTxt_"+e;$(".pletter_win").append($("#wh_content_tmp").html()),$(".pletter_win .cont:last").attr("id",t).find(".ctextarea").attr("id",s),$("#"+t).find(".facebtn").qqFace({id:"faceId_"+e,zIndex:1e6,assign:s,path:indexJS.filePath+"/face/"}),$("#"+t).find(".imgbtn").click(function(){return FileReader?void $("#"+t).find(".imginp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#"+t).find(".imginp").bind("change",function(){var e=this,t=chat.getWhToUser(),i=e.files[0];if(!i)return!1;if(0!=i.type.indexOf("image")||!i.type||!/\.(?:jpg|png|gif)$/.test(i.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var s=i.size;if(s>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var a=new FileReader;a.readAsDataURL(i),a.onload=function(e){chat.setUploadImg(e.target.result,t)},a.onprogress=function(e){},a.onloadend=function(e){},$(this).val("")}),$("#"+t).find(".ctextarea").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="whSend-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){return 13==e.keyCode?(chat.sendWhMsg($(this)),!1):void 0}),$("#"+t).find(".sendbtn").click(function(e){chat.sendWhMsg($(this).parents(".cont").find(".ctextarea"))}),$("#"+t).find(".pop_close").click(function(){$(".pletter_win .cont[id],.pletter_win .mult_dialog a[uid]").remove(),$(".pletter_win").hide()}),$("#"+t).find(".pop_small").click(function(){$(".pletter_win").hide()}),chat.socket.emit("getWhMsg",{clientStoreId:indexJS.userInfo.clientStoreId,userType:indexJS.userInfo.userType,groupId:indexJS.userInfo.groupId,groupType:indexJS.userInfo.groupType,userId:indexJS.userInfo.userId,toUser:{userId:e,userType:i}})}$("#"+t).show().find(".wh_nk").text($(this).find("label").text()),$("#"+t).find(".ctextarea").focus(),chat.setTalkListScroll(!0,$("#"+t+" .wh-content"),"dark"),chat.setWhOnlineTip(e,$("#userListId li[id='"+e+"']").length>0)})}},setWhTip:function(e){if($(".pletter_win").is(":hidden")){var t=$("#userListId li[id="+e+"] a.uname span i"),i=0;t.length>0&&(i=t.text(),i=common.isValid(i)?i:0,$("#userListId li[id="+e+"] a.uname span i").text(parseInt(i)+1)),$("#userListId li[id="+e+"]").attr("k",1),this.whTipInterId||(this.whTipInterId=setInterval(function(){$("#userListId li[k=1]").toggleClass("tip_mrg")},1e3))}},closeWhTip:function(e){$("#userListId li[id="+e+"]").attr("k",0).removeClass("tip_mrg").find("a.uname span i").text(""),0==$("#userListId li[k=1]").length&&this.whTipInterId&&(clearInterval(this.whTipInterId),this.whTipInterId=null)},fillWhBox:function(e,t,i,s,a,n,o){var r=$(".mult_dialog a[uid="+s+"]");if(0==r.length)chat.setWhVisitors(e,i,s,a,t,!0,o);else if(o&&!r.hasClass("on")){var l=r.find(".num"),d=parseInt(l.attr("t"))+1;l.attr("t",d).text(d).show()}return n?(this.setWhTip(s),!1):($(".pletter_win").show(),$(".mult_dialog a[uid="+s+"]").click(),!0)},setWhContent:function(e,t,i,s){var a=e.fromUser,n="dialog ",o=e.content,r="";if(e.rule)return void $("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>");if(i||(a.toWhUserId=a.userId),indexJS.userInfo.userId==a.userId||"0"==indexJS.userInfo.userType&&"-1"==a.userType||"-1"==indexJS.userInfo.userType&&"0"==a.userType){if(t&&(a.publishTime=e.uiId,a.toWhUserId=a.toUser.userId),e.serverSuccess){if($("#"+e.uiId+" .dtime").html(chat.formatPublishTime(a.publishTime)),$("#"+e.uiId).attr("id",a.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(a.publishTime);var l=$("#"+a.publishTime+' span[contt="a"]>a'),d=e.content.needMax?"/studio/getBigImg?publishTime="+a.publishTime+"&userId="+a.userId:l.children("img").attr("src");l.attr("href",d)}return}n+="mine",r='<span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+'</span><a href="javascript:" class="uname">我</a>'}else{if(!i&&!s){var c=this.fillWhBox(a.clientGroup,a.avatar,a.userType,a.userId,a.nickname,!0,!0);if(c)return}var u="3"==a.userType?"&nbsp;（助理）":"";r='<a href="javascript:" class="uname">'+a.nickname+u+'</a><span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+"</span>"}if(common.isBlank(a.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var p="",h=$("#wh_msg_"+a.toWhUserId+" .dialoglist"),m="";if(o.msgType==chat.msgType.img){p=o.needMax?'<a href="/studio/getBigImg?publishTime='+a.publishTime+"&userId="+a.userId+'" data-lightbox="whimg-"'+a.userId+'><img src="'+o.value+'" alt="图片"/></a>':'<a href="'+o.value+'" data-lightbox="whimg-"'+a.userId+'><img src="'+o.value+'" alt="图片" /></a>';var f=t?'</span><em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>':"";p='<p><i></i><span class="dcont" contt="a">'+p+f+"</p>"}else if(s)p='<div class="whcls"><i></i><div class="whblt" rid="'+o.infoId+'">'+o.value+"</div></div>";else{if(!t&&common.isValid(a.toUser.question)){var g='<a href="javascript:" class="uname">'+a.toUser.nickname+'</a><span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+"</span>";m='<div class="dialog" id="'+a.publishTime+'"><div class="dialog_top">'+g+'</div><div class="whcls"><i></i><div class="whblt">'+a.toUser.question+"</div></div></div>",h.append(m)}p='<p><i></i><span class="dcont" contt="a">'+o.value+"</span></p>"}if(m='<div class="'+n+'" id="'+a.publishTime+'" utype="'+a.userType+'" mType="'+o.msgType+'"><div class="dialog_top">'+r+"</div>"+p+"</div>",h.append(m),this.formatMsgToLink(a.publishTime),!i){var v=h.parents(".wh-content");v.hasClass("mCustomScrollbar")&&chat.setTalkListScroll(!0,v,"dark")}},setOnlineNum:function(){$(".mod_userlist .titbar label").text($("#userListId li").length)},searchUserList:function(e){var t=$("#userListId li[t!=14][t!=0]").map(function(){var t=$(this).find(".uname span").text();return-1!=t.indexOf(e)?{value:$(this).attr("id"),label:t,userType:$(this).attr("utype")}:null}).get();return t},setUserListIdEmpty:function(){$("#userListId").html("")},setSocket:function(){this.socket=common.getSocket(io,indexJS.socketUrl,indexJS.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),indexJS.userInfo.socketId=chat.socket.id;var e=$("#roomInfoId");chat.socket.emit("login",{userInfo:indexJS.userInfo,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:e.attr("awr"),allowWhisper:e.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(e,t){if("true"==$("#roomInfoId").attr("av")&&!chat.initUserList){var i=0,s=0;s=t>100?Math.ceil(50*Math.random())+275:10>=t?60:200/t*3+10;for(var a=0;s>a;a++)i=common.randomNumber(6),e["visitor_"+i]={userId:"visitor_"+i,clientGroup:"visitor",nickname:"游客_"+i,sequence:15,userType:-1};chat.initUserList=!0}var n=null;for(var a in e)n=e[a],chat.setOnlineUser(n);chat.setOnlineNum(),indexJS.setListScroll(".user_box")}),this.socket.on("disconnect",function(e){console.log("disconnect")}),this.socket.on("error",function(e){console.error("e:"+e)}),this.socket.on("sendMsg",function(e){if(e.fromUser.toUser&&1==e.fromUser.toUser.talkStyle)chat.setWhContent(e,!1,!1);else{if(!e.serverSuccess&&indexJS.userInfo.userId==e.fromUser.userId&&!e.rule)return;chat.setContent(e,!1,!1)}}),this.socket.on("notice",function(e){switch(e.type){case"onlineNum":var t=e.data,i=t.onlineUserInfo;t.online?chat.setOnlineUser(i):indexJS.userInfo.userId!=i.userId&&(3==i.userType?$("#userListId #"+i.userId+" .uname>span").addClass("csoffline"):($("#userListId #"+i.userId).remove(),indexJS.setListScroll(".user_box"))),chat.setOnlineNum(),3==i.userType&&chat.setWhOnlineTip(i.userId,t.online);break;case"removeMsg":$("#"+e.data.replace(/,/g,",#")).remove(),chat.setTalkListScroll();break;case"leaveRoom":chat.leaveRoomTip(e.flag,e.userIds);break;case"pushInfo":var t=e.data;switch(t.position){case 1:chat.msgPushObj.whInfos=t.infos;break;case 3:chat.msgPushObj.pbInfos=t.infos;for(var s=0,a=chat.msgPushObj.pbInfos.length;a>s;s++)chat.msgPushObj.pbInfos[s].nextTm=chat.msgPushObj.pbInfos[s].serverTime+60*chat.msgPushObj.pbInfos[s].onlineMin*1e3;break;case 4:videos.rollNews(t)}break;case"approvalResult":var t=e.data;if(t.refuseMsg){var n=t.publishTimeArr;for(var s in n)$("#"+n[s]+" span[contt] em[class=ruleTipStyle]").html("已拒绝")}else{for(var s in t)chat.formatUserToContent(t[s]);chat.setTalkListScroll(!0)}break;case"articleInfo":var o=e.data;if(o)switch(o.category){case"trade_strategy_article":var r=o.detailList&&o.detailList[0],l=r&&r.authorInfo&&r.authorInfo.userId;r&&$("#lvInfoId .te_detail").attr("uid")==l&&$("#lvInfoId .info2 p").text(r.content);break;case"class_note":o.platform&&-1!=o.platform.indexOf(indexJS.userInfo.groupId)&&(indexJS.appendTradeStrategyNote(o,!0,!0),indexJS.setListScroll($(".textlivelist>.scrollbox")))}}}),this.socket.on("loadMsg",function(e){var t=$("#dialog_list .push");t.size()>0&&t.hide(),$(".img-loading[pf=chatMessage]").hide();var i=e.msgData;if(i&&$.isArray(i)){i.reverse();for(var s in i)chat.formatUserToContent(i[s])}t.size()>0&&$("#dialog_list .push").appendTo($("#dialog_list")).show(),chat.setTalkListScroll(!0)}),this.socket.on("loadWhMsg",function(e){var t=$("#wh_msg_"+e.toUserId+" .chat_content .dialoglist .dialog .whcls").parent(),i=t.next().size(),s=t.prev().size();0==i&&0==s&&t.size()>0&&t.hide();var a=e.data;if("offline"==e.type){if(a&&!$.isEmptyObject(a))for(var n in a)chat.setWhVisitors(a[n].clientGroup,a[n].userType,n,a[n].nickname,$("#userListId li[id='"+n+"']").length>0)}else if(a&&$.isArray(a)){var o=0,r=null;a.reverse();$(".mult_dialog a[uid="+e.toUserId+"]");for(var l in a)r=a[l],chat.formatUserToContent(r,!0,e.toUserId),r.content.msgType==chat.msgType.img&&o++;0==i&&0==s&&t.size()>0&&t.appendTo($("#wh_msg_"+e.toUserId+" .chat_content .dialoglist")).show(),chat.setTalkListScroll(!0,$("#wh_msg_"+e.toUserId+" .wh-content"),"dark")}})},setTalkListScroll:function(e,t,i){var s=t?t:$("#chatMsgContentDiv");s.hasClass("mCustomScrollbar")?(s.mCustomScrollbar("update"),e&&s.mCustomScrollbar("scrollTo","bottom")):(s.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:i?i:"light-2"}),indexJS.setScrollStyle(s),s.mCustomScrollbar("scrollTo","bottom"))},setWhPushInfo:function(e,t){var i=e.attr("uid"),s=e.find("label").text().replace(/\s（助理）$/,"");if($("#wh_msg_"+i+" div[id="+chat.msgPushObj.whInfo.publishTime+"]").length>0)return!1;var a={fromUser:{publishTime:chat.msgPushObj.whInfo.publishTime,userId:i,nickname:s,userType:3},content:{msgType:chat.msgType.text,value:chat.msgPushObj.whInfo.info,infoId:chat.msgPushObj.whInfo.infoId}};return chat.setWhContent(a,!1,!1,!0),chat.msgPushObj.whInfo={},window.clearTimeout(chat.pushInfoTimeOutId),!0},formatUserToContent:function(e,t,i){var s={userId:e.userId,nickname:e.nickname,avatar:e.avatar,userType:e.userType,groupId:e.groupId,clientGroup:e.clientGroup,publishTime:e.publishTime,toUser:e.toUser,avatar:e.avatar,position:e.position};t?(s.toWhUserId=i,chat.setWhContent({fromUser:s,content:e.content},!1,!0)):chat.setContent({fromUser:s,content:e.content},!1,!0)},showTalkPushMsg:function(e){var t=[];t.push('<div class="dialog push">'),t.push(e.content),t.push("</div>"),$("#dialog_list").append(t.join("")),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)},setPushInfo:function(){var e=null,t=chat.msgPushObj.whInfos;if(t&&t.length>0)for(var i=0,s=t.length;s>i;i++)if(e=t[i],!e.pushed&&e&&indexJS.serverTime>=e.serverTime+60*e.timeOut*1e3){e.pushed=!0,chat.msgPushObj.whInfo={info:e.content,publishTime:e.publishTime,infoId:e.contentId};var a=$("#userListId li[t=3] a .headimg:not(.have_op)");if(a.length>0){var n=$(a.get(common.randomIndex(a.length))).parent();n.dblclick(),chat.setWhPushInfo($(".mult_dialog a[uid="+n.parent().attr("id")+"]"))}}var o=null,r=chat.msgPushObj.pbInfos;if(r&&r.length>0)for(var i=0,l=r.length;l>i;i++)o=r[i],o&&o.nextTm&&indexJS.serverTime>=o.nextTm&&common.dateTimeWeekCheck(o.pushDate,!1,indexJS.serverTime)&&(o.intervalMin&&o.intervalMin>0?o.nextTm=indexJS.serverTime+60*o.intervalMin*1e3:delete o.nextTm,chat.showTalkPushMsg(o))}};$(function(){chat.init()});var box={verifyCodeIntMap:{},toRoomId:null,init:function(){this.setEvent(),indexJS.checkClientGroup("visitor")&&indexJS.options.preReg&&box.openSettingBox("reg")},setEvent:function(){$(".popup_box .pop_close,.formbtn[t=close]").click(function(){$(this).parent().parent().hide(),$(".blackbg").hide(),$(".blackbg form").each(function(){this.reset()})}),this.loginEvent(),this.upgradeEvent(),this.expertMailEvent()},upgradeEvent:function(){$("#tipbtnId").hover(function(){$(".upg_tip").show()},function(){$(".upg_tip").hide()}),$(".upgradebtn").click(function(){try{$(".upgrade,#up_loading").show(),$.getJSON("/studio/getClientGroupList",null,function(e){if($("#up_loading").hide(),e){$("#upg_tbody_id").html("");var t="",i=0,s=null,a="";for(var n in e)e[n].clientGroupId==indexJS.userInfo.clientGroup&&(i=e[n].sequence);for(var o=0;o<e.length;o++)if(s=e[o],a="",s.clientGroupId==indexJS.userInfo.clientGroup?(t="当前级别",a="current"):t="visitor"!=s.clientGroupId&&i<s.sequence?"vip"==s.clientGroupId?"联系客服升级":'<a href="javascript:" t="'+s.clientGroupId+'">升级</a>':"---",!common.isBlank(common.trim(s.remark))){var r=[];r.push('<tr class="'+a+'"><td><p>'+box.getUserLevelShortName(s.clientGroupId)+'</p></td><td><p class="p2">'+common.trim(s.remark)+"</p></td><td><p>"+common.trim(s.authorityDes)+"</p></td><td>"+t+"</td></tr>"),$("#upg_tbody_id").append(r.join(""))}$("#upg_tbody_id a").click(function(){var e=$(this),t=e.attr("t");common.getJson("/studio/upgrade",{clientGroup:t},function(i){if(e.attr("disabled",!1),i.isOK)"active"===i.clientGroup&&"notActive"===t?$("#studioUpgA").show():$("#studioUpgA").hide(),$(".upgrade,.upgrade_result .fail").hide(),$(".upgrade_result,.upgrade_result .succ").show();else{var s="";"active"===t?s="很遗憾，您未激活金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"notActive"===t?s="很遗憾，您未开通金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"simulate"===t&&(s="很遗憾，您未开通金道模拟交易账户，升级失败！<br>如有疑问请联系客服！"),$(".upgrade_result .succ").hide(),$(".upgrade_result,.upgrade_result .fail").show(),$(".upgrade_result .fail>span").html(s)}},!0,function(t){e.attr("disabled",!1)})})}})}catch(e){$("#up_loading").hide(),console.error("getClientGroupList->"+e)}})},forceLogin:function(e){var t=LoginAuto.get();return"boolean"!=typeof e?t&&1==t.forceLogin:t?(t.forceLogin=e,LoginAuto.set(t)&&e):!1},loginEvent:function(){if($("#loginForm .login_option a").bind("click",function(){var e=$(this).attr("lt");$("#loginForm .login_option a.selected").removeClass("selected"),$(this).addClass("selected"),$("#loginForm .in_line[lt]").hide(),$("#loginForm .in_line[lt='"+e+"']").show(),$("#loginForm .fr[lt]").hide(),$("#loginForm .fr[lt='"+e+"']").show(),$("#loginType").val(e)}),$("#preSetPwdBtn,#preSetPwdBtn2").bind("click",function(){box.openSettingBox("password2")}),$("#popBoxPassword1 .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxPassword1"))){$(this).prop("disabled",!0),$("#popBoxPassword1 .img-loading").show();var e=this;common.getJson("/studio/resetPwd",$("#popBoxPassword1 form").serialize(),function(t){return box.showBoxError($("#popBoxPassword1")),$(e).prop("disabled",!1),$("#popBoxPassword1 .img-loading").hide(),t.isOK?(box.showTipBox("修改密码成功，请使用新密码登录！"),void box.openLgBox()):(box.showBoxError($("#popBoxPassword1"),"<i></i>"+t.msg),!1)},!0,function(t){
$(e).prop("disabled",!1),$("#popBoxPassword3 .img-loading").hide()})}}),$("#popBoxPassword2 .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxPassword2"))){$(this).prop("disabled",!0),$("#popBoxPassword2 .img-loading").show();var e=this;common.getJson("/studio/resetPwd",$("#popBoxPassword2 form").serialize(),function(t){return box.showBoxError($("#popBoxPassword2")),$(e).prop("disabled",!1),$("#popBoxPassword2 .img-loading").hide(),t.isOK?($("#popBoxPassword3_mb").val(t.mobilePhone),void box.openSettingBox("password3")):(box.showBoxError($("#popBoxPassword2"),"<i></i>"+t.msg),!1)},!0,function(t){$(e).prop("disabled",!1),$("#popBoxPassword2 .img-loading").hide()})}}),$("#popBoxPassword3 .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxPassword3"))){$(this).prop("disabled",!0),$("#popBoxPassword3 .img-loading").show();var e=this;common.getJson("/studio/resetPwd",$("#popBoxPassword3 form").serialize(),function(t){return box.showBoxError($("#popBoxPassword3")),$(e).prop("disabled",!1),$("#popBoxPassword3 .img-loading").hide(),t.isOK?(box.showTipBox("重置密码成功，请使用新密码登录！"),void box.openLgBox()):(box.showBoxError($("#popBoxPassword3"),"<i></i>"+t.msg),!1)},!0,function(t){$(e).prop("disabled",!1),$("#popBoxPassword3 .img-loading").hide()})}}),$("#preRegBtn").bind("click",function(){box.openSettingBox("reg")}),$("#reg_login").bind("click",function(){box.openLgBox()}),$("#popBoxRegister .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxRegister"))){$(this).prop("disabled",!0),$("#popBoxRegister .img-loading").show();var e=this;common.getJson("/studio/reg",$("#popBoxRegister form").serialize(),function(t){return box.showBoxError($("#popBoxRegister")),$(e).prop("disabled",!1),$("#popBoxRegister .img-loading").hide(),t.isOK?($(".blackbg,#popBoxRegister").hide(),$("#regLpBtn").attr("href","http://www.24k.hk/activity/studioLottery/index.html?userId="+t.userId+"#ba"),$(".register_result").show(),void 0):(box.showBoxError($("#popBoxRegister"),"<i></i>"+t.msg),!1)},!0,function(t){$(e).prop("disabled",!1),$("#popBoxRegister .img-loading").hide()})}}),$(".register_result .pop_close").bind("click",function(){indexJS.toRefreshView()}),$("#login_a").bind("click",function(e,t){t=t||{},box.toRoomId=t.groupId,box.openLgBox(t.closeable,t.showTip,t.loginTime),common.isValid($(this).attr("tp"))&&_gaq.push(["_trackEvent","pmchat_studio","login",$(this).attr("tp"),1,!0])}),"visitor"==indexJS.userInfo.clientGroup){var e=$("#roomInfoId").attr("lgt");common.isValid(e)&&(indexJS.currStudioAuth?this.forceLogin()?$("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:e}):window.setTimeout(function(){"visitor"==indexJS.userInfo.clientGroup&&(box.forceLogin(!0),$("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:e}))},60*e*1e3):$("#login_a").trigger("click",{closeable:!1,loginTime:e}))}$(".logout").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href="/studio/logout"}),$("#loginForm input[name=mobilePhone],#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").bind("input propertychange",function(){common.isValid(this.value)&&$(".popup_box .error").hide()}),$("#loginForm .rbtn,#popBoxPassword2 .rbtn,#popBoxRegister .rbtn").click(function(){if(!$(this).hasClass("pressed")){var e=$(this).parents(".popup_box:first"),t=e.find("input[name=mobilePhone]").val();if(!common.isMobilePhone(t))return void box.showBoxError(e,"<i></i>手机号码有误，请重新输入！");$(this).addClass("pressed").html("发送中...");try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:t,useType:$(this).attr("ut")},function(t){t&&0==t.result?(box.showBoxError(e),box.setVerifyCodeTime(e.attr("id"))):("1005"==t.errcode?box.showBoxError(e,"<i></i>"+t.errmsg):console.error("提取数据有误！"),box.resetVerifyCode(e))})}catch(i){box.resetVerifyCode(e),console.error("setMobileVerifyCode->"+i)}}}),$("#loginForm input[name='verifyCode'],#setNkForm input[name='nickname'],#popBoxRegister input[name='password1']").keydown(function(e){return 13==e.keyCode?($(this).parents("form").find(".set_submit").click(),!1):void 0}),$("#logBtnSub").click(function(){if(!$(this).prop("disabled")&&($("#loginForm input[name=clientStoreId]").val(indexJS.userInfo.clientStoreId),box.checkFormInput($("#loginForm")))){$(this).prop("disabled",!0);var e=this;$("#formBtnLoad").show(),common.getJson("/studio/login",$("#loginForm").serialize(),function(t){return $("#loginForm .error").hide(),$(e).prop("disabled",!1),$("#formBtnLoad").hide(),t.isOK?($(".blackbg,#loginBox").hide(),LoginAuto.setAutoLogin($("#autoLogin").prop("checked")),indexJS.userInfo.clientGroup=t.userInfo.clientGroup,box.toRoomId?common.getJson("/studio/checkGroupAuth",{groupId:box.toRoomId},function(e){e.isOK||(indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户方可进入【特别专场】，您还不满足条件。我们将为您自动进入直播大厅。")),indexJS.toRefreshView()},!0,function(e){"success"!=e&&(box.preGroupId=null,alert("操作失败，请联系客服！"))}):(indexJS.showWelcomeMsg(),indexJS.toRefreshView()),void 0):($("#loginForm .error").html("<i></i>"+t.error.errmsg).show(),!1)},!0,function(t){$(e).prop("disabled",!1),$("#formBtnLoad").hide()})}}),$("#setNkBtn").click(function(){if(box.checkFormInput($("#setNkForm"))){$(this).prop("disabled",!0);var e=this;$("#setNkLoad").show(),common.getJson("/studio/modifyName",$("#setNkForm").serialize(),function(t){return $("#setNkForm .error").hide(),$(e).attr("disabled",!1),$("#setNkLoad").hide(),t.isOK?($("#setNkForm").parent().find(".pop_close").click(),indexJS.refreshNickname(!0,t.nickname),$("#sendBtn").click(),void 0):($("#setNkForm .error").html("<i></i>"+(t.msg?t.msg:"修改失败，请联系客服！")).show(),!1)},!0,function(t){$(e).attr("disabled",!1),$("#setNkLoad").hide()})}})},getUserLevelShortName:function(e){var t="";switch(e){case"vip":t="l4";break;case"real":t="l3";break;case"active":t="l3";break;case"notActive":t="l3";break;case"simulate":t="l2";break;case"register":t="l1";break;default:t="l0"}return'<i class="level '+t+'"></i>'},checkFormInput:function(e){var t=!0;if(box.showBoxError(e),e.find("input").each(function(){return $(this).is(":visible")?common.isBlank($(this).val())?(("mobilePhone"==this.name||"userId"==this.name)&&box.showBoxError(e,"<i></i>手机号码不能为空！"),"verifyCode"==this.name&&box.showBoxError(e,"<i></i>验证码不能为空！"),"nickname"==this.name&&box.showBoxError(e,"<i></i>昵称不能为空！"),"password0"==this.name&&box.showBoxError(e,"<i></i>原始密码不能为空！"),"password"==this.name&&box.showBoxError(e,"<i></i>密码不能为空！"),"password1"==this.name&&box.showBoxError(e,"<i></i>确认密码不能为空！"),t=!1):"mobilePhone"!=this.name||($(this).val($.trim($(this).val())),common.isMobilePhone(this.value))?"nickname"!=this.name||common.isRightName(this.value)?"password"!=this.name||/^.{6,20}$/.test(this.value)||"loginForm"==e.attr("id")?void 0:(box.showBoxError(e,"<i></i>密码由6至20数字、字母、符号组成！"),t=!1):(box.showBoxError(e,"<i></i>昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!"),t=!1):(box.showBoxError(e,"<i></i>手机号码输入有误！"),t=!1):void 0}),!t)return t;var i=e.find("input[type='password']"),s=i.size();return 2==s&&i.eq(s-2).val()!=i.eq(s-1).val()?(box.showBoxError(e,"<i></i>两次密码输入不一致！"),t=!1):t},setVerifyCodeTime:function(e){var t=$("#"+e+" .rbtn"),i=parseInt(t.attr("t"))||120;this.verifyCodeIntMap[e]||(this.verifyCodeIntMap[e]=setInterval("box.setVerifyCodeTime('"+e+"')",1e3)),i>1?t.attr("t",i-1).html("重新获取("+(i-1)+")"):(clearInterval(this.verifyCodeIntMap[e]),this.verifyCodeIntMap[e]=null,t.attr("t",120).html("获取验证码").removeClass("pressed"))},resetVerifyCode:function(e){var t=e.attr("id");this.verifyCodeIntMap[t]&&(clearInterval(this.verifyCodeIntMap[t]),this.verifyCodeIntMap[t]=null),e.find(".rbtn").attr("t",120).html("获取验证码").removeClass("pressed")},openLgBox:function(e,t,i){e===!1?$("#loginBox .pop_close").hide():$("#loginBox .pop_close").show(),t?(i=i||1,$("#login_tip").show().text($("#setlogintip").text())):$("#login_tip").hide(),$(".popup_box").hide(),$("#loginBox,.blackbg").show()},openSettingBox:function(e){$(".popup_box").hide();var t=null;switch(e){case"reg":t=$("#popBoxRegister");break;case"password1":t=$("#popBoxPassword1");break;case"password2":t=$("#popBoxPassword2");break;case"password3":t=$("#popBoxPassword3");break;case"nickname":t=$("#popBoxNickname")}box&&(box.showBoxError(t),t.find("input[type='text'],input[type='password']").each(function(){$(this).val("")}),t.show(),$(".blackbg").show())},showBoxError:function(e,t){t?e.find(".error").html(t).show():e.find(".error").html("").hide()},refreshVerifyCode:function(){var e=LoginAuto.sessionUser.groupType;$("#verifyCodeId img").attr("src","/"+e+"/getVerifyCode?code=email&v="+Math.random())},expertMailEvent:function(){$(".expert_box .error").hide(),$("#expert").click(function(){box.refreshVerifyCode(),$(".expert,.blackbg").removeClass("dn").show()}),$("#btnSendMail").click(function(){if(common.isBlank($("#mailFrom").val()))$(".expert_box .error").html("<i></i>发件人不能为空！").show();else if(common.isBlank($("#mailContent").val()))$(".expert_box .error").html("<i></i>输入内容有误，请重新输入！").show();else if(common.isBlank($("#mailImgCode").val()))$(".expert_box .error").html("<i></i>验证码不能为空！").show();else{$(".expert_box .error").hide();var e={};e.content=$.trim($("#mailContent").val()),e.email=$.trim($("#mailFrom").val()),e.code=$.trim($("#mailImgCode").val()),common.getJson("/studio/email",{key:"studio",data:JSON.stringify(e)},function(e){e.isOK?(box.showMsg(e.msg),$(".expert,.blackbg").hide(),$("#mailFrom,#mailContent").val("")):$(".expert_box .error").html("<i></i>"+e.msg).show()})}}),$("#btnSendMail").keydown(function(e){return 13==e.keyCode?($("#btnSendMail").click(),!1):void 0}),$("#verifyCodeId img").click(function(){box.refreshVerifyCode()})},hideMsg:function(){$("#popMsgBox").is(":visible")&&$("#popMsgBox").fadeOut("normal","swing",function(){$(".blackbg").hide()})},showMsg:function(e){"string"==typeof e&&(e={msg:e}),e=$.extend({closeable:!0,title:"",msg:"",modal:!0,delay:0,btns:[{txt:"确定",fn:function(){box.hideMsg()}}]},e),$("#popMsgTit").text(e.title||""),$("#popMsgTxt").text(e.msg);var t=$("#popMsgCont");t.find("a.yesbtn").remove();for(var i=null,s=null,a=0,n=e.btns?e.btns.length:0;n>a;a++)i=e.btns[a],s=$('<a class="yesbtn" href="javascript:void(0)">'+i.txt+"</a>"),t.append(s),s.click(i.fn);e.closeable?$("#popMsgClo").show():$("#popMsgClo").hide(),$("#popMsgBox").show(),e.modal&&$(".blackbg").show(),e.delay&&window.setTimeout(function(){box.hideMsg()},e.delay)},showTipBox:function(e){$(".tipsbox").fadeIn().delay(1e3).fadeOut(200).find(".cont").text(e)}};$(function(){box.init()});var tool={financeShowIntervalId:null,financeHideIntervalId:null,tradeForUser:null,tradeList:[],tradeLoadAll:!1,init:function(){this.setEvent()},setEvent:function(){$(".mod_menu li").hover(function(){$(this).hasClass("entered")||(tool.loadFun($(this).attr("class")),$(".dr3").hasClass("on")&&clearTimeout(tool.financeHideIntervalId)),$(this).addClass("on entered"),$(this).find(".dropcont").show();var e=[null,"tool_showTrade","tool_market","tool_finance","tool_cftc","tool_pivot","tool_ppt","tool_gts","tool_studioMb"],t=$(this).index();e[t]&&_gaq.push(["_trackEvent","pmchat_studio",e[t],"content_right",1,!0])},function(){$(this).removeClass("on"),$(this).find(".dropcont").hide(),$(".dr3").hasClass("on")||(clearInterval(tool.financeShowIntervalId),tool.financeHideIntervalId=window.setTimeout("tool.clearCls('.dr3','entered')",6e4)),!$(".dr2").hasClass("on")&&pkMarketSocket&&pkMarketSocket.close(),$(".dr9").hasClass("entered")&&$(".dr9").removeClass("entered")}),$(".hqchart .hqtabnav a").click(function(){$(".hqchart .hqtabnav a").removeClass("on"),$(".hqchart .votebox a").removeClass("on"),$(this).addClass("on"),$($(".hqchart .votebox a")[0]).addClass("on");var e=$(this).attr("symbol");tool.setQuotesVote(e,"")}),$(".hqchart .votebox a").click(function(){$(".hqchart .votebox a").removeClass("on"),$(this).addClass("on")}),$(".votebtn").click(function(){var e=$(".hqchart .hqtabnav a.on").attr("symbol"),t=$(".hqchart .votebox a.on").attr("highslows");$(this).attr(e)!=e?tool.quotesVote(e,t):box.showMsg("已投过票了")}),$("#calendarFinance").val(common.formatterDate(indexJS.serverTime,"-")),$("#calendarFinance").change(function(){var e=$(this).val();tool.setFinanceData(e,1)}),$(".dr3 .date_select a").click(function(){$("#calendarFinance").trigger("click")}),$(".calc_box .calc_tabnav a").click(function(){$(this).hasClass("clicked")||tool.setPivotCalc($(this).attr("symbol")),$(".calc_box .calc_tabnav a").removeClass("on"),$(".calc_box .calc_tab").removeClass("on"),$(this).addClass("on clicked"),$($(".calc_box .calc_tab")[$(this).index()]).addClass("on")}),$(".dr9 .dropcont .cont .userad_btnbar .fl").click(function(){if(indexJS.userInfo.isLogin)(common.isBlank(indexJS.userInfo.isSetName)||indexJS.userInfo.isSetName)&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".pop_addsd").removeClass("dn").show();else{var e=e||{};box.openLgBox(e.closeable,e.showTip)}}),$("#myShowTrade").click(function(){if(indexJS.userInfo.isLogin)tool.tradeForUser=indexJS.userInfo.userId,tool.initShowTrade(),$(".dr9 .mysd_list .sdinfo .sdinfo_cont .headimg img").attr("src",$("#avatarInfoId").attr("src")),$(".dr9 .mysd_list .sdinfo .sdinfo_cont span b").text(indexJS.userInfo.nickname),$(".dr9 .allsd_list").addClass("dn"),$(".dr9 .mysd_list").removeClass("dn");else{var e={};box.openLgBox(e.closeable,e.showTip)}}),$("#backShowTrade").click(function(){tool.tradeForUser=null,tool.initShowTrade(),$(".dr9 .allsd_list").removeClass("dn"),$(".dr9 .mysd_list").addClass("dn")}),$("#flTradeImg").change(function(){var e=$(this),t=this.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var s=new FormData($("#showTradeForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:s,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var i=t.data?t.data[0]:null;i&&($("#tradeImg").val(i.fileDomain+i.filePath),e.val(""))}else alert("上传图片失败，请联系在线客服！")},error:function(e){console.error("error:",e)}})}catch(a){console.error("上传图片失败",a)}}),$("#tradeSubmit").click(function(){tool.showTrade()}),$("#showTradeAgain").click(function(){$('.pop_addsd input[type="text"],.pop_addsd textarea').val(""),$("#flTradeImg").val(""),indexJS.userInfo.isSetName&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".sd_result").addClass("dn").hide()}),$("#sdResultClose").click(function(){$('.pop_addsd input[type="text"],.pop_addsd textarea').val(""),$("#flTradeImg").val(""),indexJS.userInfo.isSetName&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".sd_result").addClass("dn").hide(),$(".pop_close").click()})},loadFun:function(e){switch(e){case"dropitem dr2":getAllMarketpriceIndex("ws://kdata.gwfx.com:8087/websocket.do","service=HqDataWebSocketService&method=pushMarketprice&symbol=XAGUSD|XAUUSD|USDX|CLWTI&dataType=simpleMarketPrice","http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getMarkrtPriceDataFromCache",null),tool.initEasyPieChart(function(){tool.setQuotesVote("Gold",""),$(".dr2").addClass("initEasyPieChart")});break;case"dropitem dr3":tool.initCalendar(function(){tool.setFinanceData("",1),$(".dr3").addClass("initCalendar"),tool.financeShowIntervalId=window.setInterval("tool.setFinanceData('',1)",6e4)});break;case"dropitem dr4":tool.setCftcCot();break;case"dropitem dr5":tool.setPivotCalc("LLG");break;case"dropitem dr6":tool.setDownloadPPT();break;case"dropitem dr9":tool.initShowTrade()}},initEasyPieChart:function(e){if($(".dr2").hasClass("initEasyPieChart"))e();else{var t=[];$.browser.msie&&t.push("/base/lib/excanvas.compiled.js"),t.push("/base/lib/jquery.easy-pie-chart.min.js"),LazyLoad.js(t,function(){$(".percentage").easyPieChart({barColor:"#66ab4a",trackColor:"#f15f5f",scaleColor:!1,lineCap:"square",lineWidth:12,animate:1e3,size:114}),e()})}},quotesVote:function(e,t){common.getJson("/studio/highsLowsVote",{symbol:e,highslows:t},function(t){var i=0;if(t.isOK){var s=t.data.highs,a=t.data.lows,n=parseInt(s)+parseInt(a);i=Math.round(parseInt(s)/n*100),$("#data_percent_1").attr("data-percent",i),$(".hqchart .datashow .fr").html("看涨<br>"+i+"%"),$(".hqchart .datashow .fl").html("看跌<br>"+Math.round(parseInt(a)/n*100)+"%"),$(".votebtn").attr(e,e)}else $("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%");$(".percentage").data("easyPieChart").update(i)})},setQuotesVote:function(e,t){$.getJSON("/studio/getHighsLowsVote",{symbol:e,highslows:t},function(e){var t=0;if(e.isOK){var i=e.data.highs,s=e.data.lows,a=parseInt(i)+parseInt(s);t=Math.round(parseInt(i)/a*100),common.isBlank(t)||isNaN(t)?($("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%")):($("#data_percent_1").attr("data-percent",t),$(".hqchart .datashow .fr").html("看涨<br>"+t+"%"),$(".hqchart .datashow .fl").html("看跌<br>"+Math.round(parseInt(s)/a*100)+"%"))}else $("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%");$(".percentage").data("easyPieChart").update(t)})},initCalendar:function(e){$(".dr3").hasClass("initCalendar")?e():LazyLoad.js(["/base/lib/pikaday/moment.min.js","/base/lib/pikaday/pikaday.min.js"],function(){var t=tool.currentDate(),i={previousMonth:"上个月",nextMonth:"下个月",months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdays:["周日","周一","周二","周三","周四","周五","周六"],weekdaysShort:["日","一","二","三","四","五","六"]};new Pikaday({field:$("#calendarFinance")[0],firstDay:1,container:$("#calendarContainer")[0],defaultDate:t,i18n:i,minDate:new Date(2e3,0,1),maxDate:new Date(2050,12,31),yearRange:[2e3,2050],onSelect:function(){var e=document.createTextNode(this.getMoment().format("YYYY-MM-DD")+" ");$("#calendarFinance").append(e)}});e()})},setFinanceData:function(e,t){common.isBlank(e)&&(e=tool.currentDate()),common.getJson("/studio/getFinancData",{releaseTime:e,dataTypeCon:t},function(e){if(0==e.result){var t={"德国":"Germany","法国":"France","欧元区":"EUR","加拿大":"CAD","美国":"USD","澳大利亚":"AUD","日本":"JPY","瑞士":"CHF","意大利":"Italy","英国":"GBP","中国":"CNY","新西兰":"NZD","韩国":"SK","香港":"HKD","西班牙":"Spain","台湾":"Taiwan","印度":"INR","新加坡":"Singapore"},i="",s=tool.formatHtml("finance");$.each(e.data.financeData,function(e,a){i+=s.formatStr(a.time.substring(0,5),common.isBlank(t[a.country])?"none":t[a.country],a.country,tool.importanceLevel(a.importanceLevel),a.name,common.isBlank(a.lastValue)?"---":a.lastValue,common.isBlank(a.predictValue)?"---":a.predictValue,common.isBlank(a.value)?"---":a.value)}),$(".dr3 .calendar_ul ul").html(i),indexJS.setListScroll(".calendar_ul.scrollbox2",{isCustom:!1,scrollbarPosition:"outside",theme:"dark-2"})}})},setCftcCot:function(){$.getJSON("/studio/get24kCftc",null,function(e){var t={gold:"纽约期金",silver:"纽约期银",usd:"美元指数",oil:"纽约原油",cu:"纽约期铜"};if(null!=e&&e){var i="",s="",a=tool.formatHtml("cftcperc"),n=tool.formatHtml("cftcdata");$.each(t,function(t,o){var r=e[t]["long"],l=e[t]["short"],d=parseInt(r)+parseInt(l),c=Math.round(parseInt(r)/d*100),u=Math.round(parseInt(l)/d*100);i+=a.formatStr(o,c,u),s+=n.formatStr(o,r,l,e[t].updatetime)}),$(".dr4 .percent_list .perc_table").html(i),$(".dr4 .perc_data .data_table tbody").html(s)}})},getOAUrl:function(){var e=window.location.host;return e=e.indexOf("localhost")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":e.indexOf("testweb1.24k.hk")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":"http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getPivotPointData&symbol="},setPivotCalc:function(e){$.post(tool.getOAUrl()+e,{},function(e){var t=["d","w"];if("true"===e.sucess.toLowerCase())for(var i=e.msg.length,s=0;i>s;s++)$.inArray(e.msg[s].pivotType,t)>-1&&($("#r3_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].resistance3),$("#r2_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].resistance2),$("#r1_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].resistance1),$("#p_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].pivotPoint),$("#s3_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].support3),$("#s2_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].support2),$("#s1_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].support1))},"json")},setDownloadPPT:function(){var e={pptx:"",ppt:"",pdf:' class="pdf"',docx:' class="word"',doc:' class="word"'};indexJS.getArticleList("download",indexJS.userInfo.groupId,1,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){if(t&&0==t.result){var i,s=t.data,a=null,n="",o=tool.formatHtml("download");for(var r in s){i=0==r?' class="fir"':"",a=s[r].detailList[0];var l=s[r].mediaUrl.substring(s[r].mediaUrl.lastIndexOf(".")+1).toLowerCase(),d=a.title+"."+l,c=common.formatterDate(s[r].publishStartDate,"-").replace("-","/").replace("-","/");n+=o.formatStr(i,e[l],a.title,a.authorInfo?a.authorInfo.name:"",c,s[r].mediaUrl,d,"")}$(".dr6 .ppt_list ul").html(n),indexJS.setListScroll(".ppt_list",{isCustom:!1,scrollbarPosition:"outside",theme:"dark-2"})}else $(".dr6 .ppt_list ul").html("")})},initShowTrade:function(){$(".loading_trade").removeClass("dn");var e={groupType:indexJS.userInfo.groupType};common.isValid(tool.tradeForUser)&&(e.userNo=tool.tradeForUser),common.getJson("/studio/getShowTrade",{data:JSON.stringify(e)},function(e){e.isOK&&common.isValid(e.data)?(common.isBlank(tool.tradeForUser)?$(".dr9 .allsd_list .sdlistcont ul").empty():$(".dr9 .mysd_list .sdlistcont ul").empty(),tool.tradeList=e.data.tradeList||[],tool.tradeLoadAll=!1,tool.setShowTrade()):$(".loading_trade").addClass("dn")})},setShowTrade:function(){var e=common.isBlank(tool.tradeForUser)?$(".dr9 .allsd_list .usersd_list li").size():$(".dr9 .mysd_list .usersd_list li").size(),t=tool.tradeList,i=null,s=t.length;if(s>e&&(tool.tradeLoadAll=!1),tool.tradeLoadAll)return $(".loading_trade").addClass("dn"),!1;$("#sdcount").text(common.isValid(tool.tradeForUser)?s:"0");for(var a,n="",o=common.isBlank(tool.tradeForUser)?tool.formatHtml("showTradeAll"):tool.formatHtml("showTradeUser"),r=e;s>r&&e+20>r;r++){switch(i=t[r],i.status){case 1:a="";break;case 0:a=' class="s1"';break;case-1:a=' class="s2"'}var l=common.formatterDateTime(i.showDate,"/").substr(0,16);n+=common.isBlank(tool.tradeForUser)?o.formatStr(i.title,i.user.userName,l,i.tradeImg,i.remark,common.isBlank(i.praise)?0:i.praise,i._id,i.user.userNo,i.user.avatar):o.formatStr(a,i.title,i.tradeImg,i.remark,l,common.isBlank(i.praise)?0:i.praise,i._id)}common.isBlank(tool.tradeForUser)?$(".dr9 .allsd_list .sdlistcont ul").append(n):$(".dr9 .mysd_list .sdlistcont ul").append(n),$(".loading_trade").addClass("dn"),r>=s-1&&(tool.tradeLoadAll=!0),tool.setUserShowTrade(),tool.showTradePraise(),indexJS.setListScroll(".dr9 .sdlistcont",{isCustom:!1,scrollbarPosition:"outside",theme:"dark-2",callbacks:{onTotalScroll:function(){$(".loading_trade").removeClass("dn"),tool.setShowTrade()}}})},setUserShowTrade:function(){$(".dr9 .allsd_list .usersd_list li .sdinfo_bar .fl a").click(function(){tool.tradeForUser=$(this).attr("userId"),tool.initShowTrade(),$(".dr9 .mysd_list .sdinfo .sdinfo_cont .headimg img").attr("src",$(this).attr("avatar")),$(".dr9 .mysd_list .sdinfo .sdinfo_cont span b").text($(this).text()),$(".dr9 .allsd_list").addClass("dn"),$(".dr9 .mysd_list").removeClass("dn")})},showTrade:function(){var e=$("#title").val(),t=$("#userName").val(),i=$("#tradeImg").val(),s=$("#remark").val();if(common.isBlank(e))$("#trade_error").text("请输入标题").show();else if(common.isBlank(t))$("#trade_error").text("请输入晒单人").show();else if(common.isBlank(i))$("#trade_error").text("请上传晒单图片").show();else{var a={groupType:indexJS.userInfo.groupType,userNo:indexJS.userInfo.userId,avatar:$("#avatarInfoId").attr("src"),userName:t,tradeImg:i,remark:s,title:e,tradeType:2};common.getJson("/studio/addShowTrade",{data:JSON.stringify(a)},function(e){e.isOK?($(".sd_result").removeClass("dn").show(),indexJS.userInfo.isSetName||($('#setNkForm input[name="nickname"]').val(t),$("#setNkBtn").click())):box.showMsg(e.msg)})}},showTradePraise:function(){$(".dr9 .sdlistcont ul li .support").click(function(){var e=$(this),t={clientId:indexJS.userInfo.userId,praiseId:$(this).attr("id")};common.getJson("/studio/setTradePraise",{data:JSON.stringify(t)},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("span");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)})},currentDate:function(){return common.formatterDate(indexJS.serverTime,"-")},clearCls:function(e,t){$(e).removeClass(t)},formatHtml:function(e){var t=[];switch(e){case"finance":t.push("<li>"),t.push('   <table cellpadding="0" cellspacing="0" border="0" width="100%" class="calendar_table">'),t.push("       <tr>"),t.push('           <td width="98"><span class="time">{0}</span></td>'),t.push('           <td><img src="http://www.24k.hk/public/economicCalenda/images/country/{1}.png" width="23">{2}</td>'),t.push('           <td width="80"><div class="stars">{3}</div></td>'),t.push("       </tr>"),t.push("       <tr>"),t.push('           <td colspan="3"><span class="tit">{4}</span></td>'),t.push("       </tr>"),t.push("       <tr>"),t.push("           <td>前值:<strong>{5}</strong></td>"),t.push("           <td>预测值:<strong>{6}</strong></td>"),t.push("           <td>公布值:<strong>{7}</strong></td>"),t.push("       </tr>"),t.push("   </table>"),t.push("</li>");break;case"cftcperc":t.push("<tr>"),t.push('   <td width="53"><strong>{0}</strong></td>'),t.push('   <td width="30">{1}%</td>'),t.push('   <td><div class="perc_box"><b style="width:{1}%"></b></div></td>'),t.push('   <td width="30" class="align_r">{2}%</td>'),t.push("</tr>");break;case"cftcdata":t.push("<tr>"),t.push("   <td>{0}</td>"),t.push('   <td align="right">{1}</td>'),t.push('   <td align="right">{2}</td>'),t.push("   <td></td>"),t.push('   <td align="center">{3}</td>'),t.push("</tr>");break;case"download":t.push("<li{0}>"),t.push("   <i{1}></i>"),t.push('   <div class="detail">'),t.push("       <strong>{2}</strong>"),t.push("       <span>{3}<b>{4}</b></span>"),t.push('       <a href="{5}" target="download" download="{6}" class="downbtn" onclick="_gaq.push([\'_trackEvent\', \'pmchat_studio\', \'file_download\',$(this).prev().prev().text()]);"><i></i><span>下载<b>{7}</b></span></a>'),t.push("   </div>"),t.push("</li>");break;case"showTradeAll":t.push("<li>"),t.push('    <span class="sd_tit" title="{0}">{0}</span>'),t.push('    <div class="sdinfo_bar">'),t.push('        <span class="fl">晒单人：<a href="javascript:void(0)" userId="{7}" avatar="{8}">{1}</a></span>'),t.push('        <span class="sd_date">{2}</span>'),t.push("    </div>"),t.push('    <a href="{3}" data-rel="usersd" data-title="{0}" class="lightbox" data-lightbox="dialog-img"><img src="{3}" alt="{0}"><i></i></a>'),t.push('    <p class="sd_skill">{4}</p>'),t.push('    <a href="javascript:void(0)" class="support" id="{6}">(<span>{5}</span>)<i>+1</i></a>'),t.push("</li>");break;case"showTradeUser":t.push("<li{0}>"),t.push('    <i class="state"></i>'),t.push('    <span class="sd_tit" title="{1}">{1}</span>'),t.push('    <a href="{2}" data-rel="usersd" data-title="{1}" class="lightbox" data-lightbox="dialog-img"><img src="{2}" alt="{1}"><i></i></a>'),t.push('    <p class="sd_skill">{3}</p>'),t.push('    <div class="sdbotbar">'),t.push('        <span class="sd_date">{4}</span>'),t.push('        <a href="javascript:void(0)" class="support" id="{6}">(<span>{5}</span>)<i>+1</i></a>'),t.push("    </div>"),t.push("</li>")}return t.join("")},importanceLevel:function(e){var t="";switch(e){case 1:t='<span class="bling">★</span><span>★</span><span>★</span><span>★</span><span>★</span>';break;case 2:t='<span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span><span>★</span>';break;case 3:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span>';break;case 4:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span>';break;case 5:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span>';break;default:t="<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>"}return t}};$(function(){tool.init()});