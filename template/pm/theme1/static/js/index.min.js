function openLive800Chat(t){var e="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";t?location.href=e:window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(t,e){common.isBlank(e)&&(e="800018282");var i="http://crm2.qq.com/page/portalpage/wpa.php?uin="+e+"&cref=&ref=&f=1&ty=1&ap=&as="+t;window.open(i,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(t)}function live800Prompt(t){window.onbeforeunload=null;var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==t)try{UUID.prototype.createUUID();window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(i)}}function qqPrompt(t){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}function UUID(){this.id=this.createUUID()}var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},clientGroupStr:{vip:"VIP会员",active:"激活会员",notActive:"真实会员",simulate:"模拟会员",register:"注册会员",visitor:"游客"},remove:function(t,e){return isNaN(e)||e>t.length?!1:void t.splice(e,1)},joinSplit:function(t){return",".concat(t).concat(",")},isBlank:function(t){return void 0==t||null==t||"undefined"==t||"null"==t||""==$.trim(t)},isValid:function(t){return!this.isBlank(t)},trim:function(t){return this.isBlank(t)?"":t.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(t){return document.createElement("div").appendChild(document.createTextNode(t)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(t){return this.isBlank(t)?"":t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(t,e){e||(e="-"),t instanceof Date||(t=new Date(t));var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate());return i},getHHMMSS:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return e},getMMSS:function(t){return t instanceof Date||(t=new Date(t)),(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},getHHMM:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return e},formatterDateTime:function(t,e){if(e||(e="-"),t instanceof Date||(t=new Date(t)),"Invalid Date"==t)return"";var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return i},longMsTimeToDateTime:function(t,e){var i=new Date(t);return this.formatterDateTime(i,e)},showBox:function(t,e){$(t).slideDown(),$(e||".layer-shadow").show()},hideBox:function(t,e){$(t).slideUp(),$(e||".layer-shadow").hide()},containSplitStr:function(t,e){return common.isBlank(t)||common.isBlank(e)?!1:-1!=(","+t+",").indexOf(","+e+",")},getJson:function(t,e,i,a,s){var n=null;return $.ajax({url:t,type:"POST",timeout:1e5,cache:!1,async:void 0!=a?a:i?!0:!1,dataType:"json",data:e,success:"function"==typeof i?i:function(t){n=t},error:function(e,i){"function"==typeof s?s(i):common.isValid(e.responseText)&&"OK"!=e.statusText?console.error(e.responseText):console.error("请求超时,请重试:url[%s]",t)}}),n},arraySort:function(t,e){return function(i,a){return e?i[t]<a[t]:i[t]>a[t]}},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},isMobilePhone:function(t){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(t)},dateTimeWeekCheck:function(t,e,i){if(this.isBlank(t))return!!e;$.isPlainObject(t)||(t=JSON.parse(t));var a=i?new Date(i):new Date,s=!1,n=this.formatterDate(a);if(s=this.isBlank(t.beginDate)||n>=t.beginDate,s&&(s=this.isBlank(t.endDate)||n<=t.endDate),!s)return!1;var o=t.weekTime;if(this.isBlank(o))return s;var r=null,l=null,c=!1;for(var d in o)if(r=o[d],(!this.isValid(r.week)||a.getDay()==parseInt(r.week))&&(l=this.getHHMMSS(a),c=this.isBlank(r.beginTime)||l>=r.beginTime,c&&(c=this.isBlank(r.endTime)||l<=r.endTime),c))break;return c},arrayUnique:function(t){if(!t)return t;for(var e,i=[],a={},s=0;null!=(e=t[s]);s++)a[e]||(i.push(e),a[e]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(t,e,i){return common.isWebSocket()?(console.log("used websocket!"),t.connect(e.webSocket+"/"+i,{transports:["websocket"]})):t.connect(e.socketIO+"/"+i)},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},clearMsgHtml:function(t){var t=t.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return t&&(t=$.trim(t)),t},formatToJson:function(t){return this.isBlank(t)?null:JSON.parse(t)},getSyllabusPlan:function(t,e,i,a){if(!t||!t.courses)return null;var s=function(t,e){if(t&&3!=e){var s,n=common.isMobile();"object"!=typeof t&&(t=JSON.parse(t));for(var o in t)if(s=t[o],n){if(1==e&&(!i&&3==s.code||i&&4==s.code))return s.url}else if(a){if(1==e&&3==s.code){var r=s.url||"";return r=r.replace(/^http:/,"rtmps:").replace(/\/index\.m3u8$/,"")}}else if(s.code==e)return s.url}return null},n=function(e,i,a){var n=null,o=e.course;return o&&o.length>i?(n=o[i],0==n.status||common.isBlank(n.lecturerId)?null:(n.studioLink=s(t.studioLink,n.courseType),n.startTime=e.startTime,n.endTime=e.endTime,n.day=l[i].day,n.isNext=a,n)):null},o=null;o=this.isValid(t.courses)&&"object"!=typeof t.courses?JSON.parse(t.courses):t.courses;for(var r,l=o.days,c=o.timeBuckets,d=(new Date(e).getDay()+6)%7,u=common.getHHMM(e),h=null,p=null,m=0;m<l.length;m++)if(0!=l[m].status)if(r=(l[m].day+6)%7,r>d){for(var f in c)if(h=c[f],p=n(h,m,!0))return p}else if(r==d)for(var f in c)if(h=c[f],h.startTime<=u&&(h.endTime>=u||"00:00"==h.endTime)?p=n(h,m,!1):h.startTime>u&&(p=n(h,m,!0)),p)return p;if(!t.publishEnd)return null;for(var m=0;m<l.length;m++)if(0!=l[m].status&&(r=(l[m].day+6)%7,!(t.publishEnd<864e5*(r+7-d)+e)))for(var f=0;f<c.length;f++)if(p=n(c[f],m,!0))return p;return null},formatSyllabus:function(t,e,i,a){var s={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},n=new Date(e).getDay(),o=this.getHHMM(e),r=$.extend({},s,a),l=function(t,e,i,a){var s=0,l=(t+6)%7,c=(n+6)%7;return s=l>c?2:c>l?0:a?1:o>=i?0:e>o?2:1,r.courseCls[s]},c=[];try{if(t){var d=$.isPlainObject(t)?t:JSON.parse(t),u=d.days?d.days.length:0;if(u>0)if(1===i){var h={0:"文字",1:"视频",2:"oneTV"};c.push('<div class="sy_panel">');var p=e-864e5*((n+6)%7),m=null,f=null,g=null;c.push('<div class="sy_nav">');for(var v=' style="width:'+100/u+'%;"',b=0;u>b;b++)m=new Date(p+(d.days[b].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),g=d.days[b].day==n?' class="active"':"",c.push('<a href="javascript:void(0)" d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');c.push("</div>"),c.push('<div class="sy_cont"><div>'),c.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var y=null,_=null,b=0;u>b;b++){if(c.push('<tbody d="'+d.days[b].day+'">'),0==d.days[b].status)_=l(d.days[b].day,null,null,!0),c.push('<tr class="'+_+'" width="100%"><td>休市</td></tr>');else for(var x=0,w=d.timeBuckets.length;w>x;x++)y=d.timeBuckets[x],_=l(d.days[b].day,y.startTime,y.endTime,!1),0==y.course[b].status?(c.push('<tr class="'+_+'">'),c.push('<td width="25%">'+y.startTime+"-"+y.endTime+"</td>"),c.push('<td colspan="2" width="75%">休市</td>'),c.push("</tr>")):y.course[b].lecturer&&(c.push('<tr class="'+_+'">'),c.push('<td width="25%">'+y.startTime+"-"+y.endTime+"【"+h[y.course[b].courseType]+"】</td>"),c.push('<td width="25%">'+y.course[b].lecturer+"</td>"),c.push('<td width="50%">'+y.course[b].title+"</td>"),c.push("</tr>"));c.push("</tbody>")}c.push("</table>"),c.push("</div></div>"),c.push("</div>")}else if(2===i){c.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),c.push("<tr>"),c.push("<th>星期\\节次</th>");for(var w=d.timeBuckets?d.timeBuckets.length:0,y=null,_=null,x=0;w>x;x++)y=d.timeBuckets[x],c.push("<th>"+r.indexCN[x]+"<br><span>("+y.startTime+"-"+y.endTime+")</span></th>");c.push("</tr>");for(var I=null,b=0,k=d.days?d.days.length:0;k>b;b++){if(I=d.days[b],c.push("<tr>"),c.push("<th>"+r.dayCN[I.day]+"</th>"),0==I.status)_=l(I.day,null,null,!0),c.push('<td class="'+_+'" colspan="'+w+'">休市</td>');else for(var x=0;w>x;x++)y=d.timeBuckets[x],_=l(I.day,y.startTime,y.endTime,!1),c.push('<td class="'+_+'">'+(0==y.course[b].status?"休市":y.course[b].lecturer)+"</td>");c.push("</tr>")}c.push("</table>")}else if(3===i){var p=o-864e5*((n+6)%7),m=null,g=null,I=null,v=' style="width:'+100/u+'%;"';c.push("<tr>");for(var b=0;u>b;b++)I=d.days[b],m=new Date(p+(d.days[b].day+6)%7*864e5),g=d.days[b].day==n?' class="active"':"",c.push('<th d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<i></i></th>");c.push("</tr>"),c.push('<tr><td class="space" colspan="'+u+'"></td></tr>');for(var y=null,_=null,b=0;u>b;b++){if(I=d.days[b],c.push('<tr d="'+I.day+'"><td colspan="'+u+'">'),0==I.status)_=l(I.day,null,null,!0),c.push('<p class="'+_+'">休市</p>');else for(var x=0,w=d.timeBuckets?d.timeBuckets.length:0;w>x;x++)y=d.timeBuckets[x],y.course[b].lecturer&&(_=l(I.day,y.startTime,y.endTime,!1),c.push('<p class="'+_+'">'),c.push("<span>"+y.startTime+"-"+y.endTime+"</span>"),0==y.course[b].status?c.push("<span>休市</span>"):(c.push("<span>"+r.courseType[y.course[b].courseType]+"</span>"),c.push("<span>"+y.course[b].lecturer+"</span>"),c.push('<span class="item">'+y.course[b].title+"</span>")),c.push("</p>"));c.push("</td></tr>")}}}}catch(S){return console.error("formatSyllabus->"+S),""}return c.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(t,e,i){if(!e)return t;for(var a in t)e.hasOwnProperty(a)&&common.isValid(e[a])&&(t[a]=e[a]);if(i)for(var a in e)t.hasOwnProperty(a)||(t[a]=e[a])},isRightName:function(t){return!/^([0-9]{2,20})$/g.test(t)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(t)},randomIndex:function(t){var e=parseInt(Math.round(Math.random()*t));return e==t&&(e=t-1),0>e?0:e},saveToDesktop:function(t,e){try{var i=new ActiveXObject("WScript.Shell"),a=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+e+".url");a.TargetPath=t,a.Save()}catch(s){return!1}return!0},getUrlParam:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null},keysrt:function(t,e){return function(i,a){return e?~~(i[t]<a[t]):~~(i[t]>a[t])}},newsMarquee:function(t,e,i,a,s,n,o){t&&(clearInterval(t),t=null);var r="object"==typeof i?i:$(i),l="object"==typeof a?a[0]:$(a)[0],c="object"==typeof s?s:$(s),d="object"==typeof n?n:$(n);if(o&&c.children().size()>0?r.show():r.hide(),d.html(""),$(l).unbind("mouseover mouseout"),o){c.css("width","auto"),d.css("width","auto");var u=r.width()-27;c.width()<u&&(c.css("width",u),d.css("width",u)),d.html(c.html());var h=function(){c.width()-l.scrollLeft<=0?l.scrollLeft-=c.width():l.scrollLeft++};t=window.setInterval(h,e),$(l).bind("mouseover",function(){window.clearInterval(t),t=null}).bind("mouseout",function(){t&&(window.clearInterval(t),t=null),t=window.setInterval(h,e)})}},placeholderSupport:function(t){t="object"==typeof t?t:$(t);var e="placeholder"in document.createElement("input");e||t.each(function(){var t=$(this).attr("placeholder");if(t){var e=$(this),i=$('<span class="placeholder">'+t+"</span>");e.before(i),i.bind("click",function(){$(this).hide(),$(this).next().focus()}),e.bind("focus",function(){$(this).prev().hide()}),e.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=e[0].defaultValue&&e.prev().hide(),$(this).attr("placeholder","")}})},openPopup:function(t){t="object"==typeof t?t:$(t),t.show()},isEmail:function(t){return/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(t)},getDateDiff:function(t,e){var i=new Date(t).getTime(),a=new Date(e).getTime(),s=Math.abs(i-a)/864e5;return s},getHourDiff:function(t,e){var i=new Date(t).getTime(),a=new Date(e).getTime(),s=Math.abs(i-a)/36e5;return s=Math.floor(s)},getMinuteDiff:function(t,e){var i=new Date(t).getTime(),a=new Date(e).getTime(),s=Math.abs(i-a)/6e4;return s=Math.floor(s)},addDate:function(t,e){var i=new Date(t);i.setDate(i.getDate()+e);var a=i.getMonth()+1;return i.getFullYear()+"-"+a+"-"+i.getDate()}};window.console||(console=function(){function t(){}function e(){return null==i&&(i=new t),i}var i=null;return t.prototype={log:function(t){},error:function(t){}},e()}()),$.fn.focusEnd=function(){$(this).focus();var t=$("<span/>").appendTo($(this)),e=t.get(0),i=null,a=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(e),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e),a=window.getSelection(),a.removeAllRanges(),a.addRange(i)),t.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var t=this,e=0;e<arguments.length;e++)t=t.replace(new RegExp("\\{"+e+"\\}","g"),null==arguments[e]||void 0==arguments[e]?"":arguments[e]);return t};var _gaq=_gaq||[],_hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(t){var e=new Date(1582,10,15,0,0,0,0),i=new Date,a=i.getTime()-e.getTime(),s=UUID.getIntegerBits(a,0,31),n=UUID.getIntegerBits(a,32,47),o=UUID.getIntegerBits(a,48,59)+"1",r=UUID.getIntegerBits(UUID.rand(4095),0,7),l=UUID.getIntegerBits(UUID.rand(4095),0,7),c=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return(t||"")+s+n+o+r+l+c},UUID.getIntegerBits=function(t,e,i){var a=UUID.returnBase(t,16),s=new Array,n="",o=0;for(o=0;o<a.length;o++)s.push(a.substring(o,o+1));for(o=Math.floor(e/4);o<=Math.floor(i/4);o++)n+=s[o]&&""!=s[o]?s[o]:"0";return n},UUID.returnBase=function(t,e){return t.toString(e).toUpperCase()},UUID.rand=function(t){return Math.floor(Math.random()*(t+1))};var chatAnalyze={localHref:window.location.href,utmStore:{ip:"",storeKey:"GWAFLGPHONECOOIKETRACK",userId:"",roomId:"",groupType:"",speakCount:0,onlineSTM:(new Date).getTime(),onlineETM:0},isLocalHref:function(){return/^https?:\/\/(\d{1,3}\.){3}\d{1,3}.+/.test(chatAnalyze.localHref)},init:function(){if(!this.isLocalHref()){var t="";-1!=chatAnalyze.localHref.indexOf("/studio")?t="studio":-1!=chatAnalyze.localHref.indexOf("/fxstudio")?t="fxstudio":-1!=chatAnalyze.localHref.indexOf("/hxstudio")&&(t="hxstudio"),""!=t&&(this.initGA(t),this.setGA(),this.setBaidu(),window.setTimeout(chatAnalyze.sendUTM(),1e4))}},initGA:function(t){"studio"==t&&(_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"])),"fxstudio"==t&&(_gaq.push(["_setAccount","UA-49389835-1"]),_gaq.push(["_setDomainName","gwfx.com"]),_gaq.push(["_addIgnoredRef","gwfx.com"])),"hxstudio"==t&&(_gaq.push(["_setAccount",""]),_gaq.push(["_setDomainName","handan.hx9999"]),_gaq.push(["_addIgnoredRef","handan.hx9999"])),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"])},setGA:function(){try{var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},setBaidu:function(){try{var t=document.createElement("script");t.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},getIp:function(t){$.getJSON("http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_="+Math.random(),function(e){chatAnalyze.utmStore.ip=e.Ip,t&&t()})},getUTMCookie:function(){for(var t=document.cookie,e=t.split(/[;&]/),i=0;i<e.length;i++){var a=e[i].split("=");if($.trim(a[0])==this.utmStore.storeKey)return a[1]}var s="127.0.0.1";-1!=chatAnalyze.localHref.indexOf("/studio")?s=".24k.hk":-1!=chatAnalyze.localHref.indexOf("/fxstudio")&&(s=".gwfx.com");var n=UUID.prototype.createUUID(-1!=s.indexOf("gwfx")?"":"G");return document.cookie=this.utmStore.storeKey+"="+escape(n)+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/;domain="+s,n},setUTM:function(t,e){try{this.getIp(),t?(this.utmStore.roomId=e.groupId,this.utmStore.userId=e.userId,this.utmStore.userTel=e.userTel,this.utmStore.clientGroup=e.clientGroup,this.utmStore.groupType=e.groupType,$(window).unload(function(){chatAnalyze.utmStore.onlineETM=(new Date).getTime(),chatAnalyze.sendUTM(null),window.event.returnValue=!0})):e.speakCount?this.utmStore.speakCount+=e.speakCount:chatAnalyze.utmStore.ip?chatAnalyze.sendUTM(e):this.getIp(function(){chatAnalyze.sendUTM(e)})}catch(i){console.log("Set UTM fail!"+i)}},utmAjax:function(t,e,i){$.ajax({async:i,url:t+"?t="+(new Date).getTime(),cache:!1,dataType:i?"jsonp":"json",data:{data:JSON.stringify(e)},success:function(t){}})},sendUTM:function(t){try{if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e=chatAnalyze.utmStore;if(!e.roomId||!e.groupType)return;if(!e.userTel&&!e.userId){var i=store.get("storeInfo_"+e.groupType);if(!i)return;e.userId=i.userId}var a=-1!=e.groupType.indexOf("fx")?1:2,s=this.getUTMCookie(),n=this.isLocalHref(),o={userId:s,customerType:e.clientGroup,ip:e.ip,businessPlatform:a,platformType:common.isMobile()?1:0,roomId:e.roomId};e.userTel?o.operationTel=e.userTel:o.visitorId=e.userId;var r=n?"http://testweb.gwfx.com:8088/GwUserTrackingManager_NEW/put/insertChart":"http://das.gwfx.com/put/insertChart";t&&t.courseId?(o.courseId=t.courseId,this.utmAjax(r,o,!0)):(o.startDateTime=e.onlineSTM,o.endDateTime=e.onlineETM,o.speakCount=e.speakCount,navigator.sendBeacon?navigator.sendBeacon(r+"Close",JSON.stringify(o)):this.utmAjax(r,o,!1))}catch(l){console.log("send UTM fail!"+l)}}};$(function(){chatAnalyze.init()});var indexJS={fromPlatform:null,isNeverLogin:!1,serverTime:0,towMinTime:0,socketUrl:"",userInfo:null,filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,syllabusData:null,infoNewCount:0,onlineCsStatus:0,pointLevel:[{points:0,name:"L1"},{points:1e4,name:"L2"},{points:3e4,name:"L3"},{points:5e4,name:"L4"},{points:1e5,name:"L5"},{points:3e5,name:"L6"},{points:5e5,name:"L7"},{points:1e6,name:"L8"},{points:2e6,name:"L9"},{points:4e11,name:"L10"}],init:function(){this.widthCheck(),this.heightCalcu(),this.serverTimeUp(),this.setVisitStore(),this.setEvent(),box.init(),videosTeach.init(),videos.init(),videosLive.init(),videosSubscribe.init(),videosTrain.init(),chatPride.init(),chat.init(),chatTeacher.init(),chatShowTrade.init()},setEvent:function(){$(window).resize(function(t){indexJS.widthCheck(),indexJS.heightCalcu()}),lightbox.option({resizeDuration:200,wrapAround:!0,disableScrolling:!0,positionFromTop:50,albumLabel:"%1 of %2"}),$("#register_a").click(function(){common.openPopup(".blackbg,.register")}),$("#personal_center").click(function(){indexJS.userInfo.isLogin?(chatShowTrade.getPointsInfo(),common.openPopup(".blackbg,.personal_center"),$('#infotab a[t="accountInfo"]').click()):common.openPopup(".blackbg,.login")}),$("#vipbenefit").click(function(){$(".vipbenefit .main_tabnav a:first").click(),common.openPopup(".blackbg,.vipbenefit")}),$("#pointsRule").click(function(){$(".pointrule .main_tabnav a:first").click(),common.openPopup(".blackbg,.pointrule")}),indexJS.setListScroll($(".pointrule .tabcont .scrollbox")),$("#infodown").click(function(){indexJS.userInfo.isLogin?(box.setDownloadPPT(1,box.getDownloadSort()),common.openPopup(".blackbg,.infodown")):common.openPopup(".blackbg,.login")}),$("#live_preview").click(function(){common.openPopup(".blackbg,.live_preview")}),$("#qqcs").click(function(){openQQChatByCommonv3("","800018282")}),$(".main_tabnav a").click(function(){var t=$(this).attr("t");switch($(this).parent().find("a").removeClass("on"),$(this).parent().parent().find(".tabcont .main_tab").removeClass("on"),$(this).addClass("on"),$("div[t="+t+"]").addClass("on"),t){case"livepride":chatPride.setTradeStrategyNote(null,!1);break;case"teacher":chatTeacher.teacherSele="off",chatTeacher.getShowTeacher(null);break;case"showtrade":chatShowTrade.initShowTrade();break;case"mySubscribe":chatShowTrade.getPointsInfo(),videosSubscribe.setSubscribeType();break;case"myPoint":chatShowTrade.getPointsInfo()}$(this).parent().hasClass("vipbene")&&!$(this).hasClass("loaded")&&($(this).addClass("loaded"),box.setVipBeneFit(t)),indexJS.heightCalcu(),"chat"==t&&(chat.showChatMsgNumTip(!0),chat.setTalkListScroll(!0))}),$(".tabnav a.tablink").click(function(){$(this).hasClass("on")||($(this).parent().find(".tablink").removeClass("on"),$(this).parent().parent().find(".tabcont .main_tab").removeClass("on"),$(this).addClass("on"),$(this).hasClass("live")?($(this).addClass("initEasyPieChart"),videos.playAuto(!0)):$(this).hasClass("teach")&&0==$("#teachVideoPanel .sub_tab .numbox .inner").children().size()&&videosTeach.playRandomTeach(!1),$($(this).parent().parent().find(".tabcont .main_tab")[$(this).index()]).addClass("on"))}),$(window).width()>768&&(indexJS.setListScroll($(".tabcont .main_tab .teacherlist .scrollbox")),indexJS.setListScroll($(".pop_train .cont .scrollbox")),indexJS.setListScroll($(".train_detail .cont .scrollbox")),indexJS.setListScroll("#teachVideoPanel .scrollbox")),$(".mod_infotab .tabnav .myaid").click(function(){"vip"==$("#roomInfoId").attr("rt")?indexJS.connectOnlineCs():(0==$(".pletter_win .mult_dialog a[utype=3]").length&&chat.getCSList(),$(this).hasClass("nocs")?box.showTipBox("助理失联中"):common.openPopup(".blackbg,.pletter_win"))}),$(".ietip .iewhybtn").click(function(){$(".ietip").hide(),$(".iestory").show()}),$(".iestory .closebtn").click(function(){$(".iestory").hide(),$(".ietip").show()}),common.placeholderSupport(".formcont .in_line input[placeholder]")},showWelcomeMsg:function(){var t=$(".mod_infotab .sub-tabnav a:contains('专场')");if(1==t.size()){var e=t.siblings(".enterbtn").attr("cgs"),i=t.text();common.containSplitStr(e,indexJS.userInfo.clientGroup)&&alert("您已具备进入“"+i+"”的条件，请关注"+i+"的课程安排。")}},fillCourse:function(){var t=indexJS.syllabusData&&indexJS.syllabusData.courses;if(t){for(var e,i={0:"文字直播",1:"视频直播",2:"oneTV直播"},a=t.days,s=t.timeBuckets,n=$(".live_preview .main_tabnav").html(""),o="",r="",l=new Date(indexJS.serverTime).getDay(),c=indexJS.serverTime-864e5*((l+6)%7),d=(100/a.length,0),u=a.length;u>d;d++){o=0==d?"fir":d==u-1?"last":"nct",r=a[d].day==l?" on":"",e=common.formatterDate(new Date(c+(a[d].day+6)%7*864e5)).substring(5),n.append('<a href="javascript:" class="'+r+'" t="'+d+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_yg_"+d+"', 'content_top', 1, true]);\"><span>"+common.daysCN[a[d].day+""]+"<b>"+e+"</b></span><i></i></a>"),$(".live_preview .tabcont").append('<div class="main_tab'+r+'" t="'+d+'" d="'+a[d].day+'"><ul class="live_prevlist"></ul></div>'),o="";var h=$(".live_preview .tabcont .main_tab:last ul"),p=null;if(1!=a[d].status)h.append('<li><a href="javascript:"><span><lable>休市</lable></span></a></li>');else{o="on";for(var m=0,f=s.length;f>m;m++)p=s[m].course[d],0!=p.status&&p.lecturer&&(h.append('<li class="'+o+'" tuid="'+p.lecturerId+'"><a href="javascript:" st="'+s[m].startTime+'" et="'+s[m].endTime+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_yg_course', '"+p.title+'\', 1, true]);"><i></i><div class="c_name">'+p.title+"<span>"+p.lecturer+'</span><span class="time">'+s[m].startTime+"- "+s[m].endTime+"　</span><span>"+i[p.courseType]+"　</span></div></a></li>"),o="")}}$(".live_preview .main_tabnav a").click(function(){$(".live_preview .main_tabnav a").removeClass("on"),$(".live_preview .tabcont .main_tab").removeClass("on"),$(this).addClass("on"),$(".live_preview .tabcont .main_tab[t="+$(this).attr("t")+"]").addClass("on")}),$(".live_preview .tabcont").css("height","200px"),indexJS.setListScroll(".live_preview .tabcont")}},toRefreshView:function(){window.location.reload()},checkClientGroup:function(t){var e=this.userInfo.clientGroup,i=!1;switch(t){case"visitor":i="visitor"==e;break;case"vip":i="vip"==e||"active"==e;break;case"new":i="vip"!=e&&"active"!=e}return i},serverTimeUp:function(){indexJS.fillCourse(),indexJS.courseTick.tick(),this.towMinTime=this.serverTime,setInterval(function(){indexJS.serverTime+=1e3,indexJS.serverTime-indexJS.towMinTime>=12e4&&(indexJS.towMinTime=indexJS.serverTime),chat.setPushInfo(),indexJS.courseTick.tick()},1e3)},refreshNickname:function(t,e){this.userInfo.isSetName=t,this.userInfo.nickname=e,$(".personal_info .username,.header-right .welcome span").text(e)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfo_"+this.userInfo.groupType,e=store.get(t),i={};if(common.isBlank(e)){var a=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+a,i.userId="visitor_"+a,i.nickname="游客_"+a,i.userType=-1,store.set(t,i)}else i=e;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||$("#contentText").attr("contenteditable",!1).append('<div class="lgtip">亲，<a href="javascript:box.openLgBox();">登录</a> 后可以发言哦~</div>')):(i.loginId=this.userInfo.userId,store.set(t,i)),this.isNeverLogin=!common.isValid(i.loginId),common.isBlank(this.userInfo.nickname)&&"visitor"!=this.userInfo.clientGroup&&this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12))},setScrollStyle:function(t){t.find(".mCSB_dragger_bar").css({background:"url(/pm/theme1/img/scroll.png) -10px 50% repeat-y",width:"6px","-webkit-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px"})},setListScroll:function(t,e,i){var a="object"==typeof t?t:$(t);a.hasClass("mCustomScrollbar")?(a.mCustomScrollbar("update"),common.isValid(e)&&a.mCustomScrollbar("scrollTo",e)):(i=$.extend({scrollButtons:{enable:!0},theme:"light-thick",scrollbarPosition:"outside",scrollButtons:!1},i),a.mCustomScrollbar(i),i.isCustom&&this.setScrollStyle(a))},getArticleList:function(t,e,i,a,s,n,o,r){o=o||{};try{$.getJSON("/studio/getArticleList",{authorId:common.trim(o.authorId),code:t,platform:e,hasContent:i,pageNo:a,pageKey:common.trim(o.pageKey),pageLess:common.trim(o.pageLess),isAll:common.trim(o.isAll),pageSize:s,orderByStr:n,ids:common.isBlank(o.ids)?"":o.ids,callTradeIsNotAuth:o.callTradeIsNotAuth,strategyIsNotAuth:o.strategyIsNotAuth},function(t){r(t)})}catch(l){console.error("getArticleList->"+l),r(null)}},getArticleInfo:function(t,e){try{$.getJSON("/studio/getArticleInfo",{id:t},function(t){e(t)})}catch(i){console.error("getArticleInfo->"+i),e(null)}},setTradeStrategy:function(t){this.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"sequence":"asc","createDate":"desc"}',null,function(e){if(e&&0==e.result){var i=e.data,a=null,s="",n=indexJS.formatHtml("tradestrategy");for(var o in i){a=i[o].detailList[0];var r="",l="";if(common.isBlank(a.author))r=a.authorInfo.name,l=a.authorInfo.avatar;else{var c=a.author.split(";");r=c[0],l=c[1]}var d=common.formatterDateTime(i[o].publishStartDate,"-").substring(0,16);s+=n.formatStr(l,r,d,a.tag,a.title,a.content)}$("#guidelist ul").html(s)}else $("#guidelist ul").html("");indexJS.setListScroll(t)})},connectOnlineCs:function(){switch(indexJS.onlineCsStatus){case 0:indexJS.onlineCsStatus=1;var t="http://jms.phgsa.cn/chat.php?pid=PM01&tln="+indexJS.userInfo.userId+"&tnn="+indexJS.userInfo.nickname+"&tul="+indexJS.userInfo.clientGroup+"&tp="+$("#myMobilePhone").attr("t")+"&ta="+$("#myMobilePhone").attr("ta");LazyLoad.js(t,function(){indexJS.onlineCsStatus=2,$("#welive_info").trigger("click")});break;case 2:$("#welive_info").trigger("click");break;case 1:}},formatHtml:function(t){var e=[];switch(t){case"tradestrategy":e.push('<li class="guideli">'),e.push('    <div class="line1 clearfix">'),e.push('        <img class="himg" src="{0}" alt="{1}">'),e.push('        <h4 class="name">{1}<span class="timespan">{2}</span></h4>'),e.push('        <span class="tag"><i></i>{3}</span>'),e.push("    </div>"),e.push('    <h4 class="gtit"><strong><a href="" target="_blank" class="taglink"></a></strong>{4}</h4>'),e.push('    <div class="g_cont">'),e.push("    <p>{5}</p>"),e.push("    </div>"),e.push("</li>");break;case"news":e.push("<li><span><i></i><b>{0} </b>{1}</span></li>")}return e.join("")},courseTick:{course:null,nextTickTime:0,tick:function(){if(!(indexJS.serverTime<=this.nextTickTime)){var currCourse=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);if(currCourse){var nextTime=0,timezoneOffset=6e4*(new Date).getTimezoneOffset();nextTime=currCourse.isNext?6e4*eval(currCourse.startTime.replace(":","*60+"))+indexJS.serverTime-indexJS.serverTime%864e5+timezoneOffset:6e4*eval(currCourse.endTime.replace(":","*60+"))+indexJS.serverTime-indexJS.serverTime%864e5+timezoneOffset+6e4,this.course=currCourse,this.nextTickTime=nextTime,videos.refreshVideo()}}}},widthCheck:function(){var t=$(window).width();1680>=t&&($("body").addClass("wid1"),1440>t&&($("body").addClass("wid2"),1281>t&&$("body").addClass("wid3"))),t>1680&&($("body").removeClass("wid1"),$("body").removeClass("wid2"),$("body").removeClass("wid3"))},heightCalcu:function(){var t=$(window).height(),e=$(".box-header").height();$(".mod_video").height(t-$(".mod_infotab").height()-e-5),$(".mod_main .tabcont .scrollbox").height(t-$(".main_tabnav").height()-e-16),$(".chat_content .scrollbox").height(t-$(".main_tabnav").height()-201-e-6),$(".sd_list .scrollbox").height(t-$(".main_tabnav").height()-$(".sdbtn_bar").height()-e-6),$(".pop_mysd .sd_list .scrollbox").height(340)}},box={verifyCodeIntMap:{},
toRoomId:null,enable:!0,storeInfoKey:"storeInfo_VerifyCodeTime",init:function(){this.setEvent()},setEvent:function(){$(".tosigninbtn").click(function(){indexJS.userInfo.isLogin?common.getJson("/studio/getSignin",null,function(t){if(null!=t){var e=t.signinInfo,i=t.signinUser,a=0;null!=e&&(a=e.serialSigDays),$(".signinbox .progressbar .barcont .current").text(a+"天");var s=new Date,n=[],o=box.formatHtml("signin");if(null!=i)for(var r in i){var l=i[r],c=null!=l.avatar?l.avatar:"/pm/theme1/img/user.jpg",d=common.getMinuteDiff(s,l.signinTime);d=0>=d?1:d;common.addDate(new Date,1);if(d>59){var u=common.getHourDiff(s,l.signinTime);n.push(o.formatStr(c,u+"小时前"))}else n.push(o.formatStr(c,d+"分钟前"))}$(".signinbox .sign_vistor ul").empty().prepend(n.join("")),$("#sign_vistor").height(75),indexJS.setListScroll($("#sign_vistor"));var h=a/30*100;h>100&&(h=100),$(".signinbox .progressbar .bar").width(h+"%"),common.openPopup(".blackbg,.signin")}else console.log("fail"),box.showMsg(t.msg)}):common.openPopup(".blackbg,.login")}),$(".popup_box .pop_close,.formbtn[t=close]").click(function(){$(this).parent().parent().hide(),$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide(),$(".blackbg form").each(function(){this.reset()})}),$("#prev").click(function(){var t=parseInt($("#page b").text()),e=0;return t>1?(e=t-1,void box.setDownloadPPT(e,box.getDownloadSort())):!1}),$("#next").click(function(){var t=parseInt($("#page b").text()),e=0;return t<parseInt($("#page span").text())?(e=t+1,void box.setDownloadPPT(e,box.getDownloadSort())):!1}),$(".infodown .ranknavbar a.rankbtn").click(function(){$(".infodown .ranknavbar a.rankbtn").removeClass("on"),$(this).addClass("on"),box.setDownloadPPT(1,box.getDownloadSort())}),$(".infodown .ranknavbar .search_bar .sbtn").click(function(){var t=$(".infodown .ranknavbar .search_bar .sinp").val();common.isBlank(t)?$(".infodown .downtable table tbody tr").show():($(".infodown .downtable table tbody tr").hide(),$(".infodown .downtable table tbody tr").each(function(){-1!=$(this).find("td.sname").text().indexOf(t)&&$(this).show()}))}),this.loginEvent(),this.modifyAvatarEvent(),this.modifyUserNameEvent(),this.modifyNickNameEvent(),this.modifyEmailEvent(),this.modifyPasswordEvent()},upgradeEvent:function(){$("#tipbtnId").hover(function(){$(".upg_tip").show()},function(){$(".upg_tip").hide()}),$(".upgradebtn").click(function(){try{$(".upgrade,#up_loading").show(),$.getJSON("/studio/getClientGroupList",null,function(t){if($("#up_loading").hide(),t){$("#upg_tbody_id").html("");var e="",i=0,a=null,s="";for(var n in t)t[n].clientGroupId==indexJS.userInfo.clientGroup&&(i=t[n].sequence);for(var o=0;o<t.length;o++)if(a=t[o],s="",a.clientGroupId==indexJS.userInfo.clientGroup?(e="当前级别",s="current"):e="visitor"!=a.clientGroupId&&i<a.sequence?"vip"==a.clientGroupId?"联系客服升级":'<a href="javascript:" t="'+a.clientGroupId+'">升级</a>':"---",!common.isBlank(common.trim(a.remark))){var r=[];r.push('<tr class="'+s+'"><td><p>'+box.getUserLevelShortName(a.clientGroupId)+'</p></td><td><p class="p2">'+common.trim(a.remark)+"</p></td><td><p>"+common.trim(a.authorityDes)+"</p></td><td>"+e+"</td></tr>"),$("#upg_tbody_id").append(r.join(""))}$("#upg_tbody_id a").click(function(){var t=$(this),e=t.attr("t");common.getJson("/studio/upgrade",{clientGroup:e},function(i){if(t.attr("disabled",!1),i.isOK)"active"===i.clientGroup&&"notActive"===e?$("#studioUpgA").show():$("#studioUpgA").hide(),$(".upgrade,.upgrade_result .fail").hide(),$(".upgrade_result,.upgrade_result .succ").show();else{var a="";"active"===e?a="很遗憾，您未激活金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"notActive"===e?a="很遗憾，您未开通金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"simulate"===e&&(a="很遗憾，您未开通金道模拟交易账户，升级失败！<br>如有疑问请联系客服！"),$(".upgrade_result .succ").hide(),$(".upgrade_result,.upgrade_result .fail").show(),$(".upgrade_result .fail>span").html(a)}},!0,function(e){t.attr("disabled",!1)})})}})}catch(t){$("#up_loading").hide(),console.error("getClientGroupList->"+t)}})},forceLogin:function(t){var e=LoginAuto.get();return"boolean"!=typeof t?e&&1==e.forceLogin:e?(e.forceLogin=t,LoginAuto.set(e)&&t):!1},loginEvent:function(){if($("#loginForm .login_option a").bind("click",function(){var t=$(this).attr("lt");$("#loginForm .login_option a.selected").removeClass("selected"),$(this).addClass("selected"),$("#loginForm .in_line[lt]").hide(),$("#loginForm .in_line[lt='"+t+"']").show(),$("#loginForm .fr[lt]").hide(),$("#loginForm .fr[lt='"+t+"']").show(),$("#loginType").val(t)}),$("#preSetPwdBtn,#preSetPwdBtn2").bind("click",function(){box.openSettingBox("password2")}),$("#popBoxPassword2 .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxPassword2"))){$(this).prop("disabled",!0),$("#popBoxPassword2 .img-loading").show();var t=this;common.getJson("/studio/resetPwd",$("#popBoxPassword2 form").serialize(),function(e){return box.showBoxError($("#popBoxPassword2")),$(t).prop("disabled",!1),$("#popBoxPassword2 .img-loading").hide(),e.isOK?($("#popBoxPassword3_mb").val(e.mobilePhone),void box.openSettingBox("password3")):(box.showBoxError($("#popBoxPassword2"),"<i></i>"+e.msg),!1)},!0,function(e){$(t).prop("disabled",!1),$("#popBoxPassword2 .img-loading").hide()})}}),$("#popBoxPassword3 .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxPassword3"))){$(this).prop("disabled",!0),$("#popBoxPassword3 .img-loading").show();var t=this;common.getJson("/studio/resetPwd",$("#popBoxPassword3 form").serialize(),function(e){return box.showBoxError($("#popBoxPassword3")),$(t).prop("disabled",!1),$("#popBoxPassword3 .img-loading").hide(),e.isOK?(box.showTipBox("重置密码成功，请使用新密码登录！"),void box.openLgBox()):(box.showBoxError($("#popBoxPassword3"),"<i></i>"+e.msg),!1)},!0,function(e){$(t).prop("disabled",!1),$("#popBoxPassword3 .img-loading").hide()})}}),$("#preRegBtn").bind("click",function(){box.openSettingBox("reg")}),$("#reg_login").bind("click",function(){box.openLgBox()}),$("#popBoxRegister .set_submit").click(function(){if(!$(this).prop("disabled")&&box.checkFormInput($("#popBoxRegister"))){$(this).prop("disabled",!0),$("#popBoxRegister .img-loading").show();var t=this;common.getJson("/studio/reg",$("#popBoxRegister form").serialize(),function(e){return box.showBoxError($("#popBoxRegister")),$(t).prop("disabled",!1),$("#popBoxRegister .img-loading").hide(),e.isOK?($(".blackbg,#popBoxRegister").hide(),$("#regLpBtn").attr("href","http://www.24k.hk/activity/studioLottery/index.html?userId="+e.userId+"#ba"),$(".register_result").show(),void 0):(box.showBoxError($("#popBoxRegister"),"<i></i>"+e.msg),!1)},!0,function(e){$(t).prop("disabled",!1),$("#popBoxRegister .img-loading").hide()})}}),$(".register_result .pop_close").bind("click",function(){indexJS.toRefreshView()}),$("#login_a").bind("click",function(t,e){e=e||{},box.toRoomId=e.groupId,box.openLgBox(e.closeable,e.showTip,e.loginTime)}),"visitor"==indexJS.userInfo.clientGroup){var t=$("#roomInfoId").attr("lgt");common.isValid(t)&&(indexJS.currStudioAuth?this.forceLogin()?$("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:t}):window.setTimeout(function(){"visitor"==indexJS.userInfo.clientGroup&&(box.forceLogin(!0),$("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:t}))},60*t*1e3):$("#login_a").trigger("click",{closeable:!1,loginTime:t}))}$("#logout").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href="/studio/logout?platform="+indexJS.fromPlatform}),$("#loginForm .rbtn,#popBoxPassword2 .rbtn,#popBoxRegister .rbtn").click(function(){if(!$(this).hasClass("pressed")){var t=$(this).parents(".popup_box:first"),e=t.find("input[name=mobilePhone]").val();if(!common.isMobilePhone(e))return void box.showBoxError(t,"<i></i>手机号码有误，请重新输入！");$(this).addClass("pressed").html("发送中...");try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:e,useType:$(this).attr("ut")},function(e){e&&0==e.result?(box.showBoxError(t),box.setVerifyCodeTime(t.attr("id"))):("1005"==e.errcode?box.showBoxError(t,"<i></i>"+e.errmsg):console.error("提取数据有误！"),box.resetVerifyCode(t))})}catch(i){box.resetVerifyCode(t),console.error("setMobileVerifyCode->"+i)}}}),$("#loginForm input[name=verifyCode],#setNkForm input[name=nickname],#loginForm input[name=password]").keydown(function(t){return 13==t.keyCode?($(this).parents("form").find(".set_submit").click(),!1):void 0}),$("#logBtnSub").click(function(){if(!$(this).prop("disabled")&&($("#loginForm input[name=clientStoreId]").val(indexJS.userInfo.clientStoreId),box.checkFormInput($("#loginForm")))){$(this).prop("disabled",!0);var t=this;$("#formBtnLoad").show(),common.getJson("/studio/login",$("#loginForm").serialize(),function(e){return $("#loginForm .error").hide(),$(t).prop("disabled",!1),$("#formBtnLoad").hide(),e.isOK?($(".blackbg,#loginBox").hide(),LoginAuto.setAutoLogin($("#autoLogin").prop("checked")),indexJS.userInfo.clientGroup=e.userInfo.clientGroup,box.toRoomId?common.getJson("/studio/checkGroupAuth",{groupId:box.toRoomId},function(t){t.isOK||(indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户方可进入【特别专场】，您还不满足条件。我们将为您自动进入直播大厅。")),indexJS.toRefreshView()},!0,function(t){"success"!=t&&(box.preGroupId=null,alert("操作失败，请联系客服！"))}):(indexJS.showWelcomeMsg(),indexJS.toRefreshView()),void 0):($("#loginForm .error").html("<i></i>"+e.error.errmsg).show(),!1)},!0,function(e){$(t).prop("disabled",!1),$("#formBtnLoad").hide()})}})},getUserLevelShortName:function(t){var e="";switch(t){case"vip":e="l4";break;case"real":e="l3";break;case"active":e="l3";break;case"notActive":e="l3";break;case"simulate":e="l2";break;case"register":e="l1";break;default:e="l0"}return'<i class="level '+e+'"></i>'},checkFormInput:function(t){var e=!0;if(box.showBoxError(t),t.find("input").each(function(){return $(this).is(":visible")?common.isBlank($(this).val())?(("mobilePhone"==this.name||"userId"==this.name)&&box.showBoxError(t,"<i></i>手机号码不能为空！"),"verifyCode"==this.name&&box.showBoxError(t,"<i></i>验证码不能为空！"),"nickname"==this.name&&box.showBoxError(t,"<i></i>昵称不能为空！"),"password0"==this.name&&box.showBoxError(t,"<i></i>原始密码不能为空！"),"password"==this.name&&box.showBoxError(t,"<i></i>密码不能为空！"),"password1"==this.name&&box.showBoxError(t,"<i></i>确认密码不能为空！"),e=!1):"nickname"!=this.name||common.isRightName(this.value)?"password"!=this.name||/^.{6,20}$/.test(this.value)||"loginForm"==t.attr("id")?void 0:(box.showBoxError(t,"<i></i>密码由6至20数字、字母、符号组成！"),e=!1):(box.showBoxError(t,"<i></i>昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!"),e=!1):void 0}),!e)return e;var i=t.find("input[type='password']"),a=i.size();return 2==a&&i.eq(a-2).val()!=i.eq(a-1).val()?(box.showBoxError(t,"<i></i>两次密码输入不一致！"),e=!1):e},setVerifyCodeTime:function(t){var e=$("#"+t+" .rbtn"),i=parseInt(e.attr("t"))||120;this.verifyCodeIntMap[t]||(this.verifyCodeIntMap[t]=setInterval("box.setVerifyCodeTime('"+t+"')",1e3)),i>1?e.attr("t",i-1).html("重新获取("+(i-1)+")"):(clearInterval(this.verifyCodeIntMap[t]),this.verifyCodeIntMap[t]=null,e.attr("t",120).html("获取验证码").removeClass("pressed"))},resetVerifyCode:function(t){var e=t.attr("id");this.verifyCodeIntMap[e]&&(clearInterval(this.verifyCodeIntMap[e]),this.verifyCodeIntMap[e]=null),t.find(".rbtn").attr("t",120).html("获取验证码").removeClass("pressed")},openLgBox:function(t,e,i){t===!1?$(".login .pop_close").hide():$(".login .pop_close").show(),e?(i=i||1,$("#login_tip").show().text($("#setlogintip").text())):$("#login_tip").hide(),$(".popup_box").hide(),common.openPopup(".blackbg,.login")},openSettingBox:function(t){$(".popup_box").hide();var e=null;switch(t){case"reg":e=$("#popBoxRegister");break;case"password1":e=$("#popBoxPassword1");break;case"password2":e=$("#popBoxPassword2");break;case"password3":e=$("#popBoxPassword3");break;case"nickname":e=$("#popBoxNickname")}box&&(box.showBoxError(e),e.find("input[type='text'],input[type='password']").each(function(){$(this).val("")}),e.show(),$(".blackbg").show())},showBoxError:function(t,e){e?t.find(".error").html(e).show():t.find(".error").html("").hide()},refreshVerifyCode:function(){var t=LoginAuto.sessionUser.groupType;$("#verifyCodeId img").attr("src","/"+t+"/getVerifyCode?code=email&v="+Math.random())},modifyAvatarEvent:function(){$("#modifyAvatar").click(function(){var t=$("#fileForm"),e=t.find("input[type=file]");"true"!=t.attr("hasEv")&&(t.attr("hasEv","true"),e.change(function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=e.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var a=new FormData($("#fileForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:a,async:!1,cache:!1,contentType:!1,processData:!1,success:function(e){if(0==e.result){var i=e.data?e.data[0]:null;if(i){var a={item:"register_avatar"};common.getJson("/studio/modifyAvatar",{avatar:i.fileDomain+i.filePath,params:JSON.stringify(a)},function(e){e.isOK?($("#avatarInfoId").attr("src",e.avatar),$("#userListId li .mynk").prev().find("img").attr("src",e.avatar),indexJS.userInfo.avatar=e.avatar,$(t).val("")):console.error("上传头像失败，请联系在线客服！")},!0,function(){alert("上传头像失败，请联系在线客服！")})}}else alert("上传头像失败，请联系在线客服！")},error:function(t){console.error("error:",t)}})}catch(s){console.error("上传图片失败",s)}})),e.click()})},modifyUserNameEvent:function(){$("#setUserName").click(function(){$(this).addClass("dn"),$("#myUserName").removeAttr("disabled").focus(),$("#saveUserName").removeClass("dn")}),$("#saveUserName").click(function(){var t=$("#myUserName").val();if(common.isBlank(t))return void box.showMsg("请输入用户名");$(this).prop("disabled",!0);var e=this;common.getJson("/studio/modifyUName",{params:JSON.stringify({userName:t,item:""})},function(t){return $(e).attr("disabled",!1),t.isOK?(box.showMsg("修改成功"),$("#myUserName").prop("disabled",!0),$("#saveUserName").addClass("dn"),$("#setUserName").removeClass("dn"),void 0):(box.showMsg(t.msg?t.msg:"修改失败，请联系客服！"),!1)},!0,function(t){$(e).attr("disabled",!1)})})},modifyEmailEvent:function(){$("#bindEmail").click(function(){$(this).addClass("dn"),$("#myEmail").removeAttr("disabled").focus(),$("#saveEmail").removeClass("dn")}),$("#saveEmail").click(function(){var t=$("#myEmail").val();if(common.isBlank(t))return void box.showMsg("请输入邮箱地址");if(!common.isEmail(t))return void box.showMsg("邮箱地址有误");$(this).prop("disabled",!0);var e=this;common.getJson("/studio/modifyEmail",{params:JSON.stringify({email:t})},function(t){return $(e).attr("disabled",!1),t.isOK?(box.showMsg(t.msg),$("#myEmail").prop("disabled",!0),$("#saveEmail").addClass("dn"),$("#bindEmail").removeClass("dn"),void 0):(box.showMsg(t.msg?t.msg:"修改失败，请联系客服！"),!1)},!0,function(t){$(e).attr("disabled",!1)})})},modifyNickNameEvent:function(){$("#modifyNk").click(function(){$(this).addClass("dn"),$("#myNickName").removeAttr("disabled").focus(),$("#setNkBtn").removeClass("dn")}),$("#setNkBtn").click(function(){var t=$("#myNickName").val();if(common.isBlank(t))return void box.showMsg("请输入昵称");if(!common.isRightName(t))return void box.showMsg("昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!");$(this).prop("disabled",!0);var e=this;common.getJson("/studio/modifyName",{nickname:t},function(t){return $(e).attr("disabled",!1),t.isOK?(indexJS.refreshNickname(!0,t.nickname),$("#myNickName").prop("disabled",!0),$("#setNkBtn").addClass("dn"),$("#modifyNk").removeClass("dn"),$(".nickNameTip").addClass("dn"),void 0):(box.showMsg(t.msg?t.msg:"修改失败，请联系客服！"),!1)},!0,function(t){$(e).attr("disabled",!1)})})},modifyPasswordEvent:function(){$("#modifyPwd").click(function(){common.openPopup($(".change_psw"))}),$("#savePwd").click(function(){var t=$("#oPwd").val(),e=$("#newPwd").val(),i=$("#newPwd1").val();if(common.isBlank(t)&&"true"==$("#oPwd").attr("s"))return void $(".change_psw .error").html("<i></i>请输入原始密码！").removeClass("dn");if(common.isBlank(e))return void $(".change_psw .error").html("<i></i>请输入新密码！").removeClass("dn");if(!/^.{6,20}$/.test(e))return void $(".change_psw .error").html("<i></i>密码由6至20数字、字母、符号组成！").removeClass("dn");if(common.isBlank(i))return void $(".change_psw .error").html("<i></i>请输入确认新的密码！").removeClass("dn");if(e!=i)return void $(".change_psw .error").html("<i></i>两次密码输入不一致！").removeClass("dn");$(".change_psw .error").addClass("dn"),$(this).prop("disabled",!0);var a=this,s={password:t,newPwd:e,newPwd1:i,item:""};common.getJson("/studio/modifyPwd",{params:JSON.stringify(s)},function(t){return $(a).attr("disabled",!1),t.isOK?(box.openLgBox(!0,!1,null),$("#myPwd").prop("disabled",!0),$(".change_psw").hide(),$('.change_psw form input[type="password"]').val(""),void 0):($(".change_psw .error").html("<i></i>"+(t.msg?t.msg:"修改失败，请联系客服！")).removeClass("dn"),!1)},!0,function(t){$(a).prop("disabled",!1)})})},hideMsg:function(){$("#popMsgBox").is(":visible")&&$("#popMsgBox").fadeOut("normal","swing",function(){$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide()})},showMsg:function(t){"string"==typeof t&&(t={msg:t}),t=$.extend({closeable:!0,title:"",msg:"",modal:!0,delay:0,btns:[{txt:"确定",fn:function(){box.hideMsg()}}]},t),$("#popMsgTit").text(t.title||""),$("#popMsgTxt").text(t.msg);var e=$("#popMsgCont");e.find("a.yesbtn").remove();for(var i=null,a=null,s=0,n=t.btns?t.btns.length:0;n>s;s++)i=t.btns[s],a=$('<a class="yesbtn" href="javascript:void(0)">'+i.txt+"</a>"),e.append(a),a.click(i.fn);t.closeable?$("#popMsgClo").show():$("#popMsgClo").hide(),$("#popMsgBox").show(),t.modal&&$(".blackbg").show(),t.delay&&window.setTimeout(function(){box.hideMsg()},t.delay)},showTipBox:function(t){$(".tipsbox").fadeIn().delay(1e3).fadeOut(200).find(".cont").text(t)},contVerifyCodeTime:function(){var t=$("#loginForm input[name=mobilePhone]").val();if(t&&this.enable){var e=this.storeInfoKey+t,i=store.get(e);if(i>1){var a="#loginForm .rbtn";$(a).attr("t",i).addClass("pressed"),box.setVerifyCodeTime(a)}}},setDownloadPPT:function(t,e){common.isBlank(e)&&(e='{"sequence":"desc","publishStartDate":"desc"}'),indexJS.getArticleList("download",indexJS.userInfo.groupId,1,t,5,e,null,function(t){if($("#totalRecords").text("共"+t.totalRecords),$("#page b").text(t.pageNo),$("#page span").text(Math.ceil(t.totalRecords/5)),t&&0==t.result){var e=t.data,i=null,a=[],s=box.formatHtml("download"),n=$(".downtable table tbody");n.html("");for(var o in e){a=[],i=e[o].detailList[0];var r=e[o].mediaUrl.substring(e[o].mediaUrl.lastIndexOf(".")+1).toLowerCase(),l=i.title+"."+r,c=common.formatterDate(e[o].publishStartDate,"-").replace("-","/").replace("-","/");a.push(s.formatStr(r,i.title,i.authorInfo?i.authorInfo.name:"",c,e[o].point,common.isBlank(e[o].downloads)?0:e[o].downloads,l,e[o]._id,i.remark,common.isBlank(i.remark)?' style="display:none;"':"")),a=$(a.join("")),$(a).find("a.downbtn").data("file_url",e[o].mediaUrl),n.append(a)}box.setDownloads()}})},setDownloads:function(){$(".downtable table tbody a.downbtn").click(function(){var t=$(this),e={groupType:indexJS.userInfo.groupType,item:"used_download",remark:"下载"+t.attr("dn"),val:-parseInt(t.attr("p")),tag:"download_"+t.attr("_id")};common.getJson("/studio/addPointsInfo",{params:JSON.stringify(e)},function(e){return e.isOK?(common.getJson(indexJS.apiUrl+"/common/modifyArticle",{id:t.attr("_id"),type:"downloads"},function(i){i.isOK&&(common.isValid(e.msg)&&"number"==typeof e.msg.change&&box.showMsg("消费"+-e.msg.change+"积分"),t.parent().prev().text(i.num))}),void($.inArray(t.attr("sufix"),["pdf","png","jpg","jpeg","gif"])>-1?window.open(t.data("file_url")):window.location.href=t.data("file_url"))):(box.showMsg(e.msg),!1)})})},getDownloadSort:function(){var t="";switch($(".infodown .ranknavbar a.on").attr("sort")){case"point":t='{"point":"desc"}';break;case"uptime":t='{"createDate":"desc"}'}return t},setVipBeneFit:function(t){common.isBlank(t)&&(t="member_activity"),indexJS.getArticleList(t,indexJS.userInfo.groupId,1,1,1,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var i=e.data[0].detailList[0];$("div[t="+t+"] .benefit_table").html(i.content)}})},formatHtml:function(t){var e=[];switch(t){case"download":e.push("<tr>"),e.push("    <td>{0}</td>"),e.push('    <td class="sname">{1}'),e.push('        <div class="arr"{9}><i></i><i class="i2"></i></div>'),e.push('        <div class="cmbox"{9}>'),e.push('            <div class="cont">'),e.push("                <b>推荐理由：</b>"),e.push("                <p>{8}</p>"),e.push("            </div>"),e.push("        </div>"),e.push("    </td>"),e.push("    <td>{2}</td>"),e.push("    <td>{3}</td>"),e.push("    <td>{4}积分</td>"),e.push("    <td>{5}</td>"),e.push('    <td><a href="javascript:void(0);" target="download" dn="{6}" p="{4}" _id="{7}" class="downbtn" sufix="{0}" onclick="_gaq.push([\'_trackEvent\', \'pmchat_studio\', \'header_zl_download\', \'content_top\', 1, true]);">下载</a></td>'),e.push("</tr>");break;case"signin":e.push("<li>"),e.push('     <div class="himg"><img src="{0}" alt=""></div>'),e.push("     <span>{1}</span>"),e.push("</li>")}return e.join("")}},videos={init:function(){return this.rollNews.bindEvents(),this.playlist.init(),this.playAuto(!1),this},player:{currVideo:{},sewisePlayer:null,blwsPlayer:null,playByIframe:function(t){this.clear(),$("#videoPlayerPanel").append('<iframe frameborder=0 width="100%" height="100%" src="'+t+'" allowfullscreen></iframe>')},playByBLWS:function(t){var e=t.split("&");if(e.length>1){var i=e[1].replace(/^vid=/g,"");this.clear(),this.blwsPlayer?this.blwsPlayer.changeVid(i):this.blwsPlayer=polyvObject("#videoPlayerPanel").videoPlayer({width:"100%",height:"100%",vid:i,flashvars:{autoplay:"0",setScreen:"fill"},onPlayOver:function(t){}})}},playBySewise:function(t,e){this.clear(),this.sewisePlayer=new Sewise.SewisePlayer({elid:"videoPlayerPanel",autostart:!0,url:t,title:e,skin:"vodWhite",localPath:"/base/lib/sewise/"}),this.sewisePlayer.startup()},playByEmbed:function(t){this.clear();var e=[];e.push('<embed src="'),e.push(t),e.push('" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'),$("#videoPlayerPanel").append(e.join(""))},clear:function(){$("#videoPlayerPanel").empty()},play:function(t,e){if(t){if(this.currVideo.url==t&&this.currVideo.title==e)return;this.currVideo={url:t,title:e},/\.html/.test(t)?this.playByIframe(t):/type=blws/.test(t)?this.playByBLWS(t):/\.swf/.test(t)?this.playByEmbed(t):/rtmp/.test(t)?obsPlayer.init(t,"videoPlayerPanel",!0):this.playBySewise(t,e),videos.setStudioInfo(!1)}}},playlist:{init:function(){indexJS.setListScroll($(".mod_livelist .livetab .scrollbox")),this.initToday(indexJS.syllabusData&&indexJS.syllabusData.courses),this.setEvent()},initToday:function(t){if($("#playlist_panel ul[t='today']").html(""),t){for(var e,i=new Date(indexJS.serverTime).getDay(),a=t.days,s=t.timeBuckets,n=[],o=0,r=0,l=a.length;l>r;r++)if(a[r].day==i&&1==a[r].status){for(var c=0,d=s.length;d>c;c++)e=s[c].course[r],0!=e.status&&e.lecturer&&(o++,n.push('<li class="" st="'+s[c].startTime+'" et="'+s[c].endTime+'">'),n.push('<span class="fl">'),n.push("<b>"+o+"</b>"),n.push(e.title),n.push("</span>"),n.push('<span class="fr">'),n.push(s[c].startTime+"-"+s[c].endTime),n.push("</span></li>"));$("#playlist_panel ul[t='today']").html(n.join(""));break}this.refreshStyle(),window.setTimeout(function(){$("#playlist_hide").trigger("click")},5e3)}},initYesterday:function(){$("#playlist_panel ul[t='yesterday']").html(""),$.getJSON("/studio/getSyllabusHis",{groupType:indexJS.userInfo.groupType,groupId:indexJS.userInfo.groupId},function(t){if(t){for(var e=null,i=[],a=0,s=t.length;s>a;a++)e=t[a],i.push('<li class="" st="'+e.startTime+'" et="'+e.endTime+'">'),i.push('<span class="fl">'),i.push("<b>"+a+"</b>"),i.push(e.title),i.push("</span>"),i.push('<span class="fr">'),i.push(e.startTime+"-"+e.endTime),i.push("</span></li>");$("#playlist_panel ul[t='yesterday']").html(i.join(""))}})},setEvent:function(){$("#playlist_nav a").bind("click",function(){var t=$(this).attr("t");$(this).addClass("on").siblings().removeClass("on"),$("#playlist_panel ul[t!='"+t+"']").hide(),$("#playlist_panel ul[t='"+t+"']").show()}),$("#playlist_hide").bind("click",function(){$("#playlist_min").show(),$("#playlist_max").hide()}),$("#playlist_show").bind("click",function(){$("#playlist_min").hide(),$("#playlist_max").show()})},refreshStyle:function(){var t=common.getHHMM(indexJS.serverTime);$("#playlist_panel ul[t='today'] li").each(function(){t<$(this).attr("st")?$(this).attr("class",""):t<$(this).attr("et")?$(this).attr("class","on"):$(this).attr("class","over")})}},rollNews:{newMarIntervalId:null,bindEvents:function(){$(".mod_scrollnews .newsclose").click(function(){$(".mod_scrollnews .newslist").hide(),$(".mod_scrollnews .newsbtn").show(),clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null}),$(".mod_scrollnews .newsbtn").click(function(){$(this).hide(),$(".mod_scrollnews .newslist").slideDown(),videos.rollNews.newsMarquee(!0)}),$("#newscont1 a").live("click",function(){return"false"===$(this).attr("url")?($("#popMsgTit").text($(this).attr("title")),$("#popMsgTxt").html($(this).data("content")||"没有内容"),$("#popMsgBox,.blackbg").show(),indexJS.setListScroll(".popMsgBox"),!1):void 0}),$("#newscont2 a").live("click",function(){return"false"===$(this).attr("url")?($("#newscont1 a[tid='"+$(this).attr("tid")+"']").trigger("click"),!1):void 0})},update:function(t){var e=$("#newscont1");if(t["delete"]){var i=t.ids.split(",");if(i.length>0)for(var a=0;a<i.length;a++)e.find('a[tid="'+i[a]+'"]').remove()}else if(t.edit){t.isValid="true"==t.isValid?!0:!1,!t.isValid||indexJS.userInfo.clientGroup&&t.clientGroup&&-1!=$.inArray(indexJS.userInfo.clientGroup,t.clientGroup)||(t.isValid=!1);var s=e.find('a[tid="'+t.id+'"]');if(t.isValid)if(s.size()>0)common.isValid(t.url)?s.attr({title:t.title,href:t.url,url:"true"}).html("<i></i><span>"+t.title+"</span>"):s.attr({title:t.title,url:"false"}).html("<i></i><span>"+t.title+"</span>").data("content",t.content);else{var n=$('<a href="javascript:void(0);" tid="'+t.id+'" title="'+t.title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_sp_zimutxt', 'content_left', 1, true]);\"><i></i><span>"+t.title+"</span></a>");common.isValid(t.url)?n.attr({href:t.url,url:"true"}):n.attr({url:"false"}).data("content",t.content),e.append(n)}else s.size()>0&&s.remove()}else if(t.infos){var o=t.infos.length,n=null;if(o>0)for(var a=0;o>a;a++)indexJS.userInfo.clientGroup&&t.infos[a].clientGroup&&$.inArray(indexJS.userInfo.clientGroup,t.infos[a].clientGroup)>-1&&1==t.infos[a].pushType&&t.infos[a].contentId&&t.infos[a].title&&(common.isValid(t.infos[a].url)?n=$('<a href="'+t.infos[a].url+'" url="true" tid="'+t.infos[a].contentId+'" title="'+t.infos[a].title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_sp_zimutxt', 'content_left', 1, true]);\"><i></i><span>"+t.infos[a].title+"</span></a>"):(n=$('<a href="javascript:void(0);" url="false" tid="'+t.infos[a].contentId+'" title="'+t.infos[a].title+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_sp_zimutxt', 'content_left', 1, true]);\"><i></i><span>"+t.infos[a].title+"</span></a>"),n.data("content",t.infos[a].content)),e.append(n))}this.newsMarquee(!0)},newsMarquee:function(t){videos.rollNews.newMarIntervalId&&(clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null);var e=30,i=$(".mod_scrollnews"),a=$("#scrollnews_demo")[0],s=$("#newscont1"),n=$("#newscont2");if(t&&s.children().size()>0?i.show():i.hide(),n.html(""),$(a).unbind("mouseover mouseout"),t){s.css("width","auto"),n.css("width","auto");var o=i.width()-27;s.width()<o&&(s.css("width",o),n.css("width",o)),n.html(s.html());var r=function(){s.width()-a.scrollLeft<=0?a.scrollLeft-=s.width():a.scrollLeft++};videos.rollNews.newMarIntervalId=window.setInterval(r,e),$(a).bind("mouseover",function(){window.clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null}).bind("mouseout",function(){videos.rollNews.newMarIntervalId&&(window.clearInterval(videos.rollNews.newMarIntervalId),videos.rollNews.newMarIntervalId=null),videos.rollNews.newMarIntervalId=window.setInterval(r,e)})}}},playAuto:function(t){var e=indexJS.courseTick.course;!e||e.isNext||0!=e.courseType&&3!=e.courseType&&common.isBlank(e.studioLink)?t?this.setStudioInfo(e):(this.setStudioInfo(!1),videosTeach.playRandomTeach(!0)):0==e.courseType?this.setStudioInfo(e):(this.setStudioInfo(!1),this.player.play(e.studioLink,e.title)),videos.rollNews.newsMarquee(e&&1==e.courseType),this.refreshCourseStyle(e)},refreshVideo:function(){var t=indexJS.courseTick.course;$(".tabnav a.tablink.live").is(".on")?this.playAuto(!0):this.refreshCourseStyle(t)},refreshCourseStyle:function(t){this.playlist.refreshStyle();var e=$("#roomList_panel a.on>i");!t||t.isNext?e.removeClass("living"):e.addClass("living"),$("#course_panel li.on").removeClass("on"),t&&$("#course_panel .main_tab[d="+t.day+"]").find('li a[st="'+t.startTime+'"][et="'+t.endTime+'"]').parent().addClass("on")},setStudioInfo:function(t){return t===!1?void $("#nextCourse").hide():($("#nextCourse").show(),videos.player.clear(),t?void((t.isNext||0==t.courseType)&&videos.setNextCourse(t)):($("#nextCourse").find(".ntext").text("当前暂无直播"),void $("#nextCourse .nextbox").hide()))},setNextCourse:function(t,e){if(t){var i="当前暂无直播，请关注下节课";t.isNext||0!=t.courseType||(i="当前正在文字直播"),$("#nextCourse").find(".ntext").text(i),$("#nextCourse .nextbox").show(),$("#nextCourse").find(".t_name").text(t.lecturer),$("#nextCourse").find(".live_name").text(t.title),$("#nextCourse").find(".time").text(common.daysCN[t.day]+" "+t.startTime+" - "+t.endTime);var a=$("#nextCourse").find(".tec_head"),s=a.data("avatars")||{},n=t.lecturerId||"";n=n.replace(/(,\w+)*$/g,"");var o=a.data("lecturerId");o!=n&&n&&(s.hasOwnProperty(o)?a.find("img").attr("src",s[o]):(a.data("lecturerId",n),$.getJSON("/studio/getUserInfo",{uid:n},function(t){if(t&&t.userNo){var e=$("#nextCourse").find(".tec_head"),i=e.data("avatars")||{};i[t.userNo]=t.avatar||"",e.data("avatars",i),e.data("lecturerId")==t.userNo&&e.find("img").attr("src",i[t.userNo])}})))}$("#lvVideoId").hide(),$("#nextCourse").show()},refreshStudioInfoAvatar:function(t){$("#nextCourse").find("img").attr("src",t)}},videosLive={init:function(){this.setEvent(),this.getMarketPrice(),this.setCftcCot(),this.setSymbolOpenPositionRatios()},setEvent:function(){$(".tabcont .main_tab .s1 a").click(function(){if($(this).hasClass("on"))return!1;var t=$(this),e=$(this).attr("cgs");if("false"==t.attr("av")&&indexJS.checkClientGroup("visitor"))return $("#login_a").trigger("click",{groupId:t.attr("rid")}),!1;if(!common.containSplitStr(e,indexJS.userInfo.clientGroup))return indexJS.checkClientGroup("vip")?("train"==t.attr("rt")?box.showMsg({title:t.find("b").text(),msg:"该房间仅对培训班学员开放,"}):box.showMsg({title:t.find("b").text(),msg:"该房间仅对新客户开放,"}),$("#popMsgTxt").append("<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。"),$("#popMsgCont .yesbtn").bind("click",function(){videosLive.contactTeacher(),_gaq.push(["_trackEvent","pmchat_studio","left_zb_confirm","content_left",1,!0])})):(box.showMsg({title:t.find("b").text(),msg:"已有真实账户并激活的客户才可进入Vip专场，您还不满足条件,"}),$("#popMsgTxt").append("<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。"),$("#popMsgCont .yesbtn").bind("click",function(){videosLive.contactTeacher(),_gaq.push(["_trackEvent","pmchat_studio","left_zb_confirm","content_left",1,!0]);
})),!1;if("2"==t.attr("st")){if("train"==t.attr("rt")){if("-1"==t.attr("ha")){if("true"!=t.attr("sp")){$(".train_detail .pop_tit label").text($(this).text());var i=$(this).attr("userno");$("#train_info_id").empty().load("/studio/getTrDetail?uid="+i,function(){$('#train_info_id .scrollbox[tid="'+i+'"]').show()}),common.openPopup(".blackbg,.train_detail")}else box.showTipBox("您没有访问该房间的权限，请联系客服！");return!1}return chatTeacher.trainRegis(t),!1}if("-1"==t.attr("ha"))return box.showTipBox("您没有访问该房间的权限，请联系客服！"),!1}common.getJson("/studio/checkGroupAuth",{groupId:t.attr("rid")},function(e){e.isOK?indexJS.toRefreshView():indexJS.checkClientGroup("vip")?("train"==t.attr("rt")?box.showMsg({title:t.find("b").text(),msg:"该房间仅对培训班学员开放,"}):box.showMsg({title:t.find("b").text(),msg:"该房间仅对新客户开放,"}),$("#popMsgTxt").append("<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。"),$("#popMsgCont .yesbtn").bind("click",function(){videosLive.contactTeacher(),_gaq.push(["_trackEvent","pmchat_studio","left_zb_confirm","content_left",1,!0])})):"train"==t.attr("rt")?common.getJson("/studio/getchatGroupByGroupId",{groupId:t.attr("rid")},function(e){for(var i=e.traninClient,a=!1,s=0;s<i.length;s++){var n=i[s];if(indexJS.userInfo.userId==n.clientId){a=!0;break}}if(a)if(e.point&&Math.abs(e.point)>0){var o=",是否消耗"+e.point+"积分直接进入房间?";box.showMsg({title:t.find("b").text(),msg:"您未报名培训班或者未通过审核"+o}),$("#popMsgTxt").append("<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。"),$("#popMsgCont .yesbtn").bind("click",function(){var i=e.point;if(0!=i){var a={groupType:indexJS.userInfo.groupType,item:"prerogative_room",tag:"user_"+indexJS.userInfo.userId,val:-e.point,groupId:t.attr("rid")};common.getJson("/studio/addPointsInfo",{params:JSON.stringify(a)},function(t){t.isOK?common.getJson("/studio/updateSession",{params:JSON.stringify(a)},function(t){t.isOK&&indexJS.toRefreshView()}):box.showTipBox(t.msg)})}else common.getJson("/studio/updateSession",{params:JSON.stringify(a)},function(t){t.isOK&&indexJS.toRefreshView()})})}else indexJS.toRefreshView()}):(box.showMsg({title:t.find("b").text(),msg:"已有真实账户并激活的客户才可进入Vip专场，您还不满足条件,"}),$("#popMsgTxt").append("<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。"),$("#popMsgCont .yesbtn").bind("click",function(){videosLive.contactTeacher(),_gaq.push(["_trackEvent","pmchat_studio","left_zb_confirm","content_left",1,!0])}))},!0,function(e){"success"!=e&&(box.showMsg({title:t.find("b").text(),msg:"操作失败,"}),$("#popMsgTxt").append("<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。"),$("#popMsgCont .yesbtn").bind("click",function(){videosLive.contactTeacher(),_gaq.push(["_trackEvent","pmchat_studio","left_zb_confirm","content_left",1,!0])}))})}),indexJS.setListScroll($(".tabcont .main_tab .infocont .rbox .scrollbox"))},getMarketPrice:function(){var t="ws://kdata.gwfx.com:8087/websocket.do",e="service=HqDataWebSocketService&method=pushMarketprice&symbol=XAGUSD|XAUUSD|USDX|CLWTI&dataType=simpleMarketPrice",i="http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getMarkrtPriceDataFromCache",a={from:"studio",fall:"fall"};getAllMarketpriceIndex(t,e,i,a)},setCftcCot:function(){$.getJSON("/studio/get24kCftc",null,function(t){var e={gold:"伦敦金",silver:"伦敦银"};if(null!=t&&t){var i="",a=videosLive.formatHtml("cftcperc");$.each(e,function(e,s){var n=t[e]["long"],o=t[e]["short"],r=parseInt(n)+parseInt(o),l=Math.round(parseInt(n)/r*100),c=Math.round(parseInt(o)/r*100);i+=a.formatStr(l,c,s),$("#ratioInfoUpdateTime").text("上次更新时间："+t[e].updatetime+" "+common.getHHMM(new Date)+" GMT+0800")}),$(".rbox .infobox .ratioInfo").html(i),videosLive.initEasyPieChart(function(){})}else videosLive.setCftcCot()})},initEasyPieChart:function(t){if($(".tabnav .live").hasClass("initEasyPieChart"))t();else{var e=[];$.browser.msie&&e.push("/base/lib/excanvas.compiled.js"),e.push("/base/lib/jquery.easy-pie-chart.min.js"),LazyLoad.js(e,function(){$(".percentage").easyPieChart({barColor:"#e34b51",trackColor:"#2bb38a",scaleColor:!1,lineCap:"square",lineWidth:2,animate:1e3,size:65}),t()})}},setSymbolOpenPositionRatios:function(){var t={LLS:"伦敦银",LLG:"伦敦金"};$.getJSON("/studio/getSymbolOpenPositionRatios",null,function(e){if(null!=e&&"SUCCESS"==e.code){var i=e.result,a=[],s=videosLive.formatHtml("symbolOpenPositionRatios");$.each(i,function(e,i){a.push(s.formatStr(t[i.symbol],i.openPositionRatios)),$("#percentInfoUpdateTime").text("上次更新时间："+common.formatterDate(i.date.time)+" "+common.getHHMM(new Date)+" GMT+0800")}),$(".rbox .infobox .percentInfo").html(a.join(""))}})},formatHtml:function(t){var e=[];switch(t){case"cftcperc":e.push('<div class="ratiobox">'),e.push('    <div class="data">'),e.push("        <span>多头<b>{0}</b>%</span><br>"),e.push('        <span class="b">空头<b>{1}</b>%</span>'),e.push("    </div>"),e.push('    <div class="percentage easyPieChart" data-percent="{1}">'),e.push('        <b class="rationame">{2}</b>'),e.push("    </div>"),e.push("</div>");break;case"symbolOpenPositionRatios":e.push('<div class="perbox">'),e.push('    <span class="pname">{0}</span>'),e.push('    <span class="pervalue">{1}%</span>'),e.push('    <div class="main"><b class="bar" style="width:{1}%"></b></div>'),e.push("</div>")}return e.join("")},contactTeacher:function(){0==$(".pletter_win .mult_dialog a[utype=3]").length&&chat.getCSList(),$(this).hasClass("nocs")?box.showTipBox("助理失联中"):common.openPopup(".blackbg,.pletter_win"),$("#popMsgBox").hide()}},videosTeach={init:function(){this.setEvent()},setEvent:function(){$("#teachVideoId a").bind("click",function(t,e,i){$("#teachVideoId a").removeClass("on");var a=$(this);videosTeach.setVideoList(a.addClass("on").attr("t"),function(){"function"==typeof e&&e(i)})})},setVideoList:function(t,e){var i=$("#teachVideoPanel .sub_tab .numbox .inner"),a=$("#teachVideoPanel").attr("t");a!=t&&($("#teachVideoPanel").attr("t",t),i.html(""),indexJS.getArticleList(t,indexJS.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){if(t&&0==t.result){var a,s=t.data;for(var n in s)a=s[n].detailList[0],i.append('<div title="'+a.title+'" class="c_num"><a href="javascript:void(0);" title="'+a.title+'" ct="'+s[n].categoryId+'" id="'+s[n]._id+'" t="'+(common.isValid(s[n].mediaUrl)&&-1!=s[n].mediaUrl.indexOf(".mp4")?"mp4":"")+'" vUrl="'+s[n].mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_jx_video', '"+a.title+"', 1, true]);\">"+(parseInt(n)+1)+"</a></div>");videosTeach.numSlide(0),$("#teachVideoPanel .numbox .c_num a").click(function(){$("#teachVideoPanel .numbox .c_num a").removeClass("on"),$(this).addClass("on"),videos.player.play($(this).attr("vurl"),$(this).attr("title"));var t=$(this).attr("id");$("#tvInfoId").attr("tid")!=t&&(indexJS.getArticleInfo(t,function(t){if(t){$("#tvInfoId").attr("tid",t._id);var e=t.detailList[0];common.isBlank(t.mediaImgUrl)?$("#tvInfoId .cpic img").hide():$("#tvInfoId .cpic img").attr("src",t.mediaImgUrl).show(),$("#tvInfoId .introtext p").text(e.remark)}}),indexJS.setListScroll("#teachVideoPanel .scrollbox"),chatAnalyze.setUTM(!1,{courseId:t}))}),"function"==typeof e&&e()}}))},playRandomTeach:function(t,e){var i=function(t){var e=$("#teachVideoPanel .numbox .c_num a");if(t||(e=e.filter("[t='mp4']")),e.size()>0){var i=common.randomIndex(e.size()),a=e.eq(i);a.trigger("click")}};if($("#teachVideoId a.on").size()>0)i(e);else{var a=$("#teachVideoId a"),s=common.randomIndex(a.size());t?a.eq(s).trigger("click",[i,e]):a.eq(s).trigger("click")}$(".tabnav a.teach").is(".on")||$(".tabnav a.teach").trigger("click")},numSlide:function(t){var e=0,i=$($(".teachlive .sub_tab")[t]),a=$(".courseNum .c_num").width(),s=$(i).find(".courseNum .c_num").size();$(i).find(".courseNum .inner").width(function(){return s*a}),$(i).find(".numctrl.next").click(function(){$(i).find(".courseNum .inner").width()-e*a-$(i).find(".courseNum .numbox").width()>0&&(e++,$(i).find(".courseNum .inner").animate({left:-e*a},"slow"))}),$(i).find(".numctrl.prev").click(function(){0!=e&&(e--,$(i).find(".courseNum .inner").animate({left:-e*a},"slow"))})}},videosSubscribe={subscribeData:null,init:function(){this.setEvent()},setEvent:function(){$("#subscribe").click(function(){indexJS.userInfo.isLogin?(common.openPopup(".blackbg,.personal_center"),$('#infotab a[t="mySubscribe"]').click()):common.openPopup(".blackbg,.login")})},setSubscribe:function(){common.getJson("/studio/getSubscribe",{params:JSON.stringify({groupType:indexJS.userInfo.groupType})},function(t){null!=t&&(videosSubscribe.subscribeData=t,$.each(t,function(t,e){var i=e.analyst.split(","),a=e.noticeType.split(",");$('input[name="'+e.type+'_analysts"]').val(e.analyst),$('input[name="'+e.type+'_noticeTypes"]').val(e.noticeType),$.each(i,function(t,i){$("#"+i+"_"+e.type).prop("checked",!0)}),$.each(a,function(t,i){$("#"+i+"_"+e.type).prop("checked",!0)});var s=$("#week_"+e.type).parent().parent().parent(),n=$("#month_"+e.type).parent().parent().parent();common.getDateDiff(e.startDate,e.endDate)>7?($("#month_"+e.type).prop("checked",!0),n.children("div.item").hide(),n.children("div.item").hide(),n.children("div.mydytime").html(common.formatterDate(e.startDate,"/")+" <b>至</b> "+common.formatterDate(e.endDate,"/")).removeClass("dn")):($("#week_"+e.type).prop("checked",!0),s.children("div.item").hide(),s.children("div.item").hide(),s.children("div.mydytime").html(common.formatterDate(e.startDate,"/")+" <b>至</b> "+common.formatterDate(e.endDate,"/")).removeClass("dn")),$(".dytable ."+e.type+' a[t="'+e.type+'"]').attr({id:e._id,orip:e.point})}))})},setSubscribeType:function(){common.getJson("/studio/getSubscribeType",{params:JSON.stringify({groupType:indexJS.userInfo.groupType})},function(t){if(null!=t){var e=[],i=videosSubscribe.formatHtml("subscribeType"),a=videosSubscribe.formatHtml("analysts"),s=(videosSubscribe.formatHtml("analyst"),videosSubscribe.formatHtml("noticeTypes")),n=(videosSubscribe.formatHtml("noticeType"),videosSubscribe.formatHtml("noticeCycle")),o=videosSubscribe.formatHtml("subscribeBtn");cls1=cls2="",$.each(t,function(t,r){var l=[],c=[],d=[],u=[],h=JSON.parse(r.analysts);h.length;$.each(h,function(t,e){var i=e.name;e.name.indexOf("(")>-1&&(i=e.name.substring(0,e.name.indexOf("("))),l.push(a.formatStr(e.userId,i,e.point,r.code))});var p=JSON.parse(r.noticeTypes),m=p.length;if($.each(p,function(t,e){0==t&&c.push('<div class="itembox w1">'),c.push(s.formatStr(e.type,e.name,e.point,r.code)),t==m-1&&(c.push("</div>"),u.push(o.formatStr(r.code,r.name,r.analysts,r.noticeTypes,r.noticeCycle)))}),common.isValid(r.noticeCycle)){cls2=" w1";var f=JSON.parse(r.noticeCycle);$.each(f,function(t,e){d.push(n.formatStr(e.cycle,e.name,e.point,r.code))})}e.push(i.formatStr(r.name,l.join(""),c.join(""),d.join(""),u.join(""),cls1,cls2,r.code))}),$(".dytable .tody tbody").html(e.join("")),indexJS.setListScroll($("#dy-scbox")),videosSubscribe.setSubscribeEvent(),videosSubscribe.setSubscribe()}})},setSubscribeEvent:function(){$('.dytable .tody input[type="checkbox"],.dytable .tody input[type="radio"],.dytable .pdbox a').unbind("click"),$('.dytable .tody input[type="checkbox"],.dytable .tody input[type="radio"],.dytable .pdbox a').click(function(){var t=0,e=[],i=[];$('.dytable .tody tr[t="'+$(this).attr("t")+'"] input[t="'+$(this).attr("t")+'"]').each(function(){$(this).is(":checked")&&(t+=parseInt($(this).attr("p")),"analyst"==$(this).attr("name")&&e.push($(this).val()),"noticeType"==$(this).attr("name")&&i.push($(this).val()))}),$('input[name="'+$(this).attr("t")+'_analysts"]').val(e.join(",")),$('input[name="'+$(this).attr("t")+'_noticeTypes"]').val(i.join(",")),$(".dytable ."+$(this).attr("t")+" b").text(t+"分"),$(".dytable ."+$(this).attr("t")+' a[t="'+$(this).attr("t")+'"]').attr("p",t)}),$(".dytable .pdbox a").unbind("click"),$(".dytable .pdbox a").click(function(){var t=$(this);if(t.hasClass("clicked"))return!1;t.addClass("clicked");var e={groupType:indexJS.userInfo.groupType,type:t.attr("t"),point:common.isBlank(t.attr("p"))?0:parseInt(t.attr("p"))};if(e.noticeCycle=common.isBlank($('input[name="noticeCycle_'+t.attr("t")+'"]:checked').val())?"":$('input[name="noticeCycle_'+t.attr("t")+'"]:checked').val(),e.analyst=$('input[name="'+t.attr("t")+'_analysts"]').val(),e.noticeType=common.isBlank($('input[name="'+t.attr("t")+'_noticeTypes"]').val())?t.attr("nts"):$('input[name="'+t.attr("t")+'_noticeTypes"]').val(),e.pointsRemark="订阅"+t.attr("tn"),e.id=common.isBlank(t.attr("id"))?"":t.attr("id"),e.orip=common.isBlank(t.attr("orip"))?0:t.attr("orip"),common.isBlank($("#myEmail").val())&&$.inArray("email",e.noticeType.split(","))>-1)box.showMsg("请先绑定邮箱！"),$('#infotab a[t="accountInfo"]').click();else if(common.isBlank(e.id)&&common.isBlank(e.analyst))box.showMsg("请选择订阅老师！");else if(common.isBlank(e.id)&&common.isBlank(e.noticeType))box.showMsg("请选择订阅方式！");else if(common.isBlank(e.id)&&common.isBlank(e.noticeCycle))box.showMsg("请选择订阅周期！");else{(common.isBlank(e.analyst)||common.isBlank(e.noticeType))&&(e.point=0,e.analyst="",e.noticeType="",e.noticeCycle="");var i=[],a=null;$("#course_panel .main_tab .live_prevlist li").each(function(){var t=$(this).attr("tuid");common.isValid(t)&&(t.indexOf(",")>-1?(a=t.split(","),i=$.merge(i,a)):i.push(t))}),$.unique(i);var s=e.analyst.split(","),n=[],o=!0;if(common.isValid(e.analyst)&&$.each(s,function(e,a){$.inArray(a,i)<0&&n.push($("#"+a+"_"+t.attr("t")).attr("cval"))}),$.each(videosSubscribe.subscribeData,function(i,a){if(t.attr("t")==a.type&&e.analyst==a.analyst&&e.noticeType==a.noticeType){var s=common.getDateDiff(a.startDate,a.endDate)>7?"month":"week";if(e.noticeCycle==s)return o=!1,!1}}),o)if(n.length>0&&$.inArray(t.attr("t"),["live_reminder","shout_single_strategy","trading_strategy"])>-1){var r={title:"温馨提醒",msg:n.join(",")+"老师没有课程安排，确定订阅？",btns:[{txt:"确定",fn:function(){videosSubscribe.saveSubscribe(e,t)}},{txt:"取消",fn:function(){box.hideMsg(),t.removeClass("clicked")}}]};box.showMsg(r)}else videosSubscribe.saveSubscribe(e,t);else box.showMsg("你已订阅相关课程，无需重复订阅！")}})},saveSubscribe:function(t,e){parseInt(t.point)!=parseInt(t.orip)||t.analyst!=e.attr("a")||t.noticeType!=e.attr("t")||t.noticeCycle!=e.attr("c")?common.getJson("/studio/subscribe",{params:JSON.stringify(t)},function(i){i.isOK?(chatShowTrade.getPointsInfo(),common.isBlank(t.analyst)||common.isBlank(t.noticeType)?box.showMsg("取消订阅成功！"):common.isValid(t.id)?box.showMsg("修改订阅成功！"):box.showMsg("订阅成功！"),videosSubscribe.setSubscribeType()):box.showMsg(i.msg),e.removeClass("clicked")}):(box.showMsg("订阅内容无变化！"),e.removeClass("clicked"))},formatHtml:function(t){var e=[];switch(t){case"subscribe":e.push("<tr>"),e.push('    <td><span class="fz12">{0}</span></td>'),e.push('    <td><span class="fz12">{1}</span></td>'),e.push("    <td>{2}</td>"),e.push("    <td>{3}</td>"),e.push("    <td>{4}</td>"),e.push("    <td>{5}</td>"),e.push("</tr>");break;case"subscribeType":e.push('<tr t="{7}">'),e.push("    <td>{0}</td>"),e.push('    <td><div class="itembox{5}">{1}</div><input type="hidden" name="{7}_analysts" /></td>'),e.push('    <td>{2}<input type="hidden" name="{7}_noticeTypes" /></td>'),e.push('    <td><div class="itembox{6}">'),e.push('    <div class="mydytime dn"></div>'),e.push("    {3}</div></td>"),e.push("    <td>{4}</td>"),e.push("</tr>");break;case"analysts":e.push('<div class="item">'),e.push('    <span class="inp_checkbox">'),e.push('        <input type="checkbox" name="analyst" id="{0}_{3}" p="{2}" value="{0}" cval="{1}" t="{3}" />'),e.push('        <label for="{0}_{3}"><i></i></label>'),e.push("    </span>"),e.push('    <span class="tname">{1}</span>'),e.push('    <span class="point">（{2}积分）</span>'),e.push("</div>");break;case"analyst":e.push('<div class="item">'),e.push('    <span class="inp_checkbox">'),e.push('    <input type="checkbox" name="analyst" id="{0}_{3}" value="{0}" p="{2}" cval="{1}" t="{3}" />'),e.push('    <label for="{0}_{3}"><i></i></label>'),e.push("    </span>"),e.push('    <span class="tname">{1}</span>'),e.push("</div>");break;case"noticeTypes":e.push('<div class="item">'),e.push('    <span class="inp_checkbox">'),e.push('        <input type="checkbox" name="noticeType" id="{0}_{3}" value="{0}" p="{2}" cval="{1}" t="{3}" />'),e.push('        <label for="{0}_{3}"><i></i></label>'),e.push("    </span>"),e.push('    <span class="tname">{1}</span>'),e.push('    <span class="point">（{2}积分）</span>'),e.push("</div>");break;case"noticeType":e.push('<div class="pdbox {0}"><a href="javascript:void(0);" class="dybtn" t="{0}" tn="{1}" nts="email"'),e.push(" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_dy_{0}', 'content_top', 1, true]);\">"),e.push("邮件订阅</a></div>");break;case"noticeCycle":e.push('<div class="item">'),e.push('    <span class="inp_radio">'),e.push('        <input type="radio" name="noticeCycle_{3}" id="{0}_{3}" value="{0}" p="{2}" cval="{1}" t="{3}" />'),e.push('        <label for="{0}_{3}"><i></i></label>'),e.push("    </span>"),e.push('    <span class="tname">{1}</span>'),e.push('    <span class="point">（{2}积分）</span>'),e.push("</div>");break;case"subscribeBtn":e.push('<div class="pdbox {0}">共计：<b>0分</b><a href="javascript:void(0);" class="dybtn" t="{0}" tn="{1}" a="{2}" t="{3}" c="{4}"'),e.push(" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'header_dy_{0}', 'content_top', 1, true]);\">"),e.push("订阅/结算</a></div>")}return e.join("")}},videosTrain={init:function(){this.setEvent(),this.initTraninNum()},setEvent:function(){$("#trains").click(function(){videosTrain.getTrainList(),common.openPopup(".blackbg,.pop_train")})},initTraninNum:function(){$.getJSON("/studio/getTrainRoomNum",{groupType:indexJS.userInfo.groupType},function(t){null!=t&&t.num>0?$("#trainsnum").show().text(t.num):$("#trainsnum").hide()})},getTrainList:function(){$.getJSON("/studio/getTrainRoomList",{groupType:indexJS.userInfo.groupType},function(t){if(null!=t){var e="",i=videosTrain.formatHtml("train");$.each(t,function(t,a){var s=common.trim(a.defaultAnalyst.introduction);e+=i.formatStr(a.defaultAnalyst.avatar,a.name,a.defaultAnalyst.userName,s,a.defaultAnalyst.userNo,a.clientGroup,a.allowInto,a.allowInto?"进入":"报名",a._id,a.allowInto?"":"("+a.clientSize+"人)")}),$(".pop_train .scrollbox .trainlist").html(e),$(".pop_train .scrollbox .trainlist .traindetails").click(function(){$(".train_detail .pop_tit label").text($(this).parent().parent().find(".train_name").text());var t=$(this).prev().attr("userno");$("#train_info_id").empty().load("/studio/getTrDetail?uid="+t,function(){$('#train_info_id .scrollbox[tid="'+t+'"]').show()}),common.openPopup(".blackbg,.train_detail")})}})},formatHtml:function(t){var e=[];switch(t){case"train":e.push("<li>"),e.push('     <div class="headimg"><img src="{0}" alt=""></div>'),e.push('     <div class="train_name">{1}</div>'),e.push('     <span class="slogan">{2}</span>'),e.push("     <p>{3}</p>"),e.push('     <a href="javascript:void(0);" class="trainbtn" userno="{4}" cgs= "{5}" isDetail="true" onclick="chatTeacher.trainRegis(this);" sp="{6}" rid="{8}">{7}<span>{9}</span></a><a href="javascript:void(0)" class="trainbtn traindetails">详情</a>'),e.push("</li>")}return e.join("")}},chatPride={classNoteInfo:[],strategyIsNotAuth:0,callTradeIsNotAuth:0,init:function(){this.setTradeStrategyNote(null,!0),this.setEvent()},setEvent:function(){$("#textliveMore").bind("click",function(){if(!$(this).is(".all")){var t=$("#textlivePanel li[aid]:last").attr("aid");chatPride.setTradeStrategyNote(t,!1)}})},setAdvertisement:function(){$(".live_banner").hasClass("loaded")||indexJS.getArticleList("advertisement",indexJS.userInfo.groupId,"0",1,5,'{"sequence":"desc","publishStartDate":"desc"}',null,function(t){if(t&&0==t.result){var e=t.data;$(".ban_ul").empty();var i=[],a=null,s=null,n=null;for(var o in e){if(a=e[o],common.isBlank(a.linkUrl)){switch(a.detailList[0].tag){case"live800":s="javascript:openLive800Chat(null)";break;case"qq":s="javascript:openQQChatByCommonv3('','800018282');";break;default:s="javascript:"}n=""}else s=a.linkUrl,n=' target="_blank"';i.push('<li><a href="'+s+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_banner', '"+a.detailList[0].title+"', 1, true]);\""+n+'><img width="100%" alt="" src="'+a.mediaUrl+'"></a></li>')}$(".ban_ul:first").html(i.join("")),$(".live_banner").slide({titCell:".num ul",mainCell:".ban_ul",effect:"left",autoPlay:!0,delayTime:300,interTime:4e3,autoPage:!0}),$(".live_banner").addClass("loaded")}})},setTradeStrategyNote:function(t,e){if(!e||!$("#textlivePanel").data("loaded")){e&&($("#textlivePanel").data("loaded",!0),t||(t=$("#textlivePanel li[aid]:last").attr("aid")));var i={type:"prerogative",item:["prerogative_strategy","prerogative_callTrade"]};common.getJson("/studio/getChatPointsConfig",{data:JSON.stringify(i)},function(e){e&&$.each(e,function(t,e){for(var i=e.clientGroup,t=0,a=i?i.length:0;a>t;t++){var s=i[t];s==indexJS.userInfo.clientGroup&&("prerogative_callTrade"==e.item?chatPride.callTradeIsNotAuth=1:"prerogative_strategy"==e.item&&(chatPride.strategyIsNotAuth=1))}});var i=chatPride.getStoreViewData()||[],a={isAll:1,pageKey:t||"",pageLess:1,ids:i.join(","),callTradeIsNotAuth:chatPride.callTradeIsNotAuth,strategyIsNotAuth:chatPride.strategyIsNotAuth};indexJS.getArticleList("class_note",indexJS.userInfo.groupId,1,1,30,'{"publishStartDate":"desc","createDate":"desc"}',a,function(t){if(t&&0==t.result){var e=t.data;for(var i in e)chatPride.appendTradeStrategyNote(e[i],!1,!1,!1);for(var i in chatPride.classNoteInfo)chatPride.appendClassNoteInfo(chatPride.classNoteInfo[i],!1,!1,!1);chatPride.classNoteInfo=[],e.length<t.pageSize&&$("#textliveMore").addClass("all").html("已加载全部")}chatPride.setAdvertisement(),indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"))})})}},appendTradeStrategyNote:function(t,e,i,a){var s,n,o,r,l=$("#textlivePanel"),c="",d=chatPride.formatHtml("tradeStrategyLiveBrief"),u=chatPride.formatHtml("tradeStrategySupport"),h=chatPride.formatHtml("tradeStrategySupportDiv"),p=chatPride.formatHtml("tag"),m=chatPride.formatHtml("tradeStrategyNoteImg"),f=/<img\s+[^>]*src=['"]([^'"]+)['"][^>]*>/;s=t.detailList&&t.detailList[0];var g=t._id||t.id,v=chatPride.getStoreViewData()||[];if(common.isValid(s.tag)&&"trading_strategy"==s.tag){if(n=new Date(t.publishStartDate).getTime(),o=l.find(".livebrief[pt='"+n+"']>div.te_info"),0==o.size()){var b="",y="",_="",x=[],w=[],I="";s.authorInfo&&(b=s.authorInfo.name||"",y=s.authorInfo.avatar||"",I=s.authorInfo.userId||"",x=common.isValid(s.authorInfo.tag)?s.authorInfo.tag.replace(/\s*，\s*/g,",").split(","):[],$.each(x,function(t,e){common.isValid(e)&&w.push(p.formatStr(e))}));var k=common.formatterDateTime(n,"-").substring(0,16)+"-"+common.formatterDateTime(t.publishEndDate,"-").substring(11,16),S=[];if(common.isValid(s.tag)&&"trading_strategy"==s.tag){var T=common.isValid(s.remark)?JSON.parse(s.remark):[],C={};if($.each(T,function(t,e){C.hasOwnProperty(e.symbol)?C[e.symbol].push(e):C[e.symbol]=[e]}),indexJS.userInfo.isLogin&&!chatPride.strategyIsNotAuth||$.inArray(g,v)>-1){_=' style="display:none;"';var L=0;Object.keys(C).length-1;$.each(C,function(t,e){var i=[];$.each(e,function(t,e){i.push(h.formatStr(t+1,e.support_level,e.drag_level,""))}),S.push(u.formatStr(e[0].name,i.join(""),0==L?'<a href="javascript:void(0);" class="viewdata"'+_+' _id="'+g+"\" item=\"prerogative_strategy\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_cl_ChaKanShuJu', 'content_right', 1, true]);\">查看数据</a>":"")),L++})}else{0==T.length&&(_=' style="display:none;"');var L=0;Object.keys(C).length-1;$.each(C,function(t,e){var i=[];$.each(e,function(t,e){i.push(h.formatStr(t+1,"****","****","dim"))}),S.push(u.formatStr(e[0].name,i.join(""),0==L?'<a href="javascript:void(0);" class="viewdata"'+_+' _id="'+g+"\" item=\"prerogative_strategy\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_cl_ChaKanShuJu', 'content_right', 1, true]);\">查看数据</a>":"")),L++})}}else _=' style="display:none;"';var J="trading_strategy"==s.tag?s.content:"";if(common.isValid(J))for(r=f.exec(J);r;)J=J.replace(f,m.formatStr(r[1])),r=f.exec(J);c=d.formatStr(y,b,k,s.title||"",J,S.join(""),n,_,w.join(""),g,I),e?l.prepend(c):l.append(c),l.find(".picpart>.imgbox").each(function(){var t=$(this);t.find("a>img").attr("src",t.attr("url"))})}else if(o.size()>0&&a){var b="",y="",_="",x=[],w=[],I="";s.authorInfo&&(b=s.authorInfo.name||"",y=s.authorInfo.avatar||"",I=s.authorInfo.userId||"",x=common.isValid(s.authorInfo.tag)?s.authorInfo.tag.replace(/\s*，\s*/g,",").split(","):[],$.each(x,function(t,e){w.push(p.formatStr(e))}));var k=common.formatterDateTime(n,"-").substring(0,16)+"-"+common.formatterDateTime(t.publishEndDate,"-").substring(11,16),S=[],T=common.isValid(s.remark)?JSON.parse(s.remark):[],C={};if($.each(T,function(t,e){C.hasOwnProperty(e.symbol)?C[e.symbol].push(e):C[e.symbol]=[e]}),common.isValid(s.tag)&&"trading_strategy"==s.tag)if(indexJS.userInfo.isLogin&&!chatPride.strategyIsNotAuth||$.inArray(g,v)>-1){var L=0;Object.keys(C).length-1;$.each(C,function(t,e){var i=[];$.each(e,function(t,e){i.push(h.formatStr(t+1,e.support_level,e.drag_level,""))}),S.push(u.formatStr(e[0].name,i.join(""),0==L?'<a href="javascript:void(0);" class="viewdata"'+_+' _id="'+g+"\" item=\"prerogative_strategy\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_cl_ChaKanShuJu', 'content_right', 1, true]);\">查看数据</a>":"")),L++})}else{0==T.length&&(_=' style="display:none;"');var L=0;Object.keys(C).length-1;$.each(C,function(t,e){var i=[];$.each(e,function(t,e){i.push(h.formatStr(t+1,"****","****","dim"))}),S.push(u.formatStr(e[0].name,i.join(""),0==L?'<a href="javascript:void(0);" class="viewdata"'+_+' _id="'+g+"\" item=\"prerogative_strategy\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_cl_ChaKanShuJu', 'content_right', 1, true]);\">查看数据</a>":"")),L++})}var J="trading_strategy"==s.tag?s.content:"";if(common.isValid(J))for(r=f.exec(J);r;)J=J.replace(f,m.formatStr(r[1])),r=f.exec(J);o=l.find(".livebrief[_aid='"+g+"']"),o.find("div.te_info").attr("tid",I),o.find("div.te_info>div.himg>img").attr("src",y),o.find("div.te_info>div.teinfo1>span.te_name").text(b),o.find("div.te_info>div.teinfo1>span.livetime").text(k),o.find("div.te_info>div.teinfo1>span.brieftit").text(s.title||""),o.find("div.te_info>div.teinfo>div.taglist").html(w.join("")),o.find("div.hdbox>div.skill").html('<span><i class="dot"></i>当前交易策略：</span>'+J),o.find("div.hdbox>div.skilldata").remove(),o.find("div.hdbox>div.skill").after(S.join("")),T.length>0&&indexJS.userInfo.isLogin&&"vip"==indexJS.userInfo.clientGroup?o.find("div.hdbox>div.skilldata>a").hide():o.find("div.hdbox>div.skilldata>a").show()}}else chatPride.classNoteInfo.push(t);if(i){var P=$('.main_tabnav a[t="livepride"] .num');if(P.parent().parent().parent().parent().is(".on"))P.data("cnt",D).html(D).hide();else{var D=(P.data("cnt")||0)+1;P.data("cnt",D).html(D).show()}}else $('.main_tabnav a[t="livepride"] .num').hide();$(".viewdata").unbind("click"),$(".viewdata").click(function(){indexJS.userInfo.isLogin?chatPride.viewData($(this)):$("#login_a").click()})},appendClassNoteInfo:function(t,e,i,a){var s,n,o,r,l,c,d=$("#textlivePanel"),u=chatPride.formatHtml("tradeStrategyNote"),h=chatPride.formatHtml("tradeStrategyHd"),p=chatPride.formatHtml("tradeStrategyHdDetail"),m=(chatPride.formatHtml("tradeStrategyNoteDetail"),chatPride.formatHtml("tradeStrategyNoteImg")),f=/<img\s+[^>]*src=['"]([^'"]+)['"][^>]*>/;s=t.detailList&&t.detailList[0],n=new Date(t.publishStartDate).getTime();var g=t._id||t.id,v=chatPride.getStoreViewData()||[];if(a&&d.find("li[aid='"+g+"']").remove(),!(d.find("li[aid='"+g+"']").size()>0)){var b="";for(s.authorInfo&&(b=s.authorInfo.name.substring(0,1)||""),o=s.content,c=f.exec(o);c;)o=o.replace(f,m.formatStr(c[1])),c=f.exec(o);if(common.isValid(s.tag)&&common.isValid(s.remark)&&("shout_single"==s.tag||"resting_order"==s.tag)){var y=[],_=JSON.parse(s.remark),x="";indexJS.userInfo.isLogin&&!chatPride.callTradeIsNotAuth||$.inArray(g,v)>-1?(x=' style="display:none;"',$.each(_,function(t,e){y.push(p.formatStr(e.name,"long"==e.longshort?"看涨":"看跌",e.point,e.profit,e.loss,""))})):$.each(_,function(t,e){y.push(p.formatStr(e.name,"long"==e.longshort?"看涨":"看跌","***","***","***","dim"))});var w=s.content||"";for(c=f.exec(w);c;)w=o.replace(f,m.formatStr(c[1])),c=f.exec(w);var I="喊单",k="prerogative_callTrade";"resting_order"==s.tag&&(I="挂单",k="prerogative_callTrade"),o=h.formatStr(w,y.join(""),x,g,b,I,k)}if(l=common.formatterDateTime(t.createDate,"-").substring(11),"trading_strategy"!=s.tag){if(r=$(u.formatStr(l,o,g)),r.find(".imgbox").each(function(){$(this).find("img").attr("src",$(this).attr("url"))}),e?d.find(".livebrief[pt='"+n+"']>div.brieflist ul").prepend(r):d.find(".livebrief[pt='"+n+"']>div.brieflist ul").append(r),i){var S=$('.main_tabnav a[t="livepride"] .num');if(S.parent().parent().parent().parent().is(".on"))S.data("cnt",T).html(T).hide();else{var T=(S.data("cnt")||0)+1;S.data("cnt",T).html(T).show()}}else $('.main_tabnav a[t="livepride"] .num').hide();$(".viewdata2").unbind("click"),$(".viewdata2").click(function(){indexJS.userInfo.isLogin?chatPride.viewData($(this)):$("#login_a").click()})}}},pushShoutSingleInfo:function(t){var e=chatPride.formatHtml("pushShortSingle"),i=t.detailList&&t.detailList[0],a=t._id||t.id,s=null;if(common.isValid(i.tag)&&common.isValid(i.remark)&&("shout_single"==i.tag||"resting_order"==i.tag)){var n="老师喊单啦";"resting_order"==i.tag&&(n="老师晒单啦"),s=common.isBlank(i.content)?(i.authorInfo.userName||"")+n:i.content.replace("<p>","").replace("</p>",""),$("#chatMsgContentDiv .dialoglist").append(e.formatStr(s,a)),chat.showSystemTopInfo("class_note",a,s),$("#chatMsgContentDiv .dialoglist .pushclose").unbind("click"),$("#chatMsgContentDiv .dialoglist .pushclose").click(function(){$(this).parent().hide()}),$("#chatMsgContentDiv .dialoglist .shoutsingle").unbind("click"),$("#chatMsgContentDiv .dialoglist .shoutsingle").click(function(){chatPride.gotoLook($(this).attr("_id"))})}},gotoLook:function(t){$('.main_tabnav a[t="livepride"]').click(),indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"),$('.livebrief_list .livebrief .brieflist ul li[aid="'+t+'"]').offset().top)},getStoreViewData:function(){return store.enabled?store.get("point_"+indexJS.userInfo.userId):void console.log("Local storage is not supported by your browser.")},viewData:function(t){var e=chatPride.getStoreViewData()||[],i={groupType:indexJS.userInfo.groupType,item:t.attr("item"),tag:"viewdata_"+t.attr("_id")};common.getJson("/studio/addPointsInfo",{params:JSON.stringify(i)},function(i){i.isOK?indexJS.getArticleInfo(t.attr("_id"),function(a){a&&(common.isValid(i.msg)&&"number"==typeof i.msg.change&&box.showMsg("消费"+Math.abs(i.msg.change)+"积分"),chatPride.setViewDataHtml(t,a),$.inArray(t.attr("_id"),e)<0&&e.push(t.attr("_id")),store.set("point_"+indexJS.userInfo.userId,e))}):box.showMsg(i.msg)})},setViewDataHtml:function(t,e){var i=e.detailList&&e.detailList[0],a=JSON.parse(i.remark),s=[],n=[],o=chatPride.formatHtml("tradeStrategyHdDetail");if("shout_single"==i.tag||"resting_order"==i.tag)$.each(a,function(t,e){s.push(o.formatStr(e.name,"long"==e.longshort?"看涨":"看跌",e.point,e.profit,e.loss,""))}),t.next("table").children("tbody").html(s.join("")),t.hide();else if("trading_strategy"==i.tag){
var r=chatPride.formatHtml("tradeStrategySupport"),l=chatPride.formatHtml("tradeStrategySupportDiv"),c={};$.each(a,function(t,e){c.hasOwnProperty(e.symbol)?c[e.symbol].push(e):c[e.symbol]=[e]});var d=0;Object.keys(c).length-1;$.each(c,function(t,i){var a=[];$.each(i,function(t,e){a.push(l.formatStr(t+1,e.support_level,e.drag_level,""))}),n.push(r.formatStr(i[0].name,a.join(""),0==d?'<a href="javascript:void(0);" class="viewdata" style="display:none;" _id="'+e._id+"\" item=\"prerogative_strategy\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_cl_ChaKanShuJu', 'content_right', 1, true]);\">查看数据</a>":"")),d++});var u=t.parent("div.skilldata").parent("div.hdbox");u.find("div.skilldata").remove(),u.children("div.skill").after(n.join(""))}},formatHtml:function(t){var e=[];switch(t){case"tradeStrategyLiveBrief":e.push('<div class="livebrief" pt="{6}" _aid="{9}">'),e.push('    <div class="te_info" tid="{10}">'),e.push('        <div class="himg"><img src="{0}" alt="" width="120" height="120"></div>'),e.push('        <div class="teinfo1">'),e.push('            <span class="te_name">{1}</span>'),e.push('            <span class="livetime">{2}</span>'),e.push("        </div>"),e.push('        <span class="brieftit">{3}</span>'),e.push('        <div class="taglist">'),e.push("            {8}"),e.push("        </div>"),e.push("    </div>"),e.push('    <div class="hdbox">'),e.push('        <div class="skill">'),e.push('            <span><i class="dot"></i>当前交易策略：</span>'),e.push("            <p>{4}</p>"),e.push("        </div>"),e.push("        {5}"),e.push('        <i class="hdbox-i"></i>'),e.push("    </div>"),e.push('    <div class="live_banner">'),e.push('        <ul class="ban_ul"></ul>'),e.push('        <div class="num">'),e.push("            <ul></ul>"),e.push("        </div>"),e.push("    </div>"),e.push('    <div class="brieflist">'),e.push("        <ul></ul>"),e.push("    </div>"),e.push("</div>");break;case"tradeStrategySupport":e.push('<div class="skilldata clearfix">'),e.push("   {2}"),e.push('    <div class="data_cont">'),e.push('        <div class="pdname"><span>{0}</span><i></i></div>'),e.push('        <b class="br-ctrl"></b>'),e.push("        {1}"),e.push("    </div>"),e.push("</div>");break;case"tradeStrategySupportDiv":e.push('<div class="support"><i class="dot"></i><b>第{0}支撑位/阻力位：</b><span class="{3}">{1}/{2}</span></div>');break;case"tradeStrategyNote":e.push('<li aid="{2}">'),e.push('    <i class="dot"></i>'),e.push('    <span class="ltime">{0}</span>'),e.push('    <div class="textcont">'),e.push("    {1}"),e.push("    </div>"),e.push("</li>");break;case"tradeStrategyHd":e.push("{0}"),e.push('<div class="hdbox2 clearfix">'),e.push('    <span class="hdtit">【{5}】{4}老师{5}了，快来围观！</span>'),e.push('    <a href="javascript:void(0);" class="viewdata2"{2} _id="{3}" item="{6}" onclick="_gaq.push([\'_trackEvent\', \'pmchat_studio\', \'right_zb_hd_ChaKanShuJu\', \'content_right\', 1, true]);">查看数据</a>'),e.push('    <table width="100%" border="0" cellspacing="0" cellpadding="0">'),e.push("        <thead>"),e.push("            <tr>"),e.push("                <th>品种</th>"),e.push('                <th width="21%">方向</th>'),e.push('                <th width="21%">进场点位</th>'),e.push('                <th width="21%">止盈</th>'),e.push('                <th width="21%">止损</th>'),e.push("            </tr>"),e.push("        </thead>"),e.push("        <tbody>"),e.push("            {1}"),e.push("        </tbody>"),e.push("    </table>"),e.push("</div>");break;case"tradeStrategyHdDetail":e.push("<tr>"),e.push("    <td>{0}</td>"),e.push("    <td>{1}</td>"),e.push('    <td><span class="{5}">{2}</span></td>'),e.push('    <td><span class="{5}">{3}</span></td>'),e.push('    <td><span class="{5}">{4}</span></td>'),e.push("</tr>");break;case"tradeStrategyNoteDetail":e.push('<div class="textcont">{0}</div>');break;case"tradeStrategyNoteImg":e.push('<div class="picpart">'),e.push('    <div class="imgbox" url="{0}">'),e.push("        <a href=\"{0}\" data-lightbox=\"liveinfo-img\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_zb_ChaKanTu', 'content_right', 1, true]);\"><i></i><img alt=\"\" /></a>"),e.push("    </div>"),e.push("</div>");break;case"tag":e.push('<a href="javascript:void(0);" class="tag"><span>{0}</span><i></i></a>');break;case"pushShortSingle":e.push('<div class="info_push">'),e.push('    <div class="pushcont">系统：{0}</div>'),e.push("    <a href=\"javascript:void(0);\" class=\"detailbtn shoutsingle\" _id=\"{1}\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_lts_QuKankan', 'content_right', 1, true]);\">去看看</a>"),e.push('    <a href="javascript:void(0);" class="pushclose"><i></i></a>'),e.push("</div>")}return e.join("")}},chat={socket:null,msgPushObj:{pbInfos:[],whInfos:[],whInfo:{}},whTipInterId:null,pushInfoTimeOutId:null,initUserList:!1,userList:{},msgType:{text:"text",img:"img",file:"file"},init:function(){this.setEvent(),this.getCSList(),this.setSocket(),this.setTalkListScroll(!0)},setEvent:function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&$("#msgFaceBtn").qqFace({id:"faceId",assign:"contentText",path:indexJS.filePath+"/face/"}),$(document).click(function(t){$("div[id^=faceId]").hide(),$(t.target).hasClass("headimg")||$(t.target).parents().hasClass("headimg")||"header"==$(t.target).parent().attr("t")||$(t.target).hasClass("uname")||$(t.target).parents().hasClass("te_ul")||$(".dialogbtn").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),chat.setTalkListScroll()}),$(".scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),chat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),chat.showViewSelect($(this).attr("t")),chat.setTalkListScroll(!0))}),$("#contentText").pastableTextarea().on("pasteImage",function(t,e){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",e.dataURL),i.find("img").attr("src",e.dataURL)):($(this).append('<a class="text-min-img" href="'+e.dataURL+'" data-lightbox="send-img"><img src="'+e.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(t){var e=$(this).html();if(13==t.keyCode)return common.isValid(e)&&($(this).html(e.replace(/<div>|<\/div>/g,"")),$(".ui-autocomplete").is(":hidden")&&$("#sendBtn").click()),!1;if(8==t.keyCode){var i=$(this).find(".txt_dia");if($.trim($(this).text())==i.text())return i.remove(),$(this).html(""),!0}}).autocomplete({source:function(t,e){/^@.*$/g.test(t.term)&&(e(chat.searchUserList(t.term.substring(1,t.term.length))),$(".ui-autocomplete").css("z-index","10000000"))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(t,e){return $("#contentText").html("").append('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e.item.value+'" utype="'+e.item.userType+'">@<label>'+e.item.label+"</label></span>&nbsp;").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(t,e){return $("<li>").attr("data-value",e.label).append("<a>"+e.label+"</a>").appendTo(t)},$("#sendBtn").click(function(){if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();if(indexJS.userInfo.isSetName===!1)return $("#personal_center").click(),$("#modifyNk").click(),$(".nickNameTip").removeClass("dn").css("color","red"),void $("#myNickName").focus();indexJS.userInfo.isLogin&&common.isBlank($(".personal_center .levelbar .le_detail").attr("sendget"))&&chatShowTrade.getPointsInfo(!0);var t=chat.getToUser(),e=$("#contentText .text-min-img img");if(e.size()>0){var i=e.attr("src");if(i.length>1048576)alert("发送的图片大小不要超过1MB.");else{chat.setUploadImg(i,t),e.remove();var a=$(".replybtn");t&&t.userId==a.attr("uid")&&t.talkStyle==a.attr("ts")&&($('.mymsg div[uid="'+t.userId+'"]').remove(),0==$("#myMsgListContent .mymsg_list").length?$(".mymsg,.mymsg em").hide():$("#myMsgListContent .mymsg_list").length<2&&$(".mymsg").height(27))}}var s=chat.getSendMsg();if(s!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:s}},a=$(".replybtn");t&&t.userId==a.attr("uid")&&t.talkStyle==a.attr("ts")&&($('.mymsg div[uid="'+t.userId+'"]').remove(),0==$("#myMsgListContent .mymsg_list").length?$(".mymsg,.mymsg em").hide():$("#myMsgListContent .mymsg_list").length<2&&$(".mymsg").height(27)),n.fromUser.pointsGlobal=parseInt($(".personal_center .levelbar .le_detail").attr("pg")),n.fromUser.toUser=t,chat.socket.emit("sendMsg",n),chat.setContent(n,!0,!1),$("#contentText").html(""),chatAnalyze.setUTM(!1,{speakCount:1})}}),$("#sendImgBtn").click(function(){return FileReader?!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor")?void box.openLgBox():indexJS.userInfo.isSetName===!1?($("#personal_center").click(),$("#modifyNk").click(),$(".nickNameTip").removeClass("dn").css("color","red"),void $("#myNickName").focus()):void $("#sendImgInp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#sendImgInp").bind("change",function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=e.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var a=new FileReader;a.readAsDataURL(e),a.onload=function(t){chat.setUploadImg(t.target.result,chat.getToUser())},a.onprogress=function(t){},a.onloadend=function(t){},$(this).val("")}),$(".pletter_win").css({top:$(window).height()/2-218,left:$(window).width()/2-310}).draggable({handle:".titonline",cursor:"move",containment:"document",scroll:!1}),$(".signinbtn").click(function(){common.getJson("/studio/addSignin",null,function(t){"3002"==t.errcode?box.showMsg(t.errmsg):t.isOK?(box.showMsg("签到成功!"),common.getJson("/studio/getSignin",null,function(t){if(null!=t){var e=t.signinInfo,i=t.signinUser,a=0;null!=e&&(a=e.serialSigDays),$(".signinbox .progressbar .barcont .current").text(a+"天");var s=new Date,n=[],o=box.formatHtml("signin");if(null!=i)for(var r in i){var l=i[r],c=null!=l.avatar?l.avatar:"/pm/theme1/img/user.jpg",d=common.getMinuteDiff(s,l.signinTime);d=0>=d?1:d,n.push(o.formatStr(c,d+"分钟前"))}$(".signinbox .sign_vistor ul").prepend(n.join("")),$("#sign_vistor").height(75),indexJS.setListScroll($("#sign_vistor"));var u=a/30*100;u>100&&(u=100),$(".signinbox .progressbar .bar").width(u+"%"),common.openPopup(".blackbg,.signin")}else console.log("fail"),box.showMsg(t.msg)})):box.showMsg(t.msg)})}),$("#chatPrideSystemTopInfo .detailbtn").bind("click",function(){$("#chatPrideSystemTopInfo").fadeOut();var t=$("#chatPrideSystemTopInfo").data("data");if(t)switch(t.type){case"class_note":chatPride.gotoLook(t.id);break;case"showTrade":chatShowTrade.gotoLook(t.id)}}),$("#chatPrideSystemTopInfo .pushclose").bind("click",function(){$("#chatPrideSystemTopInfo").fadeOut()})},setUploadImg:function(t,e){var i=chat.getUiId(),a={};common.copyObject(a,indexJS.userInfo,!0),a.toUser=e;var s={uiId:i,fromUser:a,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};e&&1==e.talkStyle?this.setWhContent(s,!0,!1):this.setContent(s,!0,!1),s.content.value=t,this.zipImg(s,100,60,function(t,e){if(t.error)return alert(t.error),$("#"+i).remove(),!1;var a=$("#"+t.uiId+" span[contt='a'] a");a.attr("href",e).children("img").attr("src",e).attr("needMax",t.content.needMax),chat.dataUpload(t)})},zipImg:function(t,e,i,a){var s=new Image;s.onload=function(){var n=document.createElement("canvas");n||a({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var o=s.width,r=s.height;if(r>=9*o)return a({error:"该图片高度太高，暂不支持发送！"}),!1;e>0&&(r>e||o>e)&&(t.content.needMax=1,r>e&&e>=o?(o=e/r*o,r=e):(r=e/o*r,o=e),s.height=r,s.width=o);var l=n.getContext("2d");n.width=o,n.height=r,l.clearRect(0,0,n.width,n.height),l.drawImage(s,0,0,o,r),a(t,n.toDataURL("image/jpeg",i/100))},s.src=t.content.value},dataUpload:function(t){var e=new XMLHttpRequest;e.open("POST","/studio/uploadData"),e.addEventListener("progress",function(e){if(e.lengthComputable){var i=(e.loaded/e.total*100|0)+"%";$("#"+t.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+t.uiId+" .shadow-conut").html(i)}},!1),e.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&console.log("dataUpload success!")},t.fromUser.socketId=this.socket.id,e.send(JSON.stringify(t))},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getCSList:function(){var t=LoginAuto.sessionUser.groupType,e=LoginAuto.sessionUser.groupId;try{$.getJSON("/"+t+"/getCS",{groupId:e},function(t){if(t&&t.length>0){var e=null;for(var i in t)e=t[i],e.nickname=e.userName,e.userId=e.userNo,e.sequence=3,e.userType=3,e.isFromAjax=!0,0==$(".mult_dialog a[uid="+e.userId+"]").length&&chat.setWhVisitors("",e.userType,e.userId,e.nickname,e.avatar,!0,!1);$(".mod_infotab .tabnav .myaid").removeClass("nocs"),$(".mult_dialog a[uid] .num").hide(),$(".mult_dialog a[uid]:first").click()}else $(".mod_infotab .tabnav .myaid").addClass("nocs")})}catch(i){console.error("getCSList->"+i),callback(null)}},getSendImgInfo:function(){var t=$("#contentText .text-min-img");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype")}:null},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getToUser:function(){var t=$("#contentText .txt_dia");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype")}:null},getSendMsg:function(t){var t=t?t:$("#contentText");if(t.text().length+t.find("img").size()>140)return alert("消息内容超过最大长度限制（140字以内）！"),!1;t.find(".txt_dia").length>0&&t.find(".txt_dia").remove();var e=common.clearMsgHtml(t.html());return common.isBlank(e)?(t.html(""),!1):e},setDialog:function(t,e,i,a,s){if(1==i)"vip"==$("#roomInfoId").attr("rt")?indexJS.connectOnlineCs():(chat.closeWhTip(t),chat.fillWhBox(null,s,a,t,e,!1,!1));else{if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+a+'">@<label>'+e+"</label></span>&nbsp;").focusEnd()}},showViewSelect:function(t){"analyst"==t?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"mine"==t?($("#dialog_list").children("[isme='true']").show(),$("#dialog_list").children("[isme='false']").hide()):"admin"==t?$("#dialog_list").children("[utype!=1]").hide():$("#dialog_list").children().show()},setContent:function(t,e,i){var a=t.fromUser;if(e&&(a.publishTime=t.uiId),t.isVisitor)return $("#"+t.uiId).remove(),void box.openLgBox();if(i&&$("#"+a.publishTime).length>0)return $("#"+a.publishTime+" span[contt] em[class=ruleTipStyle]").remove(),void $("#"+a.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",a.publishTime):$("#"+t.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(e||indexJS.userInfo.userId!=a.userId||!t.serverSuccess){var s=chat.formatContentHtml(t,e,i),n=$("#dialog_list");n.append(s),this.formatMsgToLink(a.publishTime);var o=$(".view_select .selectlist a[class=on]").attr("t");if("all"!=o&&chat.showViewSelect(o),!i){var r=$("#userListId li[id="+a.userId+"]"),l=null;a.avatar&&r.length>0&&a.avatar!=(l=r.find(".headimg img")).attr("src")&&l.attr("src",a.avatar),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0),chat.showChatMsgNumTip(!1)}$("#"+a.publishTime+" .headimg").click(function(){chat.openDiaLog($("#"+a.publishTime+" .dialogbtn").attr("avs",$(this).find("img").attr("src")))}),$("#"+a.publishTime+" .txt_dia").click(function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&chat.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+a.publishTime+" .uname").click(function(){var t=$("#"+a.publishTime+" .dialogbtn");t.attr("avs",$(this).parent().parent().find(".headimg img").attr("src")),chat.openDiaLog(t)})}else if($("#"+t.uiId+" .dtime").html(chat.formatPublishTime(a.publishTime)),$("#"+t.uiId).attr("id",a.publishTime),t.content.msgType==chat.msgType.img){chat.removeLoadDom(a.publishTime);var c=$("#"+a.publishTime+' span[contt="a"]>a'),d=t.content.needMax?"/studio/getBigImg?publishTime="+a.publishTime+"&userId="+a.userId:c.children("img").attr("src");c.attr("href",d)}},showChatMsgNumTip:function(t){var e=$("#chatMsgCount");if(t)e.data("cnt",0).html("").hide();else if(!e.parent().parent().parent().parent().is(".on")){var i=(e.data("cnt")||0)+1;e.data("cnt",i).html(i).show()}},openDiaLog:function(t){if($(".dialogbtn").not(t).hide(),!t.is(":hidden"))return t.hide(),!1;var e=t.parent(),i=t.is(".bot");e.next().size()<=0?i||t.addClass("bot"):i&&t.removeClass("bot"),t.show();var a=t.find("a"),s=t.attr("avs");common.isValid(s)?(a.attr("avs",s),t.attr("avs","")):a.attr("avs",""),a.unbind("click"),a.click(function(){var t=$(this).parent();chat.setDialog(t.attr("uid"),t.attr("nk"),$(this).attr("t"),t.attr("utype"),$(this).attr("avs")),t.hide()})},formatPublishTime:function(t,e,i){var a=Number(t.replace(/_.+/g,""));return common.isBlank(t)?"":e?common.formatterDateTime(a,i):common.getHHMM(a)},formatContentHtml:function(t,e,i){var a="dialog ",s="",n="",o="false",r="",l=t.fromUser,c=t.content,d=l.nickname,u="";indexJS.userInfo.userId==l.userId&&e&&(l.publishTime=t.uiId,u='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>');var h=l.toUser,p="";if(h&&common.isValid(h.userId)&&(p='<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">@<label>'+h.nickname+"</label></span>",indexJS.userInfo.userId==h.userId&&(o="true")),c.msgType==chat.msgType.img?(s=c.needMax?'<a href="/studio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="dialog-img"><img src="'+c.value+'" alt="图片"/></a>':'<a href="'+(c.value?c.value:"javascript:void(0);")+'" data-lightbox="dialog-img"><img src="'+c.value+'" alt="图片" /></a>',s+=u):s=c.value,indexJS.userInfo.userId==l.userId)a+="mine ",o="true",r='<a href="javascript:" class="uname">我</a><span class="ctime">'+chat.formatPublishTime(l.publishTime)+"</span>";else{if(3==l.userType&&(d+="&nbsp;（助理）"),$.inArray(l.userType,[0])>-1&&!isNaN(l.pointsGlobal)){for(var m={},f=indexJS.pointLevel.length-1;f>=0;f--){var g=indexJS.pointLevel[f];if(l.pointsGlobal>=g.points){m=g;break}}r='<span class="level">'+m.name+"</span>"}if(r+='<a href="javascript:void(0);" class="uname">'+d+'</a><span class="ctime">'+chat.formatPublishTime(l.publishTime)+"</span>",n=chat.getDialogHtml(l.userId,d,l.userType),!i&&h&&indexJS.userInfo.userId==h.userId){$(".mymsg").show(),$(".mymsg em").hide();var v=[];v.push('<div class="mymsg_list" uid="'+l.userId+'">'),v.push('    <p><span class="sender">'+l.nickname+'</span>对你说：<span class="xcont">'+s+"</span></p>"),v.push('    <a href="javascript:void(0);" class="replybtn" uid="'+l.userId+'" ts="'+h.talkStyle+'" futype="'+l.userType+'">回复</a>'),v.push('    <a href="javascript:void(0);" class="pop_close mymsg_close"><i>关闭</i></a>'),v.push("</div>"),$("#myMsgListContent").append(v.join("")),$("#myMsgListContent .mymsg_list").length>1?($(".mymsg").height(58),indexJS.setListScroll($(".mymsg"))):$(".mymsg").height(27),chat.replyEvent($(".mymsg .mymsg_list .replybtn"),$(".mymsg .mymsg_list .mymsg_close"))}}var b=chat.getAImgOrLevel(l.userId,l.clientGroup,l.userType,l.avatar),y=[];return y.push('<div class="'+a+b.level+'" id="'+l.publishTime+'"  utype="'+l.userType+'" mtype="'+c.msgType+'" isme="'+o+'">'),y.push('<div class="headimg">'),y.push('<a href="javascript:void(0);">'+b.aImg+"</a>"),y.push("</div>"),y.push('<div class="infobar">'+r+"</div>"),y.push('<div class="bubble"><i></i>'),h&&common.isValid(h.question)?(y.push('<div class="dcont">'),y.push('<div class="question"><span uid="'+h.userId+'" utype="'+h.userType+'">'+h.nickname+"</span>提问："),y.push('<span class="q">'+h.question+"</span></div>"),y.push('<div class="reply"><span>回复：</span><span contt="a">'+s+"</span></div>"),y.push("</div>")):y.push('<div class="dcont"><span contt="a">'+p+s+"</span></div>"),y.push(n+"</div>"),y.join("")},formatMsgToLink:function(t){$("#"+t+' span[contt]:contains("http:"),#'+t+' span[contt]:contains("https:")').each(function(t,e){var i=$(e).html(),a=i.split(/<img[^>]*>|<a[^>]*>.*?<\/a>/g),s="";for(var n in a)if(s=a[n],!common.isBlank(s)){var o=s.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+"\" target=\"_blank\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'left_lj_zhuli', '$(this).text()', 1, true]);\">"+t+"</a>"});e.innerHTML=e.innerHTML.replace(s,o)}})},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getAImgOrLevel:function(t,e,i,a){var s={aImg:common.isValid(a)?'<img src="'+a+'">':'<img src="/pm/theme1/img/user.png">',level:""};if(common.isValid(i)&&i>0)s.level=2==i?"analyst":"admin";else if("vip"==e)s.level="level4";else if("active"==e||"notActive"==e)s.level="level3";else if("simulate"==e)s.level="level2";else if("register"==e)s.level="level1";else if("visitor"==e||-1==i){t=t||"";var n=parseInt(t.substring(t.length-2),10);isNaN(n)&&(n=100),n=(n+17)%40,s.aImg='<img src="'+indexJS.filePath+"/upload/pic/header/chat/visitor/"+n+'.png">',s.level="visitor"}else s.level="visitor";return s},getDialogHtml:function(t,e,i){if(t&&indexJS.userInfo.userId!=t){var a=$("#roomInfoId"),s="",n=0;return(indexJS.visitorSpeak||-1==indexJS.userInfo.userId.indexOf("visitor_")&&-1==t.indexOf("visitor_"))&&(s+='<a href="javascript:void(0);" class="d1" t="0"><b></b><span>@TA</span></a>',n++),"true"==a.attr("aw")&&common.containSplitStr(a.attr("awr"),i)&&(s+='<a href="javascript:void(0);"'+(0==n?' class="d1"':"")+' t="1"><b></b><span>私聊</span></a>',n++),'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+e+'" uid="'+t+'" utype="'+i+'">'+s+"</div>"}return'<div class="dialogbtn'+(1==n?" one":"")+'"  nk="'+e+'" uid="'+t+'" utype="'+i+'"></div>'},setOnlineUser:function(t){chat.userList.hasOwnProperty(t.userId)||(chat.userList[t.userId]=t)},leaveRoomTip:function(t,e){if("forcedOut"!=t){if("roomClose"==t)$(".blackbg").children().hide(),box.showTipBox("注意：房间已停用，正自动登出..."),"visitor"==indexJS.userInfo.clientGroup?window.setTimeout(function(){indexJS.toRefreshView()},1200):window.setTimeout(function(){$(".logout").trigger("click")},1200);else if("otherLogin"==t){if("visitor"==indexJS.userInfo.clientGroup)return;chat.socket.disconnect(),$(".blackbg").children().hide(),box.showMsg({closeable:!1,title:"登出提示",msg:"注意：您的账号已在其他地方登陆，被踢出！",btns:[{txt:"重新登录",fn:function(){indexJS.toRefreshView()}},{txt:"注销",fn:function(){$("#logout").trigger("click")}}]})}}else if(e)for(var i in e)$("#userListId li[id='"+e[i]+"']").remove()},setWhOnlineTip:function(t,e){var i=$("#wh_msg_"+t+" .titonline strong");if(0!=i.length){var a=$("#wh_msg_"+t+" .titonline strong"),s=$(".mult_dialog a[uid="+t+"]").find("img"),n=$("#userListId li[t=3][uid="+t+"] .headimg");e?(a.text("在线"),s.removeClass("have_op"),n.removeClass("have_op")):(a.text("离线"),s.addClass("have_op"),n.addClass("have_op"))}},getWhToUser:function(){var t=$(".mult_dialog a[class=on]"),e=t.attr("uid");return{userId:e,nickname:t.find("label").text(),talkStyle:1,userType:t.attr("utype")}},sendWhMsg:function(t){var e=chat.getWhToUser(),i=t.find(".text-min-img img");if(i.size()>0){var a=i.attr("src");a.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(a,e),i.remove())}var s=chat.getSendMsg(t);if(s!==!1){var n={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:s}},o=$(".mult_dialog a[class=on]"),r=o.attr("uid");n.fromUser.toUser={userId:r,nickname:o.find("label").text(),talkStyle:1,userType:o.attr("utype")};var l=$("#wh_msg_"+r+" .dialog:last"),c=l.find(".whblt");c.length>0&&(n.fromUser.toUser.question=c.html(),n.fromUser.toUser.questionId=c.attr("rid"),n.fromUser.toUser.publishTime=l.attr("id")),chat.socket.emit("sendMsg",n),chat.setWhContent(n,!0,!1),t.html("")}},setWhVisitors:function(t,e,i,a,s,n,o){if(0==$(".mult_dialog a[uid="+i+"]").length){var r=this.getAImgOrLevel(i,t?t:$("#userListId li[id='"+i+"']").attr("cg"),e,s);$(".mult_dialog").append('<a href="javascript:void(0);" uid="'+i+'" utype="'+e+'" class=""><span class="himg '+r.level+'">'+r.aImg+"</span>"+a+'<i class="num dn" t="0"></i><i class="close"></i></a>');var l=$(".mult_dialog a[uid="+i+"]");if(o){var c=l.find(".num"),d=parseInt(c.attr("t"))+1;c.attr("t",d).text(d).show()}l.find(".close").click(function(){var t=$(this).parent();t.remove(),$("#wh_msg_"+t.attr("uid")).remove(),0==$(".mult_dialog a").length?($(".pletter_win .cont[id]").remove(),$(".pletter_win,.blackbg").hide()):$(".mult_dialog a:last").click()}),l.click(function(){$(".mult_dialog a").removeClass("on"),$(this).addClass("on"),$(this).find(".num").attr("t",0).text("").hide();var t=$(this).attr("uid"),e="wh_msg_"+t,i=$(this).attr("utype"),a=$(this).attr("online");if(chat.closeWhTip(t),$(".pletter_win .cont[id]").hide(),0==$("#"+e).length){var s="whTxt_"+t;$(".pletter_win").append($("#wh_content_tmp").html()),$(".pletter_win .cont:last").attr("id",e).find(".ctextarea").attr("id",s),$("#"+e).find(".facebtn").qqFace({id:"faceId_"+t,zIndex:1e6,assign:s,path:indexJS.filePath+"/face/"}),$("#"+e).find(".imgbtn").click(function(){return FileReader?void $("#"+e).find(".imginp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#"+e).find(".imginp").bind("change",function(){var t=this,e=chat.getWhToUser(),i=t.files[0];if(!i)return!1;if(0!=i.type.indexOf("image")||!i.type||!/\.(?:jpg|png|gif)$/.test(i.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var a=i.size;if(a>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var s=new FileReader;s.readAsDataURL(i),s.onload=function(t){chat.setUploadImg(t.target.result,e)},s.onprogress=function(t){},s.onloadend=function(t){},$(this).val("")}),$("#"+e).find(".ctextarea").pastableTextarea().on("pasteImage",function(t,e){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",e.dataURL),i.find("img").attr("src",e.dataURL)):($(this).append('<a class="text-min-img" href="'+e.dataURL+'" data-lightbox="whSend-img"><img src="'+e.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(t){return 13==t.keyCode?(chat.sendWhMsg($(this)),!1):void 0}),$("#"+e).find(".sendbtn").click(function(t){chat.sendWhMsg($(this).parents(".cont").find(".ctextarea"))}),$("#"+e).find(".pop_close").click(function(){$(".pletter_win .cont[id],.pletter_win .mult_dialog a[uid]").remove(),$(".pletter_win").hide(),$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide()}),$("#"+e).find(".pop_small").click(function(){$(".pletter_win").hide(),$("div.popup_box:visible").length<1&&$("div.pletter_win:visible").length<1&&$(".blackbg").hide()}),chat.socket.emit("getWhMsg",{clientStoreId:indexJS.userInfo.clientStoreId,userType:indexJS.userInfo.userType,groupId:indexJS.userInfo.groupId,groupType:indexJS.userInfo.groupType,userId:indexJS.userInfo.userId,toUser:{userId:t,userType:i}})}$("#"+e).show().find(".wh_nk").text($(this).text()),$("#"+e).find(".ctextarea").focus(),chat.setTalkListScroll(!0,$("#"+e+" .wh-content"),"dark"),chat.setWhOnlineTip(t,common.isValid(a)?!0:n)})}},setWhTip:function(t){if($(".pletter_win").is(":hidden")){var e=$("#userListId li[id="+t+"] a.uname span i"),i=0;e.length>0&&(i=e.text(),i=common.isValid(i)?i:0,$("#userListId li[id="+t+"] a.uname span i").text(parseInt(i)+1)),$("#userListId li[id="+t+"]").attr("k",1),this.whTipInterId||(this.whTipInterId=setInterval(function(){$("#userListId li[k=1]").toggleClass("tip_mrg")},1e3))}},closeWhTip:function(t){$("#userListId li[id="+t+"]").attr("k",0).removeClass("tip_mrg").find("a.uname span i").text(""),0==$("#userListId li[k=1]").length&&this.whTipInterId&&(clearInterval(this.whTipInterId),this.whTipInterId=null)},fillWhBox:function(t,e,i,a,s,n,o){var r=$(".mult_dialog a[uid="+a+"]");if(0==r.length)chat.setWhVisitors(t,i,a,s,e,!0,o);else if(o&&!r.hasClass("on")){var l=r.find(".num"),c=parseInt(l.attr("t"))+1;l.attr("t",c).text(c).show()}return n?(this.setWhTip(a),!1):($(".pletter_win").show(),$(".mult_dialog a[uid="+a+"]").click(),!0)},setWhContent:function(t,e,i,a){var s=t.fromUser,n="dialog ",o=t.content,r="";if(t.rule)return void $("#"+t.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+t.value.tip+"</em>");if(i||(s.toWhUserId=s.userId),indexJS.userInfo.userId==s.userId||"0"==indexJS.userInfo.userType&&"-1"==s.userType||"-1"==indexJS.userInfo.userType&&"0"==s.userType){if(e&&(s.publishTime=t.uiId,s.toWhUserId=s.toUser.userId),t.serverSuccess){if($("#"+t.uiId+" .ctime").html(chat.formatPublishTime(s.publishTime)),$("#"+t.uiId).attr("id",s.publishTime),t.content.msgType==chat.msgType.img){chat.removeLoadDom(s.publishTime);var l=$("#"+s.publishTime+' span[contt="a"]>a'),c=t.content.needMax?"/studio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:l.children("img").attr("src");l.attr("href",c)}return}n+="mine",r='<div class="infobar"><a href="javascript:void(0);" class="uname">我</a><span class="ctime">'+chat.formatPublishTime(s.publishTime,i,"/")+"</span></div>"}else{if(!i&&!a){var d=this.fillWhBox(s.clientGroup,s.avatar,s.userType,s.userId,s.nickname,!0,!0);if(d)return}var u="";"3"==s.userType&&(n+="analyst",u="&nbsp;（助理）"),r='<div class="infobar"><a href="javascript:void(0);" class="uname">'+s.nickname+u+'</a><span class="ctime">'+chat.formatPublishTime(s.publishTime,i,"/")+"</span></div>"}if(common.isBlank(s.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var h="",p=$("#wh_msg_"+s.toWhUserId+" .dialoglist"),m="";if(o.msgType==chat.msgType.img){h=o.needMax?'<a href="/studio/getBigImg?publishTime='+s.publishTime+"&userId="+s.userId+'" data-lightbox="whimg-"'+s.userId+'><img src="'+o.value+'" alt="图片"/></a>':'<a href="'+o.value+'" data-lightbox="whimg-"'+s.userId+'><img src="'+o.value+'" alt="图片" /></a>';var f=e?'</span><em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>':"";h='<div class="bubble"><i></i><div class="dcont"><span contt="a">'+h+f+"</span></div></div>"}else if(a)h='<div class="bubble whcls"><i></i><div class="dcont whblt" rid="'+o.infoId+'">'+o.value+"</div></div>";else{if(!e&&common.isValid(s.toUser.question)){var g='<a href="javascript:void(0);" class="uname">'+s.toUser.nickname+'</a><span class="ctime">'+chat.formatPublishTime(s.publishTime,i,"/")+"</span>";m='<div class="dialog" id="'+s.publishTime+'">'+g+'<div class="bubble whcls"><i></i><div class="dcont whblt">'+s.toUser.question+"</div></div></div>",p.append(m)}h='<div class="bubble"><i></i><div class="dcont"><span contt="a">'+o.value+"</span></div></div>"}if(m='<div class="'+n+'" id="'+s.publishTime+'" utype="'+s.userType+'" mType="'+o.msgType+'">'+r+h+"</div>",p.append(m),this.formatMsgToLink(s.publishTime),!i){var v=p.parents(".wh-content");v.hasClass("mCustomScrollbar")&&chat.setTalkListScroll(!0,v,"dark")}},setOnlineNum:function(t){common.isBlank(t)||isNaN(t)||$(".right_row .main_tabnav a[t='chat'] .dialognum span").text(parseInt(t))},searchUserList:function(t){if(!t)return[];var e=[],i=new RegExp(t,"i");return $.each(chat.userList,function(t,a){-1!=a.userType&&i.test(a.nickname)&&e.push({value:a.userId,label:a.nickname,userType:a.userType})}),e},setUserListIdEmpty:function(){$("#userListId").html("")},setSocket:function(){this.socket=common.getSocket(io,indexJS.socketUrl,indexJS.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),
indexJS.userInfo.socketId=chat.socket.id;var t=$("#roomInfoId");chat.socket.emit("login",{userInfo:indexJS.userInfo,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:t.attr("awr"),allowWhisper:t.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(t,e){var i=e;if("true"==$("#roomInfoId").attr("av")){var a=0,s=0;s=e>100?Math.ceil(50*Math.random())+275:10>=e?60:200/e*3+10;for(var n=0;s>n;n++)a=common.randomNumber(6);i+=s}var o=null;for(var n in t)o=t[n],chat.setOnlineUser(o),3==o.userType&&$(".mult_dialog a[uid="+o.userId+"]").length>0?$(".mult_dialog a[uid="+o.userId+"]").attr("online",!0):$.inArray(o.userType,[1,2])>-1&&0==$('#analystbar a[uid="'+o.userId+'"]').length&&$("#analystbar").append('<a href="javascript:void(0);" t="0" avs="'+o.avatar+'" nk="'+o.nickname+'" class="contactbtn" uid="'+o.userId+'" utype="'+o.userType+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_lts_LianXiTeacher', 'content_right', 1, true]);\">联系"+o.nickname+"</a>");chat.contactAnalystEvent(),i=i+$(".mult_dialog a[uid]").length+$("#analystbar a[uid]").length,chat.setOnlineNum(i)}),this.socket.on("disconnect",function(t){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){if(t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle)chat.setWhContent(t,!1,!1);else{if(!t.serverSuccess&&indexJS.userInfo.userId==t.fromUser.userId&&!t.rule)return;chat.setContent(t,!1,!1)}}),this.socket.on("notice",function(t){switch(t.type){case"onlineNum":var e=t.data,i=e.onlineUserInfo;if(e.online){var a=0;$.inArray(i.userType,[1,2])>-1&&0==$('#analystbar a[uid="'+i.userId+'"]').length&&($("#analystbar").append('<a href="javascript:void(0);" t="0" avs="'+i.avatar+'" nk="'+i.nickname+'" class="contactbtn" uid="'+i.userId+'" utype="'+i.userType+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_lts_LianXiTeacher', 'content_right', 1, true]);\">联系"+i.nickname+"</a>"),a+=1),chat.contactAnalystEvent(),chat.setOnlineUser(i),a+=parseInt($(".right_row .main_tabnav a[t='chat'] .dialognum span").text())+1,chat.setOnlineNum(a)}else if(indexJS.userInfo.userId!=i.userId)if(3==i.userType)$("#userListId #"+i.userId+" .uname>span").addClass("csoffline");else{var a=parseInt($(".right_row .main_tabnav a[t='chat'] .dialognum span").text());$("#userListId #"+i.userId).remove(),$("#analystbar a[uid="+i.userId+"]").remove(),$.inArray(i.userType,[1,2])>-1?a-=1:(0==i.userType||-1==i.userType)&&(a-=1),chat.setOnlineNum(a)}3==i.userType&&chat.setWhOnlineTip(i.userId,e.online);break;case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),chat.setTalkListScroll();break;case"leaveRoom":chat.leaveRoomTip(t.flag,t.userIds);break;case"pushInfo":var e=t.data;switch(e.position){case 1:chat.msgPushObj.whInfos=e.infos;break;case 3:chat.msgPushObj.pbInfos=e.infos;for(var s=0,n=chat.msgPushObj.pbInfos.length;n>s;s++)chat.msgPushObj.pbInfos[s].nextTm=chat.msgPushObj.pbInfos[s].serverTime+60*chat.msgPushObj.pbInfos[s].onlineMin*1e3;break;case 4:videos.rollNews.update(e)}break;case"approvalResult":var e=t.data;if(e.refuseMsg){var o=e.publishTimeArr;for(var s in o)$("#"+o[s]+" span[contt] em[class=ruleTipStyle]").html("已拒绝")}else{for(var s in e)chat.formatUserToContent(e[s]);chat.setTalkListScroll(!0)}break;case"articleInfo":var r=t.data;if(r)switch(r.categoryId){case"trade_strategy_article":var l=r.detailList&&r.detailList[0],c=l&&l.authorInfo&&l.authorInfo.userId;l&&$("#lvInfoId .te_detail").attr("uid")==c&&$("#lvInfoId .info2 p").text(l.content);break;case"class_note":if(r.platform&&-1!=r.platform.indexOf(indexJS.userInfo.groupId)){var l=r.detailList&&r.detailList[0];common.isValid(l.tag)&&"trading_strategy"==l.tag?chatPride.appendTradeStrategyNote(r,!0,!0,!0):chatPride.appendClassNoteInfo(r,!0,!0,!0),chatPride.setAdvertisement(),chatPride.pushShoutSingleInfo(r),indexJS.setListScroll($(".tabcont .main_tab .livebrief_list .scrollbox"))}}break;case"showTrade":var d=t.data;chatShowTrade.pushShowTradeInfo(d)}}),this.socket.on("loadMsg",function(t){$("#dialog_list .push").hide(),$(".img-loading[pf=chatMessage]").hide();var e=t.msgData;if(e&&$.isArray(e)){e.reverse();for(var i in e)chat.formatUserToContent(e[i])}$("#dialog_list .push").appendTo($("#dialog_list")).show(),chat.setTalkListScroll(!0)}),this.socket.on("loadWhMsg",function(t){$("#wh_msg_"+t.toUserId+" .chat_content .dialoglist .dialog .whcls").parent().hide();var e=t.data;if("offline"==t.type){if(e&&!$.isEmptyObject(e))for(var i in e)chat.setWhVisitors(e[i].clientGroup,e[i].userType,i,e[i].nickname,$("#userListId li[id='"+i+"']").length>0)}else if(e&&$.isArray(e)){var a=0,s=null;e.reverse();$(".mult_dialog a[uid="+t.toUserId+"]");for(var n in e)s=e[n],chat.formatUserToContent(s,!0,t.toUserId),s.content.msgType==chat.msgType.img&&a++;$("#wh_msg_"+t.toUserId+" .chat_content .dialoglist .dialog .whcls").parent().appendTo($("#wh_msg_"+t.toUserId+" .chat_content .dialoglist")).show(),chat.setTalkListScroll(!0,$("#wh_msg_"+t.toUserId+" .wh-content"),"dark")}})},setTalkListScroll:function(t,e,i){var a=e?e:$("#chatMsgContentDiv .scrollbox");a.hasClass("mCustomScrollbar")?(a.mCustomScrollbar("update"),t&&a.mCustomScrollbar("scrollTo","bottom")):(a.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:i?i:"light-thick",scrollbarPosition:"outside"}),a.mCustomScrollbar("scrollTo","bottom"))},setWhPushInfo:function(t,e){var i=t.attr("uid"),a=t.text().replace(/\s（助理）$/,"");if($("#wh_msg_"+i+" div[id="+chat.msgPushObj.whInfo.publishTime+"]").length>0)return!1;var s={fromUser:{publishTime:chat.msgPushObj.whInfo.publishTime,userId:i,nickname:a,userType:3},content:{msgType:chat.msgType.text,value:chat.msgPushObj.whInfo.info,infoId:chat.msgPushObj.whInfo.infoId}};return chat.setWhContent(s,!1,!1,!0),chat.msgPushObj.whInfo={},window.clearTimeout(chat.pushInfoTimeOutId),!0},formatUserToContent:function(t,e,i){var a={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,avatar:t.avatar,position:t.position};e?(a.toWhUserId=i,chat.setWhContent({fromUser:a,content:t.content},!1,!0)):chat.setContent({fromUser:a,content:t.content},!1,!0)},talkBoxPush:{showMsg:function(t){var e=[];e.push('<div class="info_push" style="padding-right:10px;">'),e.push(t.content),e.push("</div>"),$("#dialog_list").append(e.join("")),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}},setPushInfo:function(){var t=null,e=chat.msgPushObj.whInfos;if(e&&e.length>0&&"vip"!=$("#roomInfoId").attr("rt"))for(var i=0,a=e.length;a>i;i++)if(t=e[i],!t.pushed&&t&&indexJS.serverTime>=t.serverTime+60*t.timeOut*1e3){t.pushed=!0,chat.msgPushObj.whInfo={info:t.content,publishTime:t.publishTime,infoId:t.contentId};var s=$(".pletter_win .mult_dialog a[utype=3]"),n=$(s.get(common.randomIndex(s.length))),o=n.attr("uid");if(common.isBlank(o))continue;$(".mult_dialog a[uid="+o+"]").click(),chat.setWhPushInfo($(".mult_dialog a[uid="+o+"]")),$(".pletter_win").is(":hidden")&&$(".mod_infotab .tabnav .myaid").click()}var r=null,l=chat.msgPushObj.pbInfos;if(l&&l.length>0)for(var i=0,c=l.length;c>i;i++)r=l[i],r&&r.nextTm&&indexJS.serverTime>=r.nextTm&&common.dateTimeWeekCheck(r.pushDate,!1,indexJS.serverTime)&&(r.intervalMin&&r.intervalMin>0?r.nextTm=indexJS.serverTime+60*r.intervalMin*1e3:delete r.nextTm,chat.talkBoxPush.showMsg(r))},contactAnalystEvent:function(){$("#analystbar a").unbind("click"),$("#analystbar a").click(function(){chat.setDialog($(this).attr("uid"),$(this).attr("nk"),$(this).attr("t"),$(this).attr("utype"),$(this).attr("avs"))})},replyEvent:function(t,e){t="object"==typeof t?t:$(t),t.unbind("click"),t.click(function(){var t=$(this),e=t.prev().children("span.sender").html();chat.setDialog(t.attr("uId"),e,t.attr("ts"),t.attr("futype")),$(".mymsg em").show()}),e="object"==typeof e?e:$(e),e.unbind("click"),e.click(function(){$(this).parent().remove(),0==$("#myMsgListContent .mymsg_list").length?$(".mymsg,.mymsg em").hide():$("#myMsgListContent .mymsg_list").length<2&&$(".mymsg").height(27)})},showSystemTopInfo:function(t,e,i){var a=$("#chatPrideSystemTopInfo");a.data("data",{type:t,id:e}),a.find(".pushcont span").text(i),a.slideDown()}},chatTeacher={teacherId:null,teacherSele:"off",init:function(){this.setEvent()},setEvent:function(){$("#sdNoAuthBox .contactContact").click(function(){0==$(".pletter_win .mult_dialog a[utype=3]").length&&chat.getCSList(),$(this).hasClass("nocs")?box.showTipBox("助理失联中"):common.openPopup(".blackbg,.pletter_win"),$("#sdNoAuthBox").hide()})},sd:{analyst:null,tradeList:[],loadAll:!1,setSDEvent:function(){$("#sdNoAuthBox .aid_chat span").bind("click",function(){$("#sdNoAuthBox .pop_close").trigger("click");var t=$(this).attr("uid"),e=$("#userListId li[id='"+t+"']");0==e.size()&&(e=$("#userListId li[utype='3']:first")),e.find("em").trigger("click")})},initSD:function(){var t=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);!t||!t.lecturerId||videos.sd.analyst&&-1!=t.lecturerId.indexOf(videos.sd.analyst.userNo)||$.getJSON("/studio/getShowTradeInfo",{userNo:t.lecturerId},function(t){t&&t.analyst&&(videos.sd.analyst=t.analyst,videos.sd.tradeList=t.tradeList||[],videos.sd.loadAll=!1,$("#sdInfoId .nosd_tip").hide(),videos.sd.showPraiseInfo(),videos.sd.showSDInfo())})},showPraiseInfo:function(){$("#sdInfoId .te_info").empty();var t=this.analyst;$("#sdInfoId .te_info").append('<div class="te_detail sd" uid="'+t.userNo+'"><img src="'+t.avatar+'" alt=""><div class="rcont"><span><strong>'+t.userName+'</strong><i class="suc">TA的胜率：<b>'+(t.winRate||"--")+'</b></i></span> <a href="javascript:" class="support" uid="'+t.userNo+'"><label>'+t.praiseNum+"</label><i>+1</i></a> </div> </div>"),$("#sdInfoId .te_detail .support").click(function(){var t=$(this);try{common.getJson("/studio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:t.attr("uid")},function(e){if(e.isOK){t.find("i").fadeIn().delay(400).fadeOut();var i=t.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");t.addClass("supported"),t.attr("title","已点赞");var a=$("#lvInfoId .te_detail .support[uid='"+videos.sd.analyst.userNo+"']");a.find("label").text(t.find("label").text()),a.addClass("supported"),a.attr("title","已点赞")},!0)}catch(e){console.error("setPraise->"+e)}})},showSDInfo:function(){this.showWXInfo(),$("#sdInfoId .sd_ul").empty(),this.showTradeList()},showWXInfo:function(){var t=[];this.analyst.wechatCode&&(t.push('<div class="te_wx">'),t.push('<div class="wx-qrcode">'),this.analyst.wechatCodeImg&&t.push('<img src="'+this.analyst.wechatCodeImg+'" alt="'+this.analyst.wechatCode+'">'),t.push("</div>"),t.push('<span class="wx-num">老师微信号: <b>'+this.analyst.wechatCode+"</b></span>"),t.push("</div>"),$("#sdInfoId .te_info").append(t.join("")))},showTradeList:function(){if(videos.sd.loadAll)return!1;for(var t=$("#sdInfoId .sd_ul li").size(),e=videos.sd.tradeList,i=e?e.length:0,a=null,s=[],n=indexJS.checkClientGroup("new"),o=!1,r=t;i>r&&t+6>r;r++)a=e[r],o=!a.profit,s.push('<li><div class="cont">'),s.push('<div class="sd_tit">'),s.push('<span class="dep">'),o?s.push("持仓中"):(s.push("获利："),s.push("<b"+(/^-/.test(a.profit)?' class="fall"':"")+">"+a.profit+"</b>")),s.push("</span>"),s.push('<span class="sdtime">晒单时间: '+common.formatterDateTime(a.showDate).substring(5,16)+"</span>"),s.push("</div>"),n&&o?(s.push('<a href="javascript:videos.sd.showAuthBox()">'),s.push('<img src="/pm/theme1/img/sd_default.png"></a>')):(s.push('<a href="'+a.tradeImg+'" data-lightbox="sd-img" data-title="'+(o?"持仓中":"获利："+a.profit)+'">'),s.push('<img src="'+a.tradeImg+'"></a>')),s.push("<i></i></div></li>");r>=i-1&&(videos.sd.loadAll=!0),$("#sdInfoId .sd_ul").append(s.join("")),indexJS.setListScroll($("#sdInfoId .sd_show"),null,{callbacks:{onTotalScroll:videos.sd.showTradeList}})},showAuthBox:function(){var t=$("#userListId li[utype='3']:first");$("#sdNoAuthBox .sdzl").show(),$("#sdNoAuthBox .aid_chat img").attr("src",t.find(".headimg img").attr("src")),$("#sdNoAuthBox .aid_chat span").attr("uid",t.attr("id")).text(t.find(".uname span:first").text()),$("#sdNoAuthBox,.blackbg").show()}},trainRegis:function(t){if(indexJS.userInfo.isLogin){var e=$(t).attr("userno"),i=$(t).attr("cgs"),a=$(t).attr("updateTrain"),s=$(t).attr("isDetail"),n=indexJS.userInfo.clientGroup,o=indexJS.userInfo.nickname;if(-1!=i.indexOf(n)){var r={groupId:$(t).attr("rid"),userNo:e,clientGroup:i,nickname:o};common.getJson("/studio/addClientTrain",{data:JSON.stringify(r)},function(i){i.awInto?indexJS.toRefreshView():i.errcode?"true"==$(t).attr("rml")&&$.inArray(i.errcode,["3003","3009"])>-1?($(".train_detail .pop_tit label").text($(t).text()),$("#train_info_id").empty().load("/studio/getTrDetail?uid="+e,function(){$('#train_info_id .scrollbox[tid="'+e+'"]').show()}),common.openPopup(".blackbg,.train_detail")):box.showMsg(i.errmsg):i.isOK?a?chatTeacher.showTrani(i.chatGroup):"true"==s?videosTrain.getTrainList():box.showMsg(i.msg):box.showMsg(i.msg||i.errmsg)})}else box.showMsg({msg:"该房间仅对培训班学员开放,"}),$("#popMsgTxt").append("<a class=\"contactContact\" style=\"color:#2980d1; font-size:14px;text-decoration:none;cursor:pointer\" onclick=\"videosLive.contactTeacher();_gaq.push(['_trackEvent', 'pmchat_studio', 'left_zb_callzhuli', 'content_left', 1, true]);\">如有疑问请联系老师助理</a>。"),$("#popMsgCont .yesbtn").bind("click",function(){videosLive.contactTeacher(),_gaq.push(["_trackEvent","pmchat_studio","left_zb_confirm","content_left",1,!0])})}else $("#loginBox").css("z-index","102"),common.openPopup(".blackbg,.login")},selectAnalyst:function(t){chatTeacher.teacherSele="off",chatTeacher.getShowTeacher($(t).attr("uid")),chatTeacher.teacherSele="on"},clearHtml:function(t){var e=$(".main_tab .teacherlist .teacherbox");for(var i in t)e.find(t[i]).html("")},getShowTeacher:function(t){if($(".main_tabnav a[t=teacher]").hasClass("on")){var e;if(common.isBlank(t))e=indexJS.courseTick.course&&indexJS.courseTick.course.lecturerId.split(",")[0];else if(e=t,e==chatTeacher.teacherId||"on"==chatTeacher.teacherSele)return;common.isBlank(e)&&(e=$("#textlivePanel .livebrief[pt]:eq(0)>div.te_info").attr("tid")||"");var i=LoginAuto.sessionUser.groupId;this.clearHtml([".taglist",".sd_show .sd_ul",".tebox_teachLive ul",".tebox_studentLive ul",".tebox_teachVideo ul"]),common.getJson("/studio/getShowTeacher",{data:JSON.stringify({groupId:i,authorId:e})},function(t){var i=t.userInfo,a=t.teacherList,s=t.tradeList,n=t.trainList,o=t.trAndClNum;if(null!=i){chatTeacher.teacherId=i.userNo,$(".main_tab .teacherlist .teacherbox .te_top  .info-l span").eq(0).text(i.userName),$(".main_tab .teacherlist .teacherbox .te_top  .info-l span").eq(1).text(i.position),$(".main_tab .teacherlist .teacherbox .te_top  .himg img").attr({src:i.avatar});var r=common.isBlank(i.winRate)||""==i.winRate?"--":i.winRate,l=common.isBlank(i.earningsM)||""==i.earningsM?"--":i.earningsM;if($(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item b").eq(0).text(r),$(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item b").eq(1).text(l),$("#analystIntro").text(i.introduction),$("#analystWeChatQrCode").attr("src",i.wechatCodeImg),$(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item:last-child").empty(),$(".main_tab .teacherlist .teacherbox .te_top  .stateshow .item:last-child").append('<a href="javascript:void(0)" class="support" uid="'+i.userNo+'" onclick="chatTeacher.showAnalystPraiseInfo(this)"><i class="i6"></i></a><b>(<label>'+i.praiseNum+"</label>)</b><span>赞</span>"),$(".main_tab .teacherlist .teacherbox  .taglist").empty(),i.tag){for(var c=[],d=i.tag.split(","),u=0;u<d.length;u++){var h=d[u];c.push('<span class="tag"><span>'+h+"</span><i></i></span>")}$(".main_tab .teacherlist .teacherbox  .taglist").html(c.join(""))}}if(null!=a){for(var p=[],m=null,u=0;u<a.length;u++)m=a[u],p.push("<a href=\"javascript:void(0)\" onclick=\"chatTeacher.selectAnalyst(this);_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_OthenTeacher', '"+m.userName+'\', 1, true]);" uid="'+m.userNo+'">'+m.userName+"</a>");$(".main_tab .teacherlist .teacherbox  .clearfix .teacher_select .selectlist").html(p.join(""))}if(null!=s){var t={type:"prerogative",item:"prerogative_position"};common.getJson("/studio/getChatPointsConfig",{data:JSON.stringify(t)},function(t){var e=!1,i=!1;if(t)for(var a=t.clientGroup,n=0,o=a?a.length:0;o>n;n++){var r=a[n];r==indexJS.userInfo.clientGroup&&(e=!0)}for(var l=[],c=null,n=0,d=1;n<s.tradeList.length&&(c=s.tradeList[n],i=!c.profit,!(d>4));n++,d++)d%2!=0?l.push("<li>"):l.push('<li class="r">'),l.push('<div class="cont">'),l.push('<div class="sd_tit">'),l.push('<span class="dep">'),i?l.push("持仓中"):(l.push("获利："),l.push("<b"+(/^-/.test(c.profit)?' class="fall"':"")+">"+c.profit+"</b>")),l.push("</span>"),l.push('<span class="sdtime">晒单时间: '+common.formatterDateTime(c.showDate).substring(5,16)+"</span>"),l.push("</div>"),i?indexJS.userInfo.isLogin&&e?(l.push('<a href="#" onclick="chatTeacher.deductionIntegralShowTrade(this)" tradeId="'+c._id+'" tradeImg="'+c.tradeImg+'" isPos="'+i+'" profit="'+c.profit+'">'),l.push('<i class="i-zoom"></i><img src="/pm/theme1/img/sd_default.png"></a>')):indexJS.userInfo.isLogin?(l.push('<a href="'+c.tradeImg+'" data-lightbox="sd-img" data-title="'+(i?"持仓中":"获利："+c.profit)+'">'),l.push('<i class="i-zoom"></i><img src="'+c.tradeImg+'"></a>')):(l.push("<a href=\"javascript:chatTeacher.sd.showAuthBox();_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_ChiChangZhong', 'content_right', 1, true]);\">"),l.push('<i class="i-zoom"></i><img src="/pm/theme1/img/sd_default.png"></a>')):(l.push('<a href="'+c.tradeImg+'" data-lightbox="sd-img" data-title="'+(i?"持仓中":"获利："+c.profit)+'">'),l.push('<i class="i-zoom"></i><img src="'+c.tradeImg+'"></a>')),l.push("</div></li>");$(".main_tab .teacherlist .teacherbox .sd_show .sd_ul").html(l.join(""))})}null!=n&&chatTeacher.showTrani(n,o),indexJS.getArticleList("teach_video_base,teach_video_expert,teach_video_financial,teach_video_gw,student_style,teach_live_video",indexJS.userInfo.groupId,0,1,20,'{"createDate":"desc"}',{authorId:e},function(t){if(t&&0==t.result){for(var e=t.data,i=1,a=1,s=1,n=[],o=[],r=[],l=null,c=null,d=0;d<e.length;d++)l=e[d],c=e[d].detailList[0],"teach_live_video"==l.categoryId?6>=i&&(i%3!=0?n.push("<li>"):n.push('<li class="r">'),n.push('<a href="javascript:" class="imga" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vUrl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_Wonderfullive', '"+c.title+'\', 1, true]);"><img src="'+l.mediaImgUrl+'" ><b class="playbtn"><i></i></b></a>'),n.push('<a href="javascript:" class="vlink" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vUrl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_Wonderfullive', '"+c.title+"', 1, true]);\">"+c.tag+"</a>"),n.push("</li>"),i++):"student_style"==l.categoryId?3>=a&&(a%3!=0?o.push("<li>"):o.push('<li class="r">'),o.push('<a href="'+l.mediaUrl+'" data-lightbox="student-img" data-title="'+c.title+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_StudentsStyle', '"+c.tag+'\', 1, true]);"><div class="imga"><img src="'+l.mediaUrl+'" ></div></a>'),o.push('<span class="vlink">'+c.tag+"</span>"),o.push("</li>"),a++):3>=s&&(s%3!=0?r.push("<li>"):r.push('<li class="r">'),r.push('<a href="javascript:" class="imga" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vUrl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_teachvideo', '"+c.title+'\', 1, true]);"><img src="'+l.mediaImgUrl+'" ><b class="playbtn"><i></i></b></a>'),r.push('<a href="javascript:" class="vlink" title="'+c.title+'" ct="'+l.categoryId+'" articleId="'+l._id+'" vUrl="'+l.mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_teachvideo', '"+c.title+"', 1, true]);\">"+c.tag+"</a>"),r.push("</li>"),s++);$(".main_tab .teacherlist .teacherbox .tebox_teachLive ul").html(n.join("")),$(".main_tab .teacherlist .teacherbox .tebox_studentLive ul").html(o.join("")),$(".main_tab .teacherlist .teacherbox .tebox_teachVideo ul").html(r.join("")),$(".main_tab .teacherlist .teacherbox .tebox_teachLive ul li a").click(function(){$(".main_tab .teacherlist .teacherbox .tebox_teachLive ul li .vlink").removeClass("on"),"imga"==$(this).attr("class")&&$(this).next(".vlink").addClass("on"),"vlink"==$(this).attr("class")&&$(this).addClass("on"),videos.player.play($(this).attr("vurl"),$(this).attr("title"));var t=$(this).attr("articleId");chatAnalyze.setUTM(!1,{courseId:t})}),$(".main_tab .teacherlist .teacherbox .tebox_teachVideo ul li a").click(function(){$(".main_tab .teacherlist .teacherbox .tebox_teachVideo ul li .vlink").removeClass("on"),"imga"==$(this).attr("class")&&$(this).next(".vlink").addClass("on"),"vlink"==$(this).attr("class")&&$(this).addClass("on"),videos.player.play($(this).attr("vurl"),$(this).attr("title"));var t=$(this).attr("articleId");chatAnalyze.setUTM(!1,{courseId:t})})}})})}},showTrani:function(t,e){if(null!=t){var i=[];t.forEach(function(t,e){(e+1)%2!=0?i.push("<li>"):i.push('<li class="r">');var a=common.trim(t.remark);i.push('<div class="cont">'),i.push('<div class="headimg"><img src="'+t.defaultAnalyst.avatar+'" alt=""></div>'),i.push('<div class="train_name">'+t.name+"</span></div>"),i.push("<p>"+a+"</p>"),i.push('<a href="javascript:void(0)" class="trainbtn" userno="'+t.defaultAnalyst.userNo+'" sp="'+t.allowInto+'" cgs= "'+t.clientGroup+'" rid="'+t._id+"\" updateTrain=\"updateTrain\" onclick=\"chatTeacher.trainRegis(this);_gaq.push(['_trackEvent', 'pmchat_studio', 'right_ls_Signup', '"+t.name+"', 1, true]);\">"+(t.allowInto?"进入":"报名")+"（"+t.clientSize+"人）</a>"),i.push("</div></li>")}),e&&$(".main_tab .teacherlist .teacherbox .tebox_train  .tebox_tit span").text("(已结束开班"+e.trainNum+"期/总共"+e.clientNum+"人)"),$(".main_tab .teacherlist .teacherbox .tebox_train  ul").empty().prepend(i.join(""))}},showAnalystPraiseInfo:function(t){var e=$(t);try{common.getJson("/studio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:e.attr("uid")},function(t){if(t.isOK){var i=e.next().find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0),box.showTipBox("亲，点赞成功！")}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)}catch(i){console.error("setPraise->"+i)}},deductionIntegralShowTrade:function(t){var e=$(t);if(indexJS.userInfo.isLogin&&"vip"!=indexJS.userInfo.clientGroup){var i={groupType:indexJS.userInfo.groupType,item:"prerogative_position",tag:"trade_"+e.attr("tradeId")};common.getJson("/studio/addPointsInfo",{params:JSON.stringify(i)},function(t){t.isOK?(e.attr("href",e.attr("tradeImg")),e.attr("data-lightbox","sd-img"),e.attr("data-title",e.attr("isPos")?"持仓中":"获利："+e.attr("profit"))):box.showTipBox(t.msg)})}}},chatShowTrade={tradeForUser:null,tradeList:[],tradeLoadAll:!1,init:function(){this.setEvent()},setEvent:function(){indexJS.userInfo.isLogin&&chatShowTrade.getPointsInfo(),$("#wantShowTrade").click(function(){if(indexJS.userInfo.isLogin)(common.isBlank(indexJS.userInfo.isSetName)||indexJS.userInfo.isSetName)&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),common.openPopup(".pop_addsd,.blackbg");else{var t=t||{};box.openLgBox(t.closeable,t.showTip)}}),$("#myShowTrade").click(function(){if(indexJS.userInfo.isLogin)$(".pop_mysd .sd_list .sd_ul").empty(),chatShowTrade.getPointsInfo(),chatShowTrade.tradeForUser=indexJS.userInfo.userId,chatShowTrade.initShowTrade(),$(".pop_mysd .personal_info .headimg img").attr("src",$("#avatarInfoId").attr("src")),$(".pop_mysd .personal_info .username").text(indexJS.userInfo.nickname),$(".pop_mysd .personal_info .infobar").removeClass("dn"),common.openPopup(".pop_mysd,.blackbg");else{var t={};box.openLgBox(t.closeable,t.showTip)}}),$("#flTradeImg").change(function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=e.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var a=new FormData($("#showTradeForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:a,async:!1,cache:!1,contentType:!1,processData:!1,success:function(e){if(0==e.result){var i=e.data?e.data[0]:null;i&&($("#tradeImg").val(i.fileDomain+i.filePath),$(t).val(""))}else alert("上传图片失败，请联系在线客服！")},error:function(t){console.error("error:",t)}})}catch(s){console.error("上传图片失败",s)}}),$("#tradeSubmit").click(function(){chatShowTrade.showTrade()})},initShowTrade:function(){var t={groupType:indexJS.userInfo.groupType};common.isValid(chatShowTrade.tradeForUser)&&(t.userNo=chatShowTrade.tradeForUser),common.getJson("/studio/getShowTrade",{data:JSON.stringify(t)},function(t){t.isOK&&common.isValid(t.data)&&(common.isValid(chatShowTrade.tradeForUser)&&$(".pop_mysd .sd_list .sd_ul").empty(),chatShowTrade.tradeList=t.data.tradeList||[],chatShowTrade.tradeLoadAll=!1,chatShowTrade.setShowTrade())})},setShowTrade:function(){if(chatShowTrade.tradeLoadAll)return!1;for(var t,e=common.isBlank(chatShowTrade.tradeForUser)?$("#showTradeDiv .scrollbox ul.sd_ul li").size():$(".pop_mysd .sd_list .sd_ul li").size(),i=chatShowTrade.tradeList,a=null,s=i.length,n="",o=common.isBlank(chatShowTrade.tradeForUser)?chatShowTrade.formatHtml("showTradeAll"):chatShowTrade.formatHtml("showTradeUser"),r=e;s>r&&e+20>r;r++)if(a=i[r],!($('#showTradeDiv .sd_ul li[sid="'+a._id+'"]').length>0&&common.isBlank(chatShowTrade.tradeForUser))){switch(a.status){case 1:t="";break;case 0:t=' class="checking"';break;case-1:t=' class="failed"'}var l=common.formatterDateTime(a.showDate,"/").substr(5,11);n+=common.isBlank(chatShowTrade.tradeForUser)?o.formatStr(a.title,a.user.userName,l,a.tradeImg,a.remark,common.isBlank(a.praise)?0:a.praise,a._id,a.user.userNo,a.user.avatar):o.formatStr(a.title,l,a.tradeImg,a.remark,common.isBlank(a.praise)?0:a.praise,a._id,t)}common.isBlank(chatShowTrade.tradeForUser)?($("#showTradeDiv .scrollbox ul.sd_ul li").removeClass("r"),$("#showTradeDiv .scrollbox ul.sd_ul").append(n),$("#showTradeDiv .scrollbox ul.sd_ul li:odd").addClass("r")):($(".pop_mysd .sd_list .sd_ul li").removeClass("r"),$(".pop_mysd .sd_list .sd_ul").append(n),$(".pop_mysd .sd_list .sd_ul li:odd").addClass("r")),r>=s-1&&(chatShowTrade.tradeLoadAll=!0),chatShowTrade.setUserShowTrade(),chatShowTrade.showTradePraise(),common.isBlank(chatShowTrade.tradeForUser)?indexJS.setListScroll("#showTradeDiv .scrollbox",null,{callbacks:{onTotalScroll:function(){chatShowTrade.setShowTrade()}}}):($(".pop_mysd .sd_list .scrollbox").height(340),indexJS.setListScroll(".pop_mysd .sd_list .scrollbox",null,{callbacks:{onTotalScroll:function(){chatShowTrade.setShowTrade()}}}))},setUserShowTrade:function(){$("#showTradeDiv .sd_ul li .sd_tit .dep a").unbind("click").click(function(){chatShowTrade.tradeForUser=$(this).attr("userId"),chatShowTrade.initShowTrade(),$(".pop_mysd .personal_info .headimg img").attr("src",$(this).attr("avatar")),$(".pop_mysd .personal_info .username").text($(this).text()),$(".pop_mysd .personal_info .infobar").addClass("dn"),common.openPopup(".pop_mysd,.blackbg")})},showTrade:function(){var t=$("#title").val(),e=$("#userName").val(),i=$("#tradeImg").val(),a=$("#remark").val();if(common.isBlank(t))$("#trade_error").text("请输入标题").show();else if(common.isBlank(e))$("#trade_error").text("请输入晒单人").show();else if(common.isRightName(e))if(common.isBlank(i))$("#trade_error").text("请上传晒单图片").show();else{var s={groupType:indexJS.userInfo.groupType,groupId:indexJS.userInfo.groupId,userNo:indexJS.userInfo.userId,avatar:$("#avatarInfoId").attr("src"),userName:e,tradeImg:i,remark:a,title:t,tradeType:2};common.getJson("/studio/addShowTrade",{data:JSON.stringify(s)},function(t){t.isOK?(box.showMsg("您的晒单已成功提交，等待系统审核！"),indexJS.userInfo.isSetName||($("#myNickName").val(e),$("#setNkBtn").click()),$(".pop_addsd").hide(),$('.pop_addsd input[type="text"],.pop_addsd textarea').empty()):box.showMsg(t.msg)})}else $("#trade_error").text("晒单人为2至10位字符(数字/英文/中文/下划线)，不能全数字!")},showTradePraise:function(){$("#showTradeDiv .scrollbox ul li .support,.pop_mysd .sd_list .sd_ul li .support").unbind("click").click(function(){var t=$(this),e={clientId:indexJS.userInfo.userId,praiseId:$(this).attr("id")};common.getJson("/studio/setTradePraise",{data:JSON.stringify(e)},function(e){if(e.isOK){var i=t.find("span");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");t.addClass("supported"),t.attr("title","已点赞")},!0)})},getPointsInfo:function(t){common.getJson("/studio/getPointsInfo",{params:JSON.stringify({groupType:indexJS.userInfo.groupType})},function(e){if(e){for(var i={},a={},s=indexJS.pointLevel.length-1;s>=0;s--){var n=indexJS.pointLevel[s];if(e.pointsGlobal>=n.points){i=n,a=indexJS.pointLevel[s+1];break}}$("#myLevel,#sdLevel").text(i.name),$(".personal_center .levelbar .progress b,.pop_mysd .levelbar .progress b").css("width",e.pointsGlobal/a.points*100+"%"),$(".personal_center .levelbar .le_detail,.pop_mysd .levelbar .le_detail").attr({pg:e.pointsGlobal,sendget:t}).text(e.pointsGlobal+"/"+a.points),$("#mypoints,#sdPoints").text(e.points);var o=[],r=[],l=chatShowTrade.formatHtml("getPoint"),c=chatShowTrade.formatHtml("pointConsume");$.each(e.journal,function(t,e){e.change>0?o.unshift(l.formatStr(common.formatterDate(e.date,"."),e.remark?e.remark+"，":"",e.change)):e.change<0&&r.unshift(c.formatStr(common.formatterDate(e.date,"."),e.remark?e.remark+"，":"",Math.abs(e.change)))}),$("#myPointsDetail .get .borbox table tbody").html(o.join("")),$("#myPointsDetail .consume .borbox table tbody").html(r.join("")),$("#myPointsDetail").css("height","280px"),indexJS.setListScroll($("#myPointsDetail"))}else $("#myLevel,#sdLevel").text("L0"),$(".personal_center .levelbar .progress b,.pop_mysd .levelbar .progress b").css("width","0%"),$(".personal_center .levelbar .le_detail,.pop_mysd .levelbar .le_detail").text("0/0"),$("#mypoints,#sdPoints").text("0")})},pushShowTradeInfo:function(t){for(var e="",i=chatShowTrade.formatHtml("showTradeAll"),a=null,s=null,n=chatShowTrade.formatHtml("pushShowTradeInfo"),o=0,r=t.length;r>o;o++){if(a=t[o],0==$('#showTradeDiv .sd_ul li[sid="'+a.id+'"]').length){var l=common.formatterDateTime(a.showDate.time,"/").substr(5,11);e+=i.formatStr(a.title,a.boUser.userName,l,a.tradeImg,a.remark,common.isBlank(a.praise)?0:a.praise,a.id,a.boUser.userNo,a.boUser.avatar),$("#showTradeDiv .scrollbox ul.sd_ul li").removeClass("r"),$("#showTradeDiv .scrollbox ul.sd_ul").prepend(e),$("#showTradeDiv .scrollbox ul.sd_ul li:odd").addClass("r"),indexJS.setListScroll("#showTradeDiv .scrollbox",null,{callbacks:{onTotalScroll:function(){chatShowTrade.setShowTrade()}}})}s=a.boUser.userName+"在晒单墙晒了一单，"+(common.isBlank(a.title)?"...":a.title),$("#chatMsgContentDiv .dialoglist").append(n.formatStr(s,a.id)),chat.showSystemTopInfo("showTrade",a.id,s)}chat.setTalkListScroll(!0),$("#chatMsgContentDiv .dialoglist .pushclose").unbind("click"),$("#chatMsgContentDiv .dialoglist .pushclose").click(function(){$(this).parent().hide()}),$("#chatMsgContentDiv .dialoglist .showtrade").unbind("click"),$("#chatMsgContentDiv .dialoglist .showtrade").click(function(){chatShowTrade.gotoLook($(this).attr("_id"))})},gotoLook:function(t){$('.main_tabnav a[t="showtrade"]').click(),indexJS.setListScroll("#showTradeDiv .scrollbox",$('#showTradeDiv .sd_ul li[sid="'+t+'"]').offset().top)},formatHtml:function(t){var e=[];switch(t){case"showTradeAll":e.push('<li sid="{6}">'),e.push('    <div class="cont">'),e.push('        <div class="sd_summary">{0}</div>'),e.push('        <div class="sd_tit">'),e.push('            <span class="dep">晒单人：<a href="javascript:void(0);" class="sd_author" userId="{7}" avatar="{8}">{1}</a></span>'),e.push('            <span class="sdtime">晒单时间: {2}</span>'),e.push("        </div>"),e.push('        <a href="{3}" data-rel="sd-img" data-title="{0}" data-lightbox="dialog-img">'),
e.push('            <img src="{3}" alt="{0}" class="mCS_img_loaded"><i class="i-zoom"></i>'),e.push("        </a>"),e.push('        <p class="sd_p">{4}</p>'),e.push('        <div class="sd_bot">'),e.push('            <span class="from"><b>&nbsp;</b></span>'),e.push('            <a href="javascript:void(0)" class="support" id="{6}"><i></i>(<span>{5}</span>)</a>'),e.push("        </div>"),e.push("    </div>"),e.push("</li>");break;case"showTradeUser":e.push("<li{6}>"),e.push('    <div class="cont">'),e.push('        <div class="sd_summary">{0}<i class="status"></i></div>'),e.push('        <div class="sd_tit"><span class="sdtime">晒单时间: {1}</span></div>'),e.push('        <a href="{2}" data-rel="sd-img" data-title="{0}" data-lightbox="my-dialog-img"><img src="{2}" alt="{0}" class="mCS_img_loaded"><i class="i-zoom"></i></a>'),e.push('        <p class="sd_p">{3}</p>'),e.push('        <div class="sd_bot">'),e.push('          <span class="from"><b>&nbsp;</b></span>'),e.push('            <a href="javascript:void(0)" class="support" id="{5}"><i></i>(<span>{4}</span>)</a>'),e.push("        </div>"),e.push("    </div>"),e.push("</li>");break;case"getPoint":e.push("<tr>"),e.push('<td><span class="date">{0}</span></td>'),e.push("<td>{1}获得<b>{2}</b>积分</td>"),e.push("</tr>");break;case"pointConsume":e.push("<tr>"),e.push('<td><span class="date">{0}</span></td>'),e.push("<td>{1}消费<b>{2}</b>积分</td>"),e.push("</tr>");break;case"pushShowTradeInfo":e.push('<div class="info_push">'),e.push('    <div class="pushcont">系统：{0}</div>'),e.push("    <a href=\"javascript:void(0);\" class=\"detailbtn showtrade\" _id=\"{1}\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'right_lts_QuKankan', 'content_right', 1, true]);\">去看看</a>"),e.push('    <a href="javascript:void(0);" class="pushclose"><i></i></a>'),e.push("</div>")}return e.join("")}};