function openLive800Chat(e){var t="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";e?location.href=t:window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(e,t){common.isBlank(t)&&(t="800018282");var i="http://crm2.qq.com/page/portalpage/wpa.php?uin="+t+"&cref=&ref=&f=1&ty=1&ap=&as="+e;window.open(i,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(e)}function live800Prompt(e){window.onbeforeunload=null;var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==e)try{UUID.prototype.createUUID();window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(i)}}function qqPrompt(e){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(s){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}function getMarketpriceCrossDomainIndex(e,t){$.ajax({type:"GET",url:e,dataType:"jsonp",success:function(e){"OK"==e.code&&parseMarketpriceIndex(e,t)},error:function(){}})}function parseMarketpriceIndex(e,t){for(var i=2,s="",n=0,a=0,o=0,r=0;r<e.listResult.length;r++){s=e.listResult[r].symbol,n=e.listResult[r].deltaPrice,o=e.listResult[r].price,a=e.listResult[r].deltaPercent,i="XAGUSD"==s||"USDJPY"==s?3:"EURUSD"==s?3:2;var l=$("#price_"+s);l.html(parseFloat(o).toFixed(i));var d=$("#deltaPercent_"+s);if(d.text((100*a).toFixed(2)+"%"),t){var c=parseFloat(o).toFixed(i);c=c.toString().substring(0,c.indexOf("."))+"<span>."+c.toString().substring(c.indexOf(".")+1)+"</span>",l.html(c+'<i changeCss="true"></i>');var u=$("#price_"+s+" i");d.text(n+"  "+(100*a).toFixed(2)+"%"),n>0?"true"==u.attr("changeCss")&&(l.removeClass(t.down),d.removeClass(t.down),u.removeClass(t.downCss).addClass(t.upCss)):"true"==u.attr("changeCss")&&(l.addClass(t.down),d.addClass(t.down),u.removeClass(t.upCss).addClass(t.downCss))}else n>0?$("#price_"+s).parent().addClass("up"):$("#price_"+s).parent().removeClass("up"),$("#deltaPrice_"+s).html(parseFloat(n).toFixed(i))}}function getAllMarketpriceIndex(e,t,i,s){try{window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket?pkMarketSocket?pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t):(pkMarketSocket=new ReconnectingWebSocket(e,null,{reconnectInterval:3e3}),pkMarketSocket.onmessage=function(e){var t=JSON.parse(e.data);"OK"==t.code&&parseMarketpriceIndex(t,s)},pkMarketSocket.onopen=function(e){pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t)}):setInterval(function(){getMarketpriceCrossDomainIndex(i,s)},2e3)}catch(n){console.log("get price has error!")}}function getSymbolPriceDatas(e,t,i){$.ajax({url:e,type:"GET",dataType:"jsonp",jsonp:"jsoncallback",jsonpCallback:"_setViewPrice",timeout:5e3,beforeSend:function(){},success:function(e){_setViewPrice(e,t,i)},error:function(e){}})}function _setViewPrice(e,t,i){if(0===e.status){var s=2,n="",a=0,o=0,r=0;$.each(e.data,function(e,l){if(common.isValid(i)&&$.isArray(i)&&$.inArray(e,i)>-1){n=e,a=l.fluctuate,r=l.now,o=l.Percent,s="XAGUSD"==n||"USDJPY"==n||"SILVER"==n?3:"EURUSD"==n?3:2;var d=$("#price_"+n),c=$("#deltaPercent_"+n);if("XAGCNH"==n?(d.html(r),c.text(a+"  "+o+"%")):(d.html(parseFloat(r).toFixed(s)),c.text(a+"  "+o+"%")),t){if("XAGCNH"==n)d.html(r+'<i changeCss="true"></i>');else{var u=parseFloat(r).toFixed(s);u=u.toString().substring(0,u.indexOf("."))+"<span>."+u.toString().substring(u.indexOf(".")+1)+"</span>",d.html(u+'<i changeCss="true"></i>')}var h=$("#price_"+n+" i");c.text(a+"  "+o+"%"),a>0?"true"==h.attr("changeCss")&&(d.removeClass(t.down),c.removeClass(t.down),h.removeClass(t.downCss).addClass(t.upCss)):"true"==h.attr("changeCss")&&(d.addClass(t.down),c.addClass(t.down),h.removeClass(t.upCss).addClass(t.downCss))}else a>0?$("#price_"+n).parent().addClass("up"):$("#price_"+n).parent().removeClass("up"),$("#deltaPrice_"+n).html(parseFloat(a).toFixed(s))}})}}var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(e,t){return isNaN(t)||t>e.length?!1:void e.splice(t,1)},joinSplit:function(e){return",".concat(e).concat(",")},isBlank:function(e){return void 0==e||null==e||"undefined"==e||"null"==e||""==$.trim(e)},isValid:function(e){return!this.isBlank(e)},trim:function(e){return this.isBlank(e)?"":e.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(e){return document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(e){return this.isBlank(e)?"":e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(e,t){t||(t="-"),e instanceof Date||(e=new Date(e));var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate());return i},getHHMMSS:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return t},getMMSS:function(e){return e instanceof Date||(e=new Date(e)),(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getHHMM:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());return t},formatterDateTime:function(e,t){if(t||(t="-"),e instanceof Date||(e=new Date(e)),"Invalid Date"==e)return"";var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return i},longMsTimeToDateTime:function(e,t){var i=new Date(e);return this.formatterDateTime(i,t)},showBox:function(e,t){$(e).slideDown(),$(t||".layer-shadow").show()},hideBox:function(e,t){$(e).slideUp(),$(t||".layer-shadow").hide()},containSplitStr:function(e,t){return common.isBlank(e)||common.isBlank(t)?!1:-1!=(","+e+",").indexOf(","+t+",")},getJson:function(e,t,i,s,n){var a=null;return $.ajax({url:e,type:"POST",timeout:1e5,cache:!1,async:void 0!=s?s:!1,dataType:"json",data:t,success:"function"==typeof i?i:function(e){a=e},error:function(e,t){"function"==typeof n?n(t):common.isValid(e.responseText)&&"OK"!=e.statusText?alert(e.responseText):alert("请求超时,请重试!")}}),a},arraySort:function(e,t){return function(i,s){return t?i[e]<s[e]:i[e]>s[e]}},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},isMobilePhone:function(e){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(e)},dateTimeWeekCheck:function(e,t,i){if(this.isBlank(e))return!!t;$.isPlainObject(e)||(e=JSON.parse(e));var s=i?new Date(i):new Date,n=!1,a=this.formatterDate(s);if(n=this.isBlank(e.beginDate)||a>=e.beginDate,n&&(n=this.isBlank(e.endDate)||a<=e.endDate),!n)return!1;var o=e.weekTime;if(this.isBlank(o))return n;var r=null,l=null,d=!1;for(var c in o)if(r=o[c],(!this.isValid(r.week)||s.getDay()==parseInt(r.week))&&(l=this.getHHMMSS(s),d=this.isBlank(r.beginTime)||l>=r.beginTime,d&&(d=this.isBlank(r.endTime)||l<=r.endTime),d))break;return d},arrayUnique:function(e){if(!e)return e;for(var t,i=[],s={},n=0;null!=(t=e[n]);n++)s[t]||(i.push(t),s[t]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(e,t,i){return common.isWebSocket()?(console.log("used websocket!"),e.connect(t.webSocket+"/"+i,{transports:["websocket"]})):e.connect(t.socketIO+"/"+i)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},clearMsgHtml:function(e){var e=e.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return e&&(e=$.trim(e)),e},formatToJson:function(e){return this.isBlank(e)?null:JSON.parse(e)},getSyllabusPlan:function(e,t,i,s){if(!e||!e.courses)return null;var n=function(e,t){if(e){var n,a=common.isMobile();"object"!=typeof e&&(e=JSON.parse(e));for(var o in e)if(n=e[o],a){if(1==t&&(!i&&3==n.code||i&&4==n.code))return n.url}else if(s){if(1==t&&3==n.code){var r=n.url||"";return common.isHTTPS()&&(r=r.replace(/^rtmp:/,"rtmps:")),r}}else if(n.code==t)return n.url}},a=function(t,i,s){var a=null,o=t.course;return o&&o.length>i?(a=o[i],0==a.status||common.isBlank(a.lecturerId)?null:(a.studioLink=n(e.studioLink,a.courseType),a.startTime=t.startTime,a.endTime=t.endTime,a.day=l[i].day,a.isNext=s,a)):null},o=null;o=this.isValid(e.courses)&&"object"!=typeof e.courses?JSON.parse(e.courses):e.courses;for(var r,l=o.days,d=o.timeBuckets,c=(new Date(t).getDay()+6)%7,u=common.getHHMM(t),h=null,p=null,m=0;m<l.length;m++)if(0!=l[m].status)if(r=(l[m].day+6)%7,r>c){for(var f in d)if(h=d[f],p=a(h,m,!0))return p}else if(r==c)for(var f in d)if(h=d[f],h.startTime<=u&&(h.endTime>=u||"00:00"==h.endTime)?p=a(h,m,!1):h.startTime>u&&(p=a(h,m,!0)),p)return p;if(!e.publishEnd)return null;for(var m=0;m<l.length;m++)if(0!=l[m].status&&(r=(l[m].day+6)%7,!(e.publishEnd<864e5*(r+7-c)+t)))for(var f=0;f<d.length;f++)if(p=a(d[f],m,!0))return p;return null},formatSyllabus:function(e,t,i,s){var n={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},a=new Date(t).getDay(),o=this.getHHMM(t),r=$.extend({},n,s),l=function(e,t,i,s){var n=0,l=(e+6)%7,d=(a+6)%7;return n=l>d?2:d>l?0:s?1:o>=i?0:t>o?2:1,r.courseCls[n]},d=[];try{if(e){var c=$.isPlainObject(e)?e:JSON.parse(e),u=c.days?c.days.length:0;if(u>0)if(1===i){var h={0:"文字",1:"视频",2:"oneTV"};d.push('<div class="sy_panel">');var p=t-864e5*((a+6)%7),m=null,f=null,v=null;d.push('<div class="sy_nav">');for(var g=' style="width:'+100/u+'%;"',b=0;u>b;b++)m=new Date(p+(c.days[b].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),v=c.days[b].day==a?' class="active"':"",d.push('<a href="javascript:void(0)" d="'+c.days[b].day+'"'+v+g+">"+r.dayCN[c.days[b].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');d.push("</div>"),d.push('<div class="sy_cont"><div>'),d.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var x=null,w=null,b=0;u>b;b++){if(d.push('<tbody d="'+c.days[b].day+'">'),0==c.days[b].status)w=l(c.days[b].day,null,null,!0),d.push('<tr class="'+w+'" width="100%"><td>休市</td></tr>');else for(var I=0,k=c.timeBuckets.length;k>I;I++)x=c.timeBuckets[I],w=l(c.days[b].day,x.startTime,x.endTime,!1),0==x.course[b].status?(d.push('<tr class="'+w+'">'),d.push('<td width="25%">'+x.startTime+"-"+x.endTime+"</td>"),d.push('<td colspan="2" width="75%">休市</td>'),d.push("</tr>")):x.course[b].lecturer&&(d.push('<tr class="'+w+'">'),d.push('<td width="25%">'+x.startTime+"-"+x.endTime+"【"+h[x.course[b].courseType]+"】</td>"),d.push('<td width="25%">'+x.course[b].lecturer+"</td>"),d.push('<td width="50%">'+x.course[b].title+"</td>"),d.push("</tr>"));d.push("</tbody>")}d.push("</table>"),d.push("</div></div>"),d.push("</div>")}else if(2===i){d.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),d.push("<tr>"),d.push("<th>星期\\节次</th>");for(var k=c.timeBuckets?c.timeBuckets.length:0,x=null,w=null,I=0;k>I;I++)x=c.timeBuckets[I],d.push("<th>"+r.indexCN[I]+"<br><span>("+x.startTime+"-"+x.endTime+")</span></th>");d.push("</tr>");for(var y=null,b=0,S=c.days?c.days.length:0;S>b;b++){if(y=c.days[b],d.push("<tr>"),d.push("<th>"+r.dayCN[y.day]+"</th>"),0==y.status)w=l(y.day,null,null,!0),d.push('<td class="'+w+'" colspan="'+k+'">休市</td>');else for(var I=0;k>I;I++)x=c.timeBuckets[I],w=l(y.day,x.startTime,x.endTime,!1),d.push('<td class="'+w+'">'+(0==x.course[b].status?"休市":x.course[b].lecturer)+"</td>");d.push("</tr>")}d.push("</table>")}else if(3===i){var p=o-864e5*((a+6)%7),m=null,v=null,y=null,g=' style="width:'+100/u+'%;"';d.push("<tr>");for(var b=0;u>b;b++)y=c.days[b],m=new Date(p+(c.days[b].day+6)%7*864e5),v=c.days[b].day==a?' class="active"':"",d.push('<th d="'+c.days[b].day+'"'+v+g+">"+r.dayCN[c.days[b].day]+"<i></i></th>");d.push("</tr>"),d.push('<tr><td class="space" colspan="'+u+'"></td></tr>');for(var x=null,w=null,b=0;u>b;b++){if(y=c.days[b],d.push('<tr d="'+y.day+'"><td colspan="'+u+'">'),0==y.status)w=l(y.day,null,null,!0),d.push('<p class="'+w+'">休市</p>');else for(var I=0,k=c.timeBuckets?c.timeBuckets.length:0;k>I;I++)x=c.timeBuckets[I],x.course[b].lecturer&&(w=l(y.day,x.startTime,x.endTime,!1),d.push('<p class="'+w+'">'),d.push("<span>"+x.startTime+"-"+x.endTime+"</span>"),0==x.course[b].status?d.push("<span>休市</span>"):(d.push("<span>"+r.courseType[x.course[b].courseType]+"</span>"),d.push("<span>"+x.course[b].lecturer+"</span>"),d.push('<span class="item">'+x.course[b].title+"</span>")),d.push("</p>"));d.push("</td></tr>")}}}}catch(T){return console.error("formatSyllabus->"+T),""}return d.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(e,t,i){if(!t)return e;for(var s in e)t.hasOwnProperty(s)&&common.isValid(t[s])&&(e[s]=t[s]);if(i)for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])},isRightName:function(e){return!/^([0-9]{2,20})$/g.test(e)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(e)},randomIndex:function(e){var t=parseInt(Math.round(Math.random()*e));return t==e&&(t=e-1),0>t?0:t},saveToDesktop:function(e,t){try{var i=new ActiveXObject("WScript.Shell"),s=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+t+".url");s.TargetPath=e,s.Save()}catch(n){return!1}return!0}};window.console||(console=function(){function e(){}function t(){return null==i&&(i=new e),i}var i=null;return e.prototype={log:function(e){},error:function(e){}},t()}()),$.fn.focusEnd=function(){$(this).focus();var e=$("<span/>").appendTo($(this)),t=e.get(0),i=null,s=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(t),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t),s=window.getSelection(),s.removeAllRanges(),s.addRange(i)),e.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var e=this,t=0;t<arguments.length;t++)e=e.replace(new RegExp("\\{"+t+"\\}","g"),null==arguments[t]||void 0==arguments[t]?"":arguments[t]);return e};var pkMarketSocket=null,ChartFactory=window.Highcharts?function(){function e(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}function t(){var e=$(window).width();return 540>e?30:e>=540&&1080>e?40:80}var i={realtime:"1min","5min":"5min",hour:"1hour",day:"day"},s={ELEMENT_NOTFOUND:"没有指定画板元素",SERVICE_ERROR:"服务器出现错误",NOT_KEEP_WEBSOCKET_ERROR:"不支持websocket",NO_DATA:"没有数据"},n={line:function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i],n=s.milliseconds,a=parseFloat(s.end);0==a?t.push({x:n,y:null}):t.push({x:n,y:a})}return t},candlestick:function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i],n=s.milliseconds,a=parseFloat(s.high),o=parseFloat(s.low),r=parseFloat(s.end),l=parseFloat(s.begin);t.push([n,l,a,o,r])}return t}},a="",o=2;return null!=document.getElementById("symbol")&&"undefined"!=typeof document.getElementById("symbol")&&(a=document.getElementById("symbol").value),"XAGUSD"==a||"USDJPY"==a?o=3:("EURUSD"==a||"GBPUSD"==a||"AUDUSD"==a||"USDCHF"==a||"USDCAD"==a)&&(o=4),Highcharts.setOptions({global:{useUTC:!1}}),{pkSocket:null,closeSocket:function(){this.pkSocket&&this.pkSocket.close()},create:function(e,t,n){n&&n.show();var a=$.Deferred();if(!e||!e.length)return a.reject(s.ELEMENT_NOTFOUND),a.promise();var o={type:"post",dataType:"jsonp",jsonpCallback:"jsonpCallback",data:{kType:i.realtime}},r=this,l=$.extend(!0,{},o,t);return this.symbol=l.data.symbol,this.loadData(l).done(function(i){if(n&&n.hide(),!i||!i.code)return a.reject(s.SERVICE_ERROR);if("OK"!==i.code)return a.reject(s.SERVICE_ERROR);if(0==i.listResult.length)return a.reject(s.NO_DATA);var o=l.data.dataType,d=r.getChartType(o),i=r.parseData(i.listResult.reverse(),d,l);if(r.createChart(e,d,o,i),a.resolve(),t.wsUrl){if(t.wsParam+="&symbol="+t.data.symbol+"&dataType="+t.data.dataType,console.log("options.wsParam:"+t.wsParam),window.WebSocket||(window.WebSocket=window.MozWebSocket),!window.WebSocket)return a.reject(s.NOT_KEEP_WEBSOCKET_ERROR);try{ChartFactory.pkSocket?ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam):(ChartFactory.pkSocket=new ReconnectingWebSocket(t.wsUrl,null,{reconnectInterval:3e3}),ChartFactory.pkSocket.onmessage=function(i){var s=i.originalEvent?i.originalEvent.data:null;s&&(s=JSON.parse(s),"ok"==s.code.toLowerCase()&&s.condition&&s.condition.symbol==t.data.symbol&&s.condition.dataType==t.data.dataType&&s.listResult.length>0&&ChartFactory.add(e,s.listResult,time))},ChartFactory.pkSocket.onopen=function(e){ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam)})}catch(c){console.log("get kdata price has error!"+c)}}}),a.promise()},add:function(e,t,i){var s=this.getChartType(i);t=this.parseData(t,s),"line"===s?this.addPoint(e,t):this.addPoint(e,t)},parseData:function(e,t,i){var s=i&&i.parser&&i.parser[t]||n[t];return s(e)},getChartType:function(e){return e===i.realtime?"line":"candlestick"},createChart:function(e,t,i,s){"line"===t?this.createLineChart(e,s):"candlestick"==t&&this.createCandlestickChart(e,i,s)},createLineChart:function(e,t){var i={colors:["#b59130"],chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" 1min",position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{line:{dataGrouping:{enabled:!1},cropThreshold:300}},xAxis:{type:"datetime",tickLength:0,tickPixelInterval:70},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},opposite:!1,showLastLabel:!0,tickLength:0,lineWidth:1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=["<span>"+Highcharts.dateFormat("%Y-%m-%d %H:%M",this.x)+"</span><br/>"];return e.push("<span>价格:<strong>"+this.y+"</strong></span><br/>"),e.join("")}},series:[{name:"价位",type:"line",data:t}]};e.highcharts("StockChart",i)},addPoint:function(e,t){var i=e.highcharts();i.series[0].addPoint(t[0],!1),i.redraw()},createCandlestickChart:function(e,t,s){var n="%Y-%m-%d";t===i["5min"]?n="%Y-%m-%d %H:%M":t===i.hour&&(n="%Y-%m-%d %H:%M");var a={chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" "+t,position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{candlestick:{upColor:"#F00",upLineColor:"#F00",color:"#00a004",lineColor:"#00a004"}},xAxis:{type:"datetime",tickPixelInterval:70,tickLength:0,dateTimeLabelFormats:{day:"%m-%d",week:"%m-%d",month:"%y-%m"}},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},lineWidth:1,opposite:!1,showLastLabel:!0,endOnTick:!1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=this.points[0].point,t=["<span>"+Highcharts.dateFormat(n,this.x)+"</span><br/>"];return t.push("<span>开盘价:<strong>"+e.open+"</strong></span><br/>"),t.push("<span>最高价:<strong>"+e.high+"</span></span><br/>"),t.push("<span>最低价:<strong>"+e.low+"</strong></span><br/>"),t.push("<span>收盘价:<strong>"+e.close+"</strong></span><br/>"),t.join("")}},series:[{name:"价格",type:"candlestick",data:s}]};t===i.day&&(a.xAxis.datafor=[]),e.highcharts("StockChart",a)},loadData:function(s){var n=t(),a=s.data.dataType;return $.extend(s.data,{startTime:e(new Date),num:a===i.realtime?120:n,flag:0}),$.ajax(s)}}}():null;!function(e){e.fn.qqFace=function(t){var i={id:"facebox",path:"face/",assign:"content",zIndex:1e3,tip:""},s=e.extend(i,t),n=e("#"+s.assign),a=s.id,o=s.path,r=s.tip;return n.length<=0?(alert("缺少表情赋值对象。"),!1):void e(this).click(function(t){var i,n;if(e("#"+a).length<=0){if(i='<div id="'+a+'" class="facebox"><i class="arr"></i><div class="facecont">',i+='<table border="0" cellspacing="0" cellpadding="0"><tr>',navigator.userAgent&&/(iphone|ipod|ipad|android)/.test(navigator.userAgent.toLowerCase()))for(var l=1;45>=l;l++)n=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+s.assign+'" lf="'+n+'"/></td>',l%9==0&&(i+="</tr><tr>");else for(var l=1;75>=l;l++)n=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+s.assign+'" lf="'+n+'"/></td>',l%15==0&&(i+="</tr><tr>");i+="</tr></table></div></div>",e(this).parent().append(i),e(this).parent().find("img").click(function(){e("#"+e(this).attr("tsg")).insertAtCaret(e(this).attr("lf")),e(this).parents(".facebox").hide()})}else e("#"+a+":visible").length>0?e("#"+a).hide():e("#"+a).show();t.stopPropagation()})}}(jQuery),jQuery.fn.extend({insertAtCaret:function(e){e='<img src="'+e+'"/>';var t=$(this).get(0);t.innerHTML+=e,$(this).focusEnd()}});var indexJS={fromPlatform:null,isNeverLogin:!1,serverTime:0,towMinTime:0,socketUrl:"",userInfo:null,filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,syllabusData:null,onlineCsStatus:0,infoNewCount:0,init:function(){this.serverTimeUp(),this.setVisitStore(),this.setEvent(),this.setAdvertisement()},setScrollStyle:function(e){},setEvent:function(){$(".ul-info li").hover(function(){$(".u-info").show()},function(){$(".u-info").hide()}),$(".header-right li").hover(function(){if($(this).find(".dropcont").show(),$(this).is(".cursor")){if(1==$(this).attr("ck"))return;indexJS.fillCourse()}$(this).is(".room_rule")&&($(this).hasClass("hover-in")||(indexJS.getArticleList("bulletin_room_rule",indexJS.userInfo.groupId,1,1,1,'{"sequence":"desc"}',null,function(e){if(e&&0==e.result){var t=e.data;if(t&&t.length>0){var i=t[0].detailList[0];$("#bulletinRoomRule").find("strong").text(i.title),$("#bulletinRoomRule").find("p").html(i.content)}}}),$(this).addClass("hover-in"))),$(this).is(".notice")&&(0==$(".header-right ul li.user").length&&$(".notice .dropcont").css("width","450px"),$(this).hasClass("hover-in")||(indexJS.getArticleList("bulletin_system",indexJS.userInfo.groupId,1,1,1,'{"sequence":"desc"}',null,function(e){if(e&&0==e.result){var t=e.data;if(t&&t.length>0){var i=t[0].detailList[0];$("#bulletinTab").find("strong").text(i.title),$("#bulletinTab").find("p").html(i.content)}}}),$(this).addClass("hover-in")))},function(){$(this).find(".dropcont").hide()}),0==$(".rooms .rbox").length&&$(".changeroom").hide(),$(".changeroom").click(function(){var e=$(this);if(e.hasClass("open"))e.removeClass("open");else{e.addClass("open"),e.find("rooms").removeClass("dn");var t=e.attr("tm");if(!(common.isBlank(t)||indexJS.serverTime-Number(t)>=6e4))return;e.attr("tm",indexJS.serverTime);try{$.getJSON("/hxstudio/getRmCourseList",{roomIds:$(".rooms .rbox[rid]").map(function(){return $(this).attr("rid")}).get().join(",")},function(e){var t=$(".rooms .rbox[rid]");if(e&&e.isOK){var i=e.data;t.each(function(e){e==t.length-1&&$(this).addClass("last");var s=$(this).attr("rid");if(i.hasOwnProperty(s)){var n=i[s],a=0;"true"==$(this).find(".enterbtn").attr("av")&&n.onlineNum<=200&&(a=n.onlineNum<=10?60:200/n.onlineNum*3+10,a=Math.round(a)),$(this).find(".peo_num label").text(n.onlineNum+a),$(this).find(".info .nk").text(n.name),n.isNext||$(this).addClass("on"),n.day&&$(this).find(".info .st").text(common.daysCN[n.day]+" "+n.startTime+" - "+n.endTime)}})}else 1==t.length&&t.addClass("last")})}catch(i){console.error("getRmCourseList->"+i),callback(null)}}}),indexJS.setListScroll(".mod_room .cont"),$(document).click(function(e){(!$(e.target).parent().hasClass("roomctrl")&&!$(e.target).parents().parents().hasClass("rbox")||$(e.target).hasClass("enterbtn"))&&$(".changeroom").removeClass("open");var t=$(e.target);0==t.closest(".skinbox").length&&"skinbtn"!=t.attr("id")&&$(".skinbox").fadeOut()}),$(".rooms .rbox[rid] .enterbtn").click(function(){var e=$(this),t=$(this).attr("cgs");return"false"==e.attr("av")&&indexJS.checkClientGroup("visitor")?($("#login_a").trigger("click",{groupId:e.attr("rid")}),!1):common.containSplitStr(t,indexJS.userInfo.clientGroup)?void common.getJson("/hxstudio/checkGroupAuth",{groupId:e.attr("rid")},function(e){e.isOK?indexJS.toRefreshView():alert("您没有进入该房间的权限，如有疑问，请联系客服。")},!0,function(e){"success"!=e&&alert("操作失败，请联系客服！")}):(alert("您没有进入该房间的权限，如有疑问，请联系客服。"),!1)}),$(".mod_videolist .tabnav a").click(function(){var e=$(this).attr("t"),t=$(this).index()-1;if($(".mod_videolist .tabnav a").removeClass("on"),$(this).addClass("on"),$(".mod_videolist .listcont .list_tab").removeClass("on").eq(t).addClass("on"),"hq"==e){var i={downCss:"hq-down",upCss:"hq-up",down:"down"},s="http://news1.hx9999.com/datajson/ajaxchinesedatas",n=["GOLD","SILVER","XAUCNH","XAGCNH","USDX","CL"];setInterval(function(){getSymbolPriceDatas(s,i,n)},5e3),indexJS.setListScroll("#hangqing")}else"kx"==e?indexJS.setInformation():"usd"==e&&$("#backShowTrade").click()}),$(".mod_videolist .tabnav a.on").trigger("click"),$("#qqcs").click(function(){openQQChatByCommonv3("&utm_source=studio&utm_medium=yy&utm_content=TOP&utm_campaign=qqzx_pm","800025930")}),/op=test/.test(location.href)?$(".rooms>div[rid='hxstudio_4']").show():$(".rooms>div[rid='hxstudio_4']").hide(),$("#onlineCs").click(function(){"hxstudio_4"==indexJS.userInfo.groupId?indexJS.connectOnlineCs():openQQChatByCommonv3("&utm_source=hxstudio&utm_medium=yy&utm_content=TOP&utm_campaign=qqzx_hx","800025930")}),$("#saveToDesktop").click(function(){common.saveToDesktop(window.location.href,"视频直播间-恒信贵金属")?box.showMsg("直播间快捷方式已成功添加到桌面"):window.location.href="/hxstudio/getHxShortCut?t="+(new Date).getTime()}),$("#modifyNickName").click(function(){box.openSetNameBox(!1)}),$("#modifyAvatar").click(function(){var e=$("#fileForm"),t=e.find("input[type=file]");"true"!=e.attr("hasEv")&&(e.attr("hasEv","true"),t.change(function(){var e=$(this),t=this.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var s=new FormData($("#fileForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:s,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var i=t.data?t.data[0]:null;i&&common.getJson("/hxstudio/modifyAvatar",{avatar:i.fileDomain+i.filePath},function(t){t.isOK?($("#avatarInfoId").attr("src",t.avatar),$("#userListId li .mynk").prev().find("img").attr("src",t.avatar),indexJS.userInfo.avatar=t.avatar,e.val("")):console.error("上传头像失败，请联系在线客服！")},!0,function(){alert("上传头像失败，请联系在线客服！")})}else alert("上传头像失败，请联系在线客服！")},error:function(e){console.error("error:",e)}})}catch(n){console.error("上传图片失败",n)}})),t.click()}),$(".skin").click(function(){$(".skinbox").fadeToggle()}),$(".skinbox ul li").click(function(){var e=$(this).attr("theme"),t=$(this).attr("cs");if(common.isValid(e)&&common.isValid(t)){$(".skinbox ul li").removeClass("on"),$(".skinbox ul li span").empty(),$(this).addClass("on"),$(this).find("span").text("(默认)");var i={theme:"theme"+e,style:t};indexJS.setTheme(JSON.stringify(i))}else box.showTipBox("该皮肤暂未开放，敬请期待")}),$(".user-infbox").hover(function(){common.isValid($(".tradedata img").attr("src"))&&$(".tradedata").fadeToggle()},function(){common.isValid($(".tradedata img").attr("src"))&&$(".tradedata").fadeToggle()}),this.placeholderSupport(),this.setBulletinSlide()},fillCourse:function(){var e=indexJS.syllabusData&&indexJS.syllabusData.courses;if(e){for(var t,i={0:"文字直播",1:"视频直播",2:"oneTV直播"},s=e.days,n=e.timeBuckets,a=$(".course_nav").html(""),o="",r="",l=new Date(indexJS.serverTime).getDay(),d=indexJS.serverTime-864e5*((l+6)%7),c=100/s.length,u=0,h=s.length;h>u;u++){o=0==u?"fir":u==h-1?"last":"nct",r=s[u].day==l?" on":"",t=common.formatterDate(new Date(d+(s[u].day+6)%7*864e5)).substring(5),a.append('<a href="javascript:" class="'+o+r+'" t="'+u+'" d="'+s[u].day+'" style="width:'+c+'%;"><span>'+common.daysCN[s[u].day+""]+"<b>"+t+"</b></span><i></i></a>"),$(".cursor .dropcont .cont").append('<div class="course_tab'+r+'" t="'+u+'" d="'+s[u].day+'"><ul></ul></div>'),o="";var p=$(".cursor .course_tab:last ul"),m=null;if(1!=s[u].status)p.append('<li class="fir"><a href="javascript:"><span><lable>休市</lable></span></a></li>');else for(var f=0,v=n.length;v>f;f++)o=0==f?"fir":"",m=n[f].course[u],0!=m.status&&m.lecturer&&p.append('<li class="'+o+'"><a href="javascript:" st="'+n[f].startTime+'" et="'+n[f].endTime+'"><i></i><span><lable>'+n[f].startTime+"- "+n[f].endTime+"　</lable><lable>"+i[m.courseType]+"　</lable><lable>"+m.lecturer+"</lable></span><p>"+m.title+"</p></a></li>")}$(".course_nav a").click(function(){$(".course_nav a").removeClass("on"),$(".course_tab").removeClass("on"),$(this).addClass("on"),$(".course_tab[t="+$(this).attr("t")+"]").addClass("on")}),$(".header-right li.cursor").attr("ck",1)}},toRefreshView:function(){window.location.reload()},checkClientGroup:function(e){var t=this.userInfo.clientGroup,i=!1;switch(e){case"visitor":i="visitor"==t;break;case"vip":i="vip"==t||"active"==t;break;case"new":i="vip"!=t&&"active"!=t}return i},serverTimeUp:function(){indexJS.fillCourse(),indexJS.courseTick.tick(),videos.init().clientVideoTask(),indexJS.setInformation(),this.towMinTime=this.serverTime,setInterval(function(){indexJS.serverTime+=1e3,indexJS.serverTime-indexJS.towMinTime>=12e4&&(indexJS.towMinTime=indexJS.serverTime,indexJS.setInformation()),chat.setPushInfo(),indexJS.courseTick.tick()},1e3)},refreshNickname:function(e,t){this.userInfo.isSetName=e,this.userInfo.nickname=t,$(".username").text(t),$("#userListId li .mynk").text(t+"【我】")},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e="storeInfo_"+this.userInfo.groupType,t=store.get(e),i={};if(common.isBlank(t)){var s=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+s,i.userId="visitor_"+s,i.nickname="游客_"+s,i.userType=-1,store.set(e,i)}else i=t;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||$("#contentText").attr("contenteditable",!1).append('<div class="lgtip d n">亲，<a href="javascript:box.openLgBox();">登录</a> 后可以发言哦~</div>')):(i.loginId=this.userInfo.userId,store.set(e,i)),this.isNeverLogin=!common.isValid(i.loginId),common.isBlank(this.userInfo.nickname)&&"visitor"!=this.userInfo.clientGroup&&this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12));
},setListScroll:function(e,t){var i="object"==typeof e?e:$(e);i.hasClass("mCustomScrollbar")?i.mCustomScrollbar("update"):(t=$.extend({scrollButtons:{enable:!1},theme:"light-2",isCustom:!0},t),i.mCustomScrollbar(t),t.isCustom&&this.setScrollStyle(i))},getArticleList:function(e,t,i,s,n,a,o,r){try{$.getJSON("/hxstudio/getArticleList",{authorId:common.trim(o),code:e,platform:t,hasContent:i,pageNo:s,pageSize:n,orderByStr:a},function(e){r(e)})}catch(l){console.error("getArticleList->"+l),r(null)}},getArticleInfo:function(e,t){try{$.getJSON("/hxstudio/getArticleInfo",{id:e},function(e){t(e)})}catch(i){console.error("getArticleInfo->"+i),t(null)}},setAdvertisement:function(){this.getArticleList("advertisement",indexJS.userInfo.groupId,"0",1,5,'{"sequence":"desc"}',null,function(e){if(e&&0==e.result){var t=e.data;for(var i in t)$(".ban_ul").append('<li class="swiper-slide"><a href="'+(common.isBlank(t[i].linkUrl)?"javascript:":t[i].linkUrl)+'" target="_blank"><img width="100%" alt="" src="'+t[i].mediaUrl+'"></a></li>'),t.length>1&&$("#mod_position").append('<span class="'+(0==parseInt(i)?"p-click":"")+'"></span>');t&&t.length>1&&new Swiper(".mod_banner",{pagination:"#mod_position",paginationClickable:!0,loop:!0,autoplay:5e3,autoplayDisableOnInteraction:!1})}})},setInformation:function(){var e=$("#newInfoCount").attr("t");!common.isBlank(e)&&indexJS.serverTime-e<12e4||$.getJSON(indexJS.apiUrl+"/common/getInformation?t="+indexJS.serverTime,null,function(e){if(e&&e.isOK){var t=$("#newInfoCount").attr("pt"),i=null,s="",n=indexJS.formatHtml("news");$.each(e.data.news.item,function(e,a){t==a.pubDate&&common.isValid(t)&&(indexJS.infoNewCount++,$("#newInfoCount").text(indexJS.infoNewCount).show()),1>e&&(i=a.pubDate),(a.pubDate>t||common.isBlank(t))&&(s+=n.formatStr(a.pubDate.substring(10),a.title))}),common.isValid(s)&&$(".mod_videolist .message_list .scrollbox ul.news").prepend(s),common.isBlank(t)&&$("#newInfoCount").attr("pt",i),indexJS.setListScroll($(".mod_videolist .message_list .scrollbox")),$("#newInfoCount").attr("pt",i),$(".mod_videolist div[t='kx']").hasClass("on")&&(indexJS.infoNewCount=0,$("#newInfoCount").attr({pt:i,t:indexJS.serverTime}).text(indexJS.infoNewCount).hide())}})},setTradeStrategy:function(e){this.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"sequence":"desc"}',null,function(t){if(t&&0==t.result){var i=t.data,s=null,n="",a=indexJS.formatHtml("tradestrategy");for(var o in i){s=i[o].detailList[0];var r="",l="";if(common.isBlank(s.author))r=s.authorInfo.name,l=s.authorInfo.avatar;else{var d=s.author.split(";");r=d[0],l=d[1]}var c=common.formatterDateTime(i[o].publishStartDate,"-").substring(0,16);n+=a.formatStr(l,r,c,s.tag,s.title,s.content)}$("#guidelist ul").html(n)}else $("#guidelist ul").html("");indexJS.setListScroll(e)})},setBulletinSlide:function(){indexJS.getArticleList("bulletin_slide_info",indexJS.userInfo.groupId,1,1,1,'{"createDate":"desc"}',"",function(e){if(e&&0==e.result&&e.data&&e.data.length>0){$("#video_content .tabtxt").show(),$("#video_content .video-name").css("top","48px");var t="",i=indexJS.formatHtml("bulletinSlide");$.each(e.data,function(e,s){var n=s.detailList[0];t+=i.formatStr(n.title,n.content)}),$("#bulletinDomId").html(t),$("#bulletinPanel").slide({mainCell:".anouncelist",effect:"leftMarquee",autoPlay:!0,interTime:50}),$("#bulletinDomId li a").each(function(){var e=$(this);e.text(e.next().text());var t=e.width();t>$("#bulletinPanel").width()&&e.parent().width(t),e.click(function(){$("#popAnnTit").text($(this).attr("title")),$("#popAnnTxt").html($(this).next("div").html()),$("#popAnnBox,.blackbg").show(),indexJS.setListScroll(".popAnnCont")})})}else $("#video_content .tabtxt").hide(),$("#video_content .video-name").css("top","12px");heightCalcu()})},connectOnlineCs:function(){switch(indexJS.onlineCsStatus){case 0:indexJS.onlineCsStatus=1;var e="http://jms.phgsa.cn/chat.php?pid=P001&tln="+indexJS.userInfo.userId+"&tnn="+indexJS.userInfo.nickname+"&tul="+indexJS.userInfo.clientGroup;LazyLoad.js(e,function(){indexJS.onlineCsStatus=2,$("#welive_info").trigger("click")});break;case 2:$("#welive_info").trigger("click");break;case 1:}},placeholderSupport:function(){var e="placeholder"in document.createElement("input");e||$(".formcont .in_line input[placeholder]").each(function(){var e=$(this).attr("placeholder");if(e){var t=$(this),i=$('<span class="placeholder">'+e+"</span>");t.before(i),i.bind("click",function(){$(this).hide(),$(this).next().focus()}),t.bind("focus",function(){$(this).prev().hide()}),t.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=t[0].defaultValue&&t.prev().hide(),$(this).attr("placeholder","")}})},formatHtml:function(e){var t=[];switch(e){case"tradestrategy":t.push('<li class="guideli">'),t.push('    <div class="line1 clearfix">'),t.push('        <img class="himg" src="{0}" alt="{1}">'),t.push('        <h4 class="name">{1}<span class="timespan">{2}</span></h4>'),t.push('        <span class="tag"><i></i>{3}</span>'),t.push("    </div>"),t.push('    <h4 class="gtit"><strong><a href="" target="_blank" class="taglink"></a></strong>{4}</h4>'),t.push('    <div class="g_cont">'),t.push("    <p>{5}</p>"),t.push("    </div>"),t.push("</li>");break;case"bulletinSlide":t.push('<li><a href="javascript:void(0);" title="{0}"></a><div class="dn">{1}</div></li>');break;case"news":t.push("<li><spana><i></i><em>{0} </em>{1}</span></li>")}return t.join("")},studioGA:function(e,t,i,s,n,a){"function"==typeof ga&&"object"==typeof _trackData&&_trackData instanceof Array&&(ga(e,t,i,s,n),_trackData.push(a))},setTheme:function(e){var t=$("#themeStyle").attr("d"),i=JSON.parse(e);if(common.isValid(indexJS.userInfo.userId)&&indexJS.userInfo.isLogin){var s={userId:indexJS.userInfo.userId,defTemplate:e};common.getJson("/hxstudio/setThemeStyle",{data:JSON.stringify(s)},function(e){e.isOK&&$("#themeStyle").attr("href","/hx/"+i.theme+"/css/"+i.style+(t?".min":"")+".css?t="+(new Date).getTime())})}else $("#themeStyle").attr("href","/hx/"+i.theme+"/css/"+i.style+(t?".min":"")+".css?t="+(new Date).getTime())},courseTick:{course:null,nextTickTime:0,tick:function(){if(!(indexJS.serverTime<=this.nextTickTime)){var currCourse=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);if(currCourse){var nextTime=0;nextTime=currCourse.isNext?6e4*eval(currCourse.startTime.replace(":","*60+"))+indexJS.serverTime-indexJS.serverTime%864e5-288e5:6e4*eval(currCourse.endTime.replace(":","*60+"))+indexJS.serverTime-indexJS.serverTime%864e5-288e5+6e4,this.course=currCourse,this.nextTickTime=nextTime,this.chgSyllabusCls(currCourse),videos.clientVideoTask(),videos.sd.initSD()}}},chgSyllabusCls:function(e){$(".course_tab li a.on").removeClass("on"),e.isNext||($(".course_nav a[d='"+e.day+"']").trigger("click"),$(".course_tab[d="+e.day+"]").find('li a[st="'+e.startTime+'"][et="'+e.endTime+'"]').addClass("on"))}}};$(function(){indexJS.init()});var videos={blwsPlayer:null,newMarIntervalId:0,init:function(){return this.setEvent(),this.setVideoList(null,!0),this},setVideoList:function(e,t){if(t){var i=$("#teachVideoId").children().map(function(){return $(this).attr("t")}).get();e=i[common.randomIndex(i.length)]}var s=$("#teachVideoId div[t="+e+"] ul");s.find("li").length>0||(s.html(""),indexJS.getArticleList(e,indexJS.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){if(e&&0==e.result){var i=e.data,n=null;for(var a in i)n=i[a].detailList[0],s.append('<li title="'+n.title+'"><a href="javascript:" ct="'+i[a].categoryId+'" id="'+i[a]._id+'" t="'+(common.isValid(i[a].mediaUrl)&&-1!=i[a].mediaUrl.indexOf(".mp4")?"mp4":"")+'" vUrl="'+i[a].mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'video_play',$(this).text()]);\"><i></i>"+n.title+"</a></li>");indexJS.setListScroll(s,{isCustom:!1,theme:"minimal-dark"}),$("#teachVideoId li a").click(function(){$("#teachVideoId li a.on").removeClass("on"),$(this).addClass("on"),$(".max_box").show(),$("#video_content .video-name").text($(this).text()),videos.setVideo($(this))})}t&&videos.playVideoByDate(!0)}))},setVdTab:function(e){e?(window.SewisePlayer&&SewisePlayer.doStop(),$("#tvDivId").hide().find("iframe").remove(),$("#lvDivId").show(),this.selectVdType("lv")):($("#tvDivId").show(),$("#lvDivId").hide(),this.selectVdType("tv"))},playMp4Vd:function(e){var t=$("#teachVideoId a[class=on]");if(e||t.length<=0){var i=$("#teachVideoId li a[t=mp4]"),s=null;i.length<=0?s=$("#teachVideoId li:first a"):(s=$(i.get(common.randomIndex(i.length))),$("#teachVideoId ul").mCustomScrollbar("scrollTo","#"+s.attr("id"))),$("#teachVideoId .cate_box").removeClass("show"),$("div[t="+s.attr("ct")+"]").addClass("show"),s.click()}else t.click()},selectVdType:function(e){"lv"==e?(window.SewisePlayer&&SewisePlayer.doStop(),$(".mod_video .classmore,#video_content .max_box,#video_content .video-name").hide(),$("#tvDivId").hide().find("iframe").remove(),$("#lvDivId").show(),$(".video-checkbox").text("直播视频").attr("t","lv"),$(".video-checkbox-list").prepend($(".video-checkbox-list a[t=lv]"))):($(".mod_video .classmore,#video_content .max_box,#video_content .video-name").show(),$(".video-checkbox").text("教学视频").attr("t","tv"),$(".video-checkbox-list").prepend($(".video-checkbox-list a[t=tv]")),$("#tvDivId").show(),$("#lvDivId").hide())},setVdMaxBox:function(){$(".max_box").is(":hidden")||$(".max_box").slideUp(1e3,function(e){$(".min_box").fadeIn("fast")})},setEvent:function(){$(".video-checkbox-list a").click(function(){var e=$(this).attr("t");videos.selectVdType(e),$(".video-checkbox-list").hide(),"lv"==e?(videos.playVideoByDate(!1),$(".mod_video .classmore").hide()):(videos.playMp4Vd(),$(".mod_video .classmore").show())}),$(".mod_video .classmore").hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()}),$("#video_content").hover(function(e){$(this).children(".video-class").removeClass("dn"),$("#tvDivId").is(":visible")&&$("#teachVideoId,#video_content .video-name,.classmore").show()},function(e){$(e.target).hasClass("video-class")||$(e.target).hasClass("mod_video")||($(this).children(".video-class").addClass("dn"),$("#tvDivId").is(":visible")&&$("#teachVideoId,#video_content .video-name,.classmore").hide())}),$(".video-checkbox-list").mouseleave(function(){$(this).hide()}),$(".video-class-checked").click(function(){$(".video-checkbox-list").toggle()}),$("#vdLs_min,#vdLs_max").click(function(){"vdLs_min"==this.id?($(".min_box").hide(),$(".max_box").show()):($(".max_box").hide(),$(".min_box").show())}),$("#teachVideoId .cate_name").click(function(){$("#teachVideoId .cate_box").removeClass("show"),videos.setVideoList($(this).parent().addClass("show").attr("t"))}),videos.sd.setSDEvent(),this.bindEventRollNews()},clientVideoTask:function(){var e=$("#lvDivId embed").attr("src");($("#nextCourse").is(":visible")||$("#lvVideoId").is(":visible")&&e&&-1==e.indexOf("yy.com")&&0==$("#lvVideoId").find("object").length)&&videos.playVideoByDate(!1)},playVideoByDate:function(e){var t=indexJS.courseTick.course;!t||0!=t.courseType&&common.isBlank(t.studioLink)||t.isNext||0==t.courseType?e?t&&!t.isNext?(this.setVdTab(!0),this.setStudioInfo(t),this.setStudioTip(!0)):(this.setVdTab(!1),this.playMp4Vd()):this.setStudioInfo(t):(this.setVdTab(!0),this.setStudioVideoDiv(t.studioLink))},setStudioTip:function(e){e?$(".mod_room .titbar > span i").removeClass("off").addClass("on"):$(".mod_room .titbar > span i").removeClass("on").addClass("off")},setNextCourse:function(e,t){if(e){var i="当前暂无直播，请关注下节课";if(!e.isNext&&0==e.courseType){var s="",n=null;for(var a in indexJS.syllabusData.studioLink)if(n=indexJS.syllabusData.studioLink[a],"1"==n.code){s=n.url;break}return void this.setStudioVideoDiv(s)}$("#nextCourse").find(".ntext").text(i),$("#nextCourse .nextbox").show(),$("#nextCourse").find("img").attr("src",t.avatar),$("#nextCourse").find(".t_name").text(t.name),$("#nextCourse").find(".live_name").text(e.title),$("#nextCourse").find(".time").text(common.daysCN[e.day]+" "+e.startTime+" - "+e.endTime)}$("#lvVideoId").hide(),$("#nextCourse").show()},bindEventRollNews:function(){$(".mod_scrollnews").hide(),$(".mod_scrollnews .newsbtn").click(function(){$(this).hide(),$(".mod_scrollnews .newslist").slideDown(),videos.newsMarquee(!0)}),$("#newscont1 a").live("click",function(){return"false"===$(this).attr("url")?($("#popAnnTit").text($(this).attr("title")),$("#popAnnTxt").html($(this).data("content")||"没有内容"),$("#popAnnBox,.blackbg").show(),indexJS.setListScroll("#popAnnBox"),!1):void 0}),$("#newscont2 a").live("click",function(){$("#newscont1 a[tid='"+$(this).attr("tid")+"']").trigger("click")})},rollNews:function(e){var t=$("#newscont1");if(e["delete"]){var i=e.ids.split(",");if(i.length>0)for(var s=0;s<i.length;s++)t.find('a[tid="'+i[s]+'"]').remove()}else if(e.edit){e.isValid="true"==e.isValid?!0:!1,!e.isValid||indexJS.userInfo.clientGroup&&e.clientGroup&&-1!=$.inArray(indexJS.userInfo.clientGroup,e.clientGroup)||(e.isValid=!1);var n=t.find('a[tid="'+e.id+'"]');if(e.isValid)if(n.size()>0)common.isValid(e.url)?n.attr({title:e.title,href:e.url,url:"true"}).html("<i></i><span>"+e.title+"</span>"):n.attr({title:e.title,url:"false"}).html("<i></i><span>"+e.title+"</span>").data("content",e.content);else{var a=$('<a href="javascript:void(0);" tid="'+e.id+'" title="'+e.title+'" target="_blank"><i></i><span>'+e.title+"</span></a>");common.isValid(e.url)?(a.attr({href:e.url,url:"true"}),a.find("span").text(e.title)):a.attr({url:"false"}).data("content",e.content),t.append(a)}else n.size()>0&&n.remove()}else if(e.infos){var o=e.infos.length,a=null;if(o>0)for(var s=0;o>s;s++)indexJS.userInfo.clientGroup&&e.infos[s].clientGroup&&$.inArray(indexJS.userInfo.clientGroup,e.infos[s].clientGroup)>-1&&1==e.infos[s].pushType&&e.infos[s].contentId&&e.infos[s].title&&(common.isValid(e.infos[s].url)?a=$('<a href="'+e.infos[s].url+'" url="true" tid="'+e.infos[s].contentId+'" title="'+e.infos[s].title+'" target="_blank"><i></i><span>'+e.infos[s].title+"</span></a>"):(a=$('<a href="javascript:void(0);" url="false" tid="'+e.infos[s].contentId+'" title="'+e.infos[s].title+'" target="_blank"><i></i><span>'+e.infos[s].title+"</span></a>"),a.data("content",e.infos[s].content)),t.append(a))}t.is(":empty")?($("#video_content .tabtxt,.mod_scrollnews").hide(),$("#video_content .video-name").css("top","12px")):($("#video_content .tabtxt,.mod_scrollnews").show(),$("#video_content .video-name").css("top","48px")),heightCalcu(),this.newsMarquee(!0)},newsMarquee:function(e){videos.newMarIntervalId&&(clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null);var t=30,i=$(".mod_scrollnews"),s=$("#scrollnews_demo")[0],n=$("#newscont1"),a=$("#newscont2");if(e&&n.children().size()>0?i.show():i.hide(),a.html(""),$(s).unbind("mouseover mouseout"),e){n.css("width","auto"),a.css("width","auto");var o=i.width()-27;n.width()<o&&(n.css("width",o),a.css("width",o)),a.html(n.html());var r=function(){n.width()-s.scrollLeft<=0?s.scrollLeft-=n.width():s.scrollLeft++};videos.newMarIntervalId=window.setInterval(r,t),$(s).bind("mouseover",function(){window.clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null}).bind("mouseout",function(){videos.newMarIntervalId&&(window.clearInterval(videos.newMarIntervalId),videos.newMarIntervalId=null),videos.newMarIntervalId=window.setInterval(r,t)})}},getEmbedDom:function(e){return'<embed src="'+e+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'},setStudioVideoDiv:function(e){if(!$("#lvVideoId").is(":visible")||$("#lvVideoId").data("url")!=e)if($("#nextCourse").hide(),$("#lvVideoId").show().data("url",e).html(""),-1!=e.indexOf("rtmp")){var t=/(.*)\/([0-9]+)$/g.exec(e);if(!t||t.length<3)return;flowplayer("lvVideoId","/base/lib/flowplayer/flowplayer.swf",{clip:{url:t[2],provider:"rtmp",live:!0},plugins:{rtmp:{url:"/base/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:t[1]}},onError:function(e){}})}else $("#lvVideoId .img-loading").fadeIn(0).delay(2e3).fadeOut(200),$(videos.getEmbedDom(e)).appendTo("#lvVideoId")},setStudioInfo:function(e){if(!e)return $("#nextCourse").find(".ntext").text("当前暂无直播"),void $("#nextCourse .nextbox").hide();var t=$("#lvInfoId").attr("dy"),i=$("#lvInfoId").attr("st"),s=$("#lvInfoId").attr("et");return t==e.day&&i==e.startTime&&s==e.endTime?void((e.isNext||0==e.courseType)&&videos.setNextCourse(null)):void $.getJSON("/hxstudio/getCourseInfo",{day:e.day,startTime:e.startTime,endTime:e.endTime,authorId:e.lecturerId},function(t){$("#lvInfoId").attr("dy",e.day).attr("st",e.startTime).attr("et",e.endTime),$("#lvInfoId .intro p").text(t.remark),indexJS.setListScroll("#lvInfoId .intro p");var i=$("#lvInfoId .te_list").html(""),s=t.authors,n=null;for(var a in s)n=s[a],i.append('<div class="te_detail" uid="'+n.userId+'"><img src="'+n.avatar+'" alt=""><div class="rcont"><span><strong>'+n.name+"</strong><i>"+n.position+'</i></span> <a href="javascript:" class="support" uid="'+n.userId+'"><label>'+n.praiseNum+"</label><i>+1</i></a> </div> </div>");var o=$(".te_detail .support");"true"!=o.attr("initEvent")&&o.attr("initEvent","true").click(function(){var e=$(this);try{common.getJson("/hxstudio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:e.attr("uid")},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)}catch(t){console.error("setPraise->"+t)}}),(e.isNext||0==e.courseType)&&videos.setNextCourse(e,s&&s.length>0?s[0]:{avatar:"",name:""})})},setVideo:function(e){try{this.setStudioTip(!1),$("#lvVideoId").html("");var t=e.attr("vUrl"),i=e.text();if(-1!=t.indexOf(".html")){window.SewisePlayer&&SewisePlayer.doStop();var s=$("#tVideoId iframe"),n=!0;s.size()>0&&(s.attr("src")==t?n=!1:s.remove()),n&&$("#tVideoId").append('<iframe frameborder=0 width="100%" height="100%" src="'+t+'" allowfullscreen></iframe>')}else if($("#tVideoId iframe").remove(),-1!=t.indexOf("type=blws")){var a=t.split("&");if(a.length>1){var o=a[1].replace(/^vid=/g,"");videos.blwsPlayer?videos.blwsPlayer.changeVid(o):videos.blwsPlayer=polyvObject("#tVideoId").videoPlayer({width:"100%",height:"100%",vid:o,flashvars:{autoplay:"0",setScreen:"fill"},onPlayOver:function(e){}})}}else if(window.SewisePlayer)SewisePlayer.toPlay(t,i,0,!0);else{var r=[];r.push("/base/lib/sewise.player.min.js?server=vod"),r.push("type="+(-1!=t.indexOf(".flv")?"flv":"mp4")),r.push("videourl="+t),r.push("autostart=true"),r.push("title="+i),r.push("buffer=5");var l=r.join("&"),d=document.createElement("script");d.type="text/javascript",d.src=l,$("#tVideoId").get(0).appendChild(d);var c=function(){return window.SewisePlayer?void SewisePlayer.onPause(function(e){if(SewisePlayer.duration()<=SewisePlayer.playTime()){var t=$("#teachVideoId li a.on"),i=t.parent().next().find("a");i.length<=0?videos.playMp4Vd(!0):i.click()}}):void window.setTimeout(c,500)};c()}}catch(u){console.error("setVideo has error:"+u)}},sd:{analyst:null,tradeList:[],loadAll:!1,setSDEvent:function(){$("#sdNoAuthBox .aid_chat span").bind("click",function(){$("#sdNoAuthBox .pop_close").trigger("click");var e=$(this).attr("uid"),t=$("#userListId li[id='"+e+"']");0==t.size()&&(t=$("#userListId li[utype='3']:first")),t.find("em").trigger("click")})},initSD:function(){var e=indexJS.courseTick.course;!e||!e.lecturerId||videos.sd.analyst&&-1!=e.lecturerId.indexOf(videos.sd.analyst.userNo)||$.getJSON("/hxstudio/getShowTradeInfo",{userNo:e.lecturerId},function(e){e&&e.analyst?(videos.sd.analyst=e.analyst,videos.sd.tradeList=e.tradeList||[],videos.sd.loadAll=!1,$("#sdInfoId .nosd_tip").hide(),videos.sd.showPraiseInfo(),videos.sd.showSDInfo(),$("#sdInfoId .nosd_tip").hide()):($("#sdInfoId .nosd_tip").show(),$("#sdInfoId .te_info").empty(),$("#sdInfoId .sd_show .sd_ul").empty())})},showPraiseInfo:function(){$("#sdInfoId .te_info").empty();var e=this.analyst;$("#sdInfoId .te_info").append('<div class="te_detail sd" uid="'+e.userNo+'"><img src="'+e.avatar+'" alt=""><div class="rcont"><span><strong>'+e.userName+'</strong><i class="suc">TA的胜率：<b>'+(e.winRate||"--")+'</b></i></span> <a href="javascript:" class="support" uid="'+e.userNo+'"><label>'+e.praiseNum+"</label><i>+1</i></a> </div> </div>"),$("#sdInfoId .te_detail .support").click(function(){var e=$(this);try{common.getJson("/hxstudio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:e.attr("uid")},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)}catch(t){console.error("setPraise->"+t)}})},showSDInfo:function(){this.showWXInfo(),$("#sdInfoId .sd_ul").empty(),this.showTradeList()},showWXInfo:function(){var e=[];this.analyst.wechatCode&&(e.push('<div class="te_wx">'),e.push('<div class="wx-qrcode">'),this.analyst.wechatCodeImg&&e.push('<img src="'+this.analyst.wechatCodeImg+'" alt="'+this.analyst.wechatCode+'">'),e.push("</div>"),e.push('<span class="wx-num">老师微信号: <b>'+this.analyst.wechatCode+"</b></span>"),e.push("</div>"),$("#sdInfoId .te_info").append(e.join("")))},showTradeList:function(){if(videos.sd.loadAll)return!1;var e=$("#sdInfoId .sd_ul li").size(),t=videos.sd.tradeList,i=t?t.length:0;0==i?$("#sdInfoId .nosd_tip").show():$("#sdInfoId .nosd_tip").hide();for(var s=null,n=[],a=indexJS.checkClientGroup("new"),o=!1,r=e;i>r&&e+6>r;r++)s=t[r],o=!s.profit,n.push('<li><div class="cont">'),n.push('<div class="sd_tit">'),n.push('<span class="dep">'),o?n.push("持仓中"):(n.push("点数："),n.push("<b"+(/^-/.test(s.profit)?' class="fall"':"")+">"+s.profit+"</b>")),n.push("</span>"),n.push('<span class="sdtime">晒单时间: '+common.formatterDateTime(s.showDate).substring(5,16)+"</span>"),n.push("</div>"),a&&o?(n.push('<a href="javascript:videos.sd.showAuthBox()">'),n.push('<img src="/pm/theme1/img/sd_default.png"></a>')):(n.push('<a href="'+s.tradeImg+'" data-lightbox="sd-img" data-title="'+(o?"持仓中":"点数："+s.profit)+'">'),n.push('<img src="'+s.tradeImg+'"></a>')),n.push("<i></i></div></li>");r>=i-1&&(videos.sd.loadAll=!0),$("#sdInfoId .sd_show").css({"max-height":"165px"}),$("#sdInfoId .sd_ul").append(n.join("")),indexJS.setListScroll($("#sdInfoId .sd_show"),{callbacks:{onTotalScroll:videos.sd.showTradeList}})},showAuthBox:function(){var e=$("#userListId li[utype='3']:first");0==e.size()?$("#sdNoAuthBox .sdzl").hide():($("#sdNoAuthBox .sdzl").show(),$("#sdNoAuthBox .aid_chat img").attr("src",e.find(".headimg img").attr("src")),$("#sdNoAuthBox .aid_chat span").attr("uid",e.attr("id")).text(e.find(".uname span:first").text())),$("#sdNoAuthBox,.blackbg").show()}}},chat={socket:null,msgPushObj:{pbInfos:[],whInfos:[],whInfo:{}},whTipInterId:null,pushInfoTimeOutId:null,initUserList:!1,msgType:{text:"text",img:"img",file:"file"},init:function(){this.setEvent(),this.setSocket(),this.setTalkListScroll(!0)},setEvent:function(){$(".mod_userlist .titbar span").click(function(){$(this).addClass("on").siblings(".on").removeClass("on"),$(".user_box ul").hide().eq($(this).index()-1).show()}),(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&$("#msgFaceBtn").qqFace({id:"faceId",assign:"contentText",path:indexJS.filePath+"/face/"}),$(document).click(function(e){$("div[id^=faceId]").hide(),$(e.target).hasClass("inp-bar4")||$(e.target).parents().hasClass("envelope-reward")||$(e.target).parents().hasClass("popup_box")||$(e.target).hasClass("blackbg")||$(".envelope-reward").addClass("dn"),$(e.target).hasClass("headimg")||$(e.target).parents().hasClass("headimg")||"header"==$(e.target).parent().attr("t")||$(e.target).hasClass("uname")||$(e.target).parents().hasClass("te_ul")||$(".dialogbtn").hide()}),$(".replybtn").click(function(){chat.setDialog($(this).attr("uId"),$(".sender").html(),$(this).attr("ts"),$(this).attr("futype")),$(".mymsg em").show()}),$("#mymsgClose").click(function(){$(".mymsg,.mymsg em").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),chat.setTalkListScroll()}),$(".scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),chat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),chat.showViewSelect($(this).attr("t")),chat.setTalkListScroll(!0))}),$("#contentText").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="send-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){var t=$(this).html();if(13==e.keyCode)return common.isValid(t)&&($(this).html(t.replace(/<div>|<\/div>/g,"")),$(".ui-autocomplete").is(":hidden")&&$("#sendBtn").click()),!1;if(8==e.keyCode){var i=$(this).find(".txt_dia");if($.trim($(this).text())==i.text())return i.remove(),$(this).html(""),!0}}).autocomplete({source:function(e,t){/^@.*$/g.test(e.term)&&(t(chat.searchUserList(e.term.substring(1,e.term.length))),$(".ui-autocomplete").css("z-index","10000000"))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(e,t){return $("#contentText").html("").append('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t.item.value+'" utype="'+t.item.userType+'">@<label>'+t.item.label+"</label></span>&nbsp;").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(e,t){return $("<li>").attr("data-value",t.label).append("<a>"+t.label+"</a>").appendTo(e)},$("#sendBtn").click(function(){if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();if(indexJS.userInfo.isSetName===!1)return void box.openSetNameBox(!0);var e=$('[isme="true"]').size(),t=$("#roomInfoId").attr("spn");if(common.isValid(t)&&e==t&&!indexJS.userInfo.isLogin)return box.forceLogin(!0),void $("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:null,spn:t});chat.socket.connected||box.showTipBox("连接已断开");var i=chat.getToUser(),s=$("#contentText .text-min-img img");if(s.size()>0){var n=s.attr("src");n.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(n,i),s.remove())}var a=chat.getSendMsg();if(a!==!1){var o={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:a}},r=$(".replybtn");i&&i.userId==r.attr("uid")&&i.talkStyle==r.attr("ts")&&$(".mymsg,.mymsg em").hide(),o.fromUser.toUser=i,chat.socket.emit("sendMsg",o),chat.setContent(o,!0,!1),$("#contentText").html("")}}),$("#sendReward").click(function(){chat.reward()}),$(".envelope-reward .reward-title .reward-back").click(function(){$("#js-reward-user").val(""),$(".envelope-reward .reward-title .reward-back,.envelope-reward .reward-weima,#rewardQRCode img").addClass("dn").hide(),$(".envelope-reward .reward-form").removeClass("dn")}),$("#js-reward-send-btn").click(function(){var e=$("#js-reward-user").val();common.isBlank(e)?box.showMsg("请选择老师"):($(".envelope-reward .reward-form").addClass("dn"),$(".envelope-reward .reward-title .reward-back,.envelope-reward .reward-weima").removeClass("dn").show(),$("#qrCode").attr("src","/hx/theme1/img/rew/"+e+".png").show())}),$("#sendImgBtn").click(function(){return FileReader?!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor")?void box.openLgBox():indexJS.userInfo.isSetName===!1?void box.openSetNameBox(!0):void $("#sendImgInp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#sendImgInp").bind("change",function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var s=new FileReader;s.readAsDataURL(t),s.onload=function(e){chat.setUploadImg(e.target.result,chat.getToUser())},s.onprogress=function(e){},s.onloadend=function(e){},$(this).val("")}),$(".pletter_win").css({top:$(window).height()/2-218,left:$(window).width()/2-310}).draggable({handle:".wh_drag",cursor:"move",containment:"document",scroll:!1})},setUploadImg:function(e,t){var i=chat.getUiId(),s={};common.copyObject(s,indexJS.userInfo,!0),s.toUser=t;var n={uiId:i,fromUser:s,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};t&&1==t.talkStyle?this.setWhContent(n,!0,!1):this.setContent(n,!0,!1),n.content.value=e,this.zipImg(n,100,60,function(e,t){if(e.error)return alert(e.error),$("#"+i).remove(),!1;var s=$("#"+e.uiId+" span[contt='a'] a");s.attr("href",t).children("img").attr("src",t).attr("needMax",e.content.needMax),chat.dataUpload(e)})},zipImg:function(e,t,i,s){var n=new Image;n.onload=function(){var a=document.createElement("canvas");a||s({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var o=n.width,r=n.height;if(r>=9*o)return s({error:"该图片高度太高，暂不支持发送！"}),!1;t>0&&(r>t||o>t)&&(e.content.needMax=1,r>t&&t>=o?(o=t/r*o,r=t):(r=t/o*r,o=t),n.height=r,n.width=o);var l=a.getContext("2d");a.width=o,a.height=r,l.clearRect(0,0,a.width,a.height),l.drawImage(n,0,0,o,r),s(e,a.toDataURL("image/jpeg",i/100))},n.src=e.content.value},dataUpload:function(e){var t=new XMLHttpRequest;t.open("POST","/hxstudio/uploadData"),t.addEventListener("progress",function(t){if(t.lengthComputable){var i=(t.loaded/t.total*100|0)+"%";$("#"+e.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+e.uiId+" .shadow-conut").html(i)}},!1),t.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&console.log("dataUpload success!")},e.fromUser.socketId=this.socket.id,t.send(JSON.stringify(e))},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},getUiId:function(){var e=new Date;return e.getTime()+"_ms"},getToUser:function(){var e=$("#contentText .txt_dia");return e.length>0?{userId:e.attr("uid"),nickname:e.find("label").text(),talkStyle:0,userType:e.attr("utype")}:null},getSendMsg:function(e){var e=e?e:$("#contentText");if(e.text().length+e.find("img").size()>140)return alert("消息内容超过最大长度限制（140字以内）！"),!1;e.find(".txt_dia").length>0&&e.find(".txt_dia").remove();var t=common.clearMsgHtml(e.html());return common.isBlank(t)?(e.html(""),!1):t},setDialog:function(e,t,i,s,n){if(1==i)chat.closeWhTip(e),chat.fillWhBox(null,n,s,e,t,!1,!1);else{if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e+'" utype="'+s+'">@<label>'+t+"</label></span>&nbsp;").focusEnd()}},showViewSelect:function(e){"analyst"==e?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"me"==e?($("#dialog_list").children("[isme='true']").show(),$("#dialog_list").children("[isme='false']").hide()):"admin"==e?$("#dialog_list").children("[utype!=1]").hide():"cs"==e?($("#dialog_list").children("[utype=3]").show(),$("#dialog_list").children("[utype!=3]").hide()):$("#dialog_list").children().show()},setContent:function(e,t,i){var s=e.fromUser;if(t&&(s.publishTime=e.uiId),e.isVisitor)return $("#"+e.uiId).remove(),void box.openLgBox();if(i&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" span[contt] em[class=ruleTipStyle]").remove(),void $("#"+s.publishTime+" .approve").remove();if(e.rule)return void(e.value&&e.value.needApproval?$("#"+e.uiId).attr("id",s.publishTime):(chat.removeLoadDom(e.uiId),$("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>")));
if(t||indexJS.userInfo.userId!=s.userId||!e.serverSuccess){var n=chat.formatContentHtml(e,t,i),a=$("#dialog_list");a.append(n),this.formatMsgToLink(s.publishTime);var o=$(".view_select .selectlist a[class=on]").attr("t");if("all"!=o&&chat.showViewSelect(o),!i){var r=$("#userListId li[id="+s.userId+"]"),l=null;s.avatar&&r.length>0&&s.avatar!=(l=r.find(".headimg img")).attr("src")&&l.attr("src",s.avatar),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}$("#"+s.publishTime+" .txt_dia").click(function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&chat.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+s.publishTime+" .uname,#"+s.publishTime+" .headimg").click(function(){var e=$("#"+s.publishTime+" .dialogbtn");e.attr("avs",$(this).parents(".dialog").find(".headimg img").attr("src")),chat.openDiaLog(e,!0)})}else if($("#"+e.uiId+" .dtime").html(chat.formatPublishTime(s.publishTime)),$("#"+e.uiId).attr("id",s.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(s.publishTime);var d=$("#"+s.publishTime+' span[contt="a"]>a'),c=e.content.needMax?"/hxstudio/getBigImg?publishTime="+s.publishTime+"&userId="+s.userId:d.children("img").attr("src");d.attr("href",c)}},openDiaLog:function(e,t){if($(".dialogbtn").not(e).hide(),!e.is(":hidden"))return e.hide(),!1;if(t){var i=e.parent(),s=e.is(".bot");i.next().size()<=0?s||e.addClass("bot"):s&&e.removeClass("bot")}e.show();var n=e.find("a"),a=e.attr("avs");common.isValid(a)?(n.attr("avs",a),e.attr("avs","")):n.attr("avs",""),n.unbind("click"),n.click(function(){var e=$(this).parent();chat.setDialog(e.attr("uid"),e.attr("nk"),$(this).attr("t"),e.attr("utype"),$(this).attr("avs")),e.hide()})},formatPublishTime:function(e,t,i){var s=Number(e.replace(/_.+/g,""));return common.isBlank(e)?"":t?common.formatterDateTime(s,i):common.getHHMM(s)},formatContentHtml:function(e,t,i){var s="dialog ",n="",a="",o="false",r="",l=e.fromUser,d=e.content,c=l.nickname,u="";indexJS.userInfo.userId==l.userId&&t&&(l.publishTime=e.uiId,u='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>');var h=l.toUser,p="";h&&common.isValid(h.userId)&&(p='<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">@<label>'+h.nickname+"</label></span>",indexJS.userInfo.userId==h.userId&&(o="true")),d.msgType==chat.msgType.img?(n=d.needMax?'<a href="/hxstudio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片"/></a>':'<a href="'+(d.value?d.value:"javascript:")+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片" /></a>',n+=u):n=d.value,indexJS.userInfo.userId==l.userId?(s+="mine ",o="true",r='<span class="dtime">'+chat.formatPublishTime(l.publishTime)+'</span><a href="javascript:" class="uname">'+c+"</a>"):(3==l.userType&&(c+="&nbsp;（客服）"),r='<a href="javascript:" class="uname">'+c+'</a><span class="dtime">'+chat.formatPublishTime(l.publishTime)+"</span>",a=chat.getDialogHtml(l.userId,c,l.userType),!i&&h&&indexJS.userInfo.userId==h.userId&&($(".mymsg").show(),$(".mymsg em").hide(),$(".replybtn").attr("uid",l.userId),$(".replybtn").attr("ts",h.talkStyle),$(".replybtn").attr("futype",l.userType),$(".sender").html(l.nickname),$(".xcont").html(n)));var m=chat.getAImgOrLevel(l.userId,l.clientGroup,l.userType,l.avatar),f=[];return f.push('<div class="'+s+m.level+'" id="'+l.publishTime+'"  utype="'+l.userType+'" mtype="'+d.msgType+'" isme="'+o+'">'),f.push('<a href="javascript:" class="headimg">'+m.aImg+"<b></b></a>"),f.push('<div class="dialog_top">'+r+"</div>"),f.push("<p><i></i>"),h&&common.isValid(h.question)?(f.push('<span class="dcont">'),f.push('<span uid="'+h.userId+'" utype="'+h.userType+'">'+h.nickname+"</span>提问："),f.push('<span contt="q">'+h.question+"</span>"),f.push('<span class="dialog_reply">回复：<span contt="a">'+n+"</span></span>"),f.push("</span>")):f.push('<span class="dcont" contt="a">'+p+n+"</span>"),f.push("</p>"+a+"</div>"),f.join("")},formatMsgToLink:function(e){$("#"+e+' span[contt]:contains("http:"),#'+e+' span[contt]:contains("https:")').each(function(e,t){var i=$(t).html(),s=i.split(/<img[^>]*>|<a[^>]*>.*?<\/a>/g),n="";for(var a in s)if(n=s[a],!common.isBlank(n)){var o=n.toString().replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"});t.innerHTML=t.innerHTML.replace(n,o)}})},getAImgOrLevel:function(e,t,i,s){var n={aImg:common.isValid(s)?'<img src="'+s+'">':'<img src="/hx/theme1/img/user.png">',level:""};if(common.isValid(i)&&i>0)n.level=2==i?"analyst":"admin";else if("vip"==t)n.level="level4";else if("active"==t||"notActive"==t)n.level="level3";else if("simulate"==t)n.level="level2";else if("register"==t)n.level="level1";else if("visitor"==t||-1==i){e=e||"";var a=parseInt(e.substring(e.length-2),10);isNaN(a)&&(a=100),a=(a+17)%45,n.aImg='<img src="'+indexJS.filePath+"/upload/pic/header/chat/visitor/"+a+'.png">',n.level="visitor"}else n.level="visitor";return n},getDialogHtml:function(e,t,i){if(e&&indexJS.userInfo.userId!=e){var s=$("#roomInfoId"),n="",a=0;return(indexJS.visitorSpeak||-1==indexJS.userInfo.userId.indexOf("visitor_")&&-1==e.indexOf("visitor_"))&&(n+='<a href="javascript:" class="d1" t="0"><b></b><span>@TA</span></a>',a++),"true"==s.attr("aw")&&common.containSplitStr(s.attr("awr"),i)&&(n+='<a href="javascript:"'+(0==a?' class="d1"':"")+' t="1"><b></b><span>私聊</span></a>',a++),'<div class="dialogbtn'+(1==a?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'">'+n+"</div>"}return'<div class="dialogbtn'+(1==a?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'"></div>'},setOnlineUser:function(e){if(2==e.userType)return $("#teacherInfoId img").attr("src",e.avatar?e.avatar:"/hx/theme1/img/user-img.jpg"),$("#teacherInfoId h5").text(e.nickname),$("#teacherInfoId p").text(e.position),chat.setTeacherQRCode(e.userId),$("#outline").hide(),$("#teacherInfoId").removeClass("dn"),$("#teacherInfoId").attr({uid:e.userId,cg:common.isBlank(e.clientGroup)?"":e.clientGroup,t:e.userType,utype:e.userType}),heightCalcu(),!1;var t=e.userType>=0?"#userListId":"#visitorListId";$(t+" li[id='"+e.userId+"']").remove();var i=chat.getDialogHtml(e.userId,e.nickname,e.userType),s="",n="",a=e.sequence,o="";if(indexJS.userInfo.userId==e.userId&&(s="【我】",a="0",o="mynk"),3==e.userType){var r=$("#roomInfoId");"true"==r.attr("aw")&&common.containSplitStr(r.attr("awr"),e.userType)&&(n="<em>私聊</em>"),s="&nbsp;（客服）"}var l=chat.getAImgOrLevel(e.userId,e.clientGroup,e.userType,e.avatar),d=$(t+" li"),c='<li id="'+e.userId+'" cg="'+(common.isBlank(e.clientGroup)?"":e.clientGroup)+'" t="'+a+'" utype="'+e.userType+'" class="'+l.level+'" >'+i+'<a href="javascript:" t="header" class="uname"><div class="headimg">'+l.aImg+'<b></b></div><span class="'+o+'">'+e.nickname+s+"<i></i></span>"+n+"</a></li>";if(0==d.length)$(t).append(c);else if("0"==a)d.first().before(c);else{var u=!1,h=0,p="";d.each(function(){return h=parseInt($(this).attr("t")),e.sequence<h?($(this).before(c),u=!0,!1):e.sequence==h&&(p=$(this).find("a span").text(),e.nickname<=p)?($(this).before(c),u=!0,!1):void 0}),u||$(t).append(c)}common.isValid(i)&&$(t+" li[id="+e.userId+"] a[t=header]").click(function(e){if("0"==$(this).attr("t"))$(".user_box li").removeClass("zin");else{$(".user_box li").removeClass("zin"),$(this).parent().addClass("zin");var t=$(this).prev();t.attr("avs",$(this).find(".headimg img").attr("src")),chat.openDiaLog(t)}}).dblclick(function(){$(this).find("em").trigger("click")}).find("em").click(function(e){var t=$(this).parents("[utype]"),i=t.attr("utype");if(3!=i)return!1;var s=t.attr("id");return chat.closeWhTip(s),chat.fillWhBox(t.attr("cg"),t.find(".headimg img").attr("src"),t.attr("utype"),s,t.find(".uname span").text(),!1,!1),!1})},leaveRoomTip:function(e,t){if("forcedOut"!=e){if("roomClose"==e)$(".blackbg").children().hide(),box.showTipBox("注意：房间已停用，正自动登出..."),"visitor"==indexJS.userInfo.clientGroup?window.setTimeout(function(){indexJS.toRefreshView()},1200):window.setTimeout(function(){$(".logout").trigger("click")},1200);else if("otherLogin"==e){if("visitor"==indexJS.userInfo.clientGroup)return;chat.socket.disconnect(),$(".blackbg").children().hide(),box.showMsg({closeable:!1,title:"登出提示",msg:"由于您打开了多个直播室页面，造成重复登录，下线后请重新登录",btns:[{txt:"重新登录",fn:function(){indexJS.toRefreshView()}},{txt:"确定",fn:function(){$(".logout").trigger("click")}}]})}}else if(t)for(var i in t)$("#userListId li[id='"+t[i]+"']").remove()},setWhOnlineTip:function(e,t){var i=$("#wh_msg_"+e+" .tit strong");if(0!=i.length){var s=$("#wh_msg_"+e+" .tit strong"),n=$(".mult_dialog a[uid="+e+"]").find("img"),a=$("#userListId li[t=3][uid="+e+"] .headimg");t?(s.text("在线"),n.removeClass("have_op"),a.removeClass("have_op")):(s.text("离线"),n.addClass("have_op"),a.addClass("have_op"))}},getWhToUser:function(){var e=$(".mult_dialog a[class=on]"),t=e.attr("uid");return{userId:t,nickname:e.find("label").text(),talkStyle:1,userType:e.attr("utype")}},sendWhMsg:function(e){var t=chat.getWhToUser(),i=e.find(".text-min-img img");if(i.size()>0){var s=i.attr("src");s.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(s,t),i.remove())}var n=chat.getSendMsg(e);if(n!==!1){var a={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:n}},o=$(".mult_dialog a[class=on]").attr("uid");a.fromUser.toUser=t;var r=$("#wh_msg_"+o+" .dialog:last"),l=r.find(".whblt");l.length>0&&(a.fromUser.toUser.question=l.html(),a.fromUser.toUser.questionId=l.attr("rid"),a.fromUser.toUser.publishTime=r.attr("id")),chat.socket.emit("sendMsg",a),chat.setWhContent(a,!0,!1),e.html("")}},setWhVisitors:function(e,t,i,s,n,a,o){if(0==$(".mult_dialog a[uid="+i+"]").length){var r=this.getAImgOrLevel(i,e?e:$("#userListId li[id='"+i+"']").attr("cg"),t,n);$(".mult_dialog").append('<a href="javascript:" uid="'+i+'" utype="'+t+'" class=""><div class="headimg '+r.level+'">'+r.aImg+"<b></b></div><label>"+s+'</label><i class="num dn" t="0"></i><i class="close"></i></a>');var l=$(".mult_dialog a[uid="+i+"]");if(o){var d=l.find(".num"),c=parseInt(d.attr("t"))+1;d.attr("t",c).text(c).show()}l.find(".close").click(function(){var e=$(this).parent();e.remove(),$("#wh_msg_"+e.attr("uid")).remove(),0==$(".mult_dialog a").length?($(".pletter_win .cont[id]").remove(),$(".pletter_win").hide()):$(".mult_dialog a:last").click()}),l.click(function(){$(".mult_dialog a").removeClass("on"),$(this).addClass("on"),$(this).find(".num").attr("t",0).text("").hide();var e=$(this).attr("uid"),t="wh_msg_"+e,i=$(this).attr("utype");if(chat.closeWhTip(e),$(".pletter_win .cont[id]").hide(),0==$("#"+t).length){var s="whTxt_"+e;$(".pletter_win").append($("#wh_content_tmp").html()),$(".pletter_win .cont:last").attr("id",t).find(".ctextarea").attr("id",s),$("#"+t).find(".facebtn").qqFace({id:"faceId_"+e,zIndex:1e6,assign:s,path:indexJS.filePath+"/face/"}),$("#"+t).find(".imgbtn").click(function(){return FileReader?void $("#"+t).find(".imginp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#"+t).find(".imginp").bind("change",function(){var e=this,t=chat.getWhToUser(),i=e.files[0];if(!i)return!1;if(0!=i.type.indexOf("image")||!i.type||!/\.(?:jpg|png|gif)$/.test(i.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var s=i.size;if(s>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var n=new FileReader;n.readAsDataURL(i),n.onload=function(e){chat.setUploadImg(e.target.result,t)},n.onprogress=function(e){},n.onloadend=function(e){},$(this).val("")}),$("#"+t).find(".ctextarea").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="whSend-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){return 13==e.keyCode?(chat.sendWhMsg($(this)),!1):void 0}),$("#"+t).find(".sendbtn").click(function(e){chat.sendWhMsg($(this).parents(".cont").find(".ctextarea"))}),$("#"+t).find(".pop_close").click(function(){$(".pletter_win .cont[id],.pletter_win .mult_dialog a[uid]").remove(),$(".pletter_win").hide()}),$("#"+t).find(".pop_small").click(function(){$(".pletter_win").hide()}),chat.socket.emit("getWhMsg",{clientStoreId:indexJS.userInfo.clientStoreId,userType:indexJS.userInfo.userType,groupId:indexJS.userInfo.groupId,groupType:indexJS.userInfo.groupType,userId:indexJS.userInfo.userId,toUser:{userId:e,userType:i}})}$("#"+t).show().find(".wh_nk").text($(this).find("label").text()),$("#"+t).find(".ctextarea").focus(),chat.setTalkListScroll(!0,$("#"+t+" .wh-content"),"dark"),chat.setWhOnlineTip(e,$("#userListId li[id='"+e+"']").length>0)})}},setWhTip:function(e){if($(".pletter_win").is(":hidden")){var t=$("#userListId li[id="+e+"] a.uname span i"),i=0;t.length>0&&(i=t.text(),i=common.isValid(i)?i:0,$("#userListId li[id="+e+"] a.uname span i").text(parseInt(i)+1)),$("#userListId li[id="+e+"]").attr("k",1),this.whTipInterId||(this.whTipInterId=setInterval(function(){$("#userListId li[k=1]").toggleClass("tip_mrg")},1e3))}},closeWhTip:function(e){$("#userListId li[id="+e+"]").attr("k",0).removeClass("tip_mrg").find("a.uname span i").text(""),0==$("#userListId li[k=1]").length&&this.whTipInterId&&(clearInterval(this.whTipInterId),this.whTipInterId=null)},fillWhBox:function(e,t,i,s,n,a,o){var r=$(".mult_dialog a[uid="+s+"]");if(0==r.length)chat.setWhVisitors(e,i,s,n,t,!0,o);else if(o&&!r.hasClass("on")){var l=r.find(".num"),d=parseInt(l.attr("t"))+1;l.attr("t",d).text(d).show()}return $(".pletter_win").show(),$(".mult_dialog a[uid="+s+"]").click(),!a},setWhContent:function(e,t,i,s){var n=e.fromUser,a="dialog ",o=e.content,r="";if(e.rule)return void $("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>");if(i||(n.toWhUserId=n.userId),indexJS.userInfo.userId==n.userId||"0"==indexJS.userInfo.userType&&"-1"==n.userType||"-1"==indexJS.userInfo.userType&&"0"==n.userType){if(t&&(n.publishTime=e.uiId,n.toWhUserId=n.toUser.userId),e.serverSuccess){if($("#"+e.uiId+" .dtime").html(chat.formatPublishTime(n.publishTime)),$("#"+e.uiId).attr("id",n.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(n.publishTime);var l=$("#"+n.publishTime+' span[contt="a"]>a'),d=e.content.needMax?"/hxstudio/getBigImg?publishTime="+n.publishTime+"&userId="+n.userId:l.children("img").attr("src");l.attr("href",d)}return}a+="mine",r='<span class="dtime">'+chat.formatPublishTime(n.publishTime,i,"/")+'</span><a href="javascript:" class="uname">我</a>'}else{if(!i&&!s){var c=this.fillWhBox(n.clientGroup,n.avatar,n.userType,n.userId,n.nickname,!0,!0);if(c)return}var u="3"==n.userType?"&nbsp;（客服）":"";r='<a href="javascript:" class="uname">'+n.nickname+u+'</a><span class="dtime">'+chat.formatPublishTime(n.publishTime,i,"/")+"</span>"}if(common.isBlank(n.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var h="",p=$("#wh_msg_"+n.toWhUserId+" .dialoglist"),m="";if(o.msgType==chat.msgType.img){h=o.needMax?'<a href="/hxstudio/getBigImg?publishTime='+n.publishTime+"&userId="+n.userId+'" data-lightbox="whimg-"'+n.userId+'><img src="'+o.value+'" alt="图片"/></a>':'<a href="'+o.value+'" data-lightbox="whimg-"'+n.userId+'><img src="'+o.value+'" alt="图片" /></a>';var f=t?'</span><em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>':"";h='<p><i></i><span class="dcont" contt="a">'+h+f+"</p>"}else if(s)h='<div class="whcls"><i></i><div class="whblt" rid="'+o.infoId+'">'+o.value+"</div></div>";else{if(!t&&common.isValid(n.toUser.question)){var v='<a href="javascript:" class="uname">'+n.toUser.nickname+'</a><span class="dtime">'+chat.formatPublishTime(n.publishTime,i,"/")+"</span>";m='<div class="dialog" id="'+n.publishTime+'"><div class="dialog_top">'+v+'</div><div class="whcls"><i></i><div class="whblt">'+n.toUser.question+"</div></div></div>",p.append(m)}h='<p><i></i><span class="dcont" contt="a">'+o.value+"</span></p>"}if(m='<div class="'+a+'" id="'+n.publishTime+'" utype="'+n.userType+'" mType="'+o.msgType+'"><div class="dialog_top">'+r+"</div>"+h+"</div>",p.append(m),this.formatMsgToLink(n.publishTime),!i){var g=p.parents(".wh-content");g.hasClass("mCustomScrollbar")&&chat.setTalkListScroll(!0,g,"dark")}},setOnlineNum:function(){$(".mod_userlist .titbar label:first").text($("#userListId li").length),$(".mod_userlist .titbar label:last").text($("#visitorListId li").length)},searchUserList:function(e){var t=$("#userListId li[t!=14][t!=0]").map(function(){var t=$(this).find(".uname span").text();return-1!=t.indexOf(e)?{value:$(this).attr("id"),label:t,userType:$(this).attr("utype")}:null}).get(),i=[{value:$("#teacherInfoId").attr("uid"),label:$("#teacherInfoId dd h5").text(),userType:$("#teacherInfoId").attr("utype")}],s=$.merge(t,i);return s},setSocket:function(){this.socket=common.getSocket(io,indexJS.socketUrl,indexJS.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),indexJS.userInfo.socketId=chat.socket.id;var e=$("#roomInfoId");chat.socket.emit("login",{userInfo:indexJS.userInfo,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:e.attr("awr"),allowWhisper:e.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(e,t){if($("#userListId").html(""),"true"==$("#roomInfoId").attr("av")&&!chat.initUserList&&500>t){var i=0;for(var s in e)"visitor"==e[s].clientGroup&&i++;for(var n=0,a=10>i?560-t:500-t+3*(200/i)+10,s=0;a>s;s++)n=common.randomNumber(6),e["visitor_"+n]={userId:"visitor_"+n,clientGroup:"visitor",nickname:"游客_"+n,sequence:14,userType:-1};chat.initUserList=!0}var o=null;for(var s in e)o=e[s],chat.setOnlineUser(o);chat.setOnlineNum(),indexJS.setListScroll(".user_box")}),this.socket.on("disconnect",function(e){console.log("disconnect")}),this.socket.on("error",function(e){console.error("e:"+e)}),this.socket.on("sendMsg",function(e){if(e.fromUser.toUser&&1==e.fromUser.toUser.talkStyle)chat.setWhContent(e,!1,!1);else{if(!e.serverSuccess&&indexJS.userInfo.userId==e.fromUser.userId&&!e.rule)return;chat.setContent(e,!1,!1)}}),this.socket.on("notice",function(e){switch(e.type){case"onlineNum":var t=e.data,i=t.onlineUserInfo;t.online?chat.setOnlineUser(i):indexJS.userInfo.userId!=i.userId&&(2==i.userType?($("#teacherInfoId,.user-infbox .user-code").addClass("dn"),$("#outline").show(),heightCalcu()):-1==i.userType?$("#visitorListId #"+i.userId).remove():$("#userListId #"+i.userId).remove(),indexJS.setListScroll(".user_box")),chat.setOnlineNum();break;case"removeMsg":$("#"+e.data.replace(/,/g,",#")).remove(),chat.setTalkListScroll();break;case"leaveRoom":chat.leaveRoomTip(e.flag,e.userIds);break;case"pushInfo":var t=e.data;if(1==t.position)chat.msgPushObj.whInfos=t.infos;else if(3==t.position){chat.msgPushObj.pbInfos=t.infos;for(var s=0,n=chat.msgPushObj.pbInfos.length;n>s;s++)chat.msgPushObj.pbInfos[s].nextTm=chat.msgPushObj.pbInfos[s].serverTime+60*chat.msgPushObj.pbInfos[s].onlineMin*1e3}else 4==t.position&&videos.rollNews(t);break;case"approvalResult":var t=e.data;if(t.refuseMsg){var a=t.publishTimeArr;for(var s in a)$("#"+a[s]+" span[contt] em[class=ruleTipStyle]").html("已拒绝")}else{for(var s in t)chat.formatUserToContent(t[s]);chat.setTalkListScroll(!0)}}}),this.socket.on("loadMsg",function(e){$("#dialog_list .push").hide(),$(".img-loading[pf=chatMessage]").hide();var t=e.msgData;if(t&&$.isArray(t)){t.reverse();for(var i in t)"object"==typeof t[i]&&chat.formatUserToContent(t[i])}$("#dialog_list .push").appendTo($("#dialog_list")).show(),chat.setTalkListScroll(!0)}),this.socket.on("loadWhMsg",function(e){var t=$("#wh_msg_"+e.toUserId+" .chat_content .dialoglist .dialog .whcls").parent(),i=t.next().size(),s=t.prev().size();0==i&&0==s&&t.hide();var n=e.data;if("offline"==e.type){if(n&&!$.isEmptyObject(n))for(var a in n)chat.setWhVisitors(n[a].clientGroup,n[a].userType,a,n[a].nickname,$("#userListId li[id='"+a+"']").length>0)}else if(n&&$.isArray(n)){var o=0,r=null;n.reverse();$(".mult_dialog a[uid="+e.toUserId+"]");for(var l in n)r=n[l],chat.formatUserToContent(r,!0,e.toUserId),r.content.msgType==chat.msgType.img&&o++;0==i&&0==s&&t.appendTo($("#wh_msg_"+e.toUserId+" .chat_content .dialoglist")).show(),chat.setTalkListScroll(!0,$("#wh_msg_"+e.toUserId+" .wh-content"),"dark")}})},setTalkListScroll:function(e,t,i){var s=t?t:$("#chatMsgContentDiv");s.hasClass("mCustomScrollbar")?(s.mCustomScrollbar("update"),e&&s.mCustomScrollbar("scrollTo","bottom")):(s.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:i?i:"light-2"}),indexJS.setScrollStyle(s),s.mCustomScrollbar("scrollTo","bottom"))},setWhPushInfo:function(e,t){var i=e.attr("uid"),s=e.find("label").text().replace(/\s（客服）$/,"");if($("#wh_msg_"+i+" div[id="+chat.msgPushObj.whInfo.publishTime+"]").length>0)return!1;var n={fromUser:{publishTime:chat.msgPushObj.whInfo.publishTime,userId:i,nickname:s,userType:3},content:{msgType:chat.msgType.text,value:chat.msgPushObj.whInfo.info,infoId:chat.msgPushObj.whInfo.infoId}};return chat.setWhContent(n,!1,!1,!0),chat.msgPushObj.whInfo={},window.clearTimeout(chat.pushInfoTimeOutId),!0},formatUserToContent:function(e,t,i){var s={userId:e.userId,nickname:e.nickname,avatar:e.avatar,userType:e.userType,groupId:e.groupId,clientGroup:e.clientGroup,publishTime:e.publishTime,toUser:e.toUser,avatar:e.avatar,position:e.position};t?(s.toWhUserId=i,chat.setWhContent({fromUser:s,content:e.content},!1,!0)):chat.setContent({fromUser:s,content:e.content},!1,!0)},talkBoxPush:{talkPushList:[],talkPushInterval:null,initTBP:function(e){this.clear(),this.talkPushList=e,this.start()},clear:function(){chat.talkBoxPush.talkPushInterval&&(window.clearInterval(chat.talkBoxPush.talkPushInterval),chat.talkBoxPush.talkPushInterval=null);for(var e=chat.talkBoxPush.talkPushList,t=null,i=0,s=e.length;s>i;i++)t=e[i],t.timeoutId&&window.clearTimeout(t.timeoutId),t.intervalId&&window.clearInterval(t.intervalId)},start:function(){var e=chat.talkBoxPush.talkPushList;e&&e.length>0&&(chat.talkBoxPush.talkPushInterval=window.setInterval(function(){chat.talkBoxPush.check()},1e4))},check:function(){for(var e=chat.talkBoxPush.talkPushList,t=null,i=0,s=e.length;s>i;i++)t=e[i],t.startFlag||common.dateTimeWeekCheck(t.pushDate,!1,indexJS.serverTime)&&(t.startFlag=!0,t.timeoutId=window.setTimeout(chat.talkBoxPush.delayStartTask(t),60*(t.onlineMin||0)*1e3))},delayStartTask:function(e){return function(){chat.talkBoxPush.showMsg(e),e.intervalMin&&e.intervalMin>0&&(e.intervalId=window.setInterval(chat.talkBoxPush.startTask(e),60*e.intervalMin*1e3))}},startTask:function(e){return function(){common.dateTimeWeekCheck(e.pushDate,!1,indexJS.serverTime)?chat.talkBoxPush.showMsg(e):(window.clearInterval(e.intervalId),e.startFlag=!1)}},showMsg:function(e){var t=[];t.push('<div class="dialog push">'),e.content.indexOf("img")>-1?(t.push('<a href="'+$(e.content).find("img").attr("src")+'" data-lightbox="dialog-img">'),t.push(e.content),t.push("</a>")):t.push(e.content),t.push("</div>"),$("#dialog_list").append(t.join(""));var i=$("#dialog_list").find(".dialog.push img");i.length>0&&(i.width("100%"),i.height("auto")),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}},reward:function(){$(".inp-bar4").hasClass("clicked")?$(".envelope-reward").removeClass("dn"):($(".inp-bar4").addClass("clicked"),$(".envelope-reward").removeClass("dn"))},setTeacherQRCode:function(e){var t={userId:e};common.getJson("/hxstudio/getTeacher",{data:JSON.stringify(t)},function(e){e?(common.isValid(e.wechatCodeImg)?$(".user-infbox .user-code").attr("src",e.wechatCodeImg).removeClass("dn"):$(".user-infbox .user-code").attr("src","").addClass("dn"),common.isValid(e.introductionImg)?$(".user-infbox .tradedata img").attr("src",e.introductionImg).removeClass("dn"):$(".user-infbox .tradedata img").attr("src","").addClass("dn"),common.isValid(e.introductionImgLink)?$(".user-infbox .tradedata a").attr("href",e.introductionImgLink):$(".user-infbox .tradedata a").attr("href","javascript:void(0);")):($(".user-infbox .user-code,.user-infbox .tradedata img").attr("src","").addClass("dn"),$(".user-infbox .tradedata a").attr("href","javascript:void(0);"))})},setPushInfo:function(){var e=null,t=chat.msgPushObj.whInfos;if(t&&t.length>0)for(var i=0,s=t.length;s>i;i++)if(e=t[i],!e.pushed&&e&&indexJS.serverTime>=e.serverTime+60*e.timeOut*1e3){e.pushed=!0,chat.msgPushObj.whInfo={info:e.content,publishTime:e.publishTime,infoId:e.contentId};var n=$("#userListId li[t=3] a .headimg:not(.have_op)"),a=$(n.get(common.randomIndex(n.length))).parent();a.dblclick(),chat.setWhPushInfo($(".mult_dialog a[uid="+a.parent().attr("id")+"]"))}var o=null,r=chat.msgPushObj.pbInfos;if(r&&r.length>0)for(var i=0,l=r.length;l>i;i++)o=r[i],o.nextTm&&indexJS.serverTime>=o.nextTm&&common.dateTimeWeekCheck(o.pushDate,!1,indexJS.serverTime)&&(o.intervalMin&&o.intervalMin>0?o.nextTm=indexJS.serverTime+60*o.intervalMin*1e3:delete o.nextTm,chat.talkBoxPush.showMsg(o))}};$(function(){chat.init()});var box={verifyCodeIntId:null,toRoomId:null,init:function(){this.setEvent()},openCSBox:function(){window.open("https://www.serve888.com/serve888/chatClient/chatbox.jsp?companyID=217&s=1","Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")},setEvent:function(){$(".loginbox .pop_close,.popup_box .pop_close,.formbtn[t=close]").click(function(){$(this).parent().parent().hide(),$(".blackbg").hide(),$(".blackbg form").each(function(){this.reset()})}),this.loginEvent(),this.upgradeEvent(),this.expertMailEvent(),$("#popAnnBox .yesbtn").click(function(){$("#popAnnBox").fadeOut("normal","swing",function(){$(".blackbg").hide()})})},upgradeEvent:function(){$("#tipbtnId").hover(function(){$(".upg_tip").show()},function(){$(".upg_tip").hide()}),$(".upgradebtn").click(function(){try{$(".upgrade,#up_loading").show(),$.getJSON("/hxstudio/getClientGroupList",null,function(e){if($("#up_loading").hide(),e){$("#upg_tbody_id").html("");var t="",i=0,s=null,n="";for(var a in e)e[a].clientGroupId==indexJS.userInfo.clientGroup&&(i=e[a].sequence);for(var o=0;o<e.length;o++)if(s=e[o],n="",s.clientGroupId==indexJS.userInfo.clientGroup?(t="当前级别",n="current"):t="visitor"!=s.clientGroupId&&i<s.sequence?"vip"==s.clientGroupId?"联系客服升级":'<a href="javascript:" t="'+s.clientGroupId+'">升级</a>':"---",!common.isBlank(common.trim(s.remark))){var r=[];r.push('<tr class="'+n+'"><td><p>'+box.getUserLevelShortName(s.clientGroupId)+'</p></td><td><p class="p2">'+common.trim(s.remark)+"</p></td><td><p>"+common.trim(s.authorityDes)+"</p></td><td>"+t+"</td></tr>"),$("#upg_tbody_id").append(r.join(""))}$("#upg_tbody_id a").click(function(){var e=$(this),t=e.attr("t");common.getJson("/hxstudio/upgrade",{clientGroup:t},function(i){if(e.attr("disabled",!1),i.isOK)"active"===i.clientGroup&&"notActive"===t?$("#studioUpgA").show():$("#studioUpgA").hide(),$(".upgrade,.upgrade_result .fail").hide(),$(".upgrade_result,.upgrade_result .succ").show();else{var s="";"active"===t?s="很遗憾，您未激活恒信真实交易账户，升级失败！<br>如有疑问请联系客服！":"notActive"===t?s="很遗憾，您未开通恒信真实交易账户，升级失败！<br>如有疑问请联系客服！":"simulate"===t&&(s="很遗憾，您未开通恒信模拟交易账户，升级失败！<br>如有疑问请联系客服！"),$(".upgrade_result .succ").hide(),$(".upgrade_result,.upgrade_result .fail").show(),$(".upgrade_result .fail>span").html(s)}},!0,function(t){e.attr("disabled",!1)})})}})}catch(e){$("#up_loading").hide(),console.error("getClientGroupList->"+e)}})},forceLogin:function(e){var t=LoginAuto.get();return"boolean"!=typeof e?t&&1==t.forceLogin:t?(t.forceLogin=e,LoginAuto.set(t)&&e):!1},loginEvent:function(){if($("#verMalCodeId").click(function(){$("#verMalCodeId img").attr("src","/hxstudio/getVerifyCode?code=acLogin&t="+(new Date).getTime())}),$(".login-mode li").click(function(){$(this).addClass("on").siblings().removeClass("on"),$(".login-modebox ul").removeClass("on").eq($(this).index()).addClass("on")}),$("#login_a").bind("click",function(e,t){t=t||{},box.toRoomId=t.groupId,box.openLgBox(t.closeable,t.showTip,t.loginTime,t.spn)}),"visitor"==indexJS.userInfo.clientGroup){var e=$("#roomInfoId").attr("lgt"),t=$("#roomInfoId").attr("spn");if(common.isValid(e))if(indexJS.currStudioAuth){if(this.forceLogin())$("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:e});else if(common.isValid(e)&&!isNaN(e))try{e=parseInt(e),setTimeout(function(){box.forceLogin(!0),$("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:e})},60*e*1e3)}catch(i){console.error("set login Time has error",i)}}else $("#login_a").trigger("click",{closeable:!1,showTip:!1,loginTime:e});else common.isValid(t)&&(indexJS.currStudioAuth?this.forceLogin()&&$("#login_a").trigger("click",{closeable:!1,showTip:!0,loginTime:null,spn:t}):$("#login_a").trigger("click",{closeable:!1,showTip:!1,loginTime:null,spn:t}))}$(".logout").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href=indexJS.fromPlatform?"/hxstudio/logout?platform="+indexJS.fromPlatform:"/hxstudio/logout"}),$("#loginForm input[name=mobilePhone],#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").bind("input propertychange",function(){common.isValid(this.value)&&$(".popup_box .error,.loginbox .error").hide()}),$("#loginForm .rbtn").click(function(){if(!$(this).hasClass("pressed")){var e=$("#loginForm input[name=mobilePhone]").val();if(!common.isMobilePhone(e))return void $("#loginForm .error").html("<i></i>手机号码有误，请重新输入！").show();$(this).addClass("pressed").html("发送中...");try{$.getJSON("/hxstudio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:e,useType:$(this).attr("ut")},function(e){e&&0==e.result?($("#loginForm .error").hide(),box.setVerifyCodeTime("#loginForm .rbtn")):("1005"==e.errcode?$("#loginForm .error").html("<i></i>"+e.errmsg).show():console.error("提取数据有误！"),box.resetVerifyCode())})}catch(t){box.resetVerifyCode(),console.error("setMobileVerifyCode->"+t)}}}),$("#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").keydown(function(e){return 13==e.keyCode?($(this).parents("form").find(".set_submit").click(),!1):void 0}),$("#logBtnSub").click(function(){$("#loginForm input[name=clientStoreId]").val(indexJS.userInfo.clientStoreId);var e=$("#loginForm .login-inf").hasClass("on");if(box.checkFormInput("#loginForm",$("#loginForm .error"),e?["mobilePhone","verifyCode"]:["accountNo","pwd","verMalCode"])){$(this).attr("disabled",!0);var t=this;$("#formBtnLoad").show(),common.getJson("/hxstudio/hxLogin",$("#loginForm").serialize()+"&isPwdLogin="+e,function(e){return $("#loginForm .error").hide(),$(t).attr("disabled",!1),$("#formBtnLoad").hide(),e.isOK?($(".blackbg,#loginBox").hide(),LoginAuto.setAutoLogin($("#autoLogin").prop("checked")),indexJS.userInfo.clientGroup=e.userInfo.clientGroup,box.toRoomId?common.getJson("/hxstudio/checkGroupAuth",{groupId:box.toRoomId},function(e){!e.isOK,indexJS.toRefreshView()},!0,function(e){"success"!=e&&(box.preGroupId=null,alert("操作失败，请联系客服！"))}):(indexJS.checkClientGroup("vip"),indexJS.toRefreshView()),void 0):($("#loginForm .error").html("<i></i>"+e.error.errmsg).show(),!1)},!0,function(e){$(t).attr("disabled",!1),$("#formBtnLoad").hide()})}}),$("#setNkBtn").click(function(){if(box.checkFormInput("#setNkForm")){$(this).prop("disabled",!0);var e=this;$("#setNkLoad").show(),common.getJson("/hxstudio/modifyName",$("#setNkForm").serialize(),function(t){return $("#setNkForm .error").hide(),$(e).attr("disabled",!1),$("#setNkLoad").hide(),t.isOK?($("#setNkForm").parent().find(".pop_close").click(),indexJS.refreshNickname(!0,t.nickname),$("#sendBtn").click(),void 0):($("#setNkForm .error").html("<i></i>"+(t.msg?t.msg:"修改失败，请联系客服！")).show(),!1)},!0,function(t){$(e).attr("disabled",!1),$("#setNkLoad").hide()})}})},getUserLevelShortName:function(e){var t="";switch(e){case"vip":t="[V]";break;case"real":t="[R]";break;case"active":t="[A]";break;case"notActive":t="[N]";break;case"simulate":t="[D]";break;case"register":t="[M]";break;default:t="游客";
}return t},checkFormInput:function(e,t,i){var s=!0;t||(t=$(e+" .error")),t.attr("tId","").hide();var n=" input[type!=checkbox]";if(i)for(var a in i)n+="[name!="+i[a]+"]";return $(e+n).each(function(){return common.isBlank($(this).val())?("accountNo"==this.name&&t.attr("tId",this.name).html("<i></i>账号不能为空！").show(),"pwd"==this.name&&t.attr("tId",this.name).html("<i></i>密码不能为空！").show(),"verMalCode"==this.name&&t.attr("tId",this.name).html("<i></i>验证码不能为空！").show(),"mobilePhone"==this.name&&t.attr("tId",this.name).html("<i></i>手机号码不能为空！").show(),"verifyCode"==this.name&&t.attr("tId",this.name).html("<i></i>验证码不能为空！").show(),"nickname"==this.name&&t.attr("tId",this.name).html("<i></i>昵称不能为空！").show(),s=!1):"mobilePhone"!=this.name||($(this).val($.trim($(this).val())),common.isMobilePhone(this.value))?"nickname"!=this.name||common.isRightName(this.value)?void("verMalCode"==this.name&&$(this).val(this.value.toLowerCase())):(t.attr("tId",this.name).html("<i></i>昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!").show(),s=!1):(t.attr("tId",this.name).html("<i></i>手机号码输入有误！").show(),s=!1)}),s||t.show(),s},setVerifyCodeTime:function(e){var t=parseInt($(e).attr("t"))||60;this.verifyCodeIntId||(this.verifyCodeIntId=setInterval("box.setVerifyCodeTime('"+e+"')",1e3)),t>1?$(e).attr("t",t-1).html("重新获取("+(t-1)+")"):(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId="",$(e).attr("t",60).html("获取验证码").removeClass("pressed"))},resetVerifyCode:function(){this.verifyCodeIntId&&(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId=""),$("#loginForm .rbtn").attr("t",60).html("获取验证码").removeClass("pressed")},openLgBox:function(e,t,i,s){e===!1?$("#loginBox .pop_close").hide():$("#loginBox .pop_close").show(),t?($("#login_tip").show().text($("#setlogintip").text()),common.isValid(s)&&$("#login_tip").show().text($("#speaktip").text())):$("#login_tip").hide(),(common.isValid(i)||common.isValid(s))&&box.disableVideoSocket(),$(".popup_box").hide(),$("#loginBox,.blackbg").show(),$("#verMalCodeId").click()},openSetNameBox:function(e){var t=e?"设置昵称":"修改昵称";$(".nk_box .pop_tit").text(t),$(".nk_box,.blackbg").show()},refreshVerifyCode:function(){var e=LoginAuto.sessionUser.groupType;$("#verifyCodeId img").attr("src","/"+e+"/getVerifyCode?code=email&v="+Math.random())},expertMailEvent:function(){$(".expert_box .error").hide(),$("#expert").click(function(){box.refreshVerifyCode(),$(".expert,.blackbg").removeClass("dn").show()}),$("#btnSendMail").click(function(){if(common.isBlank($("#mailFrom").val()))$(".expert_box .error").html("<i></i>发件人不能为空！").show();else if(common.isBlank($("#mailContent").val()))$(".expert_box .error").html("<i></i>输入内容有误，请重新输入！").show();else if(common.isBlank($("#mailImgCode").val()))$(".expert_box .error").html("<i></i>请输入验证码！").show();else{$(".expert_box .error").hide();var e={};e.content=$.trim($("#mailContent").val()),e.email=$.trim($("#mailFrom").val()),common.getJson("/hxstudio/email",{key:"hxstudio",data:JSON.stringify(e)},function(e){e.isOK?(box.showMsg(e.msg),$(".expert,.blackbg").hide(),$("#mailFrom,#mailContent").val("")):$(".expert_box .error").html("<i></i>"+e.msg).show()})}}),$("#btnSendMail").keydown(function(e){return 13==e.keyCode?($("#btnSendMail").click(),!1):void 0}),$("#verifyCodeId img").click(function(){box.refreshVerifyCode()})},hideMsg:function(){$("#popMsgBox").is(":visible")&&$("#popMsgBox").fadeOut("normal","swing",function(){$(".blackbg").hide()})},showMsg:function(e){"string"==typeof e&&(e={msg:e}),e=$.extend({closeable:!0,title:"",msg:"",modal:!0,delay:0,btns:[{txt:"确定",fn:function(){box.hideMsg()}}]},e),$("#popMsgTit").text(e.title||""),$("#popMsgTxt").html(e.msg);var t=$("#popMsgCont");t.find("a.yesbtn").remove();for(var i=null,s=null,n=0,a=e.btns?e.btns.length:0;a>n;n++)i=e.btns[n],s=$('<a class="yesbtn" href="javascript:void(0)">'+i.txt+"</a>"),t.append(s),s.click(i.fn);e.closeable?$("#popMsgClo").show():$("#popMsgClo").hide(),$("#popMsgBox").show(),e.modal&&$(".blackbg").show(),e.delay&&window.setTimeout(function(){box.hideMsg()},e.delay)},showTipBox:function(e){$(".tipsbox").fadeIn().delay(1e3).fadeOut(200).find(".cont").text(e)},disableVideoSocket:function(){window.setInterval(function(){$("#lvVideoId").empty(),chat.socket.disconnect()},5e3)}};$(function(){box.init()});var tool={financeShowIntervalId:null,financeHideIntervalId:null,tradeForUser:null,tradeList:[],tradeLoadAll:!1,init:function(){this.setEvent()},setEvent:function(){$(".mod_menu li").hover(function(){$(this).hasClass("entered")||(tool.loadFun($(this).attr("class")),$(".dr3").hasClass("on")&&clearTimeout(tool.financeHideIntervalId)),$(this).hasClass("dr2")&&$(this).hasClass("entered")&&($(".dr2 .teacher-point ul").css("height",$(".mod_menu").height()-75),indexJS.setListScroll(".dr2 .teacher-point ul",{isCustom:!1,scrollbarPosition:"outside"})),$(this).addClass("on entered"),$(this).find(".dropcont").show()},function(){$(this).removeClass("on"),$(this).find(".dropcont").hide(),$(".dr3").hasClass("on")||(clearInterval(tool.financeShowIntervalId),tool.financeHideIntervalId=window.setTimeout("tool.clearCls('.dr3','entered')",6e4)),$(".dr10").hasClass("entered")&&$(".dr10").removeClass("entered")}),$("#calendarFinance").val(common.formatterDate(indexJS.serverTime,"-")),$("#calendarFinance").change(function(){var e=$(this).val();tool.setFinanceData(e,1)}),$(".dr3 .date_select a").click(function(){$("#calendarFinance").trigger("click")}),$(".calc_box .calc_tabnav a").click(function(){$(this).hasClass("clicked")||tool.setPivotCalc($(this).attr("symbol")),$(".calc_box .calc_tabnav a").removeClass("on"),$(".calc_box .calc_tab").removeClass("on"),$(this).addClass("on clicked"),$($(".calc_box .calc_tab")[$(this).index()]).addClass("on")}),$("#wantShowTrade").click(function(){if(indexJS.userInfo.isLogin)(common.isBlank(indexJS.userInfo.isSetName)||indexJS.userInfo.isSetName)&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".pop_addsd").removeClass("dn").show();else{var e=e||{};box.openLgBox(e.closeable,e.showTip)}}),$("#myShowTrade").click(function(){if(indexJS.userInfo.isLogin)tool.tradeForUser=indexJS.userInfo.userId,tool.initShowTrade(),$("#all-orders").addClass("dn"),$("#my-orders").removeClass("dn"),$("#myShowTrade").hide(),$("#backShowTrade").show();else{var e={};box.openLgBox(e.closeable,e.showTip)}}),$("#all-orders .showMore").live("click",function(){"查看全部"!=$(this).text()?($(this).text("查看全部"),$(this).parent().prev().css("max-height","48px")):($(this).text("收起内容"),$(this).parent().prev().css("max-height","none"))}),$("#backShowTrade").click(function(){tool.tradeForUser=null,tool.initShowTrade(),$("#all-orders").removeClass("dn"),$("#my-orders").addClass("dn"),$("#myShowTrade").show(),$("#backShowTrade").hide()}),$("#flTradeImg").change(function(){var e=$(this),t=this.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var s=new FormData($("#showTradeForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:s,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var i=t.data?t.data[0]:null;i&&($("#tradeImg").val(i.fileDomain+i.filePath),e.val(""))}else alert("上传图片失败，请联系在线客服！")},error:function(e){console.error("error:",e)}})}catch(n){console.error("上传图片失败",n)}}),$("#tradeSubmit").click(function(){tool.showTrade()}),$("#showTradeAgain").click(function(){$('.pop_addsd input[type="text"],.pop_addsd textarea').val(""),$("#flTradeImg").val(""),indexJS.userInfo.isSetName&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".sd_result").addClass("dn").hide()}),$("#sdResultClose").click(function(){$('.pop_addsd input[type="text"],.pop_addsd textarea').val(""),$("#flTradeImg").val(""),indexJS.userInfo.isSetName&&$("#userName").val(indexJS.userInfo.nickname).attr("readonly","readonly"),$(".sd_result").addClass("dn").hide(),$(".pop_close").click()})},loadFun:function(e){switch(e){case"dropitem dr2":tool.teacherPoint();break;case"dropitem dr3":tool.initCalendar(function(){tool.setFinanceData("",1),$(".dr3").addClass("initCalendar"),tool.financeShowIntervalId=window.setInterval("tool.setFinanceData('',1)",6e4)});break;case"dropitem dr4":tool.setCftcCot();break;case"dropitem dr5":tool.setPivotCalc("LLG");break;case"dropitem dr6":tool.setDownloadPPT()}},initCalendar:function(e){$(".dr3").hasClass("initCalendar")?e():LazyLoad.js(["/base/lib/pikaday/moment.min.js","/base/lib/pikaday/pikaday.min.js"],function(){var t=tool.currentDate(),i={previousMonth:"上个月",nextMonth:"下个月",months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdays:["周日","周一","周二","周三","周四","周五","周六"],weekdaysShort:["日","一","二","三","四","五","六"]};new Pikaday({field:$("#calendarFinance")[0],firstDay:1,container:$("#calendarContainer")[0],defaultDate:t,i18n:i,minDate:new Date(2e3,0,1),maxDate:new Date(2050,12,31),yearRange:[2e3,2050],onSelect:function(){var e=document.createTextNode(this.getMoment().format("YYYY-MM-DD")+" ");$("#calendarFinance").append(e)}});e()})},setFinanceData:function(e,t){common.isBlank(e)&&(e=tool.currentDate()),common.getJson("/hxstudio/getFinancData",{releaseTime:e,dataTypeCon:t},function(e){if(0==e.result){var t={"德国":"Germany","法国":"France","欧元区":"EUR","加拿大":"CAD","美国":"USD","澳大利亚":"AUD","日本":"JPY","瑞士":"CHF","意大利":"Italy","英国":"GBP","中国":"CNY","新西兰":"NZD","韩国":"SK","香港":"HKD","西班牙":"Spain","台湾":"Taiwan","印度":"INR","新加坡":"Singapore"},i="",s=tool.formatHtml("finance");$.each(e.data.financeData,function(e,n){i+=s.formatStr(n.time.substring(0,5),common.isBlank(t[n.country])?"none":t[n.country],n.country,tool.importanceLevel(n.importanceLevel),n.name,common.isBlank(n.lastValue)?"---":n.lastValue,common.isBlank(n.predictValue)?"---":n.predictValue,common.isBlank(n.value)?"---":n.value)}),$(".dr3 .calendar_ul ul").html(i),indexJS.setListScroll(".calendar_ul.scrollbox2",{isCustom:!1,scrollbarPosition:"outside"})}})},setCftcCot:function(){$.getJSON("/hxstudio/get24kCftc",null,function(e){var t={gold:"纽约期金",silver:"纽约期银",usd:"美元指数",oil:"纽约原油",cu:"纽约期铜"};if(null!=e&&e){var i="",s="",n=tool.formatHtml("cftcperc"),a=tool.formatHtml("cftcdata");$.each(t,function(t,o){var r=e[t]["long"],l=e[t]["short"],d=parseInt(r)+parseInt(l),c=Math.round(parseInt(r)/d*100),u=Math.round(parseInt(l)/d*100);i+=n.formatStr(o,c,u),s+=a.formatStr(o,r,l,e[t].updatetime)}),$(".dr4 .percent_list .perc_table").html(i),$(".dr4 .perc_data .data_table tbody").html(s)}})},getOAUrl:function(){var e=window.location.host;return e=e.indexOf("localhost")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":e.indexOf("testweb1.24k.hk")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":"http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getPivotPointData&symbol="},setPivotCalc:function(e){$.post(tool.getOAUrl()+e,{},function(e){var t=["d","w"];if("true"===e.sucess.toLowerCase())for(var i=e.msg.length,s=0;i>s;s++)$.inArray(e.msg[s].pivotType,t)>-1&&($("#r3_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].resistance3),$("#r2_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].resistance2),$("#r1_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].resistance1),$("#p_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].pivotPoint),$("#s3_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].support3),$("#s2_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].support2),$("#s1_"+e.msg[s].symbol+"_"+e.msg[s].pivotType).text(e.msg[s].support1))},"json")},setDownloadPPT:function(){var e={pptx:"",ppt:"",pdf:' class="pdf"',docx:' class="word"',doc:' class="word"',rar:' class="rar"',zip:' class="rar"'};indexJS.getArticleList("download",indexJS.userInfo.groupId,1,1,100,'{"sequence":"desc"}',null,function(t){if(t&&0==t.result){var i,s=t.data,n=null,a="",o=tool.formatHtml("download");for(var r in s){i=0==r?' class="fir"':"",n=s[r].detailList[0];var l=s[r].mediaUrl.substring(s[r].mediaUrl.lastIndexOf(".")+1).toLowerCase(),d=n.title+"."+l,c=common.formatterDate(s[r].publishStartDate,"-").replace("-","/").replace("-","/");a+=o.formatStr(i,e[l],n.title,n.authorInfo?n.authorInfo.name:"",c,s[r].mediaUrl,d,s[r]._id,"",common.isBlank(s[r].downloads)?0:s[r].downloads)}$(".dr6 .ppt_list ul").html(a),tool.setDownloads(),indexJS.setListScroll(".ppt_list",{isCustom:!1,scrollbarPosition:"outside"})}else $(".dr6 .ppt_list ul").html("")})},teacherPoint:function(){indexJS.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"createDate":"desc"}',"",function(e){var t=e.data.length,i="";if(e&&0==e.result&&e.data&&t>0){var s="",n=tool.formatHtml("tearchPoint");$.each(e.data,function(e,a){var o=a.detailList[0],r=common.formatterDate(a.publishStartDate,"-").replace("-","年").replace("-","月")+"日";e+1==t&&(i=' class="last"'),s+=n.formatStr(i,o.title,o.authorInfo.name,r,o.content)}),$(".dr2 .teacher-point ul").css("height",$(".mod_menu").height()-75),$(".dr2 .teacher-point ul").html(s),indexJS.setListScroll(".dr2 .teacher-point ul",{isCustom:!1,scrollbarPosition:"outside"})}})},initShowTrade:function(){indexJS.userInfo.isLogin?($("#showTradeInfo img").attr("src",$("#avatarInfoId").attr("src")),$("#showTradeNk").text(indexJS.userInfo.nickname)):($("#showTradeInfo img").attr("src",$("#visitorListId li .mynk").prev().children("img").attr("src")),$("#showTradeNk").text($("#visitorListId li .mynk").text().replace("【我】","")));var e={groupType:indexJS.userInfo.groupType};common.isValid(tool.tradeForUser)&&(e.userNo=tool.tradeForUser),common.getJson("/hxstudio/getShowTrade",{data:JSON.stringify(e)},function(e){if(e.isOK&&common.isValid(e.data)){if(common.isBlank(tool.tradeForUser)?$("#all-orders .scrollbox").empty():$("#my-orders .scrollbox").empty(),tool.tradeList=e.data.tradeList||[],indexJS.userInfo.isLogin){for(var t=null,i=0,s=0,n=tool.tradeList.length;n>s;s++)t=tool.tradeList[s],t.user.userNo==indexJS.userInfo.userId&&i++;$("#sdcount").text(i)}tool.tradeLoadAll=!1,tool.setShowTrade()}})},setShowTrade:function(){if(tool.tradeLoadAll)return!1;var e=common.isBlank(tool.tradeForUser)?$("#all-orders .scrollbox div").size():$("#my-orders .scrollbox div").size(),t=tool.tradeList,i=null,s=t.length;indexJS.userInfo.userId!=tool.tradeForUser&&common.isValid(tool.tradeForUser)&&$("#sdcount").text(common.isValid(tool.tradeForUser)?s:"0");for(var n="",a=common.isBlank(tool.tradeForUser)?tool.formatHtml("showTradeAll"):tool.formatHtml("showTradeUser"),o=e;s>o&&e+20>o;o++){i=t[o];var r=common.formatterDateTime(i.showDate,"/").substr(0,16);n+=common.isBlank(tool.tradeForUser)?a.formatStr(i.title,i.user.userName,r,i.tradeImg,i.remark,i._id,common.isBlank(i.praise)?0:i.praise,i.user.userNo,i.user.avatar):a.formatStr(i.title,r,i.tradeImg,i.remark,i._id,common.isBlank(i.praise)?0:i.praise)}common.isBlank(tool.tradeForUser)?$("#all-orders .scrollbox").append(n):$("#my-orders .scrollbox").append(n),o>=s-1&&(tool.tradeLoadAll=!0),tool.setUserShowTrade(),tool.showTradePraise(),indexJS.setListScroll($(".all-orders"),{callbacks:{onTotalScroll:function(){tool.setShowTrade()}}})},setUserShowTrade:function(){$(".all-orders .show-order-box h6 a").click(function(){tool.tradeForUser=$(this).attr("userId"),tool.initShowTrade(),$("#showTradeInfo img").attr("src",$(this).attr("avatar")),$("#showTradeNk").text($(this).text()),$("#all-orders").addClass("dn"),$("#my-orders").removeClass("dn"),$("#myShowTrade").hide(),$("#backShowTrade").show()})},showTrade:function(){var e=$("#title").val(),t=$("#userName").val(),i=$("#tradeImg").val(),s=$("#remark").val();if(common.isBlank(e))$("#trade_error").text("请输入标题").show();else if(common.isBlank(t))$("#trade_error").text("请输入晒单人").show();else if(common.isBlank(i))$("#trade_error").text("请上传晒单图片").show();else{var n={groupType:indexJS.userInfo.groupType,userNo:indexJS.userInfo.userId,avatar:$("#avatarInfoId").attr("src"),userName:t,tradeImg:i,remark:s,title:e,tradeType:2};common.getJson("/hxstudio/addShowTrade",{data:JSON.stringify(n)},function(e){e.isOK?($(".sd_result").removeClass("dn").show(),indexJS.userInfo.isSetName||($('#setNkForm input[name="nickname"]').val(t),$("#setNkBtn").click())):box.showMsg(e.msg)})}},showTradePraise:function(){$(".all-orders .scrollbox .show-order-box .support").click(function(){var e=$(this),t={clientId:indexJS.userInfo.userId,praiseId:$(this).attr("i")};common.getJson("/hxstudio/setTradePraise",{data:JSON.stringify(t)},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("span");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)})},currentDate:function(){return common.formatterDate(indexJS.serverTime,"-")},clearCls:function(e,t){$(e).removeClass(t)},setDownloads:function(){$(".dr6 .ppt_list ul li a").click(function(){var e=$(this);common.getJson(indexJS.apiUrl+"/common/modifyArticle",{id:e.attr("i"),type:"downloads"},function(t){t.isOK&&e.next(".downloads").find("span").text(t.num)})})},formatHtml:function(e){var t=[];switch(e){case"finance":t.push("<li>"),t.push('   <table cellpadding="0" cellspacing="0" border="0" width="100%" class="calendar_table">'),t.push("       <tr>"),t.push('           <td width="98"><span class="time">{0}</span></td>'),t.push('           <td><img src="http://www.24k.hk/public/economicCalenda/images/country/{1}.png" width="23">{2}</td>'),t.push('           <td width="80"><div class="stars">{3}</div></td>'),t.push("       </tr>"),t.push("       <tr>"),t.push('           <td colspan="3"><span class="tit">{4}</span></td>'),t.push("       </tr>"),t.push("       <tr>"),t.push("           <td>前值:<strong>{5}</strong></td>"),t.push("           <td>预测值:<strong>{6}</strong></td>"),t.push("           <td>公布值:<strong>{7}</strong></td>"),t.push("       </tr>"),t.push("   </table>"),t.push("</li>");break;case"cftcperc":t.push("<tr>"),t.push('   <td width="70"><strong>{0}</strong></td>'),t.push('   <td width="30">{1}%</td>'),t.push('   <td><div class="perc_box"><b style="width:{1}%"></b></div></td>'),t.push('   <td width="30" class="align_r">{2}%</td>'),t.push("</tr>");break;case"cftcdata":t.push("<tr>"),t.push("   <td>{0}</td>"),t.push('   <td align="right">{1}</td>'),t.push('   <td align="right">{2}</td>'),t.push("   <td></td>"),t.push('   <td align="center">{3}</td>'),t.push("</tr>");break;case"download":t.push("<li{0}>"),t.push("   <i{1}></i>"),t.push('   <div class="detail">'),t.push("       <strong>{2}</strong>"),t.push("       <span>{3}<b>{4}</b></span>"),t.push('       <a href="{5}" target="download" download="{6}" class="downbtn" i="{7}"><i></i><span>下载<b>{8}</b></span></a>'),t.push('       <span class="downloads">已下载:<span>{9}</span></span>'),t.push("   </div>"),t.push("</li>");break;case"tearchPoint":t.push("<li{0}>"),t.push("    <h4>{1}</h4>"),t.push("    <h6>"),t.push("        <i>作者:{2}</i>"),t.push("        <span>{3}</span>"),t.push("    </h6>"),t.push("    <p>{4}</p>"),t.push("</li>");break;case"showTradeAll":t.push('<div class="show-order-box">'),t.push("    <h5>{0}</h5>"),t.push('    <h6>晒单人：<a href="javascript:void(0)" userId="{7}" avatar="{8}">{1}</a></h6>'),t.push('    <p class="time">{2}</p>'),t.push('    <a href="{3}" data-rel="usersd" data-title="{0}" data-lightbox="usersd-all-img">'),t.push('        <img src="{3}" alt="{0}" class="mCS_img_loaded">'),t.push("    </a>"),t.push('    <p class="orders-test">{4}</p>'),t.push('    <div class="orders-btn">'),t.push('        <a href="javascript:void(0);" class="support" i="{5}"><span>{6}</span><i>+1</i></a>'),t.push('        <a href="javascript:void(0);" class="showMore">查看全部</a>'),t.push("    </div>"),t.push("</div>");break;case"showTradeUser":t.push('<div class="show-order-box">'),t.push("    <h5>{0}</h5>"),t.push('    <p class="time">{1}</p>'),t.push('    <a href="{2}" data-rel="usersd" data-title="{0}" data-lightbox="usersd-mime-img">'),t.push('        <img src="{2}" alt="{0}" class="mCS_img_loaded">'),t.push("    </a>"),t.push('    <p class="orders-test">{3}</p>'),t.push('    <div class="orders-btn">'),t.push('        <a href="javascript:void(0);" class="support" i="{4}"><span>{5}</span><i>+1</i></a>'),t.push('        <a href="javascript:void(0);" class="showMore">查看全部</a>'),t.push("    </div>"),t.push("</div>")}return t.join("")},importanceLevel:function(e){var t="";switch(e){case 1:t='<span class="bling">★</span><span>★</span><span>★</span><span>★</span><span>★</span>';break;case 2:t='<span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span><span>★</span>';break;case 3:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span>';break;case 4:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span>';break;case 5:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span>';break;default:t="<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>"}return t}};$(function(){tool.init()});