function openLive800Chat(e){var t="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";e?location.href=t:window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(){var e="http://crm2.qq.com/page/portalpage/wpa.php?uin=800018282&cref=&ref=&f=1&ty=1&ap=&as=";window.open(e,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(e)}function live800Prompt(e){window.onbeforeunload=null;var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",i="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==e)try{UUID.prototype.createUUID();window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(n){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(i,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(n){window.open(i)}}function qqPrompt(e){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(n){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}function getMarketpriceCrossDomainIndex(e,t){$.ajax({type:"GET",url:e,dataType:"jsonp",success:function(e){"OK"==e.code&&parseMarketpriceIndex(e,t)},error:function(){}})}function parseMarketpriceIndex(e,t){for(var i=2,n="",a=0,s=0,o=0,r=0;r<e.listResult.length;r++){n=e.listResult[r].symbol,a=e.listResult[r].deltaPrice,o=e.listResult[r].price,s=e.listResult[r].deltaPercent,i="XAGUSD"==n||"USDJPY"==n?3:"EURUSD"==n?3:2;var l=$("#price_"+n);l.html(parseFloat(o).toFixed(i));var d=$("#deltaPercent_"+n);if(d.text((100*s).toFixed(2)+"%"),t){var c=parseFloat(o).toFixed(i);c=c.toString().substring(0,c.indexOf("."))+"<span>."+c.toString().substring(c.indexOf(".")+1)+"</span>",l.html(c+'<i changeCss="true"></i>');var u=$("#price_"+n+" i");d.text(a+"  "+(100*s).toFixed(2)+"%"),a>0?"true"==u.attr("changeCss")&&(l.removeClass(t.down),d.removeClass(t.down),u.removeClass(t.downCss).addClass(t.upCss)):"true"==u.attr("changeCss")&&(l.addClass(t.down),d.addClass(t.down),u.removeClass(t.upCss).addClass(t.downCss))}else a>0?$("#price_"+n).parent().addClass("up"):$("#price_"+n).parent().removeClass("up"),$("#deltaPrice_"+n).html(parseFloat(a).toFixed(i))}}function getAllMarketpriceIndex(e,t,i,n){try{window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket?pkMarketSocket?pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t):(pkMarketSocket=new ReconnectingWebSocket(e,null,{reconnectInterval:3e3}),pkMarketSocket.onmessage=function(e){var t=JSON.parse(e.data);"OK"==t.code&&parseMarketpriceIndex(t,n)},pkMarketSocket.onopen=function(e){pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(t)}):setInterval(function(){getMarketpriceCrossDomainIndex(i,n)},2e3)}catch(a){console.log("get price has error!")}}var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(e,t){return isNaN(t)||t>e.length?!1:void e.splice(t,1)},joinSplit:function(e){return",".concat(e).concat(",")},isBlank:function(e){return void 0==e||null==e||"undefined"==e||"null"==e||""==$.trim(e)},isValid:function(e){return!this.isBlank(e)},trim:function(e){return this.isBlank(e)?"":e.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(e){return document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(e){return this.isBlank(e)?"":e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(e,t){t||(t="-"),e instanceof Date||(e=new Date(e));var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate());return i},getHHMMSS:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return t},getMMSS:function(e){return e instanceof Date||(e=new Date(e)),(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getHHMM:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());return t},formatterDateTime:function(e,t){if(t||(t="-"),e instanceof Date||(e=new Date(e)),"Invalid Date"==e)return"";var i=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return i},longMsTimeToDateTime:function(e,t){var i=new Date(e);return this.formatterDateTime(i,t)},showBox:function(e,t){$(e).slideDown(),$(t||".layer-shadow").show()},hideBox:function(e,t){$(e).slideUp(),$(t||".layer-shadow").hide()},containSplitStr:function(e,t){return common.isBlank(e)||common.isBlank(t)?!1:-1!=(","+e+",").indexOf(","+t+",")},getJson:function(e,t,i,n,a){var s=null;return $.ajax({url:e,type:"POST",timeout:1e5,cache:!1,async:void 0!=n?n:!1,dataType:"json",data:t,success:"function"==typeof i?i:function(e){s=e},error:function(e,t){"function"==typeof a?a(t):common.isValid(e.responseText)&&"OK"!=e.statusText?alert(e.responseText):alert("请求超时,请重试!")}}),s},arraySort:function(e,t){return function(i,n){return t?i[e]<n[e]:i[e]>n[e]}},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},isMobilePhone:function(e){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(e)},dateTimeWeekCheck:function(e,t,i){if(this.isBlank(e))return!!t;$.isPlainObject(e)||(e=JSON.parse(e));var n=i?new Date(i):new Date,a=!1,s=this.formatterDate(n);if(a=this.isBlank(e.beginDate)||s>=e.beginDate,a&&(a=this.isBlank(e.endDate)||s<=e.endDate),!a)return!1;var o=e.weekTime;if(this.isBlank(o))return a;var r=null,l=null,d=!1;for(var c in o)if(r=o[c],(!this.isValid(r.week)||n.getDay()==parseInt(r.week))&&(l=this.getHHMMSS(n),d=this.isBlank(r.beginTime)||l>=r.beginTime,d&&(d=this.isBlank(r.endTime)||l<=r.endTime),d))break;return d},arrayUnique:function(e){if(!e)return e;for(var t,i=[],n={},a=0;null!=(t=e[a]);a++)n[t]||(i.push(t),n[t]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(e,t,i){return common.isWebSocket()?(console.log("used websocket!"),e.connect(t.webSocket+"/"+i,{transports:["websocket"]})):e.connect(t.socketIO+"/"+i)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(e){for(var t="",i=0;e>i;i++)t+=Math.floor(10*Math.random());return t},clearMsgHtml:function(e){var e=e.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return e&&(e=$.trim(e)),e},formatToJson:function(e){return this.isBlank(e)?null:JSON.parse(e)},getSyllabusPlan:function(e,t){if(!e||!e.courses)return null;var i=function(e,t){if(e){var i=common.isMobile(),n=null;"object"!=typeof e&&(e=JSON.parse(e));for(var a in e)if(n=e[a],i){if(1==t&&3==n.code)return n.url}else if(n.code==t)return n.url}},n=function(t,n,a){var o=null,r=t.course;return r&&r.length>n?(o=r[n],0==o.status||common.isBlank(o.lecturerId)?null:(o.studioLink=i(e.studioLink,o.courseType),o.startTime=t.startTime,o.endTime=t.endTime,o.day=s[n].day,o.isNext=a,o)):null},a=null;a=this.isValid(e.courses)&&"object"!=typeof e.courses?JSON.parse(e.courses):e.courses;for(var s=a.days,o=a.timeBuckets,r=new Date(t).getDay(),l=common.getHHMM(t),d=null,c=!1,u=null,h=null,p=0;p<s.length;p++)if(0!=s[p].status)if(s[p].day>r){for(var m in o)if(d=o[m],h=n(d,p,!0))return h}else if(s[p].day==r)for(var m in o){if(d=o[m],d.startTime<=l&&(d.endTime>=l||"00:00"==d.endTime))return c=!0,n(d,p,!1);if(!c&&d.startTime>l)return c=!0,n(d,p,!0)}else if(!u)for(var m=0;m<o.length;m++)if(h=o[m].course,h&&0!=h[p].status&&!common.isBlank(h[p].lecturerId)){u={dayIndex:p,tmIndex:m};break}return!c&&u?n(o[u.tmIndex],u.dayIndex,!0):null},formatSyllabus:function(e,t,i,n){var a={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字直播",1:"视频直播",2:"ONE TV"}},s=new Date(t).getDay(),o=this.getHHMM(t),r=$.extend({},a,n),l=function(e,t,i,n){var a=0,l=(e+6)%7,d=(s+6)%7;return a=l>d?2:d>l?0:n?1:o>=i?0:t>o?2:1,r.courseCls[a]},d=[];try{if(e){var c=$.isPlainObject(e)?e:JSON.parse(e),u=c.days?c.days.length:0;if(u>0)if(1===i){var h={0:"文字",1:"视频",2:"oneTV"};d.push('<div class="sy_panel">');var p=t-864e5*((s+6)%7),m=null,f=null,g=null;d.push('<div class="sy_nav">');for(var v=' style="width:'+100/u+'%;"',b=0;u>b;b++)m=new Date(p+(c.days[b].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),g=c.days[b].day==s?' class="active"':"",d.push('<a href="javascript:void(0)" d="'+c.days[b].day+'"'+g+v+">"+r.dayCN[c.days[b].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');d.push("</div>"),d.push('<div class="sy_cont"><div>'),d.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var x=null,w=null,b=0;u>b;b++){if(d.push('<tbody d="'+c.days[b].day+'">'),0==c.days[b].status)w=l(c.days[b].day,null,null,!0),d.push('<tr class="'+w+'" width="100%"><td>休市</td></tr>');else for(var y=0,I=c.timeBuckets.length;I>y;y++)x=c.timeBuckets[y],w=l(c.days[b].day,x.startTime,x.endTime,!1),0==x.course[b].status?(d.push('<tr class="'+w+'">'),d.push('<td width="25%">'+x.startTime+"-"+x.endTime+"</td>"),d.push('<td colspan="2" width="75%">休市</td>'),d.push("</tr>")):x.course[b].lecturer&&(d.push('<tr class="'+w+'">'),d.push('<td width="25%">'+x.startTime+"-"+x.endTime+"【"+h[x.course[b].courseType]+"】</td>"),d.push('<td width="25%">'+x.course[b].lecturer+"</td>"),d.push('<td width="50%">'+x.course[b].title+"</td>"),d.push("</tr>"));d.push("</tbody>")}d.push("</table>"),d.push("</div></div>"),d.push("</div>")}else if(2===i){d.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),d.push("<tr>"),d.push("<th>星期\\节次</th>");for(var I=c.timeBuckets?c.timeBuckets.length:0,x=null,w=null,y=0;I>y;y++)x=c.timeBuckets[y],d.push("<th>"+r.indexCN[y]+"<br><span>("+x.startTime+"-"+x.endTime+")</span></th>");d.push("</tr>");for(var k=null,b=0,S=c.days?c.days.length:0;S>b;b++){if(k=c.days[b],d.push("<tr>"),d.push("<th>"+r.dayCN[k.day]+"</th>"),0==k.status)w=l(k.day,null,null,!0),d.push('<td class="'+w+'" colspan="'+I+'">休市</td>');else for(var y=0;I>y;y++)x=c.timeBuckets[y],w=l(k.day,x.startTime,x.endTime,!1),d.push('<td class="'+w+'">'+(0==x.course[b].status?"休市":x.course[b].lecturer)+"</td>");d.push("</tr>")}d.push("</table>")}else if(3===i){var p=o-864e5*((s+6)%7),m=null,g=null,k=null,v=' style="width:'+100/u+'%;"';d.push("<tr>");for(var b=0;u>b;b++)k=c.days[b],m=new Date(p+(c.days[b].day+6)%7*864e5),g=c.days[b].day==s?' class="active"':"",d.push('<th d="'+c.days[b].day+'"'+g+v+">"+r.dayCN[c.days[b].day]+"<i></i></th>");d.push("</tr>"),d.push('<tr><td class="space" colspan="'+u+'"></td></tr>');for(var x=null,w=null,b=0;u>b;b++){if(k=c.days[b],d.push('<tr d="'+k.day+'"><td colspan="'+u+'">'),0==k.status)w=l(k.day,null,null,!0),d.push('<p class="'+w+'">休市</p>');else for(var y=0,I=c.timeBuckets?c.timeBuckets.length:0;I>y;y++)x=c.timeBuckets[y],x.course[b].lecturer&&(w=l(k.day,x.startTime,x.endTime,!1),d.push('<p class="'+w+'">'),d.push("<span>"+x.startTime+"-"+x.endTime+"</span>"),0==x.course[b].status?d.push("<span>休市</span>"):(d.push("<span>"+r.courseType[x.course[b].courseType]+"</span>"),d.push("<span>"+x.course[b].lecturer+"</span>"),d.push('<span class="item">'+x.course[b].title+"</span>")),d.push("</p>"));d.push("</td></tr>")}}}}catch(T){return console.error("formatSyllabus->"+T),""}return d.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},copyObject:function(e,t,i){if(!t)return e;for(var n in e)t.hasOwnProperty(n)&&common.isValid(t[n])&&(e[n]=t[n]);if(i)for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])},isRightName:function(e){return!/^([0-9]{2,20})$/g.test(e)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(e)},randomIndex:function(e){var t=parseInt(Math.round(Math.random()*e));return t==e&&(t=e-1),0>t?0:t},saveToDesktop:function(e,t){try{var i=new ActiveXObject("WScript.Shell"),n=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+t+".url");n.TargetPath=e,n.Save()}catch(a){return!1}return!0}};window.console||(console=function(){function e(){}function t(){return null==i&&(i=new e),i}var i=null;return e.prototype={log:function(e){},error:function(e){}},t()}()),$.fn.focusEnd=function(){$(this).focus();var e=$("<span/>").appendTo($(this)),t=e.get(0),i=null,n=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(t),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t),n=window.getSelection(),n.removeAllRanges(),n.addRange(i)),e.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var e=this,t=0;t<arguments.length;t++)e=e.replace(new RegExp("\\{"+t+"\\}","g"),arguments[t]);return e};var pkMarketSocket=null,ChartFactory=window.Highcharts?function(){function e(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}function t(){var e=$(window).width();return 540>e?30:e>=540&&1080>e?40:80}var i={realtime:"1min","5min":"5min",hour:"1hour",day:"day"},n={ELEMENT_NOTFOUND:"没有指定画板元素",SERVICE_ERROR:"服务器出现错误",NOT_KEEP_WEBSOCKET_ERROR:"不支持websocket",NO_DATA:"没有数据"},a={line:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],a=n.milliseconds,s=parseFloat(n.end);0==s?t.push({x:a,y:null}):t.push({x:a,y:s})}return t},candlestick:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],a=n.milliseconds,s=parseFloat(n.high),o=parseFloat(n.low),r=parseFloat(n.end),l=parseFloat(n.begin);t.push([a,l,s,o,r])}return t}},s="",o=2;return null!=document.getElementById("symbol")&&"undefined"!=typeof document.getElementById("symbol")&&(s=document.getElementById("symbol").value),"XAGUSD"==s||"USDJPY"==s?o=3:("EURUSD"==s||"GBPUSD"==s||"AUDUSD"==s||"USDCHF"==s||"USDCAD"==s)&&(o=4),Highcharts.setOptions({global:{useUTC:!1}}),{pkSocket:null,closeSocket:function(){this.pkSocket&&this.pkSocket.close()},create:function(e,t,a){a&&a.show();var s=$.Deferred();if(!e||!e.length)return s.reject(n.ELEMENT_NOTFOUND),s.promise();var o={type:"post",dataType:"jsonp",jsonpCallback:"jsonpCallback",data:{kType:i.realtime}},r=this,l=$.extend(!0,{},o,t);return this.symbol=l.data.symbol,this.loadData(l).done(function(i){if(a&&a.hide(),!i||!i.code)return s.reject(n.SERVICE_ERROR);if("OK"!==i.code)return s.reject(n.SERVICE_ERROR);if(0==i.listResult.length)return s.reject(n.NO_DATA);var o=l.data.dataType,d=r.getChartType(o),i=r.parseData(i.listResult.reverse(),d,l);if(r.createChart(e,d,o,i),s.resolve(),t.wsUrl){if(t.wsParam+="&symbol="+t.data.symbol+"&dataType="+t.data.dataType,console.log("options.wsParam:"+t.wsParam),window.WebSocket||(window.WebSocket=window.MozWebSocket),!window.WebSocket)return s.reject(n.NOT_KEEP_WEBSOCKET_ERROR);try{ChartFactory.pkSocket?ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam):(ChartFactory.pkSocket=new ReconnectingWebSocket(t.wsUrl,null,{reconnectInterval:3e3}),ChartFactory.pkSocket.onmessage=function(i){var n=i.originalEvent?i.originalEvent.data:null;n&&(n=JSON.parse(n),"ok"==n.code.toLowerCase()&&n.condition&&n.condition.symbol==t.data.symbol&&n.condition.dataType==t.data.dataType&&n.listResult.length>0&&ChartFactory.add(e,n.listResult,time))},ChartFactory.pkSocket.onopen=function(e){ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(t.wsParam)})}catch(c){console.log("get kdata price has error!"+c)}}}),s.promise()},add:function(e,t,i){var n=this.getChartType(i);t=this.parseData(t,n),"line"===n?this.addPoint(e,t):this.addPoint(e,t)},parseData:function(e,t,i){var n=i&&i.parser&&i.parser[t]||a[t];return n(e)},getChartType:function(e){return e===i.realtime?"line":"candlestick"},createChart:function(e,t,i,n){"line"===t?this.createLineChart(e,n):"candlestick"==t&&this.createCandlestickChart(e,i,n)},createLineChart:function(e,t){var i={colors:["#b59130"],chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" 1min",position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{line:{dataGrouping:{enabled:!1},cropThreshold:300}},xAxis:{type:"datetime",tickLength:0,tickPixelInterval:70},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},opposite:!1,showLastLabel:!0,tickLength:0,lineWidth:1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=["<span>"+Highcharts.dateFormat("%Y-%m-%d %H:%M",this.x)+"</span><br/>"];return e.push("<span>价格:<strong>"+this.y+"</strong></span><br/>"),e.join("")}},series:[{name:"价位",type:"line",data:t}]};e.highcharts("StockChart",i)},addPoint:function(e,t){var i=e.highcharts();i.series[0].addPoint(t[0],!1),i.redraw()},createCandlestickChart:function(e,t,n){var a="%Y-%m-%d";t===i["5min"]?a="%Y-%m-%d %H:%M":t===i.hour&&(a="%Y-%m-%d %H:%M");var s={chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" "+t,position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{candlestick:{upColor:"#F00",upLineColor:"#F00",color:"#00a004",lineColor:"#00a004"}},xAxis:{type:"datetime",tickPixelInterval:70,tickLength:0,dateTimeLabelFormats:{day:"%m-%d",week:"%m-%d",month:"%y-%m"}},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},lineWidth:1,opposite:!1,showLastLabel:!0,endOnTick:!1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var e=this.points[0].point,t=["<span>"+Highcharts.dateFormat(a,this.x)+"</span><br/>"];return t.push("<span>开盘价:<strong>"+e.open+"</strong></span><br/>"),t.push("<span>最高价:<strong>"+e.high+"</span></span><br/>"),t.push("<span>最低价:<strong>"+e.low+"</strong></span><br/>"),t.push("<span>收盘价:<strong>"+e.close+"</strong></span><br/>"),t.join("")}},series:[{name:"价格",type:"candlestick",data:n}]};t===i.day&&(s.xAxis.datafor=[]),e.highcharts("StockChart",s)},loadData:function(n){var a=t(),s=n.data.dataType;return $.extend(n.data,{startTime:e(new Date),num:s===i.realtime?120:a,flag:0}),$.ajax(n)}}}():null;!function(e){e.fn.qqFace=function(t){var i={id:"facebox",path:"face/",assign:"content",zIndex:1e3,tip:""},n=e.extend(i,t),a=e("#"+n.assign),s=n.id,o=n.path,r=n.tip;return a.length<=0?(alert("缺少表情赋值对象。"),!1):void e(this).click(function(t){var i,a;if(e("#"+s).length<=0){if(i='<div id="'+s+'" class="facebox"><i class="arr"></i><div class="facecont">',i+='<table border="0" cellspacing="0" cellpadding="0"><tr>',navigator.userAgent&&/(iphone|ipod|ipad|android)/.test(navigator.userAgent.toLowerCase()))for(var l=1;45>=l;l++)a=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+n.assign+'" lf="'+a+'"/></td>',l%9==0&&(i+="</tr><tr>");else for(var l=1;75>=l;l++)a=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+n.assign+'" lf="'+a+'"/></td>',l%15==0&&(i+="</tr><tr>");i+="</tr></table></div></div>",e(this).parent().append(i),e(this).parent().find("img").click(function(){e("#"+e(this).attr("tsg")).insertAtCaret(e(this).attr("lf")),e(this).parents(".facebox").hide()})}else e("#"+s+":visible").length>0?e("#"+s).hide():e("#"+s).show();t.stopPropagation()})}}(jQuery),jQuery.fn.extend({insertAtCaret:function(e){e='<img src="'+e+'"/>';var t=$(this).get(0);t.innerHTML+=e,$(this).focusEnd()}});var indexJS={fromPlatform:null,isNeverLogin:!1,serverTime:0,towMinTime:0,socketUrl:"",userInfo:null,filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,syllabusData:null,onlineCsStatus:0,init:function(){this.serverTimeUp(),this.setVisitStore(),this.setEvent(),this.setAdvertisement()},setScrollStyle:function(e){e.find(".mCSB_dragger_bar").css({background:"url(/hx/theme1/img/scroll.jpg) 5px 50% repeat-y",width:"12px"})},setEvent:function(){$(".ul-info li").hover(function(){$(".u-info").show()},function(){$(".u-info").hide()}),$(".header-right li").hover(function(){if($(this).find(".dropcont").show(),$(this).is(".cursor")){if(1==$(this).attr("ck")||!indexJS.syllabusData)return;indexJS.fillCourse()}$(this).is(".room_rule")&&($(this).hasClass("hover-in")||(indexJS.getArticleList("bulletin_room_rule",indexJS.userInfo.groupId,1,1,1,'{"sequence":"asc"}',null,function(e){if(e&&0==e.result){var t=e.data;if(t&&t.length>0){var i=t[0].detailList[0];$("#bulletinRoomRule").find("strong").text(i.title),$("#bulletinRoomRule").find("p").html(i.content)}}}),$(this).addClass("hover-in"))),$(this).is(".notice")&&(0==$(".header-right ul li.user").length&&$(".notice .dropcont").css("width","450px"),$(this).hasClass("hover-in")||(indexJS.getArticleList("bulletin_system",indexJS.userInfo.groupId,1,1,1,'{"sequence":"asc"}',null,function(e){if(e&&0==e.result){var t=e.data;if(t&&t.length>0){var i=t[0].detailList[0];$("#bulletinTab").find("strong").text(i.title),$("#bulletinTab").find("p").html(i.content)}}}),$(this).addClass("hover-in")))},function(){$(this).find(".dropcont").hide()}),0==$(".rooms .rbox").length&&$(".changeroom").hide(),$(".changeroom").click(function(){var e=$(this);if(e.hasClass("open"))e.removeClass("open");else{e.addClass("open"),e.find("rooms").removeClass("dn");var t=e.attr("tm");if(!(common.isBlank(t)||indexJS.serverTime-Number(t)>=6e4))return;e.attr("tm",indexJS.serverTime);try{$.getJSON("/hxstudio/getRmCourseList",{roomIds:$(".rooms .rbox[rid]").map(function(){return $(this).attr("rid")}).get().join(",")},function(e){var t=$(".rooms .rbox[rid]");if(e&&e.isOK){var i=e.data;t.each(function(e){e==t.length-1&&$(this).addClass("last");var n=$(this).attr("rid");if(i.hasOwnProperty(n)){var a=i[n],s=0;"true"==$(this).find(".enterbtn").attr("av")&&a.onlineNum<=200&&(s=a.onlineNum<=10?60:200/a.onlineNum*3+10,s=Math.round(s)),$(this).find(".peo_num label").text(a.onlineNum+s),$(this).find(".info .nk").text(a.name),a.isNext||$(this).addClass("on"),a.day&&$(this).find(".info .st").text(common.daysCN[a.day]+" "+a.startTime+" - "+a.endTime)}})}else 1==t.length&&t.addClass("last")})}catch(i){console.error("getRmCourseList->"+i),callback(null)}}}),indexJS.setListScroll(".mod_room .cont"),$(document).click(function(e){(!$(e.target).parent().hasClass("roomctrl")&&!$(e.target).parents().parents().hasClass("rbox")||$(e.target).hasClass("enterbtn"))&&$(".changeroom").removeClass("open")}),$(".rooms .rbox[rid] .enterbtn").click(function(){var e=$(this),t=$(this).attr("cgs");return"false"==e.attr("av")&&indexJS.checkClientGroup("visitor")?($("#login_a").trigger("click",{groupId:e.attr("rid")}),!1):common.containSplitStr(t,indexJS.userInfo.clientGroup)?void common.getJson("/hxstudio/checkGroupAuth",{groupId:e.attr("rid")},function(e){e.isOK?indexJS.toRefreshView():alert("您没有进入该房间的权限，如有疑问，请联系客服。")},!0,function(e){"success"!=e&&alert("操作失败，请联系客服！")}):(alert("您没有进入该房间的权限，如有疑问，请联系客服。"),!1)}),$(".mod_videolist .tabnav a").click(function(){var e=$(this).index()-1;if($(".mod_videolist .tabnav a").removeClass("on"),$(this).addClass("on"),$(".mod_videolist .listcont .list_tab").removeClass("on").eq(e).addClass("on"),0==e){var t="ws://kdata.gwfx.com:8087/websocket.do",i="service=HqDataWebSocketService&method=pushMarketprice&symbol=XAGUSD|XAUUSD|USDX|CLWTI&dataType=simpleMarketPrice",n="http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getMarkrtPriceDataFromCache",a={downCss:"hq-down",upCss:"hq-up",down:"down"};getAllMarketpriceIndex(t,i,n,a),indexJS.setListScroll(".listcont .list_tab .hangqing")}1==e&&indexJS.setInformation()}),$(".mod_videolist .tabnav a.on").trigger("click"),$("#qqcs").click(function(){openQQChatByCommonv3("&utm_source=studio&utm_medium=yy&utm_content=TOP&utm_campaign=qqzx_pm")}),$("#onlineCs").click(box.openCSBox),$("#saveToDesktop").click(function(){common.saveToDesktop(window.location.href,"视频直播间-恒信贵金属")?box.showMsg("直播间快捷方式已成功添加到桌面"):window.location.href="/hxstudio/getHxShortCut?t="+(new Date).getTime()}),$("#modifyNickName").click(function(){box.openSetNameBox(!1)}),$("#modifyAvatar").click(function(){var e=$("#fileForm"),t=e.find("input[type=file]");"true"!=e.attr("hasEv")&&(e.attr("hasEv","true"),t.change(function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var n=new FormData($("#fileForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:n,async:!1,cache:!1,contentType:!1,processData:!1,success:function(e){if(0==e.result){var t=e.data?e.data[0]:null;t&&common.getJson("/hxstudio/modifyAvatar",{avatar:t.fileDomain+t.filePath},function(e){e.isOK?($("#avatarInfoId").attr("src",e.avatar),$("#userListId li .mynk").prev().find("img").attr("src",e.avatar),indexJS.userInfo.avatar=e.avatar):console.error("上传头像失败，请联系在线客服！")},!0,function(){alert("上传头像失败，请联系在线客服！")})}else alert("上传头像失败，请联系在线客服！")},error:function(e){console.error("error:",e)}})}catch(a){console.error("上传图片失败",a)}})),t.click()}),this.placeholderSupport(),this.setBulletinSlide()},fillCourse:function(){var e=indexJS.syllabusData&&indexJS.syllabusData.courses;if(e){for(var t,i={0:"文字直播",1:"视频直播",2:"oneTV直播"},n=e.days,a=e.timeBuckets,s=$(".course_nav").html(""),o="",r="",l=new Date(indexJS.serverTime).getDay(),d=indexJS.serverTime-864e5*((l+6)%7),c=100/n.length,u=0,h=n.length;h>u;u++){o=0==u?"fir":u==h-1?"last":"nct",r=n[u].day==l?" on":"",t=common.formatterDate(new Date(d+(n[u].day+6)%7*864e5)).substring(5),s.append('<a href="javascript:" class="'+o+r+'" t="'+u+'" style="width:'+c+'%;"><span>'+common.daysCN[n[u].day+""]+"<b>"+t+"</b></span><i></i></a>"),$(".cursor .dropcont .cont").append('<div class="course_tab'+r+'" t="'+u+'" d="'+n[u].day+'"><ul></ul></div>'),o="";var p=$(".cursor .course_tab:last ul"),m=null;if(1!=n[u].status)p.append('<li class="fir"><a href="javascript:"><span><lable>休市</lable></span></a></li>');else for(var f=0,g=a.length;g>f;f++)o=0==f?"fir":"",m=a[f].course[u],0!=m.status&&m.lecturer&&p.append('<li class="'+o+'"><a href="javascript:" st="'+a[f].startTime+'" et="'+a[f].endTime+'"><i></i><span><lable>'+a[f].startTime+"- "+a[f].endTime+"　</lable><lable>"+i[m.courseType]+"　</lable><lable>"+m.lecturer+"</lable></span><p>"+m.title+"</p></a></li>")}$(".course_nav a").click(function(){$(".course_nav a").removeClass("on"),$(".course_tab").removeClass("on"),$(this).addClass("on"),$(".course_tab[t="+$(this).attr("t")+"]").addClass("on")}),$(".header-right li.cursor").attr("ck",1)}},toRefreshView:function(){window.location.reload()},checkClientGroup:function(e){var t=this.userInfo.clientGroup,i=!1;switch(e){case"visitor":i="visitor"==t;break;case"vip":i="vip"==t||"active"==t;break;case"new":i="vip"!=t&&"active"!=t}return i},serverTimeUp:function(){indexJS.fillCourse(),videos.init().clientVideoTask(),indexJS.setInformation(),this.towMinTime=this.serverTime,setInterval(function(){indexJS.serverTime+=1e3,indexJS.serverTime-indexJS.towMinTime>=12e4&&(indexJS.towMinTime=indexJS.serverTime,videos.clientVideoTask(),indexJS.setInformation())},1e3)},refreshNickname:function(e,t){this.userInfo.isSetName=e,this.userInfo.nickname=t,$(".username").text(t),$("#userListId li .mynk").text(t+"【我】")},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e="storeInfo_"+this.userInfo.groupType,t=store.get(e),i={};if(common.isBlank(t)){var n=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+n,i.userId="visitor_"+n,i.nickname="游客_"+n,i.userType=-1,store.set(e,i)}else i=t;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||$("#contentText").attr("contenteditable",!1).append('<div class="lgtip d n">亲，<a href="javascript:box.openLgBox();">登录</a> 后可以发言哦~</div>')):(i.loginId=this.userInfo.userId,store.set(e,i)),this.isNeverLogin=!common.isValid(i.loginId),common.isBlank(this.userInfo.nickname)&&"visitor"!=this.userInfo.clientGroup&&this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12))},setListScroll:function(e,t){var i="object"==typeof e?e:$(e);i.hasClass("mCustomScrollbar")?i.mCustomScrollbar("update"):(t=$.extend({scrollButtons:{enable:!1},theme:"light-2",isCustom:!0},t),i.mCustomScrollbar(t),t.isCustom&&this.setScrollStyle(i))},getArticleList:function(e,t,i,n,a,s,o,r){try{$.getJSON("/hxstudio/getArticleList",{authorId:common.trim(o),code:e,platform:t,hasContent:i,pageNo:n,pageSize:a,orderByStr:s},function(e){r(e)})}catch(l){console.error("getArticleList->"+l),r(null)}},getArticleInfo:function(e,t){try{$.getJSON("/hxstudio/getArticleInfo",{id:e},function(e){t(e)})}catch(i){console.error("getArticleInfo->"+i),t(null)}},setAdvertisement:function(){this.getArticleList("advertisement",indexJS.userInfo.groupId,"0",1,5,'{"sequence":"asc"}',null,function(e){if(e&&0==e.result){var t=e.data;for(var i in t)$(".ban_ul").append('<li class="swiper-slide"><a href="'+(common.isBlank(t[i].linkUrl)?"javascript:":t[i].linkUrl)+'" target="_blank"><img width="100%" alt="" src="'+t[i].mediaUrl+'"></a></li>'),t.length>1&&$("#mod_position").append('<span class="'+(0==parseInt(i)?"p-click":"")+'"></span>');t&&t.length>1&&new Swiper(".mod_banner",{pagination:"#mod_position",paginationClickable:!0,loop:!0,autoplay:5e3,autoplayDisableOnInteraction:!1})}})},setInformation:function(){var e=$("#newInfoCount").attr("t");if(common.isBlank(e)||!(indexJS.serverTime-e<12e4)){common.formatterDate(indexJS.serverTime,"-");$.getJSON(indexJS.apiUrl+"/common/getInformation?t="+indexJS.serverTime,null,function(e){if(e&&e.isOK){var t=(e.data.news.item.length,$("#newInfoCount").attr("pt")),i=null,n="",a=indexJS.formatHtml("news");$.each(e.data.news.item,function(e,s){1>e&&(i=s.pubDate),(s.pubDate>t||common.isBlank(t))&&(n+=a.formatStr(s.pubDate.substring(10),s.title))}),common.isValid(n)&&$(".mod_videolist .message_list .scrollbox ul.news").prepend(n),indexJS.setListScroll($(".mod_videolist .message_list .scrollbox")),$("#newInfoCount").attr("pt",i),$(".mod_videolist .list_tab").eq(1).hasClass("on")&&$("#newInfoCount").attr("t",indexJS.serverTime)}})}},setTradeStrategy:function(e){this.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"sequence":"asc"}',null,function(t){if(t&&0==t.result){var i=t.data,n=null,a="",s=indexJS.formatHtml("tradestrategy");for(var o in i){n=i[o].detailList[0];var r="",l="";if(common.isBlank(n.author))r=n.authorInfo.name,l=n.authorInfo.avatar;else{var d=n.author.split(";");
r=d[0],l=d[1]}var c=common.formatterDateTime(i[o].publishStartDate,"-").substring(0,16);a+=s.formatStr(l,r,c,n.tag,n.title,n.content)}$("#guidelist ul").html(a)}else $("#guidelist ul").html("");indexJS.setListScroll(e)})},setBulletinSlide:function(){indexJS.getArticleList("bulletin_slide_info",indexJS.userInfo.groupId,1,1,1,'{"createDate":"desc"}',"",function(e){if(e&&0==e.result&&e.data&&e.data.length>0){var t="",i=indexJS.formatHtml("bulletinSlide");$.each(e.data,function(e,n){var a=n.detailList[0];t+=i.formatStr(a.title,a.content)}),$("#bulletinDomId").html(t),$("#bulletinDomId li a").each(function(){var e=$(this);e.text(e.next().text()),e.parent().width(e.width()),e.click(function(){$("#popAnnTit").text($(this).attr("title")),$("#popAnnTxt").html($(this).next("div").html()),$("#popAnnBox,.blackbg").show(),indexJS.setListScroll(".popAnnCont")})}),$("#bulletinPanel").slide({mainCell:".anouncelist",effect:"leftMarquee",autoPlay:!0,interTime:50})}})},connectOnlineCs:function(){switch(indexJS.onlineCsStatus){case 0:indexJS.onlineCsStatus=1;var e="http://jms.phgsa.cn/chat.php?pid=P001&tln="+indexJS.userInfo.userId+"&tnn="+indexJS.userInfo.nickname+"&tul="+indexJS.userInfo.clientGroup;LazyLoad.js(e,function(){indexJS.onlineCsStatus=2,$("#welive_info").trigger("click")});break;case 2:$("#welive_info").trigger("click");break;case 1:}},placeholderSupport:function(){var e="placeholder"in document.createElement("input");e||$(".formcont .in_line input[placeholder]").each(function(){var e=$(this).attr("placeholder");if(e){var t=$(this),i=$('<span class="placeholder">'+e+"</span>");t.before(i),i.bind("click",function(){$(this).hide(),$(this).next().focus()}),t.bind("focus",function(){$(this).prev().hide()}),t.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=t[0].defaultValue&&t.prev().hide(),$(this).attr("placeholder","")}})},formatHtml:function(e){var t=[];switch(e){case"tradestrategy":t.push('<li class="guideli">'),t.push('    <div class="line1 clearfix">'),t.push('        <img class="himg" src="{0}" alt="{1}">'),t.push('        <h4 class="name">{1}<span class="timespan">{2}</span></h4>'),t.push('        <span class="tag"><i></i>{3}</span>'),t.push("    </div>"),t.push('    <h4 class="gtit"><strong><a href="" target="_blank" class="taglink"></a></strong>{4}</h4>'),t.push('    <div class="g_cont">'),t.push("    <p>{5}</p>"),t.push("    </div>"),t.push("</li>");break;case"bulletinSlide":t.push('<li><a href="javascript:void(0);" title="{0}"></a><div class="dn">{1}</div></li>');break;case"news":t.push("<li><spana><i></i><em>{0} </em>{1}</span></li>")}return t.join("")}};$(function(){indexJS.init()});var videos={blwsPlayer:null,init:function(){return this.setEvent(),this.setVideoList(),this},setVideoList:function(){indexJS.getArticleList("teach_video_base",indexJS.userInfo.groupId,0,1,100,'{"sequence":"desc"}',null,function(e){var t=$("#teachVideoId ul");if(e&&0==e.result){var i=e.data,n=null;for(var a in i)n=i[a].detailList[0],t.append('<li title="'+n.title+'"><a href="javascript:" id="'+i[a]._id+'" t="'+(common.isValid(i[a].mediaUrl)&&-1!=i[a].mediaUrl.indexOf(".mp4")?"mp4":"")+'" vUrl="'+i[a].mediaUrl+'"><i></i><label>'+n.title+"</label></a></li>");indexJS.setListScroll(t,{isCustom:!1,theme:"minimal-dark"}),$("#teachVideoId li a").click(function(){$("#teachVideoId li a.on").removeClass("on"),$(this).addClass("on"),$(".video-name").show().text($(this).text()),videos.setVideo($(this))})}videos.playVideoByDate(!0)})},setVdTab:function(e){e?(window.SewisePlayer&&SewisePlayer.doStop(),$("#tvDivId").hide().find("iframe").remove(),$("#lvDivId").show(),this.selectVdType("lv")):($("#tvDivId").show(),$("#lvDivId").hide(),this.selectVdType("tv"))},playMp4Vd:function(e){var t=$("#teachVideoId a[class=on]");if(e||t.length<=0){var i=$("#teachVideoId li a[t=mp4]"),n=null;i.length<=0?n=$("#teachVideoId li:first a"):(n=$(i.get(common.randomIndex(i.length))),$("#teachVideoId ul").mCustomScrollbar("scrollTo","#"+n.attr("id"))),n.click()}else t.click()},selectVdType:function(e){"lv"==e?(window.SewisePlayer&&SewisePlayer.doStop(),$(".mod_video .classmore").hide(),$("#tvDivId").hide().find("iframe").remove(),$("#lvDivId").show(),$(".video-checkbox").text("直播视频").attr("t","lv"),$(".video-checkbox-list").prepend($(".video-checkbox-list a[t=lv]"))):($(".mod_video .classmore").show(),$(".video-checkbox").text("教学视频").attr("t","tv"),$(".video-checkbox-list").prepend($(".video-checkbox-list a[t=tv]")),$("#tvDivId").show(),$("#lvDivId").hide())},setEvent:function(){$(".video-checkbox-list a").click(function(){var e=$(this).attr("t");videos.selectVdType(e),$(".video-checkbox-list").hide(),"lv"==e?(videos.playVideoByDate(!1),$(".mod_video .classmore").hide()):(videos.playMp4Vd(),$(".mod_video .classmore").show())}),$(".mod_video .classmore").hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()}),$(".video-checkbox-list").mouseleave(function(){$(this).hide()}),$(".video-class-checked").click(function(){$(".video-checkbox-list").toggle()}),$("#tvDivId").hover(function(){$(".max_box").is(":hidden")&&$(".min_box,.v_cate,.v_name").show()},function(){$(".max_box,.min_box").hide()})},clientVideoTask:function(){var e=$("#lvDivId embed").attr("src");$("#lvVideoId").is(":visible")&&e&&-1==e.indexOf("yy.com")&&0==$("#lvVideoId").find("object").length&&videos.playVideoByDate(!1)},playVideoByDate:function(e){var t=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);!t||0!=t.courseType&&common.isBlank(t.studioLink)||t.isNext||0==t.courseType?e?t&&!t.isNext?(this.setVdTab(!0),this.setStudioInfo(t),this.setStudioTip(!0)):(this.setVdTab(!1),this.playMp4Vd(),this.synCourseStyle(null)):this.setStudioInfo(t):(this.setVdTab(!0),this.setStudioVideoDiv(t.studioLink),this.synCourseStyle(t))},synCourseStyle:function(e){$(".course_tab li a").removeClass("on"),e&&$(".course_tab[d="+e.day+"]").find('li a[st="'+e.startTime+'"][et="'+e.endTime+'"]').addClass("on")},setStudioTip:function(e){e?$(".mod_room .titbar > span i").removeClass("off").addClass("on"):$(".mod_room .titbar > span i").removeClass("on").addClass("off")},setNextCourse:function(e,t){if(e){var i="当前暂无直播，请关注下节课";if(!e.isNext&&0==e.courseType){var n="",a=null;for(var s in indexJS.syllabusData.studioLink)if(a=indexJS.syllabusData.studioLink[s],"1"==a.code){n=a.url;break}return void this.setStudioVideoDiv(n)}$("#nextCourse").find(".ntext").text(i),$("#nextCourse .nextbox").show(),$("#nextCourse").find("img").attr("src",t.avatar),$("#nextCourse").find(".t_name").text(t.name),$("#nextCourse").find(".live_name").text(e.title),$("#nextCourse").find(".time").text(common.daysCN[e.day]+" "+e.startTime+" - "+e.endTime)}$("#lvVideoId").hide(),$("#nextCourse").show()},getEmbedDom:function(e){return'<embed src="'+e+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'},setStudioVideoDiv:function(e){if($("#nextCourse").hide(),$("#lvVideoId").show().html(""),-1!=e.indexOf("rtmp")){var t=/(.*)\/([0-9]+)$/g.exec(e);if(!t||t.length<3)return;flowplayer("lvVideoId","/base/lib/flowplayer/flowplayer.swf",{clip:{url:t[2],provider:"rtmp",live:!0},plugins:{rtmp:{url:"/base/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:t[1]}},onError:function(e){}})}else $("#lvVideoId .img-loading").fadeIn(0).delay(2e3).fadeOut(200),$(videos.getEmbedDom(e)).appendTo("#lvVideoId")},setStudioInfo:function(e){if(!e)return $("#nextCourse").find(".ntext").text("当前暂无直播"),void $("#nextCourse .nextbox").hide();var t=$("#lvInfoId").attr("dy"),i=$("#lvInfoId").attr("st"),n=$("#lvInfoId").attr("et");return t==e.day&&i==e.startTime&&n==e.endTime?void((e.isNext||0==e.courseType)&&videos.setNextCourse(null)):void $.getJSON("/hxstudio/getCourseInfo",{day:e.day,startTime:e.startTime,endTime:e.endTime,authorId:e.lecturerId},function(t){$("#lvInfoId").attr("dy",e.day).attr("st",e.startTime).attr("et",e.endTime),$("#lvInfoId .intro p").text(t.remark),indexJS.setListScroll("#lvInfoId .intro p");var i=$("#lvInfoId .te_list").html(""),n=t.authors,a=null;for(var s in n)a=n[s],i.append('<div class="te_detail" uid="'+a.userId+'"><img src="'+a.avatar+'" alt=""><div class="rcont"><span><strong>'+a.name+"</strong><i>"+a.position+'</i></span> <a href="javascript:" class="support" uid="'+a.userId+'"><label>'+a.praiseNum+"</label><i>+1</i></a> </div> </div>");var o=$(".te_detail .support");"true"!=o.attr("initEvent")&&o.attr("initEvent","true").click(function(){var e=$(this);try{common.getJson("/hxstudio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:e.attr("uid")},function(t){if(t.isOK){e.find("i").fadeIn().delay(400).fadeOut();var i=e.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");e.addClass("supported"),e.attr("title","已点赞")},!0)}catch(t){console.error("setPraise->"+t)}}),(e.isNext||0==e.courseType)&&videos.setNextCourse(e,n&&n.length>0?n[0]:{avatar:"",name:""})})},setVideo:function(e){try{this.setStudioTip(!1),$("#lvVideoId").html("");var t=e.attr("vUrl"),i=e.text();if(-1!=t.indexOf(".html")){window.SewisePlayer&&SewisePlayer.doStop();var n=$("#tVideoId iframe"),a=!0;n.size()>0&&(n.attr("src")==t?a=!1:n.remove()),a&&$("#tVideoId").append('<iframe frameborder=0 width="100%" height="100%" src="'+t+'" allowfullscreen></iframe>')}else if($("#tVideoId iframe").remove(),-1!=t.indexOf("type=blws")){var s=t.split("&");if(s.length>1){var o=s[1].replace(/^vid=/g,"");videos.blwsPlayer?videos.blwsPlayer.changeVid(o):videos.blwsPlayer=polyvObject("#tVideoId").videoPlayer({width:"100%",height:"100%",vid:o,flashvars:{autoplay:"0",setScreen:"fill"},onPlayOver:function(e){}})}}else if(window.SewisePlayer)SewisePlayer.toPlay(t,i,0,!0);else{var r=[];r.push("/base/lib/sewise.player.min.js?server=vod"),r.push("type="+(-1!=t.indexOf(".flv")?"flv":"mp4")),r.push("videourl="+t),r.push("autostart=true"),r.push("title="+i),r.push("buffer=5");var l=r.join("&"),d=document.createElement("script");d.type="text/javascript",d.src=l,$("#tVideoId").get(0).appendChild(d);var c=function(){return window.SewisePlayer?void SewisePlayer.onPause(function(e){if(SewisePlayer.duration()<=SewisePlayer.playTime()){var t=$("#teachVideoId li a.on"),i=t.parent().next().find("a");i.length<=0?videos.playMp4Vd(!0):i.click()}}):void window.setTimeout(c,500)};c()}}catch(u){console.error("setVideo has error:"+u)}},getEmbedDom:function(e){return'<embed src="'+e+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'}},chat={socket:null,whPushObj:{},whTipInterId:null,pushInfoTimeOutId:null,msgType:{text:"text",img:"img",file:"file"},init:function(){this.setEvent(),this.setSocket(),this.setTalkListScroll(!0)},setEvent:function(){$(".mod_userlist .titbar span").click(function(){$(this).addClass("on").siblings(".on").removeClass("on"),$(".user_box ul").hide().eq($(this).index()-1).show()}),(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&$("#msgFaceBtn").qqFace({id:"faceId",assign:"contentText",path:indexJS.filePath+"/face/"}),$(document).click(function(e){$("div[id^=faceId]").hide(),$(e.target).hasClass("inp-bar4")||$(e.target).parents().hasClass("envelope-reward")||$(e.target).parents().hasClass("popup_box")||$(e.target).hasClass("blackbg")||$(".envelope-reward").addClass("dn"),$(e.target).hasClass("headimg")||$(e.target).parents().hasClass("headimg")||"header"==$(e.target).parent().attr("t")||$(e.target).hasClass("uname")||$(e.target).parents().hasClass("te_ul")||$(".dialogbtn").hide()}),$(".replybtn").click(function(){chat.setDialog($(this).attr("uId"),$(".sender").html(),$(this).attr("ts"),$(this).attr("futype")),$(".mymsg em").show()}),$("#mymsgClose").click(function(){$(".mymsg,.mymsg em").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),chat.setTalkListScroll()}),$(".scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),chat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),chat.showViewSelect($(this).attr("t")),chat.setTalkListScroll(!0))}),$("#contentText").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="send-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){var t=$(this).html();if(13==e.keyCode)return common.isValid(t)&&($(this).html(t.replace(/<div>|<\/div>/g,"")),$(".ui-autocomplete").is(":hidden")&&$("#sendBtn").click()),!1;if(8==e.keyCode){var i=$(this).find(".txt_dia");if($.trim($(this).text())==i.text())return i.remove(),$(this).html(""),!0}}).autocomplete({source:function(e,t){/^@.*$/g.test(e.term)&&(t(chat.searchUserList(e.term.substring(1,e.term.length))),$(".ui-autocomplete").css("z-index","10000000"))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(e,t){return $("#contentText").html("").append('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t.item.value+'" utype="'+t.item.userType+'">@<label>'+t.item.label+"</label></span>&nbsp;").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(e,t){return $("<li>").attr("data-value",t.label).append("<a>"+t.label+"</a>").appendTo(e)},$("#sendBtn").click(function(){if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();if(indexJS.userInfo.isSetName===!1)return void box.openSetNameBox(!0);var e=chat.getToUser(),t=$("#contentText .text-min-img img");if(t.size()>0){var i=t.attr("src");i.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(i,e),t.remove())}var n=chat.getSendMsg();if(n!==!1){var a={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:n}},s=$(".replybtn");e&&e.userId==s.attr("uid")&&e.talkStyle==s.attr("ts")&&$(".mymsg,.mymsg em").hide(),a.fromUser.toUser=e,chat.socket.emit("sendMsg",a),chat.setContent(a,!0,!1),$("#contentText").html("")}}),$("#sendReward").click(function(){chat.reward()}),$(".envelope-reward .reward-title .reward-back").click(function(){$("#js-reward-user").val(""),$(".envelope-reward .reward-title .reward-back,.envelope-reward .reward-weima,#rewardQRCode img").addClass("dn").hide(),$(".envelope-reward .reward-form").removeClass("dn")}),$("#js-reward-send-btn").click(function(){var e=$("#js-reward-user").val();common.isBlank(e)?box.showMsg("请选择老师"):($(".envelope-reward .reward-form").addClass("dn"),$(".envelope-reward .reward-title .reward-back,.envelope-reward .reward-weima").removeClass("dn").show(),$("#qrCode").attr("src","/hx/theme1/img/rew/"+e+".png"))}),$("#sendImgBtn").click(function(){return FileReader?!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor")?void box.openLgBox():indexJS.userInfo.isSetName===!1?void box.openSetNameBox(!0):void $("#sendImgInp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#sendImgInp").bind("change",function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=t.size;if(i>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var n=new FileReader;n.readAsDataURL(t),n.onload=function(e){chat.setUploadImg(e.target.result,chat.getToUser())},n.onprogress=function(e){},n.onloadend=function(e){},$(this).val("")}),$(".pletter_win").draggable({handle:".wh_drag"})},setUploadImg:function(e,t){var i=chat.getUiId(),n={};common.copyObject(n,indexJS.userInfo,!0),n.toUser=t;var a={uiId:i,fromUser:n,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};t&&1==t.talkStyle?this.setWhContent(a,!0,!1):this.setContent(a,!0,!1),a.content.value=e,this.zipImg(a,100,60,function(e,t){if(e.error)return alert(e.error),$("#"+i).remove(),!1;var n=$("#"+e.uiId+" span[contt='a'] a");n.attr("href",t).children("img").attr("src",t).attr("needMax",e.content.needMax),chat.dataUpload(e)})},zipImg:function(e,t,i,n){var a=new Image;a.onload=function(){var s=document.createElement("canvas");s||n({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var o=a.width,r=a.height;if(r>=9*o)return n({error:"该图片高度太高，暂不支持发送！"}),!1;t>0&&(r>t||o>t)&&(e.content.needMax=1,r>t&&t>=o?(o=t/r*o,r=t):(r=t/o*r,o=t),a.height=r,a.width=o);var l=s.getContext("2d");s.width=o,s.height=r,l.clearRect(0,0,s.width,s.height),l.drawImage(a,0,0,o,r),n(e,s.toDataURL("image/jpeg",i/100))},a.src=e.content.value},dataUpload:function(e){var t=new XMLHttpRequest;t.open("POST","/hxstudio/uploadData"),t.addEventListener("progress",function(t){if(t.lengthComputable){var i=(t.loaded/t.total*100|0)+"%";$("#"+e.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+e.uiId+" .shadow-conut").html(i)}},!1),t.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&console.log("dataUpload success!")},e.fromUser.socketId=this.socket.id,t.send(JSON.stringify(e))},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},getUiId:function(){var e=new Date;return e.getTime()+"_ms"},getToUser:function(){var e=$("#contentText .txt_dia");return e.length>0?{userId:e.attr("uid"),nickname:e.find("label").text(),talkStyle:0,userType:e.attr("utype")}:null},getSendMsg:function(e){var e=e?e:$("#contentText");if(e.text().length+e.find("img").size()>140)return alert("消息内容超过最大长度限制（140字以内）！"),!1;e.find(".txt_dia").length>0&&e.find(".txt_dia").remove();var t=common.clearMsgHtml(e.html());return common.isBlank(t)?(e.html(""),!1):t},setDialog:function(e,t,i,n,a){if(1==i)chat.closeWhTip(e),chat.fillWhBox(null,a,n,e,t,!1,!1);else{if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e+'" utype="'+n+'">@<label>'+t+"</label></span>&nbsp;").focusEnd()}},showViewSelect:function(e){"analyst"==e?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"me"==e?($("#dialog_list").children("[isme='true']").show(),$("#dialog_list").children("[isme='false']").hide()):"admin"==e?$("#dialog_list").children("[utype!=1]").hide():$("#dialog_list").children().show()},setContent:function(e,t,i){var n=e.fromUser;if(t&&(n.publishTime=e.uiId),e.isVisitor)return $("#"+e.uiId).remove(),void box.openLgBox();if(i&&$("#"+n.publishTime).length>0)return $("#"+n.publishTime+" span[contt] em[class=ruleTipStyle]").remove(),void $("#"+n.publishTime+" .approve").remove();if(e.rule)return void(e.value&&e.value.needApproval?$("#"+e.uiId).attr("id",n.publishTime):$("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>"));if(t||indexJS.userInfo.userId!=n.userId||!e.serverSuccess){var a=chat.formatContentHtml(e,t,i),s=$("#dialog_list");s.append(a),this.formatMsgToLink(n.publishTime);var o=$(".view_select .selectlist a[class=on]").attr("t");if("all"!=o&&chat.showViewSelect(o),!i){var r=$("#userListId li[id="+n.userId+"]"),l=null;n.avatar&&r.length>0&&n.avatar!=(l=r.find(".headimg img")).attr("src")&&l.attr("src",n.avatar),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}$("#"+n.publishTime+" .txt_dia").click(function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&chat.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+n.publishTime+" .uname,#"+n.publishTime+" .headimg").click(function(){var e=$("#"+n.publishTime+" .dialogbtn");e.attr("avs",$(this).parents(".dialog").find(".headimg img").attr("src")),chat.openDiaLog(e,!0)})}else if($("#"+e.uiId+" .dtime").html(chat.formatPublishTime(n.publishTime)),$("#"+e.uiId).attr("id",n.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(n.publishTime);var d=$("#"+n.publishTime+' span[contt="a"]>a'),c=e.content.needMax?"/hxstudio/getBigImg?publishTime="+n.publishTime+"&userId="+n.userId:d.children("img").attr("src");d.attr("href",c)}},openDiaLog:function(e,t){if($(".dialogbtn").not(e).hide(),!e.is(":hidden"))return e.hide(),!1;if(t){var i=e.parent(),n=e.is(".bot");i.next().size()<=0?n||e.addClass("bot"):n&&e.removeClass("bot")}e.show();var a=e.find("a"),s=e.attr("avs");common.isValid(s)?(a.attr("avs",s),e.attr("avs","")):a.attr("avs",""),a.unbind("click"),a.click(function(){var e=$(this).parent();chat.setDialog(e.attr("uid"),e.attr("nk"),$(this).attr("t"),e.attr("utype"),$(this).attr("avs")),e.hide()})},formatPublishTime:function(e,t,i){var n=Number(e.replace(/_.+/g,""));return common.isBlank(e)?"":t?common.formatterDateTime(n,i):common.getHHMM(n)},formatContentHtml:function(e,t,i){var n="dialog ",a="",s="",o="false",r="",l=e.fromUser,d=e.content,c=l.nickname,u="";indexJS.userInfo.userId==l.userId&&t&&(l.publishTime=e.uiId,u='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>');var h=l.toUser,p="";h&&common.isValid(h.userId)&&(p='<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">@<label>'+h.nickname+"</label></span>",indexJS.userInfo.userId==h.userId&&(o="true")),d.msgType==chat.msgType.img?(a=d.needMax?'<a href="/hxstudio/getBigImg?publishTime='+l.publishTime+"&userId="+l.userId+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片"/></a>':'<a href="'+(d.value?d.value:"javascript:")+'" data-lightbox="dialog-img"><img src="'+d.value+'" alt="图片" /></a>',a+=u):a=d.value,indexJS.userInfo.userId==l.userId?(n+="mine ",o="true",r='<span class="dtime">'+chat.formatPublishTime(l.publishTime)+'</span><a href="javascript:" class="uname">'+c+"</a>"):(3==l.userType&&(c+="&nbsp;（客服）"),r='<a href="javascript:" class="uname">'+c+'</a><span class="dtime">'+chat.formatPublishTime(l.publishTime)+"</span>",s=chat.getDialogHtml(l.userId,c,l.userType),!i&&h&&indexJS.userInfo.userId==h.userId&&($(".mymsg").show(),$(".mymsg em").hide(),$(".replybtn").attr("uid",l.userId),$(".replybtn").attr("ts",h.talkStyle),$(".replybtn").attr("futype",l.userType),$(".sender").html(l.nickname),$(".xcont").html(a)));var m=chat.getAImgOrLevel(l.userId,l.clientGroup,l.userType,l.avatar),f=[];return f.push('<div class="'+n+m.level+'" id="'+l.publishTime+'"  utype="'+l.userType+'" mtype="'+d.msgType+'" isme="'+o+'">'),f.push('<a href="javascript:" class="headimg">'+m.aImg+"<b></b></a>"),f.push('<div class="dialog_top">'+r+"</div>"),f.push("<p><i></i>"),h&&common.isValid(h.question)?(f.push('<span class="dcont">'),f.push('<span uid="'+h.userId+'" utype="'+h.userType+'">'+h.nickname+"</span>提问："),f.push('<span contt="q">'+h.question+"</span>"),f.push('<span class="dialog_reply">回复：<span contt="a">'+a+"</span></span>"),f.push("</span>")):f.push('<span class="dcont" contt="a">'+p+a+"</span>"),f.push("</p>"+s+"</div>"),f.join("")},formatMsgToLink:function(e){$("#"+e+' span[contt]:contains("http:"),#'+e+' span[contt]:contains("https:")').each(function(e,t){var i=$(t).html(),n=i.split(/<img src="\S+">/g),a="";for(var s in n)if(a=n[s],!common.isBlank(a)){var o=a.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"});t.innerHTML=t.innerHTML.replace(a,o)}})},getAImgOrLevel:function(e,t,i,n){var a={aImg:common.isValid(n)?'<img src="'+n+'">':'<img src="/hx/theme1/img/user.png">',level:""};if(common.isValid(i)&&i>0)a.level=2==i?"analyst":"admin";else if("vip"==t)a.level="level4";else if("active"==t||"notActive"==t)a.level="level3";else if("simulate"==t)a.level="level2";else if("register"==t)a.level="level1";else if("visitor"==t||-1==i){e=e||"";var s=parseInt(e.substring(e.length-2),10);isNaN(s)&&(s=100),s=(s+17)%45,a.aImg='<img src="'+indexJS.filePath+"/upload/pic/header/chat/visitor/"+s+'.png">',a.level="visitor"}else a.level="visitor";return a},getDialogHtml:function(e,t,i){if(e&&indexJS.userInfo.userId!=e){var n=$("#roomInfoId"),a="",s=0;return(indexJS.visitorSpeak||-1==indexJS.userInfo.userId.indexOf("visitor_")&&-1==e.indexOf("visitor_"))&&(a+='<a href="javascript:" class="d1" t="0"><b></b><span>@TA</span></a>',s++),"true"==n.attr("aw")&&common.containSplitStr(n.attr("awr"),i)&&(a+='<a href="javascript:"'+(0==s?' class="d1"':"")+' t="1"><b></b><span>私聊</span></a>',s++),'<div class="dialogbtn'+(1==s?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'">'+a+"</div>"}return'<div class="dialogbtn'+(1==s?" one":"")+'"  nk="'+t+'" uid="'+e+'" utype="'+i+'"></div>'},setOnlineUser:function(e){if(2==e.userType)return $("#teacherInfoId img").attr("src",e.avatar?e.avatar:"/hx/theme1/img/user-img.jpg"),$("#teacherInfoId h5").text(e.nickname),$("#teacherInfoId p").text(e.position),chat.setTeacherQRCode(e.userId),$("#outline").hide(),$("#teacherInfoId").removeClass("dn"),$("#teacherInfoId").attr({uid:e.userId,cg:common.isBlank(e.clientGroup)?"":e.clientGroup,t:e.userType,utype:e.userType}),heightCalcu(),!1;var t=e.userType>=0?"#userListId":"#visitorListId";$(t+" li[id='"+e.userId+"']").remove();var i=chat.getDialogHtml(e.userId,e.nickname,e.userType),n="",a="",s=e.sequence,o="";indexJS.userInfo.userId==e.userId&&(n="【我】",s="0",o="mynk");var r=chat.getAImgOrLevel(e.userId,e.clientGroup,e.userType,e.avatar),l=$(t+" li"),d='<li id="'+e.userId+'" cg="'+(common.isBlank(e.clientGroup)?"":e.clientGroup)+'" t="'+s+'" utype="'+e.userType+'" class="'+r.level+'" >'+i+'<a href="javascript:" t="header" class="uname"><div class="headimg">'+r.aImg+'<b></b></div><span class="'+o+'">'+e.nickname+n+"<i></i></span>"+a+"</a></li>";if(0==l.length)$(t).append(d);else if("0"==s)l.first().before(d);else{var c=!1,u=0,h="";l.each(function(){return u=parseInt($(this).attr("t")),e.sequence<u?($(this).before(d),c=!0,!1):e.sequence==u&&(h=$(this).find("a span").text(),e.nickname<=h)?($(this).before(d),c=!0,!1):void 0}),c||$(t).append(d)}common.isValid(i)&&$(t+" li[id="+e.userId+"] a[t=header]").click(function(e){if("0"==$(this).attr("t"))$(".user_box li").removeClass("zin");else{$(".user_box li").removeClass("zin"),$(this).parent().addClass("zin");var t=$(this).prev();t.attr("avs",$(this).find(".headimg img").attr("src")),chat.openDiaLog(t)}})},leaveRoomTip:function(e,t){if("forcedOut"!=e){if("roomClose"==e)$(".blackbg").children().hide(),box.showTipBox("注意：房间已停用，正自动登出..."),"visitor"==indexJS.userInfo.clientGroup?window.setTimeout(function(){indexJS.toRefreshView()},1200):window.setTimeout(function(){$(".logout").trigger("click")},1200);else if("otherLogin"==e){if("visitor"==indexJS.userInfo.clientGroup)return;chat.socket.disconnect(),$(".blackbg").children().hide(),box.showMsg({closeable:!1,title:"登出提示",msg:"注意：您的账号已在其他地方登陆，被踢出！",btns:[{txt:"重新登录",fn:function(){indexJS.toRefreshView()}},{txt:"确定",fn:function(){$(".logout").trigger("click")}}]})}}else if(t)for(var i in t)$("#userListId li[id='"+t[i]+"']").remove()},setWhOnlineTip:function(e,t){var i=$("#wh_msg_"+e+" .tit strong");if(0!=i.length){var n=$("#wh_msg_"+e+" .tit strong"),a=$(".mult_dialog a[uid="+e+"]").find("img"),s=$("#userListId li[t=3][uid="+e+"] .headimg");t?(n.text("在线"),a.removeClass("have_op"),s.removeClass("have_op")):(n.text("离线"),a.addClass("have_op"),s.addClass("have_op"))}},getWhToUser:function(){var e=$(".mult_dialog a[class=on]"),t=e.attr("uid");return{userId:t,nickname:e.find("label").text(),talkStyle:1,userType:e.attr("utype")}},sendWhMsg:function(e){var t=chat.getWhToUser(),i=e.find(".text-min-img img");if(i.size()>0){var n=i.attr("src");n.length>1048576?alert("发送的图片大小不要超过1MB."):(chat.setUploadImg(n,t),i.remove())}var a=chat.getSendMsg(e);if(a!==!1){var s={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:a}},o=$(".mult_dialog a[class=on]").attr("uid");s.fromUser.toUser=t;var r=$("#wh_msg_"+o+" .dialog:last"),l=r.find(".whblt");l.length>0&&(s.fromUser.toUser.question=l.html(),s.fromUser.toUser.questionId=l.attr("rid"),s.fromUser.toUser.publishTime=r.attr("id")),chat.socket.emit("sendMsg",s),chat.setWhContent(s,!0,!1),e.html("")}},setWhVisitors:function(e,t,i,n,a,s,o){if(0==$(".mult_dialog a[uid="+i+"]").length){var r=this.getAImgOrLevel(i,e?e:$("#userListId li[id='"+i+"']").attr("cg"),t,a);$(".mult_dialog").append('<a href="javascript:" uid="'+i+'" utype="'+t+'" class="on"><div class="headimg '+r.level+'">'+r.aImg+"<b></b></div><label>"+n+'</label><i class="num dn" t="0"></i><i class="close"></i></a>');var l=$(".mult_dialog a[uid="+i+"]");if(o){var d=l.find(".num"),c=parseInt(d.attr("t"))+1;d.attr("t",c).text(c).show()}l.find(".close").click(function(){var e=$(this).parent();e.remove(),$("#wh_msg_"+e.attr("uid")).remove(),0==$(".mult_dialog a").length?($(".pletter_win .cont[id]").remove(),$(".pletter_win").hide()):$(".mult_dialog a:last").click()}),l.click(function(){$(".mult_dialog a").removeClass("on"),$(this).addClass("on"),$(this).find(".num").attr("t",0).text("").hide();var e=$(this).attr("uid"),t="wh_msg_"+e,i=$(this).attr("utype");if(chat.closeWhTip(e),$(".pletter_win .cont[id]").hide(),0==$("#"+t).length){var n="whTxt_"+e;$(".pletter_win").append($("#wh_content_tmp").html()),$(".pletter_win .cont:last").attr("id",t).find(".ctextarea").attr("id",n),$("#"+t).find(".facebtn").qqFace({id:"faceId_"+e,zIndex:1e6,assign:n,path:indexJS.filePath+"/face/"}),$("#"+t).find(".imgbtn").click(function(){return FileReader?void $("#"+t).find(".imginp").trigger("click"):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$("#"+t).find(".imginp").bind("change",function(){var e=this,t=chat.getWhToUser(),i=e.files[0];if(!i)return!1;if(0!=i.type.indexOf("image")||!i.type||!/\.(?:jpg|png|gif)$/.test(i.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var n=i.size;if(n>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var a=new FileReader;a.readAsDataURL(i),a.onload=function(e){chat.setUploadImg(e.target.result,t)},a.onprogress=function(e){},a.onloadend=function(e){},$(this).val("")}),$("#"+t).find(".ctextarea").pastableTextarea().on("pasteImage",function(e,t){var i=$(this).find(".text-min-img");i.length>0?(i.attr("href",t.dataURL),i.find("img").attr("src",t.dataURL)):($(this).append('<a class="text-min-img" href="'+t.dataURL+'" data-lightbox="whSend-img"><img src="'+t.dataURL+'"/></a>'),$(this).focusEnd())}).keydown(function(e){return 13==e.keyCode?(chat.sendWhMsg($(this)),!1):void 0}),$("#"+t).find(".sendbtn").click(function(e){chat.sendWhMsg($(this).parents(".cont").find(".ctextarea"))}),$("#"+t).find(".pop_close").click(function(){$(".pletter_win .cont[id],.pletter_win .mult_dialog a[uid]").remove(),$(".pletter_win").hide()}),$("#"+t).find(".pop_small").click(function(){$(".pletter_win").hide()}),chat.socket.emit("getWhMsg",{clientStoreId:indexJS.userInfo.clientStoreId,userType:indexJS.userInfo.userType,groupId:indexJS.userInfo.groupId,groupType:indexJS.userInfo.groupType,userId:indexJS.userInfo.userId,toUser:{userId:e,userType:i}})}$("#"+t).show().find(".wh_nk").text($(this).find("label").text()),$("#"+t).find(".ctextarea").focus(),chat.setTalkListScroll(!0,$("#"+t+" .wh-content"),"dark"),chat.setWhOnlineTip(e,$("#userListId li[id='"+e+"']").length>0)})}},setWhTip:function(e){if($(".pletter_win").is(":hidden")){var t=$("#userListId li[id="+e+"] a.uname span i"),i=0;t.length>0&&(i=t.text(),i=common.isValid(i)?i:0,$("#userListId li[id="+e+"] a.uname span i").text(parseInt(i)+1)),$("#userListId li[id="+e+"]").attr("k",1),this.whTipInterId=setInterval(function(){$("#userListId li[k=1]").toggleClass("tip_mrg")},1e3)}},closeWhTip:function(e){$("#userListId li[id="+e+"]").attr("k",0).removeClass("tip_mrg").find("a.uname span i").text(""),
0==$("#userListId[k=1]").length&&this.whTipInterId&&(clearInterval(this.whTipInterId),this.whTipInterId=null)},fillWhBox:function(e,t,i,n,a,s,o){var r=$(".mult_dialog a[uid="+n+"]");if(0==r.length)chat.setWhVisitors(e,i,n,a,t,!0,o);else if(o&&!r.hasClass("on")){var l=r.find(".num"),d=parseInt(l.attr("t"))+1;l.attr("t",d).text(d).show()}return $(".pletter_win").show(),$(".mult_dialog a[uid="+n+"]").click(),!s},setWhContent:function(e,t,i,n){var a=e.fromUser,s="dialog ",o=e.content,r="";if(e.rule)return void $("#"+e.uiId+' span[contt="a"]').append('<em class="ruleTipStyle">'+e.value.tip+"</em>");if(i||(a.toWhUserId=a.userId),indexJS.userInfo.userId==a.userId||"0"==indexJS.userInfo.userType&&"-1"==a.userType||"-1"==indexJS.userInfo.userType&&"0"==a.userType){if(t&&(a.publishTime=e.uiId,a.toWhUserId=a.toUser.userId),e.serverSuccess){if($("#"+e.uiId+" .dtime").html(chat.formatPublishTime(a.publishTime)),$("#"+e.uiId).attr("id",a.publishTime),e.content.msgType==chat.msgType.img){chat.removeLoadDom(a.publishTime);var l=$("#"+a.publishTime+' span[contt="a"]>a'),d=e.content.needMax?"/hxstudio/getBigImg?publishTime="+a.publishTime+"&userId="+a.userId:l.children("img").attr("src");l.attr("href",d)}return}s+="mine",r='<span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+'</span><a href="javascript:" class="uname">我</a>'}else{if(!i&&!n){var c=this.fillWhBox(a.clientGroup,a.avatar,a.userType,a.userId,a.nickname,!0,!0);if(c)return}var u="3"==a.userType?"&nbsp;（客服）":"";r='<a href="javascript:" class="uname">'+a.nickname+u+'</a><span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+"</span>"}if(common.isBlank(a.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var h="",p=$("#wh_msg_"+a.toWhUserId+" .dialoglist"),m="";if(o.msgType==chat.msgType.img){h=o.needMax?'<a href="/hxstudio/getBigImg?publishTime='+a.publishTime+"&userId="+a.userId+'" data-lightbox="whimg-"'+a.userId+'><img src="'+o.value+'" alt="图片"/></a>':'<a href="'+o.value+'" data-lightbox="whimg-"'+a.userId+'><img src="'+o.value+'" alt="图片" /></a>';var f=t?'</span><em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>':"";h='<p><i></i><span class="dcont" contt="a">'+h+f+"</p>"}else if(n)h='<div class="whcls"><i></i><div class="whblt" rid="'+o.infoId+'">'+o.value+"</div></div>";else{if(!t&&common.isValid(a.toUser.question)){var g='<a href="javascript:" class="uname">'+a.toUser.nickname+'</a><span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+"</span>";m='<div class="dialog" id="'+a.publishTime+'"><div class="dialog_top">'+g+'</div><div class="whcls"><i></i><div class="whblt">'+a.toUser.question+"</div></div></div>",p.append(m)}h='<p><i></i><span class="dcont" contt="a">'+o.value+"</span></p>"}if(m='<div class="'+s+'" id="'+a.publishTime+'" utype="'+a.userType+'" mType="'+o.msgType+'"><div class="dialog_top">'+r+"</div>"+h+"</div>",p.append(m),this.formatMsgToLink(a.publishTime),!i){var v=p.parents(".wh-content");v.hasClass("mCustomScrollbar")&&chat.setTalkListScroll(!0,v,"dark")}},setOnlineNum:function(){$(".mod_userlist .titbar label:first").text($("#userListId li").length),$(".mod_userlist .titbar label:last").text($("#visitorListId li").length)},searchUserList:function(e){var t=$("#userListId li[t!=14][t!=0]").map(function(){var t=$(this).find(".uname span").text();return-1!=t.indexOf(e)?{value:$(this).attr("id"),label:t,userType:$(this).attr("utype")}:null}).get(),i=[{value:$("#teacherInfoId").attr("uid"),label:$("#teacherInfoId dd h5").text(),userType:$("#teacherInfoId").attr("utype")}],n=$.merge(t,i);return n},setSocket:function(){this.socket=common.getSocket(io,indexJS.socketUrl,indexJS.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),indexJS.userInfo.socketId=chat.socket.id;var e=$("#roomInfoId");chat.socket.emit("login",{userInfo:indexJS.userInfo,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:e.attr("awr"),allowWhisper:e.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(e,t){if($("#userListId").html(""),"true"==$("#roomInfoId").attr("av")&&200>=t)for(var i=0,n=10>=t?60:200/t*3+10,a=0;n>a;a++)i=common.randomNumber(6),e["visitor_"+i]={userId:"visitor_"+i,clientGroup:"visitor",nickname:"游客_"+i,sequence:14,userType:-1};var s=null;for(var a in e)s=e[a],chat.setOnlineUser(s);chat.setOnlineNum(),indexJS.setListScroll(".user_box")}),this.socket.on("disconnect",function(e){console.log("disconnect")}),this.socket.on("error",function(e){console.error("e:"+e)}),this.socket.on("sendMsg",function(e){if(e.fromUser.toUser&&1==e.fromUser.toUser.talkStyle)chat.setWhContent(e,!1,!1);else{if(!e.serverSuccess&&indexJS.userInfo.userId==e.fromUser.userId&&!e.rule)return;chat.setContent(e,!1,!1)}}),this.socket.on("notice",function(e){switch(e.type){case"onlineNum":var t=e.data,i=t.onlineUserInfo;t.online?chat.setOnlineUser(i):indexJS.userInfo.userId!=i.userId&&(2==i.userType?($("#teacherInfoId,.user-infbox .user-code").addClass("dn"),$("#outline").show(),heightCalcu()):-1==i.userType?$("#visitorListId #"+i.userId).remove():$("#userListId #"+i.userId).remove(),indexJS.setListScroll(".user_box")),chat.setOnlineNum();break;case"removeMsg":$("#"+e.data.replace(/,/g,",#")).remove(),chat.setTalkListScroll();break;case"leaveRoom":chat.leaveRoomTip(e.flag,e.userIds);break;case"pushInfo":var t=e.data;1==t.position?(chat.whPushObj={info:t.content,publishTime:t.publishTime,infoId:t.contentId},chat.pushInfoTimeOutId=window.setTimeout(function(){var e=$("#userListId li[t=3] a .headimg:not(.have_op)");$(e.get(common.randomIndex(e.length))).parent().find("em").click(),$("#main_ad_box .pop_close").click()},60*t.timeOut*1e3)):3==t.position&&chat.talkBoxPush.initTBP(t.infos);break;case"approvalResult":var t=e.data;if(t.refuseMsg){var n=t.publishTimeArr;for(var a in n)$("#"+n[a]+" span[contt] em[class=ruleTipStyle]").html("已拒绝")}else{for(var a in t)chat.formatUserToContent(t[a]);chat.setTalkListScroll(!0)}}}),this.socket.on("loadMsg",function(e){$(".img-loading[pf=chatMessage]").hide();var t=e.msgData;if(t&&$.isArray(t)){t.reverse();for(var i in t)chat.formatUserToContent(t[i])}chat.setTalkListScroll(!0)}),this.socket.on("loadWhMsg",function(e){var t=e.data;if("offline"==e.type){if(t&&!$.isEmptyObject(t))for(var i in t)chat.setWhVisitors(t[i].clientGroup,t[i].userType,i,t[i].nickname,$("#userListId li[id='"+i+"']").length>0)}else if(t&&$.isArray(t)){var n=0,a=null;t.reverse();var s=0,o=$(".mult_dialog a[uid="+e.toUserId+"]");for(var r in t)a=t[r],3==a.userType&&chat.setWhPushInfo(o,a.publishTime)&&s++,chat.formatUserToContent(a,!0,e.toUserId),a.content.msgType==chat.msgType.img&&n++;0==s&&chat.setWhPushInfo(o,null),chat.setTalkListScroll(!0,$("#wh_msg_"+e.toUserId+" .wh-content"),"dark")}})},setTalkListScroll:function(e,t,i){var n=t?t:$("#chatMsgContentDiv");n.hasClass("mCustomScrollbar")?(n.mCustomScrollbar("update"),e&&n.mCustomScrollbar("scrollTo","bottom")):(n.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:i?i:"light-2"}),indexJS.setScrollStyle(n),n.mCustomScrollbar("scrollTo","bottom"))},setWhPushInfo:function(e,t){if($.isEmptyObject(chat.whPushObj))return!1;if(t&&t<chat.whPushObj.publishTime)return!1;var i=e.attr("uid"),n=e.find("label").text().replace(/\s（客服）$/,"");if($("#wh_msg_"+i+" div[id="+chat.whPushObj.publishTime+"]").length>0)return!1;var a={fromUser:{publishTime:chat.whPushObj.publishTime,userId:i,nickname:n,userType:3},content:{msgType:chat.msgType.text,value:chat.whPushObj.info,infoId:chat.whPushObj.infoId}};return chat.setWhContent(a,!1,!1,!0),chat.whPushObj={},window.clearTimeout(chat.pushInfoTimeOutId),!0},formatUserToContent:function(e,t,i){var n={userId:e.userId,nickname:e.nickname,avatar:e.avatar,userType:e.userType,groupId:e.groupId,clientGroup:e.clientGroup,publishTime:e.publishTime,toUser:e.toUser,avatar:e.avatar,position:e.position};t?(n.toWhUserId=i,chat.setWhContent({fromUser:n,content:e.content},!1,!0)):chat.setContent({fromUser:n,content:e.content},!1,!0)},talkBoxPush:{talkPushList:[],talkPushInterval:null,initTBP:function(e){this.clear(),this.talkPushList=e,this.start()},clear:function(){chat.talkBoxPush.talkPushInterval&&(window.clearInterval(chat.talkBoxPush.talkPushInterval),chat.talkBoxPush.talkPushInterval=null);for(var e=chat.talkBoxPush.talkPushList,t=null,i=0,n=e.length;n>i;i++)t=e[i],t.timeoutId&&window.clearTimeout(t.timeoutId),t.intervalId&&window.clearInterval(t.intervalId)},start:function(){var e=chat.talkBoxPush.talkPushList;e&&e.length>0&&(chat.talkBoxPush.talkPushInterval=window.setInterval(function(){chat.talkBoxPush.check()},1e4))},check:function(){for(var e=chat.talkBoxPush.talkPushList,t=null,i=0,n=e.length;n>i;i++)t=e[i],t.startFlag||common.dateTimeWeekCheck(t.pushDate,!1,indexJS.serverTime)&&(t.startFlag=!0,t.timeoutId=window.setTimeout(chat.talkBoxPush.delayStartTask(t),60*(t.onlineMin||0)*1e3))},delayStartTask:function(e){return function(){chat.talkBoxPush.showMsg(e),e.intervalMin&&e.intervalMin>0&&(e.intervalId=window.setInterval(chat.talkBoxPush.startTask(e),60*e.intervalMin*1e3))}},startTask:function(e){return function(){common.dateTimeWeekCheck(e.pushDate,!1,indexJS.serverTime)?chat.talkBoxPush.showMsg(e):(window.clearInterval(e.intervalId),e.startFlag=!1)}},showMsg:function(e){var t=[];t.push('<div class="dialog push">'),t.push(e.content),t.push("</div>"),$("#dialog_list").append(t.join("")),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}},reward:function(){if($(".inp-bar4").hasClass("clicked"))$(".envelope-reward").removeClass("dn");else{var e={groupId:indexJS.userInfo.groupId,hasQRCode:!0};common.getJson("/hxstudio/getTeachers",{data:JSON.stringify(e)},function(e){e&&($("#js-reward-user").empty(),$("#js-reward-user").append('<option value="">请选择老师</option>'),$.each(e,function(e,t){$("#js-reward-user").append('<option value="'+t.userNo+'">'+t.userName+"</option>")}),$(".inp-bar4").addClass("clicked"),$(".envelope-reward").removeClass("dn"))})}},setTeacherQRCode:function(e){var t={userId:e};common.getJson("/hxstudio/getTeacher",{data:JSON.stringify(t)},function(e){e&&common.isValid(e.wechatCodeImg)&&$(".user-infbox .user-code").attr("src",e.wechatCodeImg).removeClass("dn")})}};$(function(){chat.init()});var box={verifyCodeIntId:null,toRoomId:null,init:function(){this.setEvent()},openCSBox:function(){window.open("https://www.serve888.com/serve888/chatClient/chatbox.jsp?companyID=217&s=1","Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")},setEvent:function(){$(".loginbox .pop_close,.popup_box .pop_close,.formbtn[t=close]").click(function(){$(this).parent().parent().hide(),$(".blackbg").hide(),$(".blackbg form").each(function(){this.reset()})}),this.loginEvent(),this.upgradeEvent(),this.expertMailEvent(),$("#popAnnBox .yesbtn").click(function(){$("#popAnnBox").fadeOut("normal","swing",function(){$(".blackbg").hide()})})},upgradeEvent:function(){$("#tipbtnId").hover(function(){$(".upg_tip").show()},function(){$(".upg_tip").hide()}),$(".upgradebtn").click(function(){try{$(".upgrade,#up_loading").show(),$.getJSON("/hxstudio/getClientGroupList",null,function(e){if($("#up_loading").hide(),e){$("#upg_tbody_id").html("");var t="",i=0,n=null,a="";for(var s in e)e[s].clientGroupId==indexJS.userInfo.clientGroup&&(i=e[s].sequence);for(var o=0;o<e.length;o++)if(n=e[o],a="",n.clientGroupId==indexJS.userInfo.clientGroup?(t="当前级别",a="current"):t="visitor"!=n.clientGroupId&&i<n.sequence?"vip"==n.clientGroupId?"联系客服升级":'<a href="javascript:" t="'+n.clientGroupId+'">升级</a>':"---",!common.isBlank(common.trim(n.remark))){var r=[];r.push('<tr class="'+a+'"><td><p>'+box.getUserLevelShortName(n.clientGroupId)+'</p></td><td><p class="p2">'+common.trim(n.remark)+"</p></td><td><p>"+common.trim(n.authorityDes)+"</p></td><td>"+t+"</td></tr>"),$("#upg_tbody_id").append(r.join(""))}$("#upg_tbody_id a").click(function(){var e=$(this),t=e.attr("t");common.getJson("/hxstudio/upgrade",{clientGroup:t},function(i){if(e.attr("disabled",!1),i.isOK)"active"===i.clientGroup&&"notActive"===t?$("#studioUpgA").show():$("#studioUpgA").hide(),$(".upgrade,.upgrade_result .fail").hide(),$(".upgrade_result,.upgrade_result .succ").show();else{var n="";"active"===t?n="很遗憾，您未激活恒信真实交易账户，升级失败！<br>如有疑问请联系客服！":"notActive"===t?n="很遗憾，您未开通恒信真实交易账户，升级失败！<br>如有疑问请联系客服！":"simulate"===t&&(n="很遗憾，您未开通恒信模拟交易账户，升级失败！<br>如有疑问请联系客服！"),$(".upgrade_result .succ").hide(),$(".upgrade_result,.upgrade_result .fail").show(),$(".upgrade_result .fail>span").html(n)}},!0,function(t){e.attr("disabled",!1)})})}})}catch(e){$("#up_loading").hide(),console.error("getClientGroupList->"+e)}})},forceLogin:function(e){var t=LoginAuto.get();return"boolean"!=typeof e?t&&1==t.forceLogin:t?(t.forceLogin=e,LoginAuto.set(t)&&e):!1},loginEvent:function(){$("#verMalCodeId").click(function(){$("#verMalCodeId img").attr("src","/hxstudio/getVerifyCode?code=acLogin&t="+(new Date).getTime())}),$(".login-mode li").click(function(){$(this).addClass("on").siblings().removeClass("on"),$(".login-modebox ul").removeClass("on").eq($(this).index()).addClass("on")}),$("#login_a").bind("click",function(e,t){t=t||{},box.toRoomId=t.groupId,box.openLgBox(t.closeable,t.showTip)}),"visitor"==indexJS.userInfo.clientGroup&&(indexJS.currStudioAuth||$("#login_a").trigger("click",{closeable:!1})),$(".logout").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href=indexJS.fromPlatform?"/hxstudio/logout?platform="+indexJS.fromPlatform:"/hxstudio/logout"}),$("#loginForm input[name=mobilePhone],#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").bind("input propertychange",function(){common.isValid(this.value)&&$(".popup_box .error,.loginbox .error").hide()}),$("#loginForm .rbtn").click(function(){if(!$(this).hasClass("pressed")){var e=$("#loginForm input[name=mobilePhone]").val();if(!common.isMobilePhone(e))return void $("#loginForm .error").html("<i></i>手机号码有误，请重新输入！").show();$(this).addClass("pressed").html("发送中...");try{$.getJSON("/hxstudio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:e,useType:$(this).attr("ut")},function(e){e&&0==e.result?($("#loginForm .error").hide(),box.setVerifyCodeTime("#loginForm .rbtn")):("1005"==e.errcode?$("#loginForm .error").html("<i></i>"+e.errmsg).show():console.error("提取数据有误！"),box.resetVerifyCode())})}catch(t){box.resetVerifyCode(),console.error("setMobileVerifyCode->"+t)}}}),$("#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").keydown(function(e){return 13==e.keyCode?($(this).parents("form").find(".set_submit").click(),!1):void 0}),$("#logBtnSub").click(function(){$("#loginForm input[name=clientStoreId]").val(indexJS.userInfo.clientStoreId);var e=$("#loginForm .login-inf").hasClass("on");if(box.checkFormInput("#loginForm",$("#loginForm .error"),e?["mobilePhone","verifyCode"]:["accountNo","pwd","verMalCode"])){$(this).attr("disabled",!0);var t=this;$("#formBtnLoad").show(),common.getJson("/hxstudio/hxLogin",$("#loginForm").serialize()+"&isPwdLogin="+e,function(e){return $("#loginForm .error").hide(),$(t).attr("disabled",!1),$("#formBtnLoad").hide(),e.isOK?($(".blackbg,#loginBox").hide(),LoginAuto.setAutoLogin($("#autoLogin").prop("checked")),indexJS.userInfo.clientGroup=e.userInfo.clientGroup,box.toRoomId?common.getJson("/hxstudio/checkGroupAuth",{groupId:box.toRoomId},function(e){!e.isOK,indexJS.toRefreshView()},!0,function(e){"success"!=e&&(box.preGroupId=null,alert("操作失败，请联系客服！"))}):(indexJS.checkClientGroup("vip"),indexJS.toRefreshView()),void 0):($("#loginForm .error").html("<i></i>"+e.error.errmsg).show(),!1)},!0,function(e){$(t).attr("disabled",!1),$("#formBtnLoad").hide()})}}),$("#setNkBtn").click(function(){if(box.checkFormInput("#setNkForm")){$(this).prop("disabled",!0);var e=this;$("#setNkLoad").show(),common.getJson("/hxstudio/modifyName",$("#setNkForm").serialize(),function(t){return $("#setNkForm .error").hide(),$(e).attr("disabled",!1),$("#setNkLoad").hide(),t.isOK?($("#setNkForm").parent().find(".pop_close").click(),indexJS.refreshNickname(!0,t.nickname),$("#sendBtn").click(),void 0):($("#setNkForm .error").html("<i></i>"+(t.msg?t.msg:"修改失败，请联系客服！")).show(),!1)},!0,function(t){$(e).attr("disabled",!1),$("#setNkLoad").hide()})}})},getUserLevelShortName:function(e){var t="";switch(e){case"vip":t="[V]";break;case"real":t="[R]";break;case"active":t="[A]";break;case"notActive":t="[N]";break;case"simulate":t="[D]";break;case"register":t="[M]";break;default:t="游客"}return t},checkFormInput:function(e,t,i){var n=!0;t||(t=$(e+" .error")),t.attr("tId","").hide();var a=" input[type!=checkbox]";if(i)for(var s in i)a+="[name!="+i[s]+"]";return $(e+a).each(function(){return common.isBlank($(this).val())?("accountNo"==this.name&&t.attr("tId",this.name).html("<i></i>账号不能为空！").show(),"pwd"==this.name&&t.attr("tId",this.name).html("<i></i>密码不能为空！").show(),"verMalCode"==this.name&&t.attr("tId",this.name).html("<i></i>验证码不能为空！").show(),"mobilePhone"==this.name&&t.attr("tId",this.name).html("<i></i>手机号码不能为空！").show(),"verifyCode"==this.name&&t.attr("tId",this.name).html("<i></i>验证码不能为空！").show(),"nickname"==this.name&&t.attr("tId",this.name).html("<i></i>昵称不能为空！").show(),n=!1):"mobilePhone"!=this.name||($(this).val($.trim($(this).val())),common.isMobilePhone(this.value))?"nickname"!=this.name||common.isRightName(this.value)?void("verMalCode"==this.name&&$(this).val(this.value.toLowerCase())):(t.attr("tId",this.name).html("<i></i>昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!").show(),n=!1):(t.attr("tId",this.name).html("<i></i>手机号码输入有误！").show(),n=!1)}),n||t.show(),n},setVerifyCodeTime:function(e){var t=parseInt($(e).attr("t"))||60;this.verifyCodeIntId||(this.verifyCodeIntId=setInterval("box.setVerifyCodeTime('"+e+"')",1e3)),t>1?$(e).attr("t",t-1).html("重新获取("+(t-1)+")"):(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId="",$(e).attr("t",60).html("获取验证码").removeClass("pressed"))},resetVerifyCode:function(){this.verifyCodeIntId&&(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId=""),$("#loginForm .rbtn").attr("t",60).html("获取验证码").removeClass("pressed")},openLgBox:function(e,t){e===!1?$("#loginBox .pop_close").hide():$("#loginBox .pop_close").show(),t?$("#login_tip").show():$("#login_tip").hide(),$(".popup_box").hide(),$("#loginBox,.blackbg").show(),$("#verMalCodeId").click()},openSetNameBox:function(e){var t=e?"设置昵称":"修改昵称";$(".nk_box .pop_tit").text(t),$(".nk_box,.blackbg").show()},refreshVerifyCode:function(){var e=LoginAuto.sessionUser.groupType;$("#verifyCodeId img").attr("src","/"+e+"/getVerifyCode?code=email&v="+Math.random())},expertMailEvent:function(){$(".expert_box .error").hide(),$("#expert").click(function(){box.refreshVerifyCode(),$(".expert,.blackbg").removeClass("dn").show()}),$("#btnSendMail").click(function(){if(common.isBlank($("#mailFrom").val()))$(".expert_box .error").html("<i></i>发件人不能为空！").show();else if(common.isBlank($("#mailContent").val()))$(".expert_box .error").html("<i></i>输入内容有误，请重新输入！").show();else if(common.isBlank($("#mailImgCode").val()))$(".expert_box .error").html("<i></i>请输入验证码！").show();else{$(".expert_box .error").hide();var e={};e.content=$.trim($("#mailContent").val()),e.email=$.trim($("#mailFrom").val()),common.getJson("/hxstudio/email",{key:"hxstudio",data:JSON.stringify(e)},function(e){e.isOK?(box.showMsg(e.msg),$(".expert,.blackbg").hide(),$("#mailFrom,#mailContent").val("")):$(".expert_box .error").html("<i></i>"+e.msg).show()})}}),$("#btnSendMail").keydown(function(e){return 13==e.keyCode?($("#btnSendMail").click(),!1):void 0}),$("#verifyCodeId img").click(function(){box.refreshVerifyCode()})},hideMsg:function(){$("#popMsgBox").is(":visible")&&$("#popMsgBox").fadeOut("normal","swing",function(){$(".blackbg").hide()})},showMsg:function(e){"string"==typeof e&&(e={msg:e}),e=$.extend({closeable:!0,title:"",msg:"",modal:!0,delay:0,btns:[{txt:"确定",fn:function(){box.hideMsg()}}]},e),$("#popMsgTit").text(e.title||""),$("#popMsgTxt").html(e.msg);var t=$("#popMsgCont");t.find("a.yesbtn").remove();for(var i=null,n=null,a=0,s=e.btns?e.btns.length:0;s>a;a++)i=e.btns[a],n=$('<a class="yesbtn" href="javascript:void(0)">'+i.txt+"</a>"),t.append(n),n.click(i.fn);e.closeable?$("#popMsgClo").show():$("#popMsgClo").hide(),$("#popMsgBox").show(),e.modal&&$(".blackbg").show(),e.delay&&window.setTimeout(function(){box.hideMsg()},e.delay)},showTipBox:function(e){$(".tipsbox").fadeIn().delay(1e3).fadeOut(200).find(".cont").text(e)}};$(function(){box.init()});var tool={financeShowIntervalId:null,financeHideIntervalId:null,init:function(){this.setEvent()},setEvent:function(){$(".mod_menu li").hover(function(){$(this).hasClass("entered")||(tool.loadFun($(this).attr("class")),$(".dr3").hasClass("on")&&clearTimeout(tool.financeHideIntervalId)),$(this).hasClass("dr2")&&$(this).hasClass("entered")&&($(".dr2 .teacher-point ul").css("height",$(".mod_menu").height()-75),indexJS.setListScroll(".dr2 .teacher-point ul",{isCustom:!1,scrollbarPosition:"outside"})),$(this).addClass("on entered"),$(this).find(".dropcont").show()},function(){$(this).removeClass("on"),$(this).find(".dropcont").hide(),$(".dr3").hasClass("on")||(clearInterval(tool.financeShowIntervalId),tool.financeHideIntervalId=window.setTimeout("tool.clearCls('.dr3','entered')",6e4))}),$("#calendarFinance").val(common.formatterDate(indexJS.serverTime,"-")),$("#calendarFinance").change(function(){var e=$(this).val();tool.setFinanceData(e,1)}),$(".dr3 .date_select a").click(function(){$("#calendarFinance").trigger("click")}),$(".calc_box .calc_tabnav a").click(function(){$(this).hasClass("clicked")||tool.setPivotCalc($(this).attr("symbol")),$(".calc_box .calc_tabnav a").removeClass("on"),$(".calc_box .calc_tab").removeClass("on"),$(this).addClass("on clicked"),$($(".calc_box .calc_tab")[$(this).index()]).addClass("on")})},loadFun:function(e){switch(e){case"dropitem dr2":tool.teacherPoint();break;case"dropitem dr3":tool.initCalendar(function(){tool.setFinanceData("",1),$(".dr3").addClass("initCalendar"),tool.financeShowIntervalId=window.setInterval("tool.setFinanceData('',1)",6e4)});break;case"dropitem dr4":tool.setCftcCot();break;case"dropitem dr5":tool.setPivotCalc("LLG");break;case"dropitem dr6":tool.setDownloadPPT()}},initCalendar:function(e){$(".dr3").hasClass("initCalendar")?e():LazyLoad.js(["/base/lib/pikaday/moment.min.js","/base/lib/pikaday/pikaday.min.js"],function(){var t=tool.currentDate(),i={previousMonth:"上个月",nextMonth:"下个月",months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdays:["周日","周一","周二","周三","周四","周五","周六"],weekdaysShort:["日","一","二","三","四","五","六"]};new Pikaday({field:$("#calendarFinance")[0],firstDay:1,container:$("#calendarContainer")[0],defaultDate:t,i18n:i,minDate:new Date(2e3,0,1),maxDate:new Date(2050,12,31),yearRange:[2e3,2050],onSelect:function(){var e=document.createTextNode(this.getMoment().format("YYYY-MM-DD")+" ");$("#calendarFinance").append(e)}});e()})},setFinanceData:function(e,t){common.isBlank(e)&&(e=tool.currentDate()),common.getJson("/hxstudio/getFinancData",{releaseTime:e,dataTypeCon:t},function(e){if(0==e.result){var t={"德国":"Germany","法国":"France","欧元区":"EUR","加拿大":"CAD","美国":"USD","澳大利亚":"AUD","日本":"JPY","瑞士":"CHF","意大利":"Italy","英国":"GBP","中国":"CNY","新西兰":"NZD","韩国":"SK","香港":"HKD","西班牙":"Spain","台湾":"Taiwan","印度":"INR","新加坡":"Singapore"},i="",n=tool.formatHtml("finance");$.each(e.data.financeData,function(e,a){i+=n.formatStr(a.time.substring(0,5),common.isBlank(t[a.country])?"none":t[a.country],a.country,tool.importanceLevel(a.importanceLevel),a.name,common.isBlank(a.lastValue)?"---":a.lastValue,common.isBlank(a.predictValue)?"---":a.predictValue,common.isBlank(a.value)?"---":a.value)}),$(".dr3 .calendar_ul ul").html(i),indexJS.setListScroll(".calendar_ul.scrollbox2",{isCustom:!1,scrollbarPosition:"outside"})}})},setCftcCot:function(){$.getJSON("/hxstudio/get24kCftc",null,function(e){var t={gold:"纽约期金",silver:"纽约期银",usd:"美元指数",oil:"纽约原油",cu:"纽约期铜"};if(null!=e&&e){var i="",n="",a=tool.formatHtml("cftcperc"),s=tool.formatHtml("cftcdata");$.each(t,function(t,o){var r=e[t]["long"],l=e[t]["short"],d=parseInt(r)+parseInt(l),c=Math.round(parseInt(r)/d*100),u=Math.round(parseInt(l)/d*100);i+=a.formatStr(o,c,u),n+=s.formatStr(o,r,l,e[t].updatetime)}),$(".dr4 .percent_list .perc_table").html(i),$(".dr4 .perc_data .data_table tbody").html(n)}})},getOAUrl:function(){var e=window.location.host;return e=e.indexOf("localhost")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":e.indexOf("testweb1.24k.hk")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":"http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getPivotPointData&symbol="},setPivotCalc:function(e){$.post(tool.getOAUrl()+e,{},function(e){var t=["d","w"];if("true"===e.sucess.toLowerCase())for(var i=e.msg.length,n=0;i>n;n++)$.inArray(e.msg[n].pivotType,t)>-1&&($("#r3_"+e.msg[n].symbol+"_"+e.msg[n].pivotType).text(e.msg[n].resistance3),$("#r2_"+e.msg[n].symbol+"_"+e.msg[n].pivotType).text(e.msg[n].resistance2),$("#r1_"+e.msg[n].symbol+"_"+e.msg[n].pivotType).text(e.msg[n].resistance1),$("#p_"+e.msg[n].symbol+"_"+e.msg[n].pivotType).text(e.msg[n].pivotPoint),$("#s3_"+e.msg[n].symbol+"_"+e.msg[n].pivotType).text(e.msg[n].support3),$("#s2_"+e.msg[n].symbol+"_"+e.msg[n].pivotType).text(e.msg[n].support2),$("#s1_"+e.msg[n].symbol+"_"+e.msg[n].pivotType).text(e.msg[n].support1))},"json")},setDownloadPPT:function(){var e={pptx:"",ppt:"",pdf:' class="pdf"',docx:' class="word"',doc:' class="word"'};indexJS.getArticleList("download",indexJS.userInfo.groupId,1,1,100,'{"sequence":"asc"}',null,function(t){if(t&&0==t.result){var i,n=t.data,a=null,s="",o=tool.formatHtml("download");for(var r in n){i=0==r?' class="fir"':"",a=n[r].detailList[0];var l=n[r].mediaUrl.substring(n[r].mediaUrl.lastIndexOf(".")+1).toLowerCase(),d=a.title+"."+l,c=common.formatterDate(n[r].publishStartDate,"-").replace("-","/").replace("-","/");s+=o.formatStr(i,e[l],a.title,a.authorInfo?a.authorInfo.name:"",c,n[r].mediaUrl,d,"")}$(".dr6 .ppt_list ul").html(s),indexJS.setListScroll(".ppt_list",{isCustom:!1,scrollbarPosition:"outside"})}else $(".dr6 .ppt_list ul").html("")})},teacherPoint:function(){indexJS.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"createDate":"desc"}',"",function(e){var t=e.data.length,i="";if(e&&0==e.result&&e.data&&t>0){var n="",a=tool.formatHtml("tearchPoint");$.each(e.data,function(e,s){var o=s.detailList[0],r=common.formatterDate(s.publishStartDate,"-").replace("-","年").replace("-","月")+"日";e+1==t&&(i=' class="last"'),n+=a.formatStr(i,o.title,o.authorInfo.name,r,o.content)}),$(".dr2 .teacher-point ul").css("height",$(".mod_menu").height()-75),$(".dr2 .teacher-point ul").html(n),indexJS.setListScroll(".dr2 .teacher-point ul",{isCustom:!1,scrollbarPosition:"outside"})}})},currentDate:function(){return common.formatterDate(indexJS.serverTime,"-")},clearCls:function(e,t){$(e).removeClass(t)},formatHtml:function(e){var t=[];switch(e){case"finance":t.push("<li>"),t.push('   <table cellpadding="0" cellspacing="0" border="0" width="100%" class="calendar_table">'),t.push("       <tr>"),t.push('           <td width="98"><span class="time">{0}</span></td>'),t.push('           <td><img src="http://www.24k.hk/public/economicCalenda/images/country/{1}.png" width="23">{2}</td>'),t.push('           <td width="80"><div class="stars">{3}</div></td>'),t.push("       </tr>"),t.push("       <tr>"),t.push('           <td colspan="3"><span class="tit">{4}</span></td>'),t.push("       </tr>"),t.push("       <tr>"),t.push("           <td>前值:<strong>{5}</strong></td>"),t.push("           <td>预测值:<strong>{6}</strong></td>"),t.push("           <td>公布值:<strong>{7}</strong></td>"),t.push("       </tr>"),t.push("   </table>"),t.push("</li>");break;case"cftcperc":t.push("<tr>"),t.push('   <td width="70"><strong>{0}</strong></td>'),t.push('   <td width="30">{1}%</td>'),t.push('   <td><div class="perc_box"><b style="width:{1}%"></b></div></td>'),t.push('   <td width="30" class="align_r">{2}%</td>'),t.push("</tr>");break;case"cftcdata":t.push("<tr>"),t.push("   <td>{0}</td>"),t.push('   <td align="right">{1}</td>'),t.push('   <td align="right">{2}</td>'),t.push("   <td></td>"),t.push('   <td align="center">{3}</td>'),t.push("</tr>");break;case"download":t.push("<li{0}>"),t.push("   <i{1}></i>"),t.push('   <div class="detail">'),t.push("       <strong>{2}</strong>"),t.push("       <span>{3}<b>{4}</b></span>"),t.push('       <a href="{5}" target="download" download="{6}" class="downbtn"><i></i><span>下载<b>{7}</b></span></a>'),t.push("   </div>"),t.push("</li>");break;case"tearchPoint":t.push("<li{0}>"),t.push("    <h4>{1}</h4>"),t.push("    <h6>"),t.push("        <i>作者:{2}</i>"),t.push("        <span>{3}</span>"),t.push("    </h6>"),t.push("    <p>{4}</p>"),t.push("</li>")}return t.join("")},importanceLevel:function(e){var t="";switch(e){case 1:t='<span class="bling">★</span><span>★</span><span>★</span><span>★</span><span>★</span>';break;case 2:t='<span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span><span>★</span>';break;case 3:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span>';break;case 4:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span>';break;case 5:t='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span>';break;default:t="<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>"}return t}};$(function(){tool.init()});