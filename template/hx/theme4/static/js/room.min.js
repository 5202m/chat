function openLive800Chat(e){var t="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";e?location.href=t:window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(e,t){common.isBlank(t)&&(t="800018282");var o="http://crm2.qq.com/page/portalpage/wpa.php?uin="+t+"&cref=&ref=&f=1&ty=1&ap=&as="+e;window.open(o,"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(e)}function live800Prompt(e){window.onbeforeunload=null;var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",o="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(2==e)try{UUID.prototype.createUUID();window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(i){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(o,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(i){window.open(o)}}function qqPrompt(e){var t="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var o=UUID.prototype.createUUID();getGacookiesTrack(o,"2","1"),window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(i){window.open(t,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(e,t){return isNaN(t)||t>e.length?!1:void e.splice(t,1)},joinSplit:function(e){return",".concat(e).concat(",")},isBlank:function(e){return void 0==e||null==e||"undefined"==e||"null"==e||""==$.trim(e)},isValid:function(e){return!this.isBlank(e)},trim:function(e){return this.isBlank(e)?"":e.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(e){return document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(e){return this.isBlank(e)?"":e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(e,t){t||(t="-"),e instanceof Date||(e=new Date(e));var o=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate());return o},getHHMMSS:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return t},getMMSS:function(e){return e instanceof Date||(e=new Date(e)),(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getHHMM:function(e){e instanceof Date||(e=new Date(e));var t=(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());return t},formatterDateTime:function(e,t){if(t||(t="-"),e instanceof Date||(e=new Date(e)),"Invalid Date"==e)return"";var o=e.getFullYear()+t+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+t+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());return o},longMsTimeToDateTime:function(e,t){var o=new Date(e);return this.formatterDateTime(o,t)},showBox:function(e,t){$(e).slideDown(),$(t||".layer-shadow").show()},hideBox:function(e,t){$(e).slideUp(),$(t||".layer-shadow").hide()},containSplitStr:function(e,t){return common.isBlank(e)||common.isBlank(t)?!1:-1!=(","+e+",").indexOf(","+t+",")},getJson:function(e,t,o,i,r){var s=null;return $.ajax({url:e,type:"POST",timeout:1e5,cache:!1,async:void 0!=i?i:!1,dataType:"json",data:t,success:"function"==typeof o?o:function(e){s=e},error:function(e,t){"function"==typeof r?r(t):common.isValid(e.responseText)&&"OK"!=e.statusText?alert(e.responseText):alert("请求超时,请重试!")}}),s},arraySort:function(e,t){return function(o,i){return t?o[e]<i[e]:o[e]>i[e]}},randomNumber:function(e){for(var t="",o=0;e>o;o++)t+=Math.floor(10*Math.random());return t},isMobilePhone:function(e){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(e)},dateTimeWeekCheck:function(e,t,o){if(this.isBlank(e))return!!t;$.isPlainObject(e)||(e=JSON.parse(e));var i=o?new Date(o):new Date,r=!1,s=this.formatterDate(i);if(r=this.isBlank(e.beginDate)||s>=e.beginDate,r&&(r=this.isBlank(e.endDate)||s<=e.endDate),!r)return!1;var n=e.weekTime;if(this.isBlank(n))return r;var a=null,l=null,u=!1;for(var d in n)if(a=n[d],(!this.isValid(a.week)||i.getDay()==parseInt(a.week))&&(l=this.getHHMMSS(i),u=this.isBlank(a.beginTime)||l>=a.beginTime,u&&(u=this.isBlank(a.endTime)||l<=a.endTime),u))break;return u},arrayUnique:function(e){if(!e)return e;for(var t,o=[],i={},r=0;null!=(t=e[r]);r++)i[t]||(o.push(t),i[t]=!0);return o},isWebSocket:function(){return window.WebSocket},getSocket:function(e,t,o){return common.isWebSocket()?(console.log("used websocket!"),e.connect(t.webSocket+"/"+o,{transports:["websocket"]})):e.connect(t.socketIO+"/"+o)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(e){for(var t="",o=0;e>o;o++)t+=Math.floor(10*Math.random());return t},clearMsgHtml:function(e){var e=e.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return e&&(e=$.trim(e)),e},formatToJson:function(e){return this.isBlank(e)?null:JSON.parse(e)},getSyllabusPlan:function(e,t,o,i){if(!e||!e.courses)return null;var r=function(e,t){if(e){var r,s=common.isMobile();"object"!=typeof e&&(e=JSON.parse(e));for(var n in e)if(r=e[n],s){if(1==t&&(!o&&3==r.code||o&&4==r.code))return r.url}else if(i){if(1==t&&3==r.code){var a=r.url||"";return a=a.replace(/^http:/,"rtmps:").replace(/\/playlist\.m3u8$/,"")}}else if(r.code==t)return r.url}},s=function(t,o,i){var s=null,n=t.course;return n&&n.length>o?(s=n[o],0==s.status||common.isBlank(s.lecturerId)?null:(s.studioLink=r(e.studioLink,s.courseType),s.startTime=t.startTime,s.endTime=t.endTime,s.day=a[o].day,s.isNext=i,s)):null},n=null;n=this.isValid(e.courses)&&"object"!=typeof e.courses?JSON.parse(e.courses):e.courses;for(var a=n.days,l=n.timeBuckets,u=new Date(t).getDay(),d=common.getHHMM(t),c=null,h=!1,m=null,p=null,f=0;f<a.length;f++)if(0!=a[f].status)if(a[f].day>u){for(var g in l)if(c=l[g],p=s(c,f,!0))return p}else if(a[f].day==u)for(var g in l){if(c=l[g],c.startTime<=d&&(c.endTime>=d||"00:00"==c.endTime))return h=!0,s(c,f,!1);if(!h&&c.startTime>d)return h=!0,s(c,f,!0)}else if(!m)for(var g=0;g<l.length;g++)if(p=l[g].course,p&&0!=p[f].status&&!common.isBlank(p[f].lecturerId)){m={dayIndex:f,tmIndex:g};break}return!h&&m?s(l[m.tmIndex],m.dayIndex,!0):null},formatSyllabus:function(e,t,o,i){var r={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字在线",1:"视频在线",2:"ONE TV"}},s=new Date(t).getDay(),n=this.getHHMM(t),a=$.extend({},r,i),l=function(e,t,o,i){var r=0,l=(e+6)%7,u=(s+6)%7;return r=l>u?2:u>l?0:i?1:n>=o?0:t>n?2:1,a.courseCls[r]},u=[];try{if(e){var d=$.isPlainObject(e)?e:JSON.parse(e),c=d.days?d.days.length:0;if(c>0)if(1===o){var h={0:"文字",1:"视频",2:"oneTV"};u.push('<div class="sy_panel">');var m=t-864e5*((s+6)%7),p=null,f=null,g=null;u.push('<div class="sy_nav">');for(var v=' style="width:'+100/c+'%;"',S=0;c>S;S++)p=new Date(m+(d.days[S].day+6)%7*864e5),f=p.getFullYear()+"-"+(p.getMonth()<9?"0":"")+(p.getMonth()+1)+"-"+(p.getDate()<10?"0":"")+p.getDate(),g=d.days[S].day==s?' class="active"':"",u.push('<a href="javascript:void(0)" d="'+d.days[S].day+'"'+g+v+">"+a.dayCN[d.days[S].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');u.push("</div>"),u.push('<div class="sy_cont"><div>'),u.push('<table cellpadding="0" cellspacing="0" border="0" class="'+a.tableCls+'">');for(var b=null,w=null,S=0;c>S;S++){if(u.push('<tbody d="'+d.days[S].day+'">'),0==d.days[S].status)w=l(d.days[S].day,null,null,!0),u.push('<tr class="'+w+'" width="100%"><td>休市</td></tr>');else for(var T=0,k=d.timeBuckets.length;k>T;T++)b=d.timeBuckets[T],w=l(d.days[S].day,b.startTime,b.endTime,!1),0==b.course[S].status?(u.push('<tr class="'+w+'">'),u.push('<td width="25%">'+b.startTime+"-"+b.endTime+"</td>"),u.push('<td colspan="2" width="75%">休市</td>'),u.push("</tr>")):b.course[S].lecturer&&(u.push('<tr class="'+w+'">'),u.push('<td width="25%">'+b.startTime+"-"+b.endTime+"【"+h[b.course[S].courseType]+"】</td>"),u.push('<td width="25%">'+b.course[S].lecturer+"</td>"),u.push('<td width="50%">'+b.course[S].title+"</td>"),u.push("</tr>"));u.push("</tbody>")}u.push("</table>"),u.push("</div></div>"),u.push("</div>")}else if(2===o){u.push('<table cellpadding="0" cellspacing="1" border="0" class="'+a.tableCls+'">'),u.push("<tr>"),u.push("<th>星期\\节次</th>");for(var k=d.timeBuckets?d.timeBuckets.length:0,b=null,w=null,T=0;k>T;T++)b=d.timeBuckets[T],u.push("<th>"+a.indexCN[T]+"<br><span>("+b.startTime+"-"+b.endTime+")</span></th>");u.push("</tr>");for(var y=null,S=0,I=d.days?d.days.length:0;I>S;S++){if(y=d.days[S],u.push("<tr>"),u.push("<th>"+a.dayCN[y.day]+"</th>"),0==y.status)w=l(y.day,null,null,!0),u.push('<td class="'+w+'" colspan="'+k+'">休市</td>');else for(var T=0;k>T;T++)b=d.timeBuckets[T],w=l(y.day,b.startTime,b.endTime,!1),u.push('<td class="'+w+'">'+(0==b.course[S].status?"休市":b.course[S].lecturer)+"</td>");u.push("</tr>")}u.push("</table>")}else if(3===o){var m=n-864e5*((s+6)%7),p=null,g=null,y=null,v=' style="width:'+100/c+'%;"';u.push("<tr>");for(var S=0;c>S;S++)y=d.days[S],p=new Date(m+(d.days[S].day+6)%7*864e5),g=d.days[S].day==s?' class="active"':"",u.push('<th d="'+d.days[S].day+'"'+g+v+">"+a.dayCN[d.days[S].day]+"<i></i></th>");u.push("</tr>"),u.push('<tr><td class="space" colspan="'+c+'"></td></tr>');for(var b=null,w=null,S=0;c>S;S++){if(y=d.days[S],u.push('<tr d="'+y.day+'"><td colspan="'+c+'">'),0==y.status)w=l(y.day,null,null,!0),u.push('<p class="'+w+'">休市</p>');else for(var T=0,k=d.timeBuckets?d.timeBuckets.length:0;k>T;T++)b=d.timeBuckets[T],b.course[S].lecturer&&(w=l(y.day,b.startTime,b.endTime,!1),u.push('<p class="'+w+'">'),u.push("<span>"+b.startTime+"-"+b.endTime+"</span>"),0==b.course[S].status?u.push("<span>休市</span>"):(u.push("<span>"+a.courseType[b.course[S].courseType]+"</span>"),u.push("<span>"+b.course[S].lecturer+"</span>"),u.push('<span class="item">'+b.course[S].title+"</span>")),u.push("</p>"));u.push("</td></tr>")}}}}catch(J){return console.error("formatSyllabus->"+J),""}return u.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},isHTTPS:function(){return/^https:\/\//.test(location.href)},copyObject:function(e,t,o){if(!t)return e;for(var i in e)t.hasOwnProperty(i)&&common.isValid(t[i])&&(e[i]=t[i]);if(o)for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])},isRightName:function(e){return!/^([0-9]{2,20})$/g.test(e)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(e)},randomIndex:function(e){var t=parseInt(Math.round(Math.random()*e));return t==e&&(t=e-1),0>t?0:t},saveToDesktop:function(e,t){try{var o=new ActiveXObject("WScript.Shell"),i=o.CreateShortcut(o.SpecialFolders("Desktop")+"\\"+t+".url");i.TargetPath=e,i.Save()}catch(r){return!1}return!0}};window.console||(console=function(){function e(){}function t(){return null==o&&(o=new e),o}var o=null;return e.prototype={log:function(e){},error:function(e){}},t()}()),$.fn.focusEnd=function(){$(this).focus();var e=$("<span/>").appendTo($(this)),t=e.get(0),o=null,i=null;return document.selection?(o=document.body.createTextRange(),o.moveToElementText(t),o.select()):window.getSelection&&(o=document.createRange(),o.selectNode(t),i=window.getSelection(),i.removeAllRanges(),i.addRange(o)),e.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var e=this,t=0;t<arguments.length;t++)e=e.replace(new RegExp("\\{"+t+"\\}","g"),null==arguments[t]||void 0==arguments[t]?"":arguments[t]);return e};var roomJS={initSewise:!1,web24kPath:"",filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,fromPlatform:null,serverTime:0,pushObj:{talkPush:[],talkPushInterval:null,whInfos:[]},msgType:{text:"text",img:"img",file:"file"},socket:null,socketUrl:"",userInfo:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.whTalk.initWH(),this.setSocket(),this.setEvent(),this.setVideoList(),studioMbPop.load(this.userInfo,this.fromPlatform,{onShow:function(){$("#tVideoDiv video").hide()},onHide:function(){$("#tVideoDiv video").show()}}),this.initRoom()},initRoom:function(){if(this.userInfo.nickname||this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12)),"visitor"==this.userInfo.clientGroup){var e=$("#currStudioInfo").attr("lgt"),t=$("#currStudioInfo").attr("spn");if(common.isValid(e)&&!isNaN(e))if(this.currStudioAuth)if(studioMbPop.Login.forceLogin())studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform,closeable:!1,showTip:!0,lgTime:e});else try{e=parseInt(e),window.setTimeout(function(){studioMbPop.Login.forceLogin(!0),studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform,closeable:!1,showTip:!0,lgTime:e})},60*e*1e3)}catch(o){console.error("set login Time has error",o)}else studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform,closeable:!1,lgTime:e});else common.isValid(t)&&(this.currStudioAuth?studioMbPop.Login.forceLogin()&&studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform,closeable:!1,showTip:!0,lgTime:null,spn:t}):studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform,closeable:!1,lgTime:null,spn:t}))}},refreshNickname:function(e,t){this.userInfo.isSetName=e,this.userInfo.nickname=t,$("#header_ui").text(t),studioMbPop.Person.refreshNickname(t)},serverTimeUp:function(){setInterval(function(){roomJS.serverTime+=1e3,roomJS.setPushInfo()},1e3)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var e="storeInfo_"+this.userInfo.groupType,t=store.get(e),o={};if(common.isBlank(t)){var i=common.randomNumber(6);o.clientStoreId=(new Date).getTime()+"_"+i,o.userId="visitor_"+i,o.nickname="游客_"+i,o.userType=-1,store.set(e,o),$(".collect-tip").fadeIn().delay(6e4).fadeOut()}else o=t;this.userInfo.clientStoreId=o.clientStoreId,this.userInfo.visitorId=o.userId,this.userInfo.loginId=o.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=o.nickname,this.userInfo.userId=o.userId,this.visitorSpeak||($("#contentText").attr("contenteditable",!1).append('<span style="margin:15px 5px;">亲，<a id="contentText_login" href="javascript:void(0);" style="text-decoration: underline;color:#3F51B5;cursor: pointer;">登录</a>&nbsp;&nbsp;后可以发言哦~</span>'),$("#contentText_login").click(function(){studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform})}))):(o.loginId=this.userInfo.userId,store.set(e,o)),this.isNeverLogin=!common.isValid(o.loginId)},setSocket:function(){studioMbPop.loadingBlock($("#talkBoxTab")),this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),roomJS.userInfo.socketId=roomJS.socket.id,roomJS.socket.emit("login",{userInfo:roomJS.userInfo,lastPublishTime:$("#dialog_list>li:last").attr("id"),fromPlatform:roomJS.fromPlatform,allowWhisper:roomJS.whTalk.enable},navigator.userAgent)}),this.socket.on("onlineUserList",function(e,t){if(roomJS.whTalk.enable){for(var o in e)3==e[o].userType&&roomJS.whTalk.setCSOnline(e[o].userId,!0);roomJS.whTalk.getCSList()}}),this.socket.on("disconnect",function(){console.log("disconnect")}),this.socket.on("error",function(e){console.error("e:"+e)}),this.socket.on("sendMsg",function(e){if(e.fromUser.toUser&&1==e.fromUser.toUser.talkStyle)roomJS.whTalk.receiveMsg(e,!1,!1);else{if(!e.serverSuccess&&roomJS.userInfo.userId==e.fromUser.userId&&!e.rule)return;roomJS.setContent(e,!1,!1)}}),this.socket.on("notice",function(e){switch(e.type){case"onlineNum":var t=e.data,o=t.onlineUserInfo;3==o.userType&&roomJS.whTalk.enable&&roomJS.whTalk.setCSOnline(o.userId,t.online);break;case"removeMsg":$("#"+e.data.replace(/,/g,",#")).remove(),roomJS.setListScroll($("#talkPanel"));break;case"leaveRoom":roomJS.leaveRoomTip(e.flag);break;case"approvalResult":var t=e.data,i=0;if(t.refuseMsg){var r=t.publishTimeArr;for(i in r)$("#"+r[i]+" .dialog em[class=ruleTipStyle]").html("已拒绝")}else{for(i in t)roomJS.formatUserToContent(t[i]);roomJS.setListScroll($("#talkPanel"))}break;case"pushInfo":var t=e.data;if(1==t.position)roomJS.pushObj.whInfos=t.infos;else if(3==t.position){roomJS.pushObj.talkPush=t.infos;for(var i=0,s=roomJS.pushObj.talkPush.length;s>i;i++)roomJS.pushObj.talkPush[i].nextTm=roomJS.pushObj.talkPush[i].serverTime+60*roomJS.pushObj.talkPush[i].onlineMin*1e3}break;case"serverTime":roomJS.serverTime=e.data}}),this.socket.on("loadMsg",function(e){var t=e.msgData,o=e.isAdd;if(o||$("#content_ul").html(""),t&&$.isArray(t)){t.reverse();for(var i in t)roomJS.formatUserToContent(t[i]);studioMbPop.loadingBlock($("#talkBoxTab"),!0),roomJS.setListScroll($("#talkPanel"),{toButtom:!0})}}),this.socket.on("loadWhMsg",function(e){var t=e.data;if(t&&$.isArray(t))for(var o,i=0,r=t.length;r>i;i++)o=t[i],roomJS.formatUserToContent(o,!0,e.toUserId);studioMbPop.loadingBlock($("#whTalkBoxTab"),!0)})},setVideoList:function(){studioMbPop.loadingBlock($("#videosTab")),this.getArticleList("teach_video_base,teach_video_gw,teach_video_expert,teach_video_financial",this.userInfo.groupId,0,1,100,'{"sequence":"desc","publishStartDate":"desc"}',null,function(e){var t=$("#videosTab .boxcont");if(t.html(""),e&&0==e.result){for(var o=e.data,i=[],r=null,s=0,n=o?o.length:0;n>s;s++)s%5==0&&i.push('<ul class="teach-ul">'),r=o[s].detailList[0],i.push('<li><a title="'+r.title+'" href="javascript:void(0)" id="'+o[s]._id+'" vUrl="'+o[s].mediaUrl+'"><i></i><span>'+r.title+"</span></a></li>"),(s%5==4||s==n-1)&&i.push("</ul>"),t.html(i.join(""));t.find("li a").click(function(){$(this).is(".on")||($("#videosTab .boxcont li a.on").removeClass("on"),$(this).addClass("on")),roomJS.video.play("studio","mp4",$(this).attr("vUrl"),$(this).text())})}roomJS.video.start(),studioMbPop.loadingBlock($("#videosTab"),!0)})},setEvent:function(){this.setEventCen(),this.video.init(),this.setEventChat(),this.setHeight(),this.browserState.initBrowserState()},setHeight:function(){$("#tVideoDiv").height(.55*$(".videopart").width());var e=0;e+=$(".videopart").height(),e+=$(".cen-ulist").is(":hidden")?0:$(".cen-ulist").height(),e+=$("#header").is(":hidden")?0:$("#header").height(),e=$(window).height()-e,$(".cen-pubox .boxcont:gt(1)").height(e),e-=$(".float-box").height(),$(".cen-pubox .boxcont:lt(2)").height(e)},setEventCen:function(){$(".cen-ulist li").click(function(){$(".cen-ulist li.on").removeClass("on"),$(this).addClass("on");var e=$(this).attr("t");"talkBoxTab"==e?(roomJS.view.boardCtrl(1),roomJS.whTalk.whSwitch(!1)):"whTalkBoxTab"==e?(roomJS.whTalk.whSwitch(!0),roomJS.view.boardCtrl(1)):(roomJS.whTalk.whSwitch(!1),roomJS.view.boardCtrl(0),"TradeArticleTab"==e&&roomJS.setTradeArticle()),$("#cenTabPanel").children().hide().eq($(this).index()).show()}),$("#header_hb").bind("click",function(){window.location.href="/hxstudio/home"}),$("#header_ui").bind("click",function(){roomJS.userInfo&&roomJS.userInfo.isLogin?studioMbPop.popBox("person"):studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform})}),$(window).resize(function(){roomJS.setHeight(),roomJS.setListScroll($(".mCustomScrollbar"))})},setEventChat:function(){$("#msgFaceBtn").bind("click",function(){$(this).blur(),2==roomJS.view.viewBoard?roomJS.view.boardCtrl(1):roomJS.view.boardCtrl(2),roomJS.face.init($("#facePanel"),$("#contentText"),roomJS.filePath+"/face/",!roomJS.visitorSpeak&&"visitor"==roomJS.userInfo.clientGroup)}),$("#talkBoxTab .view_select").click(function(){var e=$(this);e.is(".dw")?(e.removeClass("dw"),roomJS.view.viewSelect=!1):(e.addClass("dw"),roomJS.view.viewSelect=!0)}).find(".selectlist a").click(function(){if(!$(this).is(".on")){$("#talkBoxTab .view_select .selectlist a").removeClass("on"),$("#talkBoxTab .view_select .selected").text($(this).text()),$(this).addClass("on");var e=$(this).attr("t");roomJS.showViewSelect(e)}}),$(document).bind("click",function(e){if(roomJS.view.viewSelect){var t=$("#talkBoxTab .view_select");t.is(e.target)||0!=t.find(e.target).length||t.trigger("click")}if(roomJS.whTalk.viewSelect){var t=$("#whThtalkBoxTab .view_select");t.is(e.target)||0!=t.find(e.target).length||t.trigger("click")}}),$("#contentText").keydown(function(e){var t=$(this).html();return 13==e.keyCode?(common.isValid(t)&&($(this).html(t.replace(/<div>|<\/div>/g,"")),$("#sendBtn").click()),!1):void 0}).keyup(function(e){if($.browser.msie&&$(this).trigger("input"),8==e.keyCode){var t=$(this).find(".txt_dia");if($.trim($(this).text())==t.text()&&0==$(this).find("img").length)return t.remove(),$(this).html(""),!0}}).focus(function(){4==roomJS.view.viewBoard&&roomJS.view.boardCtrl(1)}).bind("input",function(){var e=$.trim($(this).text())!=$(this).find(".txt_dia").text()||$(this).find("img").size()>0;e?($("#sendBtn").show(),$("#sendToolBtn").hide(),$("#floatBox").removeClass("send-add")):($("#sendBtn").hide(),$("#sendToolBtn").show(),$("#floatBox").addClass("send-add"))}),$("#sendBtn").click(function(){if($(this).blur(),roomJS.view.boardCtrl(1),!roomJS.whTalk.tabCheck&&!roomJS.visitorSpeak&&"visitor"==roomJS.userInfo.clientGroup)return void studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform});if(roomJS.userInfo.isSetName===!1)return void studioMbPop.popBox("set",{studioChatObj:roomJS});var e=$('[isme="true"]').size(),t=$("#currStudioInfo").attr("spn");if(common.isValid(t)&&e==t&&!roomJS.userInfo.isLogin)return studioMbPop.Login.forceLogin(!0),void studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform,closeable:!1,showTip:!0,lgTime:null,spn:spn});roomJS.socket.connected||studioMbPop.showMessage("连接已断开");var o=roomJS.getToUser(),i=roomJS.getSendMsg();if(i!==!1){var r={uiId:roomJS.getUiId(),fromUser:roomJS.userInfo,content:{msgType:roomJS.msgType.text,value:i}};r.fromUser.toUser=o,roomJS.whTalk.tabCheck?roomJS.whTalk.sendWhMsg(r):(roomJS.socket.emit("sendMsg",r),roomJS.setContent(r,!0,!1)),$("#contentText").html("").trigger("input")}}),$("#sendToolBtn").click(function(){4==roomJS.view.viewBoard?roomJS.view.boardCtrl(1):roomJS.view.boardCtrl(4)}),$("#top_msg").click(function(){var e=$(this).find("label");$(this).slideUp(),roomJS.setDialog(e.attr("fuserId"),e.attr("fnickname"),0,e.attr("fuType"),null)}),$("#top_msg i").click(function(){return $("#top_msg").slideUp(),!1}),$(".file-img").click(function(){return FileReader?roomJS.whTalk.tabCheck||roomJS.visitorSpeak||"visitor"!=roomJS.userInfo.clientGroup?roomJS.userInfo.isSetName===!1?void studioMbPop.popBox("set",{studioChatObj:roomJS}):void 0:void studioMbPop.popBox("login",{groupId:roomJS.userInfo.groupId,clientGroup:roomJS.userInfo.clientGroup,clientStoreId:roomJS.userInfo.clientStoreId,platform:roomJS.fromPlatform}):void alert("发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！")}),$(".file-img").bind("change",function(){var e=this,t=e.files[0];if(!t)return!1;if(0!=t.type.indexOf("image")||!t.type||!/\.(?:jpg|png|gif)$/.test(t.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var o=t.size;if(o>=1048576)return alert("发送的图片大小不要超过1MB."),!1;var i=new FileReader;i.readAsDataURL(t),i.onload=function(e){roomJS.setUploadImg(e.target.result,roomJS.getToUser())},i.onprogress=function(e){},i.onloadend=function(e){},roomJS.view.boardCtrl(1),$(this).val("")})},setUploadImg:function(e,t){var o=roomJS.getUiId(),i={};common.copyObject(i,roomJS.userInfo,!0),i.toUser=t;var r={uiId:o,fromUser:i,content:{msgType:this.msgType.img,value:"",needMax:0,maxValue:""}};roomJS.whTalk.tabCheck?roomJS.whTalk.sendWhMsg(r):this.setContent(r,!0,!1),r.content.value=e,this.zipImg(r,100,60,function(e,t){if(e.error)return alert(e.error),$("#"+o).remove(),!1;var i=$("#"+e.uiId+" span[contt='a'] a");i.attr("href",t).children("img").attr("url",t).attr("needMax",e.content.needMax),roomJS.dataUpload(e)})},zipImg:function(e,t,o,i){var r=new Image;r.onload=function(){var s=document.createElement("canvas");s||i({error:"发送图片功能目前只支持Chrome、Firefox、IE10或以上版本的浏览器！"});var n=r.width,a=r.height;if(a>=9*n)return i({error:"该图片高度太高，暂不支持发送！"}),!1;t>0&&(a>t||n>t)&&(e.content.needMax=1,a>t&&t>=n?(n=t/a*n,a=t):(a=t/n*a,n=t),r.height=a,r.width=n);var l=s.getContext("2d");s.width=n,s.height=a,l.clearRect(0,0,s.width,s.height),l.drawImage(r,0,0,n,a),i(e,s.toDataURL("image/jpeg",o/100))},r.src=e.content.value},dataUpload:function(e){var t=new XMLHttpRequest;t.open("POST","/hxstudio/uploadData"),t.addEventListener("progress",function(t){if(t.lengthComputable){var o=(t.loaded/t.total*100|0)+"%";$("#"+e.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+e.uiId+" .shadow-conut").html(o)}},!1),t.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&console.log("dataUpload success!")},e.fromUser.socketId=this.socket.id,t.send(JSON.stringify(e))},view:{viewSelect:!1,viewBoard:1,boardCtrl:function(e){if(this.viewBoard!=e){this.viewBoard=e;var t={header:$("#header"),backToLive:$("#backToLive"),floatBox:$("#floatBox"),facePanel:$("#facePanel"),imgBox:$("#sendToolPanel")};switch(e){case 0:t.header.show(),t.backToLive.data("showBoard",!0).trigger("show"),t.floatBox.hide();break;case 1:t.header.show(),t.backToLive.data("showBoard",!0).trigger("show"),t.floatBox.show(),t.facePanel.hide(),t.imgBox.hide();break;case 2:t.header.hide(),t.backToLive.data("showBoard",!1).trigger("show"),t.floatBox.show(),t.facePanel.show(),t.imgBox.hide();break;case 3:t.header.show(),t.backToLive.data("showBoard",!1).trigger("show"),t.floatBox.show(),t.facePanel.hide(),t.imgBox.hide();break;case 4:t.header.hide(),t.backToLive.data("showBoard",!1).trigger("show"),t.floatBox.show(),t.facePanel.hide(),t.imgBox.show()}}}},video:{initPlayer:!1,playerType:"",videoType:"",studioType:"",videoUrl:"",videoTitle:"",liveUrl:"http://ct.phgsa.cn:1935/live/01/playlist.m3u8",$panel:null,init:function(){navigator.userAgent.match(/Android/i)||-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPod")||-1!=navigator.userAgent.indexOf("iPad")?this.playerType="video":this.playerType="swf";var e=$(".videopart input:first");e.attr("yc"),e.attr("mc");this.$panel=$("#tVideoDiv"),this.$panel.css({"z-index":"inherit"}),this.setEvent()},start:function(e){var t=common.getSyllabusPlan(roomJS.syllabusData,roomJS.serverTime,!1,!0);!t||t.isNext||0!=t.courseType&&common.isBlank(t.studioLink)||2==t.courseType||0==t.courseType?e?studioMbPop.showMessage("目前还没有视频直播，详情请留意直播间的课程安排！"):t&&!t.isNext&&0==t.courseType?($(".videopart").hide().css({height:"0"}),roomJS.setHeight()):this.playMp4Vd():this.play("yy","",t.studioLink,"")},playMp4Vd:function(){if($("#studioTeachId a[class=on]").length<=0){var e=$("#videosTab li a"),t=$(e.get(common.randomIndex(e.length)));t.click()}},play:function(e,t,o,i){this.videoUrl=o,this.videoTitle=i,this.stop(),this.studioType=e;var r=$("#backToLive");$(".videopart").is(":hidden")&&($(".videopart").show().css({height:"auto"}),roomJS.setHeight());var s;if("studio"==e?(s=this.$panel.children("div[t=2]"),r.data("showVideo",!0).trigger("show")):(s=this.$panel.children("div[t=1]"),$("#videosTab li a.on").removeClass("on"),r.data("showVideo",!1).trigger("show")),s.show(),"video"==this.playerType)if(this.initPlayer){var n=s.find("video");n[0].pause(),n.attr("src",o),n[0].play()}else{var a=$("body").attr("fp"),l="webui"!=a&&"app"!=a;s.append('<video src="'+o+'" controls="true" autoplay="'+l+'" style="width: 100%; height: 100%; background-color: rgb(0, 0, 0);"></video>'),l||s.find("video").trigger("pause"),this.initPlayer=!0,this.setEventAd()}else if("studio"==e)if(this.initPlayer&&window.SewisePlayer)SewisePlayer.toPlay(o,i,0,!0),this.videoType=t;else{var u=[];u.push("/base/lib/sewise.player.min.js?server=vod"),u.push("type="+t),u.push("videourl="+o),u.push("autostart=true"),u.push("logo="),u.push("title="+i),u.push("buffer=5");var d=u.join("&"),c=document.createElement("script");c.type="text/javascript",c.src=d,this.initPlayer=!0,this.videoType=t,s.get(0).appendChild(c),this.setEventAd()}else{if(-1!=o.indexOf("rtmp")){var h=/(.*)\/([0-9]+)$/g.exec(o);if(!h||h.length<3)return;flowplayer(s[0],"/base/lib/flowplayer/flowplayer.swf",{clip:{url:h[2],provider:"rtmp",live:!0},plugins:{rtmp:{proxyType:"best",url:"/base/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:"rtmps://5748416443938.streamlock.net/live"}},onError:function(e){}})}else s.html('<embed src="'+o+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>');this.initPlayer=!0,this.videoType=t}},stop:function(){var e="studio"==this.studioType?this.$panel.children("div[t=2]"):this.$panel.children("div[t=1]");"video"==this.playerType?e.find("video").trigger("pause"):"studio"==this.studioType&&window.SewisePlayer?SewisePlayer.doStop():e.empty(),e.hide(),$(".ctrlblock").hide(),$("#videoPop").show(),$("#videoPopPlay").hide()},setEvent:function(){$(".ctrlblock div.replay a").bind("click",function(){var e=$("#videosTab li a.on");e.trigger("click")}),$(".ctrlblock div.nextbtn a").bind("click",function(){for(var e=$("#videosTab li a"),t=0,o=e.size();o>t;t++)if(e.eq(t).is(".on")){e.eq(o-1>t?t+1:0).trigger("click");break}}),$("#backToLive").css({left:function(){return $(window).width()-$(this).width()-10},top:function(){return $(window).height()-$("#header").height()-70}}).data("showBoard",!0).data("showVideo",!0).bind("show",function(){var e=$(this);e.data("showBoard")&&e.data("showVideo")?e.show():e.hide()}),$("#backToLive").draggable({start:function(){$(this).addClass("blue")},stop:function(){$(this).removeClass("blue")}}),$("#backToLive").bind("click",function(){roomJS.socket.emit("serverTime"),window.setTimeout(function(){roomJS.video.start(!0)},1e3)}),$("#videoPop").bind("click",function(){roomJS.video.popVideoWindow(),$("#videoPopPlay").show(),$(this).hide()}),$("#videoPopPlay").bind("click",function(){roomJS.video.play(roomJS.video.studioType,roomJS.video.videoType,roomJS.video.videoUrl,roomJS.video.videoTitle)})},setEventAd:function(){if("sewise"==this.playerType){
var e=function(){return window.SewisePlayer?(SewisePlayer.onPause(function(){"studio"==roomJS.video.studioType&&window.setTimeout(function(){SewisePlayer.duration()<=SewisePlayer.playTime()&&$(".ctrlblock").show()},1e3)}),void SewisePlayer.onStart(function(){$(".ctrlblock").hide()})):void window.setTimeout(e,500)};e()}else if("video"==this.playerType){var t=this.$panel.find("video");t.bind("ended",function(){"studio"==roomJS.video.studioType&&$(".ctrlblock").show()}).bind("loadstart",function(){$(".ctrlblock").hide()})}},popVideoWindow:function(){this.stop();var e="playerType="+this.playerType+"&studioType="+this.studioType+"&videoType="+this.videoType+"&url="+this.videoUrl+"&title="+this.videoTitle;window.open("/studio/gotoVideo?"+e,"studioVideoWindow","height=600,width=800,top=0,right=0,toolbar=no,menubar=no,scrollbars=no,location=no,status=no")}},face:{initFace:!1,init:function(e,t,o,i){this.initFace||(this.build(e,o),new Swiper(e,{pagination:".swiper-pagination",paginationClickable:!0}),e.find("img").bind("click",{panel:e,assign:t,disabled:i},function(e){e.data.disabled||e.data.assign.append($(this).clone()).trigger("input")}),this.initFace=!0)},build:function(e,t){for(var o=[],i=7,r=1;75>=r;r+=21){o.push('<div class="swiper-slide"><table border="0" cellspacing="0" cellpadding="0">');for(var s=r,n=Math.min(r+20,75);n>=s;s++)s%i==1&&o.push("<tr>"),o.push('<td><img src="'+t+s+'.gif"/></td>'),(s%i==0||s==n)&&o.push("</tr>");o.push("</table></div>")}e.find("div.face").html(o.join(""))}},setListScroll:function(e,t){var o="object"==typeof e?e:$(e);t=$.extend({scrollButtons:{enable:!1},theme:"dark-2",toButtom:!1},t),o.hasClass("mCustomScrollbar")?(o.mCustomScrollbar("update"),t.toButtom&&o.mCustomScrollbar("scrollTo","bottom")):(o.mCustomScrollbar(t),t.toButtom&&o.mCustomScrollbar("scrollTo","bottom"))},getUiId:function(){var e=new Date;return e.getTime()+"_ms"},getArticleList:function(e,t,o,i,r,s,n,a){try{var l={code:e,platform:t,hasContent:o,pageNo:i,pageSize:r,orderByStr:s};n&&(l.authorId=common.trim(n)),$.getJSON("/hxstudio/getArticleList",l,function(e){a(e)})}catch(u){console.error("getArticleList->"+u),a(null)}},setTradeArticle:function(){studioMbPop.loadingBlock($("#TradeArticleTab")),roomJS.getArticleList("trade_strategy_article",roomJS.userInfo.groupId,1,1,1,'{"createDate":"desc"}',null,function(e){var t=$("#TradeArticleTab ul:first"),o=[];if(e&&0==e.result){var i=e.data;if(i&&i.length>0)for(var r=null,s=null,n=0,a=i.length;a>n;n++)r=i[n].detailList[0],s=r.authorInfo||{},o.push("<li>"),o.push('<div class="himg"><img src="'+(s.avatar||"")+'"></div>'),o.push('<div class="detail">'),o.push("<h3>"+r.title+"</h3>"),o.push('<div class="subinfo">'),o.push("<span>"+(s.name||"")+"</span>"),o.push("<span>"+(i[n].publishStartDate?common.longMsTimeToDateTime(i[n].publishStartDate):"")+"</span>"),o.push("</div>"),o.push("<p>"+r.content+"</p>"),o.push("</div>")}t.html(o.join("")),$("#TradeArticleTab .detail p span").attr("style",""),studioMbPop.loadingBlock($("#TradeArticleTab"),!0)})},showViewSelect:function(e){var t=$("#dialog_list");"analyst"==e?(t.children("[utype!=2]").hide(),t.children("[utype=2]").show()):"me"==e?(t.children("[isme='false']").hide(),t.children("[isme='true']").show()):t.children().show(),roomJS.setListScroll($("#talkPanel"),{toButtom:!0})},getSendMsg:function(e){if(e=e||$("#contentText"),e.text().length+e.find("img").size()>140)return studioMbPop.showMessage("消息内容超过最大长度限制（140字以内）！"),!1;var t=e.html();return t=common.clearMsgHtml(t),common.isBlank(t)?(e.html(""),!1):(e.find(".txt_dia").length>0&&(e.find(".txt_dia").remove(),t=e.html(),t=t.replace(/^(&nbsp;){1,2}/,"")),t)},getToUser:function(){var e=$("#contentText .txt_dia");return e.length>0?{userId:e.attr("uid"),nickname:e.find("label").text(),talkStyle:0,userType:e.attr("utype"),avatar:e.attr("avatar")}:null},formatPublishTime:function(e){return common.isBlank(e)?"":common.getHHMM(Number(e.replace(/_.+/g,"")))},setDialog:function(e,t,o,i,r){(roomJS.visitorSpeak||"visitor"!=roomJS.userInfo.clientGroup)&&($("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e+'" utype="'+i+'" avatar="'+r+'">@<label>'+t+"</label></span>&nbsp;").focusEnd())},setContent:function(e,t,o){var i=e.fromUser;if(t&&(i.publishTime=e.uiId),e.isVisitor)return void $("#"+e.uiId).remove();if(o&&$("#"+i.publishTime).length>0)return $("#"+i.publishTime+" .dialog em[class=ruleTipStyle]").remove(),void $("#"+i.publishTime+" input").remove();if(e.rule)return void(e.value&&e.value.needApproval?$("#"+e.uiId).attr("id",i.publishTime):(roomJS.removeLoadDom(e.uiId),$("#"+e.uiId+" .dialog").append('<em class="ruleTipStyle">'+e.value.tip+"</em>")));if(t||roomJS.userInfo.userId!=i.userId||!e.serverSuccess){var r=roomJS.formatContentHtml(e,t,o,!1),s=$("#dialog_list");$("#talkPanel");s.append(r),o||roomJS.setListScroll($("#talkPanel"),{toButtom:!0}),this.formatMsgToLink(i.publishTime);var n=$("#talkBoxTab .view_select .selectlist a[class=on]").attr("t");"all"!=n&&roomJS.showViewSelect(n),$("#"+i.publishTime+" .c-menu a").click(function(){var e=$(this).parents(".c-menu");roomJS.setDialog(e.attr("uid"),e.attr("nk"),$(this).attr("t"),e.attr("utype"))}),$("#"+i.publishTime+" .headimg").click(function(){$("#"+i.publishTime+" .c-menu a[t=0]").trigger("click")}),$("#"+i.publishTime+" .txt_dia").click(function(){roomJS.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+i.publishTime+" .uname").click(function(){$("#"+i.publishTime+" .c-menu a[t=0]").trigger("click")})}else if($("#"+e.uiId+" .uname span").html(roomJS.formatPublishTime(i.publishTime)),$("#"+e.uiId).attr("id",i.publishTime),e.content.msgType==roomJS.msgType.img){roomJS.removeLoadDom(i.publishTime);var a=$("#"+i.publishTime+' span[contt="a"]>a'),l=e.content.needMax?"/hxstudio/getBigImg?publishTime="+i.publishTime+"&userId="+i.userId:a.children("img").attr("src");a.attr("url",l)}},formatContentHtml:function(e,t,o,i){var r,s="clearfix ",n="",a="false",l="",u=e.fromUser,d=e.content,c=u.nickname,h=u.toUser,m=[],p="";roomJS.userInfo.userId==u.userId&&t&&(u.publishTime=e.uiId,p='<em class="img-loading"></em><span class="shadow-box"></span><s class="shadow-conut"></s>'),d.msgType==roomJS.msgType.img?(r=d.needMax?'<a href="javascript:void(0)" onclick="roomJS.showImgInWindow(this)" url="/hxstudio/getBigImg?publishTime='+u.publishTime+"&userId="+u.userId+'"><img src="'+d.value+'" alt="图片"/></a>':'<a href="javascript:void(0)" onclick="roomJS.showImgInWindow(this)" url="'+d.value+'"><img src="'+d.value+'" alt="图片" /></a>',r='<span contt="a">'+r+"</span>"+p):r='<span contt="a">'+d.value+"</span>",h&&common.isValid(h.userId)?(i?m.push(r):common.isValid(h.question)?(m.push('<p class="question"><em>'),m.push('<strong class="asker" uid="'+h.userId+'" utype="'+h.userType+'">'+h.nickname+"</strong>"),m.push("提问：</em>"),m.push('<span contt="q">'+h.question+"</span>"),m.push("</p>"),m.push('<p class="reply"><span>回复：</span>'),m.push(r),m.push("</p>")):(m.push('<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">'),m.push("@<label>"+h.nickname+"</label>"),m.push("</span>"),m.push(r)),roomJS.userInfo.userId==h.userId&&(a="true")):m.push(r),roomJS.userInfo.userId==u.userId?(s+="me-li",c="我",a="true",i&&h&&(l=" csid="+h.userId)):(3==u.userType?(c+="&nbsp;（助理）",s+="admin"):2==u.userType?s+="analyst":1==u.userType&&(s+="admin"),i&&(l=" csid="+u.userId),n=i?"":roomJS.getDialogHtml(u.userId,c,u.userType),!o&&h&&(roomJS.userInfo.userId!=h.userId||i||($("#top_msg label").html(u.nickname+":@"+h.nickname).attr("tId",h.userId).attr("fuType",u.userType).attr("fnickname",u.nickname).attr("fuserId",u.userId),$("#top_msg span").html(d.value),$("#top_msg").slideDown())));var f=[];return f.push('<li class="'+s+'" id="'+u.publishTime+'" isme="'+a+'" utype="'+u.userType+'" mType="'+d.msgType+'" t="header"'+l+">"),f.push('<div class="headimg" uid="'+u.userId+'">'),f.push(roomJS.getUserAImgCls(u.userId,u.clientGroup,u.userType,u.avatar)),f.push("</div>"),f.push('<div class="detail">'),f.push('<span class="uname">'),roomJS.userInfo.userId==u.userId?(f.push("<span>"+roomJS.formatPublishTime(u.publishTime)+"</span>"),f.push("<strong>"+c+"</strong>")):(f.push("<strong>"+c+"</strong>"),f.push("<span>"+roomJS.formatPublishTime(u.publishTime)+"</span>")),f.push("</span>"),f.push('<div class="dialog">'+m.join("")+"</div>"),f.push("</div>"),f.push(n),f.push("</li>"),f.join("")},showImgInWindow:function(e){var t=$(e).attr("url");t&&window.open(t,"studioImgWindow","top=0,right=0,toolbar=no,menubar=no,scrollbars=no,location=no,status=no")},formatMsgToLink:function(e){$("#"+e+' span[contt]:contains("http:"),#'+e+' span[contt]:contains("https:")').each(function(e,t){var o,i=$(t).html(),r=i.split(/<img[^>]*>|<a[^>]*>.*?<\/a>/g);for(var s in r)if(o=r[s],!common.isBlank(o)){var n=o.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"});t.innerHTML=t.innerHTML.replace(o,n)}})},removeLoadDom:function(e){$("#"+e+" .img-loading,#"+e+" .img-load-gan,#"+e+" .shadow-box,#"+e+" .shadow-conut").remove()},getUserAImgCls:function(e,t,o,i){var r="";if(common.isValid(i))return'<img src="'+i+'">';if("vip"==t)r="user_v";else{if("active"==t){var s=0;return e&&e.length>0&&(s+=e.charCodeAt(0)+e.charCodeAt(e.length-1)),s=(s+15)%45,'<img src="'+roomJS.filePath+"/upload/pic/header/chat/visitor/"+s+'.png">'}if("notActive"==t)r="user_r";else if("simulate"==t)r="user_d";else if("register"==t)r="user_m";else{if("visitor"==t||-1==o){e=e||"";var s=parseInt(e.substring(e.length-2),10);return isNaN(s)&&(s=100),s=(s+17)%45,'<img src="'+roomJS.filePath+"/upload/pic/header/chat/visitor/"+s+'.png">'}r="cm"}}return'<img src="/hx/theme4/img/'+r+'.png">'},leaveRoomTip:function(e){if("roomClose"==e)studioMbPop.showMessage("注意：房间已停用，正自动登出..."),"visitor"==roomJS.userInfo.clientGroup?window.setTimeout(function(){studioMbPop.reload()},2e3):window.setTimeout(function(){LoginAuto.setAutoLogin(!1),window.location.href="/hxstudio/logout?platform="+roomJS.fromPlatform},2e3);else if("otherLogin"==e){if("visitor"==roomJS.userInfo.clientGroup)return;roomJS.socket.disconnect(),studioMbPop.popBox("msg",{msg:"由于您打开了多个直播室页面，造成重复登录，下线后请重新登录",type:"logout"})}},getDialogHtml:function(e,t,o){if(roomJS.userInfo.userId!=e){var i=!1,r=$("#studioListId a[class~=ing]"),s='<div class="c-menu" style="display:none;" nk="'+t+'" uid="'+e+'" utype="'+o+'">';return s+="<ul>",(roomJS.visitorSpeak||-1==roomJS.userInfo.userId.indexOf("visitor_")&&e&&-1==e.indexOf("visitor_"))&&(s+='<li><a href="javascript:void(0)" t="0"><i></i>@TA</a></li>',i=!0),"true"==r.attr("aw")&&common.containSplitStr(r.attr("awr"),o)&&(s+='<li><a href="javascript:void(0)" t="1"><i></i>私信</a></li>',i=!0),s+="</ul>",i?s+"</div>":""}return""},formatUserToContent:function(e,t,o){var i={userId:e.userId,nickname:e.nickname,avatar:e.avatar,userType:e.userType,groupId:e.groupId,clientGroup:e.clientGroup,publishTime:e.publishTime,toUser:e.toUser,position:e.position};t?(i.toWhUserId=o,roomJS.whTalk.receiveMsg({fromUser:i,content:e.content},!1,!0)):roomJS.setContent({fromUser:i,content:e.content},!1,!0)},talkBoxPush:{initTBP:function(e){this.clear(),roomJS.pushObj.talkPush=e,this.start()},clear:function(){roomJS.pushObj.talkPushInterval&&(window.clearInterval(roomJS.pushObj.talkPushInterval),roomJS.pushObj.talkPushInterval=null);for(var e=roomJS.pushObj.talkPush,t=null,o=0,i=e.length;i>o;o++)t=e[o],t.timeoutId&&window.clearTimeout(t.timeoutId),t.intervalId&&window.clearInterval(t.intervalId)},start:function(){var e=roomJS.pushObj.talkPush;e&&e.length>0&&window.setInterval(function(){roomJS.talkBoxPush.check()},1e4)},check:function(){for(var e=roomJS.pushObj.talkPush,t=null,o=0,i=e.length;i>o;o++)t=e[o],t.startFlag||common.dateTimeWeekCheck(t.pushDate,!1,roomJS.serverTime)&&(t.startFlag=!0,window.setTimeout(roomJS.talkBoxPush.delayStartTask(t),60*(t.onlineMin||0)*1e3))},delayStartTask:function(e){return function(){roomJS.talkBoxPush.showMsg(e),e.intervalMin&&e.intervalMin>0&&(e.intervalId=window.setInterval(roomJS.talkBoxPush.startTask(e),60*e.intervalMin*1e3))}},startTask:function(e){return function(){common.dateTimeWeekCheck(e.pushDate,!1,roomJS.serverTime)?roomJS.talkBoxPush.showMsg(e):(window.clearInterval(e.intervalId),e.startFlag=!1)}},showMsg:function(e){var t=[];if(t.push('<li class="clearfix push">'),e.content.indexOf("img")>-1){var o=$(e.content).find("img").attr("src");t.push('<a href="javascript:void(0)" onclick="roomJS.showImgInWindow(this)" url="'+o+'">'),t.push('<p><img src="'+o+'" style="width:100%;height:auto;" /></p>'),t.push("</a>")}else t.push(e.content);t.push("</div>");$("#talkPanel");$("#dialog_list").append(t.join(""));var i=$("#dialog_list").find(".dialog.push img");i.length>0&&(i.width("100%"),i.height("auto")),roomJS.setListScroll($("#talkPanel"),{toButtom:!0})}},browserState:{hiddenProperty:"hidden",visibilityStateProperty:"visibilityState",visibilityEvent:"visibilitychange",getBrowserPrefix:function(){if("hidden"in document)return null;for(var e=["moz","ms","o","webkit"],t=0;t<e.length;t++){var o=e[t]+"Hidden";if(o in document)return e[t]}return null},initBrowserState:function(){var e=this.getBrowserPrefix();e?(this.hiddenProperty=e+"Hidden",this.visibilityStateProperty=e+"VisibilityState",this.visibilityEvent=e+"visibilitychange"):(this.hiddenProperty="hidden",this.visibilityStateProperty="visibilityState",this.visibilityEvent="visibilitychange"),this.setBrowserStateEvent()},setBrowserStateEvent:function(){document.addEventListener(this.visibilityEvent,function(){"visible"===document[roomJS.browserState.visibilityStateProperty]&&roomJS.socket.emit("serverTime")})}},whTalk:{enable:!1,status:0,tabCheck:!1,CSMap:{},currCS:null,msgCnt:0,pushObj:null,askMsgObj:null,viewSelect:!1,initWH:function(){this.enable="true"==$("#currStudioInfo").attr("aw"),this.refreshTips(),$("#whTalkBoxTab .view_select").click(function(){var e=$(this);e.is(".dw")?(e.removeClass("dw"),roomJS.whTalk.viewSelect=!1):(e.addClass("dw"),roomJS.whTalk.viewSelect=!0)}).find(".selectlist a").live("click",function(){if(!$(this).is(".on")){var e=$(this).attr("uid");roomJS.whTalk.setCurrCS({userId:e})}})},whSwitch:function(e){e?(this.tabCheck=!0,this.msgCnt=0,this.refreshTips(),this.setWHTalkListScroll(),this.pushMsg()):this.tabCheck=!1},loadMsg:function(e){if(this.CSMap.hasOwnProperty(e)&&!this.CSMap[e].load){var t=this.CSMap[e];t.load=!0,studioMbPop.loadingBlock($("#whTalkBoxTab")),roomJS.socket.emit("getWhMsg",{clientStoreId:roomJS.userInfo.clientStoreId,userType:roomJS.userInfo.userType,groupId:roomJS.userInfo.groupId,groupType:roomJS.userInfo.groupType,userId:roomJS.userInfo.userId,toUser:{userId:t.userNo,userType:t.userType}})}},setCurrCS:function(e){var t=null;if(e&&e.userId)this.CSMap.hasOwnProperty(e.userId)?t=this.CSMap[e.userId]:(t={userNo:e.userId,userName:e.userName||e.nickname,online:!0,load:!1,userType:e.userType,avatar:e.avatar},this.CSMap[e.userId]=t);else{var o=null;for(var i in this.CSMap)o=this.CSMap[i],(!t||3!=t.userType&&3==o.userType||t.userType==o.userType&&!t.online&&o.online)&&(t=o)}if(!t)return null;if(t.load||this.loadMsg(t.userNo),t.userNo){this.currCS=t;var r=$("#whTalkBoxTab .view_select"),s=r.find("a[uid="+this.currCS.userNo+"]");return r.find(".selectlist a").removeClass("on"),0==s.size()?(r.find(".selectlist").append('<a href="javascript:void(0)" class="on" uid="'+this.currCS.userNo+'">'+this.currCS.userName+"</a>"),r.find(".selected").text(this.currCS.userName)):(s.addClass("on"),r.find(".selected").text(s.text())),r.find(".selectlist a").size()<=1?r.hide():(r.show(),$("#whDialog_list").children().hide(),$("#whDialog_list").children("[csid="+this.currCS.userNo+"]").show(),this.setWHTalkListScroll()),t}return null},getCSList:function(){try{$.getJSON("/hxstudio/getCS",{groupId:roomJS.userInfo.groupId},function(e){if(e&&e.length>0)for(var t,o,i=0,r=e.length;r>i;i++)t=e[i],roomJS.whTalk.CSMap.hasOwnProperty(t.userNo)?o=roomJS.whTalk.CSMap[t.userNo]:(o={online:!1},roomJS.whTalk.CSMap[t.userNo]=o),o.userNo=t.userNo,o.userName=t.userName,o.userType=3,o.avatar=common.isValid(t.avatar)?t.avatar:"/hx/theme4/img/cm.png",o.load=!1})}catch(e){console.error("getCSList->"+e)}},setCSOnline:function(e,t){var o=null;this.CSMap.hasOwnProperty(e)?o=this.CSMap[e]:(o={},this.CSMap[e]=o),o.online=t},refreshTips:function(){roomJS.whTalk.msgCnt>0?$(".wh_tips").text(roomJS.whTalk.msgCnt).show():$(".wh_tips").hide()},setWHTalkListScroll:function(){roomJS.setListScroll($("#whTalkPanel"),{toButtom:!0})},receiveMsg:function(e,t,o){var i=e.fromUser;if(t&&(i.publishTime=e.uiId),e.isVisitor)return void $("#"+e.uiId).remove();if(o&&$("#"+i.publishTime).length>0)return $("#"+i.publishTime+" .dialog em.ruleTipStyle").remove(),void $("#"+i.publishTime+" input").remove();if(e.rule)return void(e.value&&e.value.needApproval?$("#"+e.uiId).attr("id",i.publishTime):$("#"+e.uiId+" .dialog").append('<em class="ruleTipStyle">'+e.value.tip+"</em>"));if(t||roomJS.userInfo.userId!=i.userId||!e.serverSuccess){var r=roomJS.formatContentHtml(e,t,o,!0);$("#whTalkPanel");if(o?$("#whDialog_list").prepend(r):$("#whDialog_list").append(r),this.tabCheck&&roomJS.whTalk.setWHTalkListScroll(),roomJS.formatMsgToLink(i.publishTime),roomJS.userInfo.userId!=i.userId&&$("#"+i.publishTime+" .uname,#"+i.publishTime+" .headimg").click(function(){var e=$(this).parents("li:first"),t={userId:e.find(".headimg").attr("uid"),nickname:e.find(".uname strong").text(),userType:e.attr("utype"),avatar:e.find(".headimg img").attr("src")};roomJS.whTalk.setCurrCS(t)}),this.tabCheck||o||(roomJS.whTalk.msgCnt++,this.refreshTips()),o||roomJS.userInfo.userId==i.userId||this.setCurrCS(i),o||(this.askMsgObj=null),o&&i.toUser&&common.isValid(i.toUser.question)){var s=this.setCurrCS({userId:i.toUser.userId});this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:i.toUser.question},fromUser:{nickname:s.userName,userId:s.userNo,userType:s.userType,avatar:s.avatar,publishTime:i.toUser.publishTime}},!1,!0)}}else if($("#"+e.uiId+" .uname span").html(roomJS.formatPublishTime(i.publishTime)),$("#"+e.uiId).attr("id",i.publishTime),e.content.msgType==roomJS.msgType.img){roomJS.removeLoadDom(i.publishTime);var n=$("#"+i.publishTime+' span[contt="a"]>a'),a=e.content.needMax?"/hxstudio/getBigImg?publishTime="+i.publishTime+"&userId="+i.userId:n.children("img").attr("src");n.attr("url",a)}},pushMsg:function(){this.currCS||this.setCurrCS(),this.pushObj&&this.currCS&&(this.receiveMsg({content:{maxValue:"",msgType:"text",status:1,value:this.pushObj.info},fromUser:{nickname:this.currCS.userName,userId:this.currCS.userNo,userType:this.currCS.userType,avatar:this.currCS.avatar,publishTime:this.pushObj.publishTime}},!1,!1),this.askMsgObj=this.pushObj,this.pushObj=null)},sendWhMsg:function(e){return this.currCS||this.setCurrCS(),this.currCS?(e.fromUser.toUser={userId:this.currCS.userNo,nickname:this.currCS.nickname,talkStyle:1,userType:this.currCS.userType},this.askMsgObj&&(e.fromUser.toUser.question=this.askMsgObj.info,e.fromUser.toUser.questionId=this.askMsgObj.infoId,e.fromUser.toUser.publishTime=this.askMsgObj.publishTime),roomJS.whTalk.receiveMsg(e,!0,!1),void(e.content.msgType!=roomJS.msgType.img&&roomJS.socket.emit("sendMsg",e))):void studioMbPop.showMessage("客服不在线，暂不可私聊！")}},disableVideoSocket:function(){window.setInterval(function(){$("#tVideoDiv").empty(),roomJS.socket.disconnect()},5e3)},setPushInfo:function(){var e=null,t=roomJS.pushObj.whInfos;if(t&&t.length>0)for(var o=0,i=t.length;i>o;o++)e=t[o],e.pushed||e&&roomJS.serverTime>=e.serverTime+60*e.timeOut*1e3&&(e.pushed=!0,roomJS.whTalk.pushObj={info:e.content,publishTime:e.publishTime,infoId:e.contentId},roomJS.whTalk.pushMsg());var r=null,s=roomJS.pushObj.talkPush;if(s&&s.length>0)for(var o=0,n=s.length;n>o;o++)r=s[o],r&&r.nextTm&&roomJS.serverTime>=r.nextTm&&common.dateTimeWeekCheck(r.pushDate,!1,roomJS.serverTime)&&(r.intervalMin&&r.intervalMin>0?r.nextTm=roomJS.serverTime+60*r.intervalMin*1e3:delete r.nextTm,roomJS.talkBoxPush.showMsg(r))}};