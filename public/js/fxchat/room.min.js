var room={kpSocket:null,maxRows:50,msgType:{text:"text",img:"img",file:"file"},imgDB:{},isCanReSend:!0,socket:null,socketUrl:"",userInfo:null,verifyCodeIntervalId:"",init:function(){room.wrapAdjust(!0),this.setUserInfo(),this.setSocket(),this.setEvent(),this.createImgDB(),this.setAdvertisement()},getUserAvatar:function(t,e){return common.isValid(t)?t:e&&0!=e?"/images/fxchat/def_b_user.png":"/images/fxchat/user.jpg"},setUserInfo:function(){$(".user-name").html(room.userInfo.nickname),$(".user-img img").attr("src",this.getUserAvatar(room.userInfo.avatar,room.userInfo.userType))},getArticleList:function(t,e,o,n,i,r,s){try{$.getJSON("/fxchat/getArticleList",{code:t,platform:e,hasContent:o,pageNo:n,pageSize:i,orderByStr:r},function(t){s(t)})}catch(a){console.error("getArticleList->"+a),s(null)}},setAdvertisement:function(){this.getArticleList("advertisement","fxchat_room","0",1,1,"",function(t){if(0==t.result){var e=t.data;e&&e[0]&&(common.isValid(e[0].linkUrl)&&$("#room_advertisement a").attr("href",e[0].linkUrl),$("#room_advertisement img").attr("src",e[0].mediaUrl),$("#room_advertisement").show(),room.wrapAdjust(!0))}})},createImgDB:function(){try{room.imgDB=openDatabase("imgDB","1.0","imgDB",15728640),room.imgDB.transaction(function(t){t.executeSql("create table if not exists bigImg (id unique, data)",[],function(){room.clearImgTable()})})}catch(t){room.isCanReSend=!1}},deleteImgDataById:function(t){room.imgDB.transaction(function(e){e.executeSql("delete from bigImg where id=?",[t])})},clearImgTable:function(){room.imgDB.transaction(function(t){t.executeSql("delete from bigImg")})},getImgDataById:function(t,e){try{room.imgDB.transaction(function(o){o.executeSql("select * from bigImg where id=?",[t],function(t,o){e(o.rows.item(0).data)},null)})}catch(o){console.error("getImgDataById has error:"+o)}},insertImgDBData:function(t){try{room.imgDB.transaction(function(e){e.executeSql("insert into bigImg (id, data) values (?, ?)",[t.id,t.data])})}catch(e){console.error("insertImgDBData has error:"+e)}},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},setPrice:function(t,e,o,n){try{t?getAllMarketpriceIndex("ws://kdata.gwfx.com:8087/websocket.do","service=HqDataWebSocketService&method=pushMarketprice&symbol=USDX|EURUSD|USDJPY|XAUUSD&dataType=simpleMarketPrice","http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getMarkrtPriceDataFromCache"):ChartFactory.create(n,{url:"http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getKDataFromCache",data:{symbol:e,dataType:o}},$("#kchatLayer .loading-box"))}catch(i){console.error("setPrice->"+i)}},wrapAdjust:function(t){$(".wrapper").css("top",$("#header").height()),t&&($(".hq-btn").css({left:function(){return $(window).width()-$(this).width()-5},top:function(){return $("#header").height()+7}}),$(".kf-btn").css({left:function(){return $(window).width()-$(this).width()-5},top:function(){return $("#header").height()+52}}))},setEvent:function(){$("#loginForm input[name=mobilePhone]")[0].addEventListener("input",function(t){var e=$(this).parents("form").find(".rbtn");common.isMobilePhone(this.value)?e.attr("disabled",!1):e.attr("disabled",!0)},!1),$("#loginForm .rbtn").click(function(){if($(".wrong-info").html(""),!$(this).is(":disabled")){$(this).attr("disabled",!0);var t=$("#loginForm input[name=mobilePhone]").val(),e=$(this).attr("ut");try{room.setVerifyCodeTime("#loginForm .rbtn"),$.getJSON("/fxchat/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:t,useType:e},function(t){t&&0==t.result||("1005"==t.errcode?alert(t.errmsg):console.error("提取数据有误！"),room.setVerifyCodeTime("#loginForm .rbtn",!0))})}catch(o){room.setVerifyCodeTime("#loginForm .rbtn",!0),console.error("setMobileVerifyCode->"+o)}}}),$(".date-box .hide-btn").click(function(){$(".date-box").hide(),$(".hq-btn").show(),room.wrapAdjust()}),$("#product_price_ul li").click(function(){$("#kchatLayer").attr("symbol",$(this).attr("name")).show().find(".lay-tt").text($(this).find("h2").text()),$("#kchat_ul li:first").click()}),$("#kchatLayer .del-btn").click(function(){$("#kchatLayer").attr("symbol","").hide().find(".lay-tt").text(""),$(".layer-shadow").hide()}),$("#kchat_ul li").click(function(){$("#kchat_ul li").removeClass("on"),$(this).addClass("on"),$(".date-chart").hide();var t=$(".date-chart").eq($(this).index());t.show(),$(".layer-shadow").show(),room.setPrice(!1,$("#kchatLayer").attr("symbol"),$(this).attr("t"),t)}),function(){util.rangeControl=function(t,e){return t=Math.max(t,0),Math.min(t,e)};var t,e;util.toucher($(".hq-btn")[0]).on("singleTap",function(t){"1"!=$(this).attr("set_p")&&room.setPrice(!0),$(this).attr("set_p","1"),$(".date-box").show(),$(this).hide(),room.wrapAdjust()}).on("swipeStart",function(o){t=parseInt(this.style.left)||0,e=parseInt(this.style.top)||0,this.style.transition="none"}).on("swipe",function(o){return this.style.left=util.rangeControl(t+o.moveX,$(window).width()-this.clientWidth)+"px",this.style.top=util.rangeControl(e+o.moveY,$(window).height()-this.clientHeight)+"px",!1}).on("swipeEnd",function(t){return!1}),util.toucher($(".kf-btn")[0]).on("singleTap",function(t){var e=$(this).attr("uId"),o=$(this).attr("n");room.setTxtOfNickname(common.isValid(e)?e:3,common.isValid(o)?o:"金道客服",null,3)}).on("swipeStart",function(o){t=parseInt(this.style.left)||0,e=parseInt(this.style.top)||0,this.style.transition="none"}).on("swipe",function(o){return this.style.left=util.rangeControl(t+o.moveX,$(window).width()-this.clientWidth)+"px",this.style.top=util.rangeControl(e+o.moveY,$(window).height()-this.clientHeight)+"px",!1}).on("swipeEnd",function(t){return!1})}(),$("#room_advertisement s").click(function(){$("#room_advertisement").hide(),room.wrapAdjust()}),$(".set-btn").click(function(){$(".set-bar").show()}),$(".set-bar .set-close").click(function(){$(".set-bar").hide()}),$("#readSet").click(function(){$(this).hasClass("guan-fon")?($(this).removeClass("guan-fon").addClass("on-fon"),$("#content_ul li[uType!=2]").hide()):($(this).removeClass("on-fon").addClass("guan-fon"),$("#content_ul li").show()),room.setScrollToBottom()}),$("#contentText").focus(function(){$(".add-img").hide(),$(".wrapper").css("top","0px"),$("#header").fadeOut("fast"),room.setScrollToBottom()}).blur(function(){room.wrapAdjust(),$("#header").fadeIn("fast"),room.setScrollToBottom()}),$("#contentText")[0].addEventListener("input",function(t){common.isValid(this.value)?($("#sendBtn").show(),$("#addBtn").hide()):($("#addBtn").show(),$("#sendBtn").hide())},!1),$("#contentText").keydown(function(t){8==t.keyCode&&common.isBlank($(this).val())&&room.removeTxtOfNickname()}),$("#content_div")[0].addEventListener("touchstart",function(t){0==$(".wrapper").position().top&&$("#contentText").blur()},!1),$("#top_info label").click(function(){room.setTxtOfNickname($(this).attr("fuserId"),$(this).attr("fnickname"),$("#top_info span").html(),$(this).attr("fuType")),$(this).html(""),$("#top_info").hide(),$(".talk-infobox").css("margin-top","25px")}),$("#loginSection .del-btn,#tipSection .del-btn").click(function(){common.hideBox("#openBox"),$("#formBtnLoad").hide(),$("#loginForm")[0].reset(),$(".wrong-info").html(""),room.setVerifyCodeTime("#loginForm .rbtn",!0)}),$("#close_top_btn").click(function(){$("#top_info").hide()}),$("#loginForm input[type=text]").blur(function(){common.isValid(this.value)&&$(".wrong-info[tId="+this.name+"]").html("")}),$("#formBtn").click(function(){$(".wrong-info").html(""),room.checkLoginInput()&&($("#formBtn").attr("disabled",!0),$("#formBtnLoad").show(),common.getJson("/fxchat/checkClient",$("#loginForm").serialize(),function(t){if(room.clearVerifyInter("#loginForm .rbtn"),$(".wrong-info").html(""),$("#formBtn").attr("disabled",!1),$("#formBtnLoad").hide(),t.errcode)return $(".wrong-info").html(t.errmsg),!1;var e=t.flag;t.isSys?t.isOK?(room.userInfo.nickname=t.nickname,room.userInfo.userType=t.userType,$(".user-stadus").hide(),$("#loginSection").hide(),$("#tipSection h2").html("验证成功"),$("#tipSection .succ-p-info").html("尊贵的客户：欢迎光临金道环球投资微解盘！"),$("#tipSection").show()):$(".wrong-info").html("账号或手机号验证不通过，请重新输入！"):1==e?($("#loginSection").hide(),$("#tipSection h2").html("登录成功"),$("#tipSection .succ-p-info").html("尊贵的客户：欢迎光临金道环球投资微解盘，即时参与和分析师互动，让投资变得更简单！"),$("#tipSection").show(),$(".user-stadus").hide()):4==e?$(".wrong-info").html("该账号已被占用，请输入其他账号！"):$(".wrong-info").html("账号或手机号验证不通过，请重新输入！")},!0,function(t){$("#formBtn").attr("disabled",!1),$("#formBtnLoad").hide()}))}),$("#sendBtn").click(function(){var t=$("#contentText").val();if(common.isValid(t)){if(t.length>=80)return room.showTipBox("注意：消息内容超过最大长度限制（80字以内）！"),!1;t=t.replace(/<[^>].*?>/g,"");var e="(((https|http)://)?)[A-Za-z0-9-_]+\\.[A-Za-z0-9-_&\\?\\/.=]+",o=new RegExp(e,"gi");t=t.replace(o,function(t){return isNaN(t)?'<a href="'+t+'" target="_blank">'+t+"</a>":t});var n={uiId:room.getUiId(),fromUser:room.userInfo,content:{msgType:room.msgType.text,value:t}};n.fromUser.toUser=room.getToUser(),room.socket.emit("sendMsg",n),room.setContent(n,!0,!1),n.fromUser.toUser=null,room.removeTxtOfNickname(),$("#contentText").val(""),$(this).hide(),$("#addBtn").show()}}),$("#addBtn").click(function(){$(".add-img").show()}),$("#fileBtn")[0].addEventListener("change",function(){var t=this;$(".add-img").hide(),room.checkSendAuthority(function(e){if(e){var o=t.files[0];if(!o)return!1;if(0!=o.type.indexOf("image")||!o.type||!/\.(?:jpg|png|gif)$/.test(o.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var n=o.size;if(n>=3145728)return alert("发送的图片大小不要超过3MB."),!1;var i=new FileReader;i.readAsDataURL(o);var r=room.getUiId();room.setContent({uiId:r,fromUser:room.userInfo,content:{msgType:room.msgType.img,value:"",needMax:0}},!0,!1),i.onload=function(t){var e={uiId:r,fromUser:room.userInfo,content:{msgType:room.msgType.img,value:"",needMax:0,maxValue:""}};e.content.value=t.target.result,room.zipImg(e,100,60,function(t,o){if(t.error)return alert(t.error),$("#"+r).remove(),!1;e.content.value.length<o.length&&(o=e.content.value);var n=$("#"+t.uiId+" .dialog .imgdiv img");n.attr("src",o),n.attr("needMax",t.content.needMax),room.dataUpload(t),1==t.content.needMax&&room.isCanReSend&&room.insertImgDBData({id:r,data:t.content.value})})},i.onprogress=function(t){},i.onloadend=function(t){}}})},!1)},dataUpload:function(t){var e=new XMLHttpRequest;e.open("POST","/fxchat/uploadData"),e.addEventListener("progress",function(e){if(e.lengthComputable){var o=(e.loaded/e.total*100|0)+"%";$("#"+t.uiId+" .shadow-box").css({height:"'+ra+'"}),$("#"+t.uiId+" .shadow-conut").html(o)}},!1),e.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&console.log("success!")},t.fromUser.socketId=room.socket.id,e.send(JSON.stringify(t))},zipImg:function(t,e,o,n){var i=new Image;i.onload=function(){var r=document.createElement("canvas"),s=i.width,a=i.height;if(a>=9*s)return n({error:"该图片高度太高，暂不支持发送！"}),!1;e>0&&(a>e||s>e)&&(t.content.needMax=1,a>e&&e>=s?(s=e/a*s,a=e):(a=e/s*a,s=e),i.height=a,i.width=s);var m=r.getContext("2d");r.width=s,r.height=a,m.clearRect(0,0,r.width,r.height),m.drawImage(i,0,0,s,a),n(t,r.toDataURL("image/jpeg",o/100))},i.src=t.content.value},checkSendStatus:function(t,e,o){var n=$("#"+t),i=null;o==room.msgType.img?(i=$(".imgdiv .sending",n),i.siblings(".shadow-conut").html(""),i.addClass("sfailed").removeClass("sending").attr("title","重发")):(i=$(".txtBox .sending",n),i.addClass("sfailed").removeClass("sending").attr("title","重发"))},checkSendAuthority:function(t){common.getJson("/fxchat/checkSendAuthority",{accountNo:room.userInfo.accountNo,userId:room.userInfo.userId,groupId:room.userInfo.groupId,fromPlatform:room.userInfo.fromPlatform},function(e){e.isVisitor?(room.openLoginBox(),t(!1)):t(!0)},!0)},removeTxtOfNickname:function(){var t=$("#txtNicknameId");common.isValid(t.text())&&(t.html(""),$("#contentText").css({"padding-left":"1%"}).width("98%"))},setTxtOfNickname:function(t,e,o,n){$("#contentText").width("98%");var i="";common.isValid(o)&&(i='<span style="display:none;">'+o+"</span>"),$("#txtNicknameId").html('<span class="dt-send-name" tId="'+t+'" uType="'+n+'">@<label>'+e+"</label>"+i+"</span>");var r=parseInt($("#txtNicknameId").width());$("#contentText").css({"padding-left":r+5}).width($("#contentText").width()-r)},checkLoginInput:function(){var t=!0;return $("#loginForm input[type=text]").each(function(){return common.isBlank($(this).val())?("accountNo"==this.name&&$(".wrong-info").attr("tId",this.name).html("账号不能为空！"),"mobilePhone"==this.name&&$(".wrong-info").attr("tId",this.name).html("手机号码不能为空！"),"verifyCode"==this.name&&$(".wrong-info").attr("tId",this.name).html("验证码不能为空！"),t=!1):"mobilePhone"!=this.name||common.isMobilePhone($(this).val())?void 0:($(".wrong-info").attr("tId",this.name).html("手机号码输入有误！"),t=!1)}),t},setVerifyCodeTime:function(t,e){var o=0;e||(o=parseInt($(t).attr("t"))||60,o>1&&common.isBlank(room.verifyCodeIntervalId)&&(room.verifyCodeIntervalId=setInterval("room.setVerifyCodeTime('"+t+"')",1e3))),o>1?$(t).attr("t",o-1).val("获取验证码("+(o-1)+")"):room.clearVerifyInter(t)},clearVerifyInter:function(t){common.isValid(room.verifyCodeIntervalId)&&(clearInterval(room.verifyCodeIntervalId),room.verifyCodeIntervalId="");var e=!0;common.isMobilePhone($("#loginForm input[name=mobilePhone]").val())&&(e=!1),$(t).attr("t",60).attr("disabled",e).val("获取验证码")},openLoginBox:function(){$("#loginForm")[0].reset(),$("#loginForm input[type=hidden]").each(function(){$(this).val(room.userInfo[this.name])}),$("#tipSection").hide(),$("#loginSection").show(),common.showBox("#openBox")},setLoadImg:function(t,e){e?t.parent().find(".loading-box").show():t.parent().find(".loading-box").hide()},timeOutSend:function(t,e,o){window.setTimeout(function(){room.checkSendStatus(t,e,o)},6e4)},formatPublishTime:function(t){return common.isBlank(t)?"":common.longMsTimeToDateTime(Number(t.replace(/_.+/g,"")),".")},getToUser:function(){var t=$("#txtNicknameId .dt-send-name");if(t.length>0){var e=common.trim(t.attr("uType")),o={userId:common.trim(t.attr("tId")),nickname:t.find("label").text(),userType:e,talkStyle:"3"==e?1:0},n=t.find("span");return n.length>0&&(o.question=n.text()),o}return null},setContent:function(t,e,o){var n=t.fromUser;if(e&&(n.publishTime=t.uiId,room.timeOutSend(t.uiId,!0,t.content.msgType)),t.isVisitor)return $("#"+t.uiId).remove(),void room.openLoginBox();if(o&&$("#"+n.publishTime).length>0)return void $("#"+n.publishTime+" .dialog em[class=ruleTipStyle]").remove();if(t.rule)return room.removeLoadDom(t.uiId),void(t.value&&(t.value.leaveRoom?room.leaveRoomTip():t.value.needApproval?$("#"+t.uiId).attr("id",n.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>")));if(e||room.userInfo.userId!=n.userId||!t.serverSuccess){var i=$("#content_div")[0],r=i.scrollTop+$(i).height()>=i.scrollHeight,s=room.formatContentHtml(t,e),a=$("#content_ul");if(a.append(s),!o&&r&&room.setScrollToBottom(),t.content.msgType==room.msgType.text&&n.toUser&&common.isValid(n.toUser.userId)){o||n.toUser.userId!=room.userInfo.userId||n.userId==room.userInfo.userId||($("#top_info").show(),$(".talk-infobox").css("margin-top",25+$("#top_info").height()+"px"),$("#top_info label").html(n.nickname+":@"+n.toUser.nickname).attr("tId",n.toUser.userId).attr("fuType",n.userType).attr("fnickname",n.nickname).attr("fuserId",n.userId),$("#top_info span").html(t.content.value));var m=null;common.isValid(n.toUser.question)?(m=$("#"+n.publishTime+" .dialog .asker"),m.click(function(){room.setTxtOfNickname($(this).attr("tId"),$(this).html(),null,$(this).attr("uType"))})):(m=$("#"+n.publishTime+" .dialog .dt-send-name"),m.click(function(){room.setTxtOfNickname($(this).attr("tId"),$(this).find("label").text(),null,$(this).attr("uType"))}))}$("#"+n.publishTime+" .headimg img").click(function(){var t=$(this).parent().parent();room.setTxtOfNickname($(this).parent().attr("tId"),t.find(".uname strong").text(),null,t.attr("uType"))}),$("#readSet").hasClass("on-fon")&&$("#content_ul li[uType!=2]").hide()}else if(room.removeLoadDom(t.uiId),$("#"+t.uiId).attr("id",n.publishTime),$("#"+t.uiId+" .uname label").html(room.formatPublishTime(n.publishTime)),t.content.msgType==room.msgType.img){1==t.content.needMax&&room.isCanReSend&&room.deleteImgDataById(t.uiId);var l=$("#"+n.publishTime+" .imgdiv"),c=t.content.needMax?"/fxchat/getBigImg?publishTime="+n.publishTime+"&userId="+n.userId:l.find("a img").attr("src");l.find("a[class=swipebox]").attr("href",c),$(".swipebox").swipebox()}},getUserTypeName:function(t){return 1==t?"(管理员)":2==t?"(分析师)":3==t?"(客服)":void 0},formatNickname:function(t,e,o){if(t&&0!=t){var n="";return common.isValid(o)&&(n=o+"-"),n+=e+this.getUserTypeName(t)}return e},formatContentHtml:function(t,e){var o="",n="",i="",r="",s="",a=[],m=t.fromUser,l=t.content,c=room.formatNickname(m.userType,m.nickname,m.position);if(room.userInfo.userId==m.userId?(o="me-li",c="我",n="<label>"+room.formatPublishTime(m.publishTime)+"</label><strong>"+c+"</strong>",e&&(s='<i class="sending"></i>',r=s+'<span class="shadow-box"></span><s class="shadow-conut"></s>')):2==m.userType?room.msgType.img!=l.msgType&&(o="expert-li"):o="visitor-li",common.isBlank(n)&&(n="<strong>"+c+"</strong>"+room.formatPublishTime(m.publishTime)),a.push('<li class="'+o+' clearfix" id="'+m.publishTime+'" uType="'+m.userType+'" mType="'+l.msgType+'">'),a.push('<div class="headimg" tId="'+m.userId+'"><img src="'+room.getUserAvatar(m.avatar,m.userType)+'"/></div>'),a.push('<div class="detail">'),a.push('<span class="uname">'+n+"</span>"),l.msgType==room.msgType.img){a.push('<div class="dialog sendimg">'),a.push('<div class="imgdiv">');l.needMax?a.push('<a href="/fxchat/getBigImg?publishTime='+m.publishTime+"&userId="+m.userId+'" class="swipebox" ><img src="'+l.value+'" alt="图片"/></a>'):a.push('<a href="'+l.value+'" class="swipebox" ><img src="'+l.value+'" alt="图片" /></a>'),a.push(r),a.push("</div></div>")}else l.msgType==room.msgType.text&&m.toUser&&common.isValid(m.toUser.userId)?common.isValid(m.toUser.question)?(a.push('<div class="dialog">'),a.push('<p class="question"><span class="asker" tId="'+m.toUser.userId+'" uType="'+m.toUser.userType+'">'+m.toUser.nickname+"</span><label>&nbsp;:&nbsp;</label><span>"+m.toUser.question+"</span></p>"),a.push('<p class="reply"><span>回复:</span>'+common.encodeHtml(l.value)+"</p></div>")):(i='<span class="dt-send-name" tId="'+m.toUser.userId+'" uType="'+m.toUser.userType+'">@<label>'+m.toUser.nickname+"</label></span>",a.push('<div class="dialog"><span class="to"></span>'+i+common.encodeHtml(l.value)+"</div>")):a.push('<div class="dialog txtBox"><span class="to"></span>'+s+common.encodeHtml(l.value)+"</div>");return a.push("</div></li>"),a.join("")},leaveRoomTip:function(t){var e="";"roomClose"==t&&(e="房间已停用，"),"otherLogin"==t&&(e="您的账号已在其他地方登陆，"),this.showTipBox("注意："+e+"正自动退出房间....."),window.setTimeout(function(){window.location.href="/fxchat"},3e3)},showTipBox:function(t){var e=$(".errorbox");e.find("span").html(t),e.fadeIn(0).delay(6e3).fadeOut(200)},removeLoadDom:function(t){$("#"+t+" .sending,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},setSocket:function(){this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),room.userInfo.socketId=room.socket.id,room.socket.emit("login",{userInfo:room.userInfo,lastPublishTime:$("#content_ul li:last").attr("id")}),room.setLoadImg($("#content_ul"),!0)}),this.socket.on("disconnect",function(t){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){room.setContent(t,!1,!1),t.content&&t.content.msgType==room.msgType.img&&$(".swipebox").swipebox()}),this.socket.on("notice",function(t){var e=t.data;switch(t.type){case"onlineNum":$("#onlineUserNum").text(e.onlineUserNum),room.userInfo.userId==e.userId&&e.hasRegister&&$(".user-stadus").hide();break;case"removeMsg":$("#"+e.replace(/,/g,",#")).remove();break;case"leaveRoom":room.leaveRoomTip(t.flag);break;case"approvalResult":if(e.refuseMsg){var o=e.publishTimeArr;for(var n in o)$("#"+o[n]+" .dialog em[class=ruleTipStyle]").html("已拒绝")}else{for(var n in e)room.formatUserToContent(e[n]);$(".swipebox").swipebox(),room.setScrollToBottom()}}}),this.socket.on("loadMsg",function(t){var e=t.msgData,o=t.isAdd;if(o||$("#content_ul").html(""),room.setLoadImg($("#content_ul"),!1),e&&$.isArray(e)){e.reverse();for(var n in e)room.formatUserToContent(e[n]);$(".swipebox").swipebox(),o||room.setScrollToBottom()}}),this.socket.on("targetCS",function(t){$(".kf-btn").attr("uId",t.userId).attr("n",t.nickname),$("#content_ul .dialog .dt-send-name[tId=3]").attr("tId",t.userId).find("label").html(t.nickname)})},setScrollToBottom:function(){$("#content_div").scrollTop($("#content_div")[0].scrollHeight)},formatUserToContent:function(t){var e={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,publishTime:t.publishTime,toUser:t.toUser,avatar:t.avatar,position:t.position};room.setContent({fromUser:e,content:t.content},!1,!0)}};$(function(){room.init()});