var studioMbPerson={load:function(o,i){o&&o.isLogin&&(this.refreshNickname(o.nickname),$("#person_hp").attr("src",studioMbPerson.getUserLevelIco(o.clientGroup)),$("#upg_tbody_id").html(""),studioMbPop.loadingBlock($("#upg_tbody_id")),$.getJSON("/studio/getClientGroupList",null,function(i){if(studioMbPop.loadingBlock($("#upg_tbody_id"),!0),i){var t="",e=0,n=null;for(var s in i)i[s]._id==o.clientGroup&&(e=i[s].sequence);var r,d=[];for(var u in i)n=i[u],r="",n._id==o.clientGroup?(r=' class="on"',t="当前级别"):t="visitor"!=n._id&&e<n.sequence?"vip"==n._id?"联系客服升级":'<a href="javascript:void(0)" t="'+n._id+'">升级</a>':"---",d.push("<tr"+r+'><td width="17%"><img src="'+studioMbPerson.getUserLevelIco(n._id)+'"></td>'),d.push('<td width="20%"><b>'+common.trim(n.remark)+"</b></td>"),d.push('<td width="43%">'+common.trim(n.authorityDes)+"</td>"),d.push('<td width="20%">'+t+"</td></tr>");$("#upg_tbody_id").append(d.join("")),$("#upg_tbody_id a").click(function(){var o=$(this).attr("t");studioMbPop.loadingBlock($("#personPop")),common.getJson("/studio/upgrade",{clientGroup:o},function(i){if(studioMbPop.loadingBlock($("#personPop"),!0),i.isOK){var t="升级成功！重新登录后，您可享用更多直播间权限。";"active"===i.clientGroup&&"notActive"===o&&(t+="<br/>注：你已经激活真实交易账户，直接为你升级到A级别。"),studioMbPop.popBox("msg",{msg:t,type:"upg"})}else"real"===o?studioMbPop.showMessage("很遗憾，您未激活金道真实交易账户，升级失败！如有疑问请联系客服！"):"real"===o?studioMbPop.showMessage("很遗憾，您未开通金道真实交易账户，升级失败！如有疑问请联系客服！"):"simulate"===o&&studioMbPop.showMessage("很遗憾，您未开通金道模拟交易账户，升级失败！如有疑问请联系客服！")},!0,function(){studioMbPop.loadingBlock($("#personPop"),!0)})})}}),$(".logoutbtn").bind("click",i,function(o){LoginAuto.setAutoLogin(!1),window.location.href="/studio/logout?platform="+o.data}))},init:function(){},getUserLevelIco:function(o){var i="/images/studio_mb/user1.png";switch(o){case"vip":i="/images/studio_mb/user2.png";break;case"active":i="/images/studio_mb/user3.png";break;case"notActive":i="/images/studio_mb/user3.png";break;case"simulate":i="/images/studio_mb/user4.png";break;case"register":i="/images/studio_mb/user5.png"}return i},refreshNickname:function(o){$("#person_nn").html(o)}},studioMbLogin={verifyCodeIntervalId:0,groupId:null,clientStoreId:null,load:function(){this.setEvent()},init:function(o,i,t){this.groupId=o,this.clientStoreId=i,this.resetFormInput(),$("#loginForm_csi").val(i),t?$("#loginPop .pop-close").show():$("#loginPop .pop-close").hide()},setEvent:function(){$("#loginForm_sub").bind("click",function(){studioMbLogin.checkFormInput()&&(studioMbPop.loadingBlock($("#loginPop")),common.getJson("/studio/login",$("#loginForm").serialize(),function(o){return o.isOK?void(studioMbLogin.groupId?common.getJson("/studio/checkGroupAuth",{groupId:studioMbLogin.groupId,redirectDef:1},function(o){o.isOK?(studioMbPop.loadingBlock($("#loginPop"),!0),studioMbPop.reload()):studioMbPop.showMessage("您没有访问该直播间的权限，如需进入请升级直播间等级或联系客服！")},!0,function(o){studioMbPop.loadingBlock($("#loginPop"),!0),"success"!=o&&studioMbPop.showMessage("操作失败，请联系客服！")}):(studioMbPop.loadingBlock($("#loginPop"),!0),LoginAuto.setAutoLogin($("#loginForm_al").prop("checked")),studioMbPop.reload())):(studioMbPop.loadingBlock($("#loginPop"),!0),studioMbPop.showMessage(o.error.errmsg),!1)},!0,function(){studioMbLogin.resetFormInput(),studioMbPop.loadingBlock($("#loginPop"),!0)}))}),$("#loginForm_mb").bind("input propertychange",function(){var o=$("#loginForm_vcb");parseInt(o.attr("t"))<60&&0==o.is(".pressed")||(common.isMobilePhone(this.value)?o.addClass("pressed"):o.removeClass("pressed"))}),$("#loginForm_vcb").bind("click",function(){if($("#loginForm_vc").blur(),$(this).hasClass("pressed")){$(this).removeClass("pressed").val("发送中...");var o=$("#loginForm_mb").val();try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:o,useType:"studio_login"},function(o){o&&0==o.result?studioMbLogin.setVerifyCodeTime():("1005"==o.errcode?studioMbPop.showMessage(o.errmsg):console.error("提取数据有误！"),studioMbLogin.resetVerifyCode())})}catch(i){studioMbLogin.resetVerifyCode(),console.error("getMobileVerifyCode->"+i)}}})},resetFormInput:function(){$("#loginForm_mb").val("").trigger("input"),$("#loginForm_vc").val("")},checkFormInput:function(){var o,i,t=!0,e="";return o=$("#loginForm_mb").val(),i=$("#loginForm_vc").val(),common.isBlank(o)?(t=!1,e="手机号码不能为空！"):common.isBlank(i)?(t=!1,e="手机验证码不能为空！"):common.isMobilePhone(o)||(t=!1,e="手机号码输入有误！"),studioMbPop.showMessage(e),t},resetVerifyCode:function(){studioMbLogin.verifyCodeIntervalId&&(clearInterval(studioMbLogin.verifyCodeIntervalId),studioMbLogin.verifyCodeIntervalId=null),$("#loginForm_vcb").attr("t",60).val("获取验证码"),$("#loginForm_mb").trigger("input")},setVerifyCodeTime:function(){var o=$("#loginForm_vcb"),i=parseInt(o.attr("t"))||60;studioMbLogin.verifyCodeIntervalId||(studioMbLogin.verifyCodeIntervalId=window.setInterval(studioMbLogin.setVerifyCodeTime,1e3)),i>1?o.attr("t",i-1).val(i-1+"秒后重新获取"):studioMbLogin.resetVerifyCode()}},studioMbMsg={type:null,load:function(){$("#resultForm_sub").bind("click",function(){studioMbPop.popHide()})},init:function(o,i){this.type=o,$("#resultForm_msg").html(i)}},studioMbSet={studioChatObj:null,load:function(){this.setEvent()},init:function(o){this.studioChatObj=o,$("#setForm").trigger("reset")},setEvent:function(){$("#setForm_sub").bind("click",function(){studioMbSet.checkFormInput()&&(studioMbPop.loadingBlock($("#setPop")),common.getJson("/studio/modifyName",$("#setForm").serialize(),function(o){return studioMbPop.loadingBlock($("#setPop"),!0),o.isOK?($("#pmInfoSetBox .pop_close").trigger("click"),studioMbSet.studioChatObj.refreshNickname(!0,o.nickname),$("#sendBtn").trigger("click"),void 0):(studioMbPop.showMessage(o.msg?o.msg:"修改失败，请联系客服！"),!1)},!0,function(){studioMbPop.loadingBlock($("#setPop"),!0)}))})},checkFormInput:function(){var o=!0,i="",t=$("#setForm_nn").val();return common.isBlank(t)?(o=!1,i="昵称不能为空！"):common.isRightName(t)||(o=!1,i="昵称为2至10位字符(数字、英文、中文、下划线),不能全是数字"),studioMbPop.showMessage(i),o}},studioMbPop={Person:studioMbPerson,Login:studioMbLogin,Set:studioMbSet,Msg:studioMbMsg,onShow:null,onHide:null,showMessage:function(o){if(o){var i=$(".errorbox");i.hide().find("div").html(o),i.fadeIn().delay(1e3).fadeOut(200)}},loadingBlock:function(o,i){i?o.children("div.img-loading").remove():o.append('<div class="img-loading"><i></i></div>')},popShow:function(o){$(".popupbg").is(":hidden")&&$(".popupbg").fadeIn(),$(".popupbox").hide(),this.onShow&&this.onShow.call(null),o.show()},popHide:function(){$(".popupbox").hide(),this.onHide&&this.onHide.call(null),$(".popupbg").fadeOut()},reload:function(){var o=window.location.href;o=-1==o.indexOf("?")?o+"?t="+(new Date).getTime():-1==o.indexOf("t=")?o+"&t="+(new Date).getTime():o.replace(/t=\d*/,"t="+(new Date).getTime()),window.location.href=o},load:function(o,i,t){t&&(this.onShow="function"==typeof t.onShow?t.onShow:null,this.onHide="function"==typeof t.onHide?t.onHide:null),this.Person.load(o,i),this.Login.load(),this.Set.load(),this.Msg.load(),$(".pop-close").click(function(){studioMbPop.popHide()})},popBox:function(o,i){switch(o){case"person":this.popShow($("#personPop")),this.Person.init();break;case"login":this.popShow($("#loginPop")),this.Login.init(i.groupId,i.clientStoreId,i.closeable!==!1);break;case"set":this.popShow($("#setPop")),this.Set.init(i.studioChatObj);break;case"msg":this.popShow($("#resultPop")),this.Msg.init(i.type,i.msg,i.groupId)}}};