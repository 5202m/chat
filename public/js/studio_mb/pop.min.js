var studioMbPerson={load:function(o){o&&o.isLogin&&($("#person_nn").html(o.nickname),$("#person_hp").attr("src",studioMbPerson.getUserLevelIco(o.clientGroup)),$("#upg_tbody_id").html(""),studioMbPop.loadingBlock($("#upg_tbody_id")),$.getJSON("/studio/getClientGroupList",null,function(e){if(studioMbPop.loadingBlock($("#upg_tbody_id"),!0),e){var i="",t=0,s=null;for(var n in e)e[n]._id==o.clientGroup&&(t=e[n].sequence);var r,d=[];for(var u in e)s=e[u],r="",s._id==o.clientGroup?(r=' class="on"',i="当前级别"):i="visitor"!=s._id&&t<s.sequence?"vip"==s._id?"联系客服升级":'<a href="javascript:void(0)" t="'+s._id+'">升级</a>':"---",d.push("<tr"+r+'><td width="17%"><img src="'+studioMbPerson.getUserLevelIco(s._id)+'"></td>'),d.push('<td width="20%"><b>'+common.trim(s.remark)+"</b></td>"),d.push('<td width="43%">'+common.trim(s.authorityDes)+"</td>"),d.push('<td width="20%">'+i+"</td></tr>");$("#upg_tbody_id").append(d.join("")),$("#upg_tbody_id a").click(function(){var o=$(this).attr("t");studioMbPop.loadingBlock($("#personPop")),common.getJson("/studio/upgrade",{clientGroup:o},function(e){studioMbPop.loadingBlock($("#personPop"),!0),e.isOK?studioMbPop.popBox("msg",{msg:"升级成功！重新登录后，您可享用更多直播间权限。",type:"upg"}):"real"===o?studioMbPop.showMessage("很遗憾，您未开通金道真实交易账户，升级失败！如有疑问请联系客服！"):"simulate"===o&&studioMbPop.showMessage("很遗憾，您未开通金道模拟交易账户，升级失败！如有疑问请联系客服！")},!0,function(){studioMbPop.loadingBlock($("#personPop"),!0)})})}}))},init:function(){},getUserLevelIco:function(o){var e="/images/studio_mb/user1.png";switch(o){case"vip":e="/images/studio_mb/user2.png";break;case"real":e="/images/studio_mb/user3.png";break;case"simulate":e="/images/studio_mb/user4.png";break;case"register":e="/images/studio_mb/user5.png"}return e}},studioMbLogin={groupId:null,clientStoreId:null,load:function(){this.setEvent()},init:function(o,e){this.groupId=o,this.clientStoreId=e,this.resetFormInput(),$("#loginForm_csi").val(e)},setEvent:function(){$("#loginForm_sub").bind("click",function(){studioMbLogin.checkFormInput()&&(studioMbPop.loadingBlock($("#loginPop")),common.getJson("/studio/login",$("#loginForm").serialize(),function(o){return o.isOK?void(studioMbLogin.groupId?common.getJson("/studio/checkGroupAuth",{groupId:studioMbLogin.groupId},function(){studioMbPop.loadingBlock($("#loginPop"),!0),studioMbPop.reload()},!0,function(o){studioMbPop.loadingBlock($("#loginPop"),!0),"success"!=o&&studioMbPop.showMessage("操作失败，请联系客服！")}):(studioMbPop.loadingBlock($("#loginPop"),!0),studioMbPop.reload())):(studioMbPop.loadingBlock($("#loginPop"),!0),studioMbPop.showMessage(o.error.errmsg),studioMbLogin.resetFormInput(),!1)},!0,function(){studioMbLogin.resetFormInput(),studioMbPop.loadingBlock($("#loginPop"),!0)}))}),$("#loginForm_prc").bind("click",function(){studioMbPop.popBox("resetChk")}),$("#loginForm_plp").bind("click",function(){studioMbPop.popBox("loginPM",{groupId:studioMbLogin.groupId,clientStoreId:studioMbLogin.clientStoreId})}),$("#loginForm_pr").bind("click",function(){studioMbPop.popBox("reg",{clientStoreId:studioMbLogin.clientStoreId,clientGroup:"",mobilePhone:"",verifyCode:"",isPM:!1,groupId:studioMbLogin.groupId})})},resetFormInput:function(){$("#loginForm").trigger("reset")},checkFormInput:function(){var o,e,i=!0,t="";return o=$("#loginForm_mb").val(),e=$("#loginForm_pwd").val(),common.isBlank(o)?(i=!1,t="手机号码不能为空！"):common.isBlank(e)?(i=!1,t="密码不能为空！"):common.isMobilePhone(o)||(i=!1,t="手机号码输入有误！"),studioMbPop.showMessage(t),i}},studioMbLoginPm={verifyCodeIntervalId:0,groupId:null,clientStoreId:null,load:function(){this.setEvent()},init:function(o,e){this.groupId=o,this.clientStoreId=e,this.resetFormInput(),$("#loginPmForm_csi").val(e)},setEvent:function(){$("#loginPmForm_sub").bind("click",function(){studioMbLoginPm.checkFormInput()&&(studioMbPop.loadingBlock($("#loginPmPop")),common.getJson("/studio/login",$("#loginPmForm").serialize(),function(o){return o.isOK?void(studioMbLoginPm.groupId?common.getJson("/studio/checkGroupAuth",{groupId:studioMbLoginPm.groupId},function(){studioMbPop.loadingBlock($("#loginPmPop"),!0),studioMbPop.reload()},!0,function(o){studioMbPop.loadingBlock($("#loginPmPop"),!0),"success"!=o&&studioMbPop.showMessage("操作失败，请联系客服！")}):(studioMbPop.loadingBlock($("#loginPmPop"),!0),studioMbPop.reload())):(studioMbPop.loadingBlock($("#loginPmPop"),!0),o.hasPM?(studioMbPop.popBox("reg",{clientStoreId:studioMbLoginPm.clientStoreId,clientGroup:o.clientGroup,mobilePhone:o.mobilePhone,verifyCode:o.verifyCode,isPM:!0,groupId:studioMbLoginPm.groupId}),!1):(studioMbPop.showMessage(o.error.errmsg),!1))},!0,function(){studioMbLoginPm.resetFormInput(),studioMbPop.loadingBlock($("#loginPmPop"),!0)}))}),$("#loginPmForm_mb").bind("input propertychange",function(){var o=$("#loginPmForm_vcb");parseInt(o.attr("t"))<60&&0==o.is(".pressed")||(common.isMobilePhone(this.value)?o.addClass("pressed"):o.removeClass("pressed"))}),$("#loginPmForm_vcb").bind("click",function(){if($("#loginPmForm_vc").blur(),$(this).hasClass("pressed")){$(this).removeClass("pressed").val("发送中...");var o=$("#loginPmForm_mb").val();try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:o,useType:"studio_login"},function(o){o&&0==o.result?studioMbLoginPm.setVerifyCodeTime():("1005"==o.errcode?studioMbPop.showMessage(o.errmsg):console.error("提取数据有误！"),studioMbLoginPm.resetVerifyCode())})}catch(e){studioMbLoginPm.resetVerifyCode(),console.error("getMobileVerifyCode->"+e)}}})},resetFormInput:function(){$("#loginPmForm_mb").val("").trigger("input"),$("#loginPmForm_vc").val("")},checkFormInput:function(){var o,e,i=!0,t="";return o=$("#loginPmForm_mb").val(),e=$("#loginPmForm_vc").val(),common.isBlank(o)?(i=!1,t="手机号码不能为空！"):common.isBlank(e)?(i=!1,t="手机验证码不能为空！"):common.isMobilePhone(o)||(i=!1,t="手机号码输入有误！"),studioMbPop.showMessage(t),i},resetVerifyCode:function(){studioMbLoginPm.verifyCodeIntervalId&&(clearInterval(studioMbLoginPm.verifyCodeIntervalId),studioMbLoginPm.verifyCodeIntervalId=null),$("#loginPmForm_vcb").attr("t",60).val("获取验证码"),$("#loginPmForm_mb").trigger("input")},setVerifyCodeTime:function(){var o=$("#loginPmForm_vcb"),e=parseInt(o.attr("t"))||60;studioMbLoginPm.verifyCodeIntervalId||(studioMbLoginPm.verifyCodeIntervalId=window.setInterval(studioMbLoginPm.setVerifyCodeTime,1e3)),e>1?o.attr("t",e-1).val(e-1+"秒后重新获取"):studioMbLoginPm.resetVerifyCode()}},studioMbReg={verifyCodeIntervalId:0,groupId:null,load:function(){this.setEvent()},init:function(o,e,i,t,s,n){this.groupId=n,$("#regForm").trigger("reset"),$("#regForm_csi").val(o),$("#regForm_cg").val(e),$("#regForm_mb").val(i).trigger("input"),$("#regForm_vc").val(t);var r=$("#regPop").find(".mtit span"),d=$("#regForm").find(".pm");s?(r.html("直播间设置"),d.hide()):(r.html("直播间注册"),d.show())},setEvent:function(){$("#regForm_sub").bind("click",function(){studioMbReg.checkFormInput()&&(studioMbPop.loadingBlock($("#regPop")),common.getJson("/studio/reg",$("#regForm").serialize(),function(o){return studioMbPop.loadingBlock($("#regPop"),!0),o.isOK?void studioMbPop.popBox("msg",{msg:"恭喜你注册成功！",type:"reg",groupId:studioMbReg.groupId}):(studioMbPop.showMessage(o.error.errmsg),!1)},!0,function(){studioMbPop.loadingBlock($("#regPop"),!0)}))}),$("#regForm_mb").bind("input propertychange",function(){var o=$("#regForm_vcb");parseInt(o.attr("t"))<60&&0==o.is(".pressed")||(common.isMobilePhone(this.value)?o.addClass("pressed"):o.removeClass("pressed"))}),$("#regForm_vcb").bind("click",function(){if($("#regForm_vc").blur(),$(this).hasClass("pressed")){$(this).removeClass("pressed").val("发送中...");var o=$("#regForm_mb").val();try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:o,useType:"studio_reg"},function(o){o&&0==o.result?studioMbReg.setVerifyCodeTime():("1005"==o.errcode?studioMbPop.showMessage(o.errmsg):console.error("提取数据有误！"),studioMbReg.resetVerifyCode())})}catch(e){studioMbReg.resetVerifyCode(),console.error("getMobileVerifyCode->"+e)}}})},checkFormInput:function(){var o,e,i,t,s,n=!0,r="";return o=$("#regForm_mb").val(),e=$("#regForm_vc").val(),i=$("#regForm_nn").val(),t=$("#regForm_pwd1").val(),s=$("#regForm_pwd").val(),common.isBlank(o)?(n=!1,r="手机号码不能为空！"):common.isMobilePhone(o)?common.isBlank(e)?(n=!1,r="手机验证码不能为空！"):common.isBlank(t)||common.isBlank(s)?(n=!1,r="密码不能为空！"):t!=s?(n=!1,r="两次密码不一致！"):/^[A-Za-z0-9]{6,16}$/.test(s)?common.isRightName(this.value)||(n=!1,r="昵称为2至10位字符(数字、英文、中文、下划线),不能全是数字"):(n=!1,r="密码输入有误，请输入6至16位字母或数字组合！"):(n=!1,r="手机号码输入有误！"),studioMbPop.showMessage(r),n},resetVerifyCode:function(){studioMbReg.verifyCodeIntervalId&&(clearInterval(studioMbReg.verifyCodeIntervalId),studioMbReg.verifyCodeIntervalId=null),$("#regForm_vcb").attr("t",60).val("获取验证码"),$("#regForm_mb").trigger("input")},setVerifyCodeTime:function(){var o=$("#regForm_vcb"),e=parseInt(o.attr("t"))||60;studioMbReg.verifyCodeIntervalId||(studioMbReg.verifyCodeIntervalId=window.setInterval(studioMbReg.setVerifyCodeTime,1e3)),e>1?o.attr("t",e-1).val(e-1+"秒后重新获取"):studioMbReg.resetVerifyCode()}},studioMbResetChk={verifyCodeIntervalId:0,load:function(){this.setEvent()},init:function(){$("#resetChkForm_mb").val("").trigger("input"),$("#resetChkForm_vc").val("")},setEvent:function(){$("#resetChkForm_sub").bind("click",function(){if(studioMbResetChk.checkFormInput()){var o={mobilePhone:$("#resetChkForm_mb").val(),verifyCode:$("#resetChkForm_vc").val(),isCheck:"true"};studioMbPop.loadingBlock($("#resetChkPop")),common.getJson("/studio/getPwd",o,function(e){return studioMbPop.loadingBlock($("#resetChkPop"),!0),e.isOK?void studioMbPop.popBox("reset",o):(studioMbPop.showMessage(e.error.errmsg),!1)},!0,function(){studioMbPop.loadingBlock($("#resetChkPop"),!0)})}}),$("#resetChkForm_mb").bind("input propertychange",function(){var o=$("#resetChkForm_vcb");parseInt(o.attr("t"))<60&&0==o.is(".pressed")||(common.isMobilePhone(this.value)?o.addClass("pressed"):o.removeClass("pressed"))}),$("#resetChkForm_vcb").bind("click",function(){if($("#resetChkForm_vc").blur(),$(this).hasClass("pressed")){$(this).removeClass("pressed").val("发送中...");var o=$("#resetChkForm_mb").val();try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:o,useType:"studio_resetPWD"},function(o){o&&0==o.result?studioMbResetChk.setVerifyCodeTime():("1005"==o.errcode?studioMbPop.showMessage(o.errmsg):console.error("提取数据有误！"),studioMbResetChk.resetVerifyCode())})}catch(e){studioMbResetChk.resetVerifyCode(),console.error("getMobileVerifyCode->"+e)}}})},checkFormInput:function(){var o,e,i=!0,t="";return o=$("#resetChkForm_mb").val(),e=$("#resetChkForm_vc").val(),common.isBlank(o)?(i=!1,t="手机号码不能为空！"):common.isBlank(e)?(i=!1,t="手机验证码不能为空！"):common.isMobilePhone(o)||(i=!1,t="手机号码输入有误！"),studioMbPop.showMessage(t),i},resetVerifyCode:function(){studioMbResetChk.verifyCodeIntervalId&&(clearInterval(studioMbResetChk.verifyCodeIntervalId),studioMbResetChk.verifyCodeIntervalId=null),$("#resetChkForm_vcb").attr("t",60).val("获取验证码"),$("#resetChkForm_mb").trigger("input")},setVerifyCodeTime:function(){var o=$("#resetChkForm_vcb"),e=parseInt(o.attr("t"))||60;studioMbResetChk.verifyCodeIntervalId||(studioMbResetChk.verifyCodeIntervalId=window.setInterval(studioMbResetChk.setVerifyCodeTime,1e3)),e>1?o.attr("t",e-1).val(e-1+"秒后重新获取"):studioMbResetChk.resetVerifyCode()}},studioMbReset={load:function(){this.setEvent()},init:function(o,e){$("#resetForm_mb").val(o),$("#resetForm_vc").val(e)},setEvent:function(){$("#resetForm_sub").bind("click",function(){studioMbReset.checkFormInput()&&(studioMbPop.loadingBlock($("#resetPop")),common.getJson("/studio/getPwd",$("#resetForm").serialize(),function(o){studioMbPop.loadingBlock($("#resetPop"),!0),o.isOK?studioMbPop.reload():studioMbPop.showMessage(o.error.errmsg)},!0,function(){studioMbPop.loadingBlock($("#resetPop"),!0)}))})},checkFormInput:function(){var o,e,i=!0,t="";return o=$("#resetForm_pwd1").val(),e=$("#resetForm_pwd").val(),common.isBlank(o)||common.isBlank(e)?(i=!1,t="密码不能为空！"):o!=e?(i=!1,t="两次密码不一致！"):/^[A-Za-z0-9]{6,16}$/.test(e)||(i=!1,t="密码输入有误，请输入6至16位字母或数字组合！"),studioMbPop.showMessage(t),i}},studioMbMsg={type:null,groupId:null,load:function(){$("#resultForm_sub").bind("click",function(){"reg"===studioMbMsg.type?studioMbMsg.groupId?common.getJson("/studio/checkGroupAuth",{groupId:studioMbMsg.groupId},function(){studioMbPop.reload()},!0,function(o){"success"!=o&&studioMbPop.reload()}):studioMbPop.reload():studioMbPop.popHide()})},init:function(o,e,i){this.type=o,this.groupId=i,$("#resultForm_msg").html(e)}},studioMbPop={Person:studioMbPerson,Login:studioMbLogin,LoginPM:studioMbLoginPm,Reg:studioMbReg,ResetChk:studioMbResetChk,Reset:studioMbReset,Msg:studioMbMsg,onShow:null,onHide:null,showMessage:function(o){if(o){var e=$(".errorbox");e.hide().find("div").html(o),e.fadeIn().delay(1e3).fadeOut(200)}},loadingBlock:function(o,e){e?o.children("div.img-loading").remove():o.append('<div class="img-loading"><i></i></div>')},popShow:function(o){$(".popupbg").is(":hidden")&&$(".popupbg").fadeIn(),$(".popupbox").hide(),this.onShow&&this.onShow.call(null),o.show()},popHide:function(){$(".popupbox").hide(),this.onHide&&this.onHide.call(null),$(".popupbg").fadeOut()},reload:function(){window.location.href="/studio?t="+(new Date).getTime()},load:function(o,e){e&&(this.onShow="function"==typeof e.onShow?e.onShow:null,this.onHide="function"==typeof e.onHide?e.onHide:null),this.Person.load(o),this.Login.load(),this.LoginPM.load(),this.Reg.load(),this.ResetChk.load(),this.Reset.load(),this.Msg.load(),$(".pop-close").click(function(){studioMbPop.popHide()})},popBox:function(o,e){switch(o){case"person":this.popShow($("#personPop")),this.Person.init();break;case"login":this.popShow($("#loginPop")),this.Login.init(e.groupId,e.clientStoreId);break;case"loginPM":this.popShow($("#loginPmPop")),this.LoginPM.init(e.groupId,e.clientStoreId);break;case"reg":this.popShow($("#regPop")),this.Reg.init(e.clientStoreId,e.clientGroup,e.mobilePhone,e.verifyCode,e.isPM,e.groupId);break;case"resetChk":this.popShow($("#resetChkPop")),this.ResetChk.init();break;case"reset":this.popShow($("#resetPop")),this.Reset.init(e.mobilePhone,e.verifyCode);break;case"msg":this.popShow($("#resultPop")),this.Msg.init(e.type,e.msg,e.groupId)}}};