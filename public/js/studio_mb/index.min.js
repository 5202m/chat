var studioChatMbIdx={fromPlatform:null,userInfo:null,mobile24kPath:"",apiUrl:"",init:function(){this.setVisitStore(),this.setClientGroupAuth(),this.setAdvertisement(),this.setEvent(),studioMbPop.load(this.userInfo,this.fromPlatform,{onShow:function(){$(".boxcont").height($(window).height()-$(".sroll-box").height()-$("#header").height()-$(".cen-ulist").height()-$(".fob_open").height())},onHide:function(){$(".boxcont").height("auto")}}),this.initRoom()},initRoom:function(){this.userInfo.nickname||this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12)),"visitor"==this.userInfo.clientGroup&&(studioMbPop.Login.forceLogin()?studioMbPop.popBox("login",{groupId:"",clientGroup:studioChatMbIdx.userInfo.clientGroup,clientStoreId:studioChatMbIdx.userInfo.clientStoreId,platform:studioChatMbIdx.fromPlatform,closeable:!1,showTip:!0}):window.setTimeout(function(){"visitor"==studioChatMbIdx.userInfo.clientGroup&&(studioMbPop.Login.forceLogin(!0),studioMbPop.popBox("login",{groupId:"",clientGroup:studioChatMbIdx.userInfo.clientGroup,clientStoreId:studioChatMbIdx.userInfo.clientStoreId,platform:studioChatMbIdx.fromPlatform,closeable:!1,showTip:!0}))},18e4))},checkClientGroup:function(t){var e=studioChatMbIdx.userInfo.clientGroup,o=!1;switch(t){case"visitor":o="visitor"==e;break;case"vip":o="vip"==e||"active"==e;break;case"new":o="vip"!=e&&"active"!=e}return o},refreshNickname:function(t,e){this.userInfo.isSetName=t,this.userInfo.nickname=e,$("#header_ui").text(e),studioMbPop.Person.refreshNickname(e)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfo_"+this.userInfo.groupType,e=store.get(t),o={};if(common.isBlank(e)){var i=common.randomNumber(6);o.clientStoreId=(new Date).getTime()+"_"+i,o.userId="visitor_"+i,o.nickname="游客_"+i,o.userType=-1,store.set(t,o),"wechat"!=this.fromPlatform&&$(".collect-tip").fadeIn().delay(6e4).fadeOut()}else o=e;this.userInfo.clientStoreId=o.clientStoreId,this.userInfo.visitorId=o.userId,this.userInfo.loginId=o.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=o.nickname,this.userInfo.userId=o.userId,$("#contentText").attr("contenteditable",!1).append('<span style="margin:15px 5px;">亲，<a href="javascript:;" onclick="studioChat.openLoginBox();" style="text-decoration: underline;color:#3F51B5;cursor: pointer;">登录</a>&nbsp;&nbsp;后可以发言哦~</span>')):(o.loginId=this.userInfo.userId,store.set(t,o),$("#contentText").html("").attr("contenteditable",!0)),this.isNeverLogin=!common.isValid(o.loginId)},setClientGroupAuth:function(){var t=function(t){t=t||"",t=","+t;var e=[],o=0;return t.indexOf(",vip")>=0&&(e.push("VIP"),o++),t.indexOf(",active")>=0&&t.indexOf(",notActive")>=0?(e.push("真实"),o+=2):t.indexOf(",active")>=0?(e.push("已激活"),o++):t.indexOf(",notActive")>=0&&(e.push("未激活"),o++),t.indexOf(",simulate")>=0&&(e.push("模拟"),o++),t.indexOf(",register")>=0&&(e.push("注册"),o++),t.indexOf(",visitor")>=0&&(e.push("游客"),o++),6==o?"所有客户均可观看":e.join(",")+"用户可观看"};$("#studioListTab .tit span[aw]").each(function(){$(this).html(t($(this).attr("aw")))})},setAdvertisement:function(){this.getArticleList("advertisement","studio_home","0",1,3,'{"sequence":"asc","createDate":"desc"}',function(t){if(0==t.result){var e=t.data;for(var o in e)$("#slider ul").append('<li class="swiper-slide"><a href="'+(common.isBlank(e[o].linkUrl)?"javascript:":e[o].linkUrl)+'" target="_blank"><img width="100%" alt="" src="'+e[o].mediaUrl+'"></a></li>'),e.length>1&&$("#position").append('<span class="'+(0==parseInt(o)?"p-click":"")+'"></span>');e&&e.length>1&&new Swiper(".scroll-imbd",{pagination:".dot-infobox",paginationClickable:!0,loop:!0,autoplay:5e3,autoplayDisableOnInteraction:!1})}})},setBulletin:function(){studioMbPop.loadingBlock($("#bulletinTab")),studioChatMbIdx.getArticleList("bulletin_system","studio_home",1,1,1,'{"sequence":"asc","createDate":"desc"}',function(t){var e=$("#bulletinTab .notice_cont");if(e.html(""),t&&0==t.result){var o=t.data;o&&o.length>0&&e.html(o[0].detailList[0].content)}studioMbPop.loadingBlock($("#bulletinTab"),!0)})},setEvent:function(){this.setEventHeader(),this.setEventCen(),this.setEventRoom(),this.setEventSyllabus(),$(".c_close").click(function(){$(".collect-tip").hide()})},setEventHeader:function(){$("#header_ui").bind("click",function(){studioChatMbIdx.userInfo&&studioChatMbIdx.userInfo.isLogin?studioMbPop.popBox("person"):studioMbPop.popBox("login",{groupId:"",clientGroup:studioChatMbIdx.userInfo.clientGroup,clientStoreId:studioChatMbIdx.userInfo.clientStoreId,platform:studioChatMbIdx.fromPlatform})})},setEventCen:function(){var t=new Swiper(".cen-qhbox",{loop:!1,autoplay:!1,onSlideChangeStart:function(t){$(".cen-ulist li").eq(t.activeIndex).trigger("click")}});$(".cen-ulist li").bind("click",t,function(t){$(".cen-ulist li.on").removeClass("on"),$(this).addClass("on");var e=$(this).attr("t");"bulletinTab"==e?studioChatMbIdx.setBulletin():"tradeInfoTab"==e?(_gaq.push(["_trackEvent","m_24k_studio","tradstrategy_tab","content_middle",1,!0]),studioChatMbIdx.setNewsInfo("#tradeInfoTab .boxcont",!1,3,5)):"commentTab"==e&&(_gaq.push(["_trackEvent","m_24k_studio","comment_tab","content_middle",1,!0]),studioChatMbIdx.setNewsInfo("#commentTab .boxcont",!1,3,3)),t.data.slideTo($(this).index(),300,!1)}),$("#tradeInfoTab .moreitem").bind("click",function(){_gaq.push(["_trackEvent","m_24k_studio","tradstrategy_more","content_middle",1,!0]),studioChatMbIdx.setNewsInfo("#tradeInfoTab .boxcont",!0,3,5)}),$("#commentTab .moreitem").bind("click",function(){_gaq.push(["_trackEvent","m_24k_studio","comment_more","content_middle",1,!0]),studioChatMbIdx.setNewsInfo("#commentTab .boxcont",!0,3,3)})},setEventRoom:function(){$(".videoroom-ul li").click(function(){$(".videoroom-ul li.on").removeClass("on"),$(this).addClass("on")}),$("#studioListTab .videoroom-ul li:first").trigger("click");var t=$("#studioListTab .videoroom-ul>li");1==t.size()&&t.find(".syllabus").show(),$(".btns .enter").click(function(){var t=$(this).parents("li"),e=t.attr("gi");return"true"!=t.attr("ga")?("visitor"==studioChatMbIdx.userInfo.clientGroup?studioMbPop.popBox("login",{groupId:e,clientGroup:studioChatMbIdx.userInfo.clientGroup,clientStoreId:studioChatMbIdx.userInfo.clientStoreId,platform:studioChatMbIdx.fromPlatform}):studioChatMbIdx.checkClientGroup("vip")?studioMbPop.showMessage("该房间仅对新客户开放。"):studioMbPop.showMessage("已有真实账户并激活的客户才可进入Vip专场，您还不满足条件。"),!1):"true"!=t.attr("go")?(studioMbPop.showMessage("该直播间暂未开放，请稍后访问！"),!1):(studioMbPop.loadingBlock($("body")),common.getJson("/studio/checkGroupAuth",{groupId:e},function(t){studioMbPop.loadingBlock($("body"),!0),t.isOK?studioMbPop.reload():t.error&&"1000"===t.error.errcode?studioMbPop.showMessage("您长时间未操作，请刷新页面后重试！"):studioChat.checkClientGroup("vip")?studioMbPop.showMessage("该房间仅对新客户开放。"):studioMbPop.showMessage("已有真实账户并激活的客户才可进入Vip专场，您还不满足条件。")},!0,function(t){"success"!=t&&(studioMbPop.loadingBlock($("body"),!0),studioMbPop.showMessage("操作失败，请联系客服！"))}),!1)})},setEventSyllabus:function(){var t=$("#studioListTab .videoroom-ul li").map(function(){return $(this).attr("gi")}).get().join(",");$.getJSON("/studio/getSyllabus?t="+(new Date).getTime(),{groupType:studioChatMbIdx.userInfo.groupType,groupId:t},function(t){var e=null,o=t.data;if(o){o instanceof Array||(o=[o]);var i=null,n=null,s=null,r=["周日","周一","周二","周三","周四","周五","周六"],a={0:"文字直播",1:"视频直播",2:"ONE TV"};for(var u in o)if(i=o[u],i.courses){e=common.formatSyllabus(i.courses,t.serverTime,3,{dayCN:r,courseType:a}),n=$("#studioListTab .videoroom-ul li[gi="+i.groupId+"]"),s=common.getSyllabusPlan(i,t.serverTime),s&&(n.find(".syll-tip .syll-time").text(r[s.day+""]+" "+s.startTime+"-"+s.endTime).next().text(a[s.courseType]).next().text(s.lecturer),s.isNext?n.find(".tit div").removeClass("st"):n.find(".tit div").addClass("st"),n.find(".syll-tip").show());var l=n.find(".timetable");l.html(e),l.find("th").bind("click",function(){var t=$(this);t.siblings(".active").removeClass("active"),t.addClass("active");var e=t.attr("d");t.parent().siblings("tr[d]").hide(),t.parent().siblings("tr[d='"+e+"']").show()}),l.find("th.active").trigger("click")}}}),$(".btns .timebtn").click(function(){var t=$(this).parents("li:first").attr("gi");return _gaq.push(["_trackEvent","m_24k_studio","schedule_"+t,"content_middle",1,!0]),$(".pop-time .sc_cont").empty().append($(this).parents("li").find(".timetable").clone(!0)),studioMbPop.popShow($(".pop-time")),!1})},getArticleList:function(t,e,o,i,n,s,r){try{$.getJSON("/wechat/getArticleList",{code:t,platform:e,hasContent:o,pageNo:i,pageSize:n,orderByStr:s},function(t){r(t)})}catch(a){console.error("getArticleList->"+a),r(null)}},setNewsInfo:function(t,e,o,i,n){var s=$(t),r=s.find(".moreitem"),a=e?parseInt(r.attr("pno")||1):1;return 0>a?!1:(studioMbPop.loadingBlock(s),void this.getNewsInfoList(o,i,a,n,function(t){var o;if(t&&0==(o=t.informations).result){var n,u=o.informationList,l=null,d=[],c=5==i?"tradstrategy_":"comment_";if(u&&u.length>0){d.push('<ul class="trade-ul">');for(var p in u)l=u[p],n=e?"":" onclick=\"_gaq.push(['_trackEvent', 'm_24k_studio', '"+c+p+"', 'content_middle',1,true]);\"",d.push("<li><a"+n+' href="'+studioChatMbIdx.mobile24kPath+"/comment/"+l.id+"_"+l.contenttype2+'.html" target="_blank">'),d.push("<span>"+l.title+"</span>"),d.push("<time>"+(l.datestr?l.datestr.replace(/(^\d{4}-)|(:\d{2}$)/g,""):"")+"</time>"),d.push("</a></li>");d.push("</ul>")}e||s.find("ul").remove(),r.before(d.join("")),o.totalPage>o.pageNo?r.html("更多"+(5==i?"交易策略":"专业评论")).attr("pno",a+1):r.html("已加载全部"+(5==i?"交易策略":"专业评论")).attr("pno",-1)}else console.error("提取数据有误！");studioMbPop.loadingBlock(s,!0)}))},getNewsInfoList:function(t,e,o,i,n){try{var s=o||1,r=i||5;$.getJSON(this.apiUrl+"/common/getNewsInfoList",{pageNo:s,pageSize:r,lang:"zh",contentType1:t,contentType2:e},function(t){n(t)})}catch(a){console.error("getNewsInfoList->"+a),n(null)}}};