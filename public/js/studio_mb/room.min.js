var studioChatMb={initSewise:!1,web24kPath:"",filePath:"",apiUrl:"",exStudioStr:"",studioDate:"",serverTime:0,pushObj:{whPush:{},talkPush:[],talkPushInterval:null},msgType:{text:"text",img:"img",file:"file"},socket:null,socketUrl:"",userInfo:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.setSocket(),this.setEvent(),this.setVideoList(),studioMbPop.load(this.userInfo,{onShow:function(){$("#tVideoDiv video").hide()},onHide:function(){$("#tVideoDiv video").show()}})},serverTimeUp:function(){setInterval(function(){studioChatMb.serverTime+=1e3},1e3)},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfo_"+this.userInfo.groupType,e=store.get(t),i={};if(common.isBlank(e)){var s=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+s,i.userId="visitor_"+s,i.nickname="游客_"+s,i.userType=-1,store.set(t,i),$(".collect-tip").fadeIn().delay(6e4).fadeOut()}else i=e;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup&&(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId)},setSocket:function(){studioMbPop.loadingBlock($("#talkBoxTab")),this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),studioChatMb.userInfo.socketId=studioChatMb.socket.id,studioChatMb.socket.emit("login",{userInfo:studioChatMb.userInfo,lastPublishTime:$("#dialog_list>li:last").attr("id")},navigator.userAgent)}),this.socket.on("disconnect",function(){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle||studioChatMb.setContent(t,!1,!1)}),this.socket.on("notice",function(t){switch(t.type){case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),studioChatMb.setTalkListScroll();break;case"leaveRoom":studioChatMb.leaveRoomTip(t.flag);break;case"approvalResult":var e=t.data,i=0;if(e.refuseMsg){var s=e.publishTimeArr;for(i in s)$("#"+s[i]+" .dialog em[class=ruleTipStyle]").html("已拒绝")}else{for(i in e)studioChatMb.formatUserToContent(e[i]);studioChatMb.setTalkListScroll()}break;case"pushInfo":var e=t.data;3==e.position&&studioChatMb.talkBoxPush.initTBP(e.infos)}}),this.socket.on("loadMsg",function(t){var e=t.msgData,i=t.isAdd;if(i||$("#content_ul").html(""),e&&$.isArray(e)){e.reverse();for(var s in e)studioChatMb.formatUserToContent(e[s]);studioMbPop.loadingBlock($("#talkBoxTab"),!0)}})},setVideoList:function(){studioMbPop.loadingBlock($("#videosTab")),this.getArticleList("teach_video",this.userInfo.groupId,0,1,100,'{"sequence":"asc"}',null,function(t){var e=$("#videosTab .boxcont");if(e.html(""),t&&0==t.result){for(var i=t.data,s=[],o=null,a=0,n=i?i.length:0;n>a;a++)a%5==0&&s.push('<ul class="teach-ul">'),o=i[a].detailList[0],s.push('<li><a title="'+o.title+'" href="javascript:void(0)" id="'+i[a]._id+'" vUrl="'+i[a].mediaUrl+'"><i></i><span>'+o.title+"</span></a></li>"),(a%5==4||a==n-1)&&s.push("</ul>"),e.html(s.join(""));e.find("li a").click(function(){$(this).is(".on")||($("#videosTab .boxcont li a.on").removeClass("on"),$(this).addClass("on")),studioChatMb.video.play("studio","mp4",$(this).attr("vUrl"),$(this).text())})}studioChatMb.video.start(),studioMbPop.loadingBlock($("#videosTab"),!0)})},setEvent:function(){this.setEventCen(),this.video.init(),this.setEventChat()},setEventCen:function(){var t=new Swiper(".cen-qhbox",{loop:!1,autoplay:!1,onSlideChangeStart:function(t){$(".cen-ulist li").eq(t.activeIndex).trigger("click")}});$(".cen-ulist li").click(function(){$(".cen-ulist li.on").removeClass("on"),$(this).addClass("on");var e=$(this).attr("t");"talkBoxTab"==e?studioChatMb.view.boardCtrl(1):(studioChatMb.view.boardCtrl(0),"bulletinTab"==e?studioChatMb.setBulletin():"TradeArticleTab"==e&&studioChatMb.setTradeArticle()),t.slideTo($(this).index(),300,!1)}),$("#header_hb").bind("click",function(){window.location.href="/studio/home"}),$("#header_ui").bind("click",function(){studioChatMb.userInfo&&studioChatMb.userInfo.isLogin?studioMbPop.popBox("person"):studioMbPop.popBox("login",{groupId:studioChatMb.userInfo.groupId,clientStoreId:studioChatMb.userInfo.clientStoreId})})},setEventChat:function(){$("#msgFaceBtn").bind("click",function(){$(this).blur(),$("#facePanel").is(":hidden")?studioChatMb.view.boardCtrl(2):studioChatMb.view.boardCtrl(1),studioChatMb.face.init($("#facePanel"),$("#contentText"),studioChatMb.filePath+"/face/","visitor"==studioChatMb.userInfo.clientGroup)}),$(".view_select").click(function(){var t=$(this);t.is(".dw")?(t.removeClass("dw"),studioChatMb.view.viewSelect=!1):(t.addClass("dw"),studioChatMb.view.viewSelect=!0)}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),studioChatMb.showViewSelect($(this).attr("t")))}),$(document).bind("touchstart",function(t){if(studioChatMb.view.viewSelect){var e=$(".view_select");e.is(t.target)||0!=e.find(t.target).length||e.trigger("click")}2==studioChatMb.view.viewBoard&&0==$(".float-box").find(t.target).length&&$("#contentText").trigger("blur")}),"visitor"==studioChatMb.userInfo.clientGroup&&($("#contentText").attr("contenteditable","false"),$("#contentText").html('<span style="margin:15px 5px;">亲，<a id="contentText_login" href="javascript:void(0);" onclick="studioChatMb.preLogin();" style="text-decoration: underline;color:#3F51B5;cursor: pointer;">登录</a>&nbsp;&nbsp;后可以发言哦~</span>'),$("#contentText_login").click(function(){$("#header_ui").trigger("click")})),$("#contentText").keydown(function(t){var e=$(this).html();return 13==t.keyCode?(common.isValid(e)&&($(this).html(e.replace(/<div>|<\/div>/g,"")),$("#sendBtn").click()),!1):void 0}).keyup(function(t){if(8==t.keyCode){var e=$(this).find(".txt_dia");if($.trim($(this).text())==e.text()&&0==$(this).find("img").length)return e.remove(),$(this).html(""),!0}}).focus(function(){}).blur(function(){}).bind("input",function(){var t="visitor"!=studioChatMb.userInfo.clientGroup&&($.trim($(this).text())!=$(this).find(".txt_dia").text()||$(this).find("img").size()>0);t?$("#sendBtn").addClass("pressed"):$("#sendBtn").removeClass("pressed")}),$("#sendBtn").click(function(){if($(this).blur(),studioChatMb.view.boardCtrl(1),"visitor"!=studioChatMb.userInfo.clientGroup){var t=studioChatMb.getToUser(),e=studioChatMb.getSendMsg();if(e!==!1){var i={uiId:studioChatMb.getUiId(),fromUser:studioChatMb.userInfo,content:{msgType:studioChatMb.msgType.text,value:e}};i.fromUser.toUser=t,studioChatMb.socket.emit("sendMsg",i),studioChatMb.setContent(i,!0,!1),$("#contentText").html("").trigger("input")}}}),$("#top_msg").click(function(){var t=$(this).find("label");$(this).slideUp(),studioChatMb.setDialog(t.attr("fuserId"),t.attr("fnickname"),0,t.attr("fuType"),null,$(this).find("span").text())}),$("#top_msg i").click(function(){return $("#top_msg").slideUp(),!1})},view:{viewSelect:!1,viewBoard:1,boardCtrl:function(t){if(this.viewBoard!=t){this.viewBoard=t;var e={header:$("#header"),backToLive:$("#backToLive"),facePanel:$("#facePanel"),floatBox:$(".float-box")};switch(t){case 0:e.header.show(),e.backToLive.data("showBoard",!0).trigger("show"),e.floatBox.hide();break;case 1:e.header.show(),e.backToLive.data("showBoard",!0).trigger("show"),e.floatBox.show(),e.facePanel.hide();break;case 2:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.show();break;case 3:e.header.hide(),e.backToLive.data("showBoard",!1).trigger("show"),e.floatBox.show(),e.facePanel.hide()}}}},video:{initPlayer:!1,playerType:"",videoType:"",studioType:"",liveUrl:"http://ct.phgsa.cn:1935/live/01/playlist.m3u8",$panel:null,backToLivePos:{x:0,y:0},init:function(){navigator.userAgent.match(/Android/i)||-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPod")||-1!=navigator.userAgent.indexOf("iPad")?this.playerType="video":this.playerType="sewise";var t=$(".videopart input:first");t.attr("yc"),t.attr("mc");this.$panel=$("#tVideoDiv"),this.$panel.css({"z-index":"inherit"}).height(.55*$(window).width()),this.setEvent()},start:function(){common.dateTimeWeekCheck(studioChatMb.studioDate,!0)?this.play("yy","",this.liveUrl,""):$("#videosTab li:first a").click()},play:function(t,e,i,s){this.studioType=t;var o=$("#backToLive");if("studio"==t?o.data("showVideo",!0).trigger("show"):($("#videosTab li a.on").removeClass("on"),o.data("showVideo",!1).trigger("show")),"video"==this.playerType)if(this.initPlayer){var a=this.$panel.find("video");a[0].pause(),a.attr("src",i),a[0].play()}else{var n=$("body").attr("fp"),r="webui"!=n&&"app"!=n;this.$panel.append('<video src="'+i+'" controls="true" autoplay="'+r+'" style="width: 100%; height: 100%; background-color: rgb(0, 0, 0);"></video>'),r||this.$panel.find("video")[0].pause(),this.initPlayer=!0,this.setEventAd()}else if(this.initPlayer)e==this.videoType?SewisePlayer.toPlay(i,s,0,!0):(SewisePlayer.doStop(),SewisePlayer.setup({server:"vod",type:e,videourl:i,autostart:!0,logo:"",title:s,buffer:5},this.$panel),this.videoType=e);else{var l=[];l.push("/js/lib/sewise.player.min.js?server=vod"),l.push("type="+e),l.push("videourl="+i),l.push("autostart=true"),l.push("logo="),l.push("title="+s),l.push("buffer=5");var u=l.join("&"),d=document.createElement("script");d.type="text/javascript",d.src=u,this.initPlayer=!0,this.videoType=e,this.$panel.append(d),this.setEventAd()}},setEvent:function(){$(".ctrlblock div.replay a").bind("click",function(){var t=$("#videosTab li a.on");t.trigger("click")}),$(".ctrlblock div.nextbtn a").bind("click",function(){for(var t=$("#videosTab li a"),e=0,i=t.size();i>e;e++)if(t.eq(e).is(".on")){t.eq(i-1>e?e+1:0).trigger("click");break}}),$("#backToLive").css({left:function(){return $(window).width()-$(this).width()-10},top:function(){return $(window).height()-$("#header").height()-70}}).data("showBoard",!0).data("showVideo",!0).bind("show",function(){var t=$(this);t.data("showBoard")&&t.data("showVideo")?t.show():t.hide()});var t=function(t,e){return t=Math.max(t,10),Math.min(t,e-10)};util.toucher($("#backToLive")[0]).on("singleTap",function(){studioChatMb.video.play("yy","",studioChatMb.video.liveUrl,"")}).on("swipeStart",function(){studioChatMb.video.backToLivePos.x=parseInt(this.style.left)||0,studioChatMb.video.backToLivePos.y=parseInt(this.style.top)||0,this.style.transition="none",this.style.background=" rgba(181,144,48,0.8)"}).on("swipe",function(e){return this.style.left=t(studioChatMb.video.backToLivePos.x+e.moveX,$(window).width()-this.clientWidth)+"px",this.style.top=t(studioChatMb.video.backToLivePos.y+e.moveY,$(window).height()-this.clientHeight)+"px",!1}).on("swipeEnd",function(){return this.style.background=" rgba(181,144,48,.6)",!1})},setEventAd:function(){if("sewise"==this.playerType){var t=function(){return window.SewisePlayer?(SewisePlayer.onPause(function(){"studio"==studioChatMb.video.studioType&&window.setTimeout(function(){SewisePlayer.duration()<=SewisePlayer.playTime()&&$(".ctrlblock").show()},1e3)}),void SewisePlayer.onStart(function(){$(".ctrlblock").hide()})):void window.setTimeout(t,500)};t()}else if("video"==this.playerType){var e=this.$panel.find("video");e.bind("ended",function(){"studio"==studioChatMb.video.studioType&&$(".ctrlblock").show()}).bind("loadstart",function(){$(".ctrlblock").hide()})}}},face:{initFace:!1,init:function(t,e,i,s){this.initFace||(this.build(t,i),new Swiper(t,{pagination:".swiper-pagination",paginationClickable:!0}),t.find("img").bind("click",{panel:t,assign:e,disabled:s},function(t){t.data.disabled||t.data.assign.append($(this).clone()).trigger("input")}),this.initFace=!0)},build:function(t,e){for(var i=[],s=7,o=1;75>=o;o+=21){i.push('<div class="swiper-slide"><table border="0" cellspacing="0" cellpadding="0">');for(var a=o,n=Math.min(o+20,75);n>=a;a++)a%s==1&&i.push("<tr>"),i.push('<td><img src="'+e+a+'.gif"/></td>'),(a%s==0||a==n)&&i.push("</tr>");i.push("</table></div>")}t.find("div.face").html(i.join(""))}},setTalkListScroll:function(){$("#talkPanel").scrollTop($("#talkPanel")[0].scrollHeight)},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getArticleList:function(t,e,i,s,o,a,n,r){try{var l={code:t,platform:e,hasContent:i,pageNo:s,pageSize:o,orderByStr:a};n&&(l.authorId=common.trim(n)),$.getJSON("/studio/getArticleList",l,function(t){r(t)})}catch(u){console.error("getArticleList->"+u),r(null)}},setBulletin:function(){studioMbPop.loadingBlock($("#bulletinTab")),studioChatMb.getArticleList("bulletin_system",studioChatMb.userInfo.groupId,1,1,1,'{"sequence":"asc"}',null,function(t){var e=$("#bulletinTab .notice_cont");if(e.html(""),t&&0==t.result){var i=t.data;i&&i.length>0&&e.html(i[0].detailList[0].content)}studioMbPop.loadingBlock($("#bulletinTab"),!0)})},setTradeArticle:function(){studioMbPop.loadingBlock($("#TradeArticleTab")),studioChatMb.getArticleList("trade_strategy_article",studioChatMb.userInfo.groupId,1,1,1,'{"createDate":"desc"}',null,function(t){var e=$("#TradeArticleTab ul:first"),i=[];if(t&&0==t.result){var s=t.data;if(s&&s.length>0)for(var o=null,a=null,n=0,r=s.length;r>n;n++)o=s[n].detailList[0],a=o.author.split(";"),i.push("<li>"),i.push('<div class="himg"><img src="'+a[1]+'"></div>'),i.push('<div class="detail">'),i.push("<h3>"+o.title+"</h3>"),i.push('<div class="subinfo">'),i.push("<span>"+a[0]+"</span>"),i.push("<span>"+(s[n].publishStartDate?common.longMsTimeToDateTime(s[n].publishStartDate):"")+"</span>"),i.push("</div>"),i.push("<p>"+o.content+"</p>"),i.push("</div>")}e.html(i.join("")),$("#TradeArticleTab .detail p span").attr("style",""),studioMbPop.loadingBlock($("#TradeArticleTab"),!0)})},showViewSelect:function(t){var e=$("#dialog_list");"analyst"==t?(e.children("[utype!=2]").hide(),e.children("[utype=2]").show()):"me"==t?(e.children("[isMe=false]").hide(),e.children("[isMe=true]").show()):e.children().show(),studioChatMb.setTalkListScroll()},getSendMsg:function(t){if(t=t||$("#contentText"),t.text().length+t.find("img").size()>140)return studioMbPop.showMessage("消息内容超过最大长度限制（140字以内）！"),!1;var e=t.html();return e=common.clearMsgHtml(e),common.isBlank(e)?(t.html(""),!1):(t.find(".txt_dia").length>0&&(t.find(".txt_dia").remove(),e=t.html()),e)},getToUser:function(){var t=$("#contentText .txt_dia");if(t.length>0){var e={userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype")},i=t.find("input");return i.length>0&&(e.question=i.val()),e}return null},formatPublishTime:function(t){return common.isBlank(t)?"":common.getHHMM(Number(t.replace(/_.+/g,"")))},setDialog:function(t,e,i,s,o,a){if(2==s&&$("#teacherListId li[uid='"+t+"'] a.te_btn").addClass("on"),1==i){studioChat.fillWhBox(s,t,e,!1),studioChat.getWhBox().show();var n=$(".mult_dialog a[uid="+t+"]");n.click(),common.isValid(o)&&n.find("img").attr("src",o)}else{if("visitor"==studioChatMb.userInfo.clientGroup)return;$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,""));var r=a?'<input type="hidden" value="'+a+'">':"";$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+s+'">'+r+"@<label>"+e+"</label></span>&nbsp;").focusEnd()}},setContent:function(t,e,i){var s=t.fromUser;if(e&&(s.publishTime=t.uiId),t.isVisitor)return void $("#"+t.uiId).remove();if(i&&$("#"+s.publishTime).length>0)return $("#"+s.publishTime+" .dialog em[class=ruleTipStyle]").remove(),void $("#"+s.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",s.publishTime):$("#"+t.uiId+" .dialog").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(!e&&studioChatMb.userInfo.userId==s.userId&&t.serverSuccess)return $("#"+t.uiId+" .uname span").html(studioChatMb.formatPublishTime(s.publishTime)),void $("#"+t.uiId).attr("id",s.publishTime);var o=studioChatMb.formatContentHtml(t,e,i),a=$("#dialog_list"),n=$("#talkPanel"),r=n.scrollTop()+n.height()+30>=n.get(0).scrollHeight;a.append(o),r&&studioChatMb.setTalkListScroll(),this.formatMsgToLink(s.publishTime);var l=$(".view_select .selectlist a[class=on]").attr("t");"all"!=l&&studioChatMb.showViewSelect(l),$("#"+s.publishTime+" .c-menu a").click(function(){var t=$(this).parents(".c-menu");studioChatMb.setDialog(t.attr("uid"),t.attr("nk"),$(this).attr("t"),t.attr("utype"))}),$("#"+s.publishTime+" .headimg").click(function(){$("#"+s.publishTime+" .c-menu a[t=0]").trigger("click")}),$("#"+s.publishTime+" .txt_dia").click(function(){studioChatMb.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+s.publishTime+" .uname").click(function(){$("#"+s.publishTime+" .c-menu a[t=0]").trigger("click")})},formatContentHtml:function(t,e,i){var s="clearfix ",o="",a="false",n=t.fromUser,r=t.content,l=n.nickname,u=n.toUser,d=[];u&&common.isValid(u.userId)?(common.isValid(u.question)?(d.push('<p class="question"><em>'),d.push('<strong class="asker" uid="'+u.userId+'" utype="'+u.userType+'">'+u.nickname+"</strong>"),d.push("提问：</em>"),d.push("<span>"+u.question+"</span>"),d.push("</p>"),d.push('<p class="reply"><span>回复：</span>'),d.push(r.value),d.push("</p>")):(d.push('<span class="txt_dia" uid="'+u.userId+'" utype="'+u.userType+'">'),d.push("@<label>"+u.nickname+"</label>"),d.push("</span>"),d.push(r.value)),studioChatMb.userInfo.userId==u.userId&&(a="true")):d.push(r.value),studioChatMb.userInfo.userId==n.userId?(s+="me-li",l="我",a="true"):(2==n.userType&&(s+="expert-li"),1==n.userType&&(s+="visitor-li"),o=studioChatMb.getDialogHtml(n.userId,l,n.userType),!i&&u&&studioChatMb.userInfo.userId==u.userId&&($("#top_msg label").html(n.nickname+":@"+u.nickname).attr("tId",u.userId).attr("fuType",n.userType).attr("fnickname",n.nickname).attr("fuserId",n.userId),$("#top_msg span").html(r.value),$("#top_msg").slideDown()));var h=[];return h.push('<li class="'+s+'" id="'+n.publishTime+'" isMe="'+a+'" utype="'+n.userType+'" mType="'+r.msgType+'" t="header">'),h.push('<div class="headimg" uid="'+n.userId+'">'),h.push(studioChatMb.getUserAImgCls(n.clientGroup,n.userType,n.avatar)),h.push("</div>"),h.push('<div class="detail">'),h.push('<span class="uname">'),studioChatMb.userInfo.userId==n.userId?(h.push("<span>"+studioChatMb.formatPublishTime(n.publishTime)+"</span>"),h.push("<strong>"+l+"</strong>")):(h.push("<strong>"+l+"</strong>"),h.push("<span>"+studioChatMb.formatPublishTime(n.publishTime)+"</span>")),h.push("</span>"),h.push('<div class="dialog">'+d.join("")+"</div>"),h.push("</div>"),h.push(o),h.push("</li>"),h.join("")},formatMsgToLink:function(t){$("#"+t+' .dcont:contains("http:"),#'+t+' .dcont:contains("https:")').each(function(t,e){var i,s=$(e).html(),o=s.split(/<img src="\S+">/g);for(var a in o)if(i=o[a],!common.isBlank(i)){var n=i.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+'" target="_blank" style="color:#3181c6;">'+t+"</a>"});e.innerHTML=e.innerHTML.replace(i,n)}})},getUserAImgCls:function(t,e,i){var s="";return e&&0!=e&&common.isValid(i)?'<img src="'+i+'">':(s="vip"==t?"user_v":"real"==t?"user_r":"simulate"==t?"user_d":"register"==t?"user_m":"user_c",'<img src="images/studio/'+s+'.png">')},leaveRoomTip:function(t){if("visitor"!=studioChatMb.userInfo.clientGroup){var e="";"roomClose"==t&&(e="房间已停用，"),"otherLogin"==t&&(e="您的账号已在其他地方登陆，"),studioMbPop.showMessage("注意："+e+"正自动登出....."),window.setTimeout(function(){window.location.href="/studio/logout"},3e3)}},getDialogHtml:function(t,e,i){if(studioChatMb.userInfo.userId!=t){var s=!1,o=$("#studioListId a[class~=ing]"),a='<div class="c-menu" style="display:none;" nk="'+e+'" uid="'+t+'" utype="'+i+'">';return a+="<ul>",-1==studioChatMb.userInfo.userId.indexOf("visitor_")&&-1==t.indexOf("visitor_")&&(a+='<li><a href="javascript:void(0)" t="0"><i></i>@TA</a></li>',s=!0),"true"==o.attr("aw")&&common.containSplitStr(o.attr("awr"),i)&&(a+='<li><a href="javascript:void(0)" t="1"><i></i>私信</a></li>',s=!0),a+="</ul>",s?a+"</div>":""}return""},formatUserToContent:function(t){var e={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,position:t.position};studioChatMb.setContent({fromUser:e,content:t.content},!1,!0)},talkBoxPush:{initTBP:function(t){this.clear(),studioChatMb.pushObj.talkPush=t,this.start()},clear:function(){studioChatMb.pushObj.talkPushInterval&&(window.clearInterval(studioChatMb.pushObj.talkPushInterval),studioChatMb.pushObj.talkPushInterval=null);for(var t=studioChatMb.pushObj.talkPush,e=null,i=0,s=t.length;s>i;i++)e=t[i],e.timeoutId&&window.clearTimeout(e.timeoutId),e.intervalId&&window.clearInterval(e.intervalId)},start:function(){var t=studioChatMb.pushObj.talkPush;t&&t.length>0&&window.setInterval(function(){studioChatMb.talkBoxPush.check()},1e4)},check:function(){for(var t=studioChatMb.pushObj.talkPush,e=null,i=0,s=t.length;s>i;i++)e=t[i],e.startFlag||common.dateTimeWeekCheck(e.pushDate,!1,studioChatMb.serverTime)&&(e.startFlag=!0,window.setTimeout(studioChatMb.talkBoxPush.delayStartTask(e),60*(e.onlineMin||0)*1e3))},delayStartTask:function(t){return function(){studioChatMb.talkBoxPush.showMsg(t),t.intervalMin&&t.intervalMin>0&&(t.intervalId=window.setInterval(studioChatMb.talkBoxPush.startTask(t),60*t.intervalMin*1e3))}},startTask:function(t){return function(){common.dateTimeWeekCheck(t.pushDate,!1,studioChatMb.serverTime)?studioChatMb.talkBoxPush.showMsg(t):(window.clearInterval(t.intervalId),t.startFlag=!1)}},showMsg:function(t){var e=[];e.push('<li class="clearfix push">'),e.push(t.content),e.push("</div>"),$("#dialog_list").append(e.join(""));var i=$("#talkPanel"),s=i.scrollTop()+i.height()+30>=i.get(0).scrollHeight;s&&studioChatMb.setTalkListScroll()}}};