var studioChat={filePath:"",msgType:{text:"text",img:"img",file:"file"},socket:null,socketUrl:"",userInfo:null,init:function(){this.setEvent(),this.setSocket(),this.setVideo()},setVideo:function(){try{if(0==$("#yyVideoDiv embed").length){var t=$("#yyVideoDiv"),e=t.attr("yc"),s=t.attr("mc");$('<embed src="http://yy.com/s/'+e+(common.isValid(s)?"/"+s:"")+'/yyscene.swf" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>').appendTo("#yyVideoDiv")}$("#yyVideoDiv").show()}catch(i){console.error("setVideo has error:"+i)}},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getVisitorList:function(t){if(!common.isBlank(t))try{$(".searchResult").hide(),$(".searchResult ul").html(""),$.getJSON("/studio/getVistiorByName",{groupType:studioChat.userInfo.groupType,groupId:studioChat.userInfo.groupId,nickname:t},function(t){if(t){$(".searchResult").show();var e=0,s="";for(var i in t)s=t[i].userId||t[i].visitorId,$(".searchResult ul li[uid="+s+"]").length>0||(e=t[i].onlineStatus,$(".searchResult ul").append('<li uid="'+s+'"  '+(1==e?"":'class="off"')+"><label>"+t[i].nickname+"</label></li>"));$(".searchResult ul li").click(function(){$(".searchResult").hide();var t=$(this).attr("uid");studioChat.setWhVisitors(-1!=t.indexOf("visitor_")?-1:0,t,$(this).find("label").text(),!$(this).hasClass("off")),$(".visitorDiv ul li[uid="+$(this).attr("uid")+"]").click()})}})}catch(e){alert("查询异常,请联系管理员！"),console.error("getVistiorByName->"+e)}},setWhBox:function(t){t&&$("#newMsgShowBtn").attr("t","hide"),$("#newMsgTipBtn").click()},setWhTipInfo:function(t){t&&$("#newMsgTipBtn").attr("uid",t),studioChat.setWhTipImgPlay(t)},sendWhMsg:function(t){var e=studioChat.getSendMsg(t);if(e!==!1){var s={uiId:studioChat.getUiId(),fromUser:studioChat.userInfo,content:{msgType:studioChat.msgType.text,value:e}},i=$(".visitorDiv ul li[class~=on]");s.fromUser.toUser={userId:i.attr("uid"),nickname:i.find("label").text(),talkStyle:1,userType:i.attr("utype")},studioChat.socket.emit("sendMsg",s),studioChat.setWhContent(s,!0,!1),t.html("")}},setWhOnlineTip:function(t,e,s){if(e){if(s){var i="";"-1"==s.userType&&common.isValid(s.loginId)?(i=$(".visitorDiv ul li[uid="+s.loginId+"]"),i.length>0&&(i.attr("uid",s.userId),$("#wh_msg_"+s.loginId).attr("id","wh_msg_"+s.userId))):"0"==s.userType&&common.isValid(s.visitorId)&&(i=$(".visitorDiv ul li[uid="+s.visitorId+"]"),i.length>0&&(i.attr("uid",s.userId),$("#wh_msg_"+s.visitorId).attr("id","wh_msg_"+s.userId)));var a=$("#wh_msg_"+t+" .wh-title label").text(),o=$("#wh_msg_"+t+" .wh-title .title-tip");common.isValid(a)&&a!=s.nickname?o.text("账号转变:"+a+" --> "+s.nickname).show():o.text("").hide(),$(".visitorDiv ul li[uid="+t+"] label,#wh_msg_"+t+" .wh-title label").text(s.nickname)}$(".visitorDiv ul li[uid="+t+"]").removeClass("off"),$("#wh_msg_"+t+" .wh-title strong").text("在线")}else $(".visitorDiv ul li[uid="+t+"]").addClass("off"),$("#wh_msg_"+t+" .wh-title strong").text("离线")},setWhVisitors:function(t,e,s,i,a){if(0==$(".visitorDiv ul li[uid="+e+"]").length){$(".visitorDiv ul").append('<li uid="'+e+'"  '+(i?"":'class="off"')+' utype="'+t+'"><span  class="user-row"><label>'+s+'</label><em class="close ym" t="0"></em></span></li>');var o=$(".visitorDiv ul li[uid="+e+"]");if(a){var n=o.find(".close"),r=parseInt(n.attr("t"))+1;n.attr("t",r).text(r).addClass("ym")}o.find(".close").click(function(){var t=$(this).parent().parent();t.remove(),$("#wh_msg_"+t.attr("uid")).remove(),$(".visitorDiv ul li").length>0&&$(".visitorDiv ul li:last").click()}),o.click(function(){$(".visitorDiv ul li").removeClass("on"),$(this).addClass("on"),$(this).find(".close").attr("t",0).text("").removeClass("ym");var t=$(this).attr("uid"),e="wh_msg_"+t;if(studioChat.closeWhTipMsg(t),$(".wh-right").children().hide(),0==$("#"+e).length){var s='<div id="'+e+'" class="wh-tab-msg"><div class="wh-title"><span><label>'+$(this).find("label").text()+'</label>【<strong></strong>】</span><span class="title-tip"></span></div><div class="wh-content"></div><div class="wh-txt"><div class="toolbar"><a href="javascript:" class="facebtn" style="">表情</a></div><div contenteditable="true" class="ctextarea" id="whTxt_'+t+'" data-placeholder="按回车键发送"></div></div></div>';$(".wh-right").append(s),$("#"+e).find(".ctextarea").keydown(function(t){return 13==t.keyCode?(studioChat.sendWhMsg($(this)),!1):void 0}),$("#"+e).find(".facebtn").qqFace({id:"faceId_"+t,zIndex:1e6,assign:"whTxt_"+t,path:studioChat.filePath+"/face/"}),studioChat.socket.emit("getWhMsg",{groupId:studioChat.userInfo.groupId,groupType:studioChat.userInfo.groupType,userId:studioChat.userInfo.userId,toUserId:t})}else $("#"+e).show(),studioChat.setTalkListScroll(!0,$("#"+e+" .wh-content"),"dark");studioChat.setWhOnlineTip(t,!$(this).hasClass("off"))})}},getWhBox:function(){return $(".window-container[wid=newMsgShowBtn]")},setWhTipImgPlay:function(t){$(".wh_msg_ftip").attr("uid",t).attr("k",1).show().addClass("have"),$("#userListId li[id="+t+"]").attr("k",1),studioChat.whTipIntervalId=setInterval(function(){$("#userListId li[k=1],.wh_msg_ftip[k=1]").toggleClass("have_op")},1e3)},closeWhTipMsg:function(t){$(".wh_msg_ftip[uid="+t+"]").attr("k",0).removeClass("have have_op"),$("#userListId li[id="+t+"]").attr("k",0).removeClass("have_op"),0==$("#userListId[k=1]").length&&0==$(".wh_msg_ftip[k=1]").length&&studioChat.whTipIntervalId&&(clearInterval(studioChat.whTipIntervalId),studioChat.whTipIntervalId=null)},fillWhBox:function(t,e,s,i,a){var o=this.getWhBox();if(0==o.length)return studioChat.setWhBox(!0),studioChat.setWhVisitors(t,e,s,!0,a),i&&studioChat.setWhTipInfo(e),!1;var n=$(".visitorDiv ul li[uid="+e+"]");if(0==n.length){if(studioChat.setWhVisitors(t,e,s,!0,a),!o.is(":hidden"))return!1;i&&studioChat.setWhTipInfo(e)}else{if(a&&!n.hasClass("on")){var r=n.find(".close"),l=parseInt(r.attr("t"))+1;r.attr("t",l).text(l).addClass("ym")}if(o.is(":hidden")){var u=$("#wh_msg_"+e+" .wh-content");if(0==u.length)return!1;i&&studioChat.setWhTipImgPlay(e)}else!n.hasClass("on")&&i&&studioChat.setWhTipImgPlay(e)}return!0},setWhContent:function(t,e,s){var i=t.fromUser,a="dialog ",o=t.content,n="";if(t.rule)return void $("#"+t.uiId+" .dcont").append('<em class="ruleTipStyle">'+t.value.tip+"</em>");if(s||(i.toWhUserId=i.userId),studioChat.userInfo.userId==i.userId){if(e&&(i.publishTime=t.uiId,i.toWhUserId=i.toUser.userId),t.serverSuccess)return $("#"+t.uiId+" .dtime").html(studioChat.formatPublishTime(i.publishTime)),void $("#"+t.uiId).attr("id",i.publishTime);a+="mine",n='<span class="wh-dia-title"><label class="dtime">'+studioChat.formatPublishTime(i.publishTime,s,"/")+'</label><label class="wh-nk">我</label></span>'}else{if(!s&&!this.fillWhBox(i.userType,i.userId,i.nickname,!0,!0))return!1;n='<span class="wh-dia-title"><label class="wh-nk">'+i.nickname+'</label><label class="dtime">'+studioChat.formatPublishTime(i.publishTime,s,"/")+"</label></span>"}if(common.isBlank(i.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var r='<div class="'+a+'" id="'+i.publishTime+'" utype="'+i.userType+'" mType="'+o.msgType+'" t="header"><div>'+n+'</div><p><span class="dcont">'+o.value+"</span></p></div>",l=$("#wh_msg_"+i.toWhUserId+" .wh-content"),u=l.find(".mCSB_container");u.length>0?u.append(r):l.append(r),this.formatMsgToLink(i.publishTime),s||studioChat.setTalkListScroll(!0,l,"dark")},setEvent:function(){$("#header_img_id").attr("src",studioChat.userInfo.avatar),jqWindowsEngineZIndex=1e5,$("#newMsgTipBtn").click(function(){var t=$(this).attr("uid");studioChat.closeWhTipMsg(t);var e=studioChat.getWhBox();if(e.length>0)return e.show(),void $(".visitorDiv ul li[uid="+t+"]").click();var s=[];s.push('<div class="wh-box"><div class="wh-left"><div class="searchDiv">'),s.push('<input type="text" id="vSearchTxt"/><a href="javascript:" id="vSearchTxtBtn"><em></em></a>'),s.push('<div class="searchResult"><ul></ul></div></div><div class="visitorDiv">'),s.push('<ul></ul></div></div><div class="wh-right"></div></div>'),$("#newMsgShowBtn").newWindow({windowTitle:"私聊",content:s.join(""),windowType:"normal",minimizeButton:!0,maximizeButton:!1,statusBar:!1,resizeIcon:"",width:680,height:550,beforeMinimize:function(t){return t.hide(),!1}}),$("#newMsgShowBtn").click(),$("#vSearchTxt").keydown(function(t){13==t.keyCode&&studioChat.getVisitorList(this.value)}),$("#vSearchTxtBtn").click(function(){studioChat.getVisitorList($("#vSearchTxt").val())})}),$(".wh_msg_ftip").click(function(){var t=$(this).attr("uid");studioChat.closeWhTipMsg(t);var e=studioChat.getWhBox();e.length>0?($(".visitorDiv ul li[uid="+t+"]").click(),e.show()):$("#newMsgTipBtn").click()}),$("#approveAllHandler button").click(function(){var t=[],e=[];return $("#dialog_list .approve input:checked").each(function(){var s=$(this).parents("div");t.push(s.attr("id"));for(var i=s.attr("fuId"),a=!1,o=0,n=e.length;n>o;o++)if(i===e[o]){a=!0;break}a||e.push(i)}),0==t.length?(alert("请选择聊天记录！"),!1):void studioChat.socket.emit("approvalMsg",{fromUser:studioChat.userInfo,status:$(this).attr("btnType"),publishTimeArr:t,fuIdArr:e})}),$("#approveCheckAll").click(function(){var t=$(this).prop("checked");$("#dialog_list .approve input[type=checkbox]").each(function(){$(this).prop("checked",t)})}),$(document).click(function(t){$("div[id^=faceId]").hide(),$(t.target).hasClass("headimg")||$(t.target).parent().hasClass("headimg")||"header"==$(t.target).parent().attr("t")||$(t.target).hasClass("uname")||$(".dialogbtn").hide(),$(t.target).hasClass("searchResult")||$(".searchResult").hide()}),$(".facebtn").qqFace({id:"faceId",assign:"contentText",path:studioChat.filePath+"/face/"}),$(".replybtn").click(function(){studioChat.setDialog($(this).attr("uId"),$(".sender").html(),$(this).attr("ts"),$(this).attr("futype")),$(".mymsg em").show()}),$(".closebtn").click(function(){$(".mymsg,.mymsg em").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),studioChat.setTalkListScroll()}),$(".scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),studioChat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),studioChat.showViewSelect($(this).attr("t")),studioChat.setTalkListScroll(!0))}),$("#contentText").keydown(function(t){return 13==t.keyCode?($("#sendBtn").click(),!1):void 0}).autocomplete({source:function(t,e){/^@.*$/g.test(t.term)&&e(studioChat.searchUserList(t.term.substring(1,t.term.length)))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(t,e){return $("#contentText").html("").append('<span class="txt_dia" contenteditable="false" uid="'+e.item.value+'" utype="'+e.item.userType+'">@<label>'+e.item.label+"</label></span>"),$("#contentText").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(t,e){return $("<li>").append("<a>"+e.label+"</a>").appendTo(t)},$("#sendBtn").click(function(){var t=studioChat.getToUser(),e=studioChat.getSendMsg();if(e!==!1){var s={uiId:studioChat.getUiId(),fromUser:studioChat.userInfo,content:{msgType:studioChat.msgType.text,value:e}},i=$(".replybtn");t&&t.userId==i.attr("uId")&&t.talkStyle==i.attr("ts")&&$(".mymsg,.mymsg em").hide(),s.fromUser.toUser=t,studioChat.socket.emit("sendMsg",s),studioChat.setContent(s,!0,!1),$("#contentText").html("")}})},searchUserList:function(t){var e=$("#userListId li[t!=14][t!=0]").map(function(){var e=$(this).find(".uname").text();return-1!=e.indexOf(t)?{value:this.id,label:e,userType:$(this).attr("utype")}:null}).get();return e},showViewSelect:function(t){"analyst"==t?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"me"==t?($("#dialog_list").children("[isMe=false]").hide(),$("#dialog_list").children("[isMe=true]").show()):$("#dialog_list").children().show()},getSendMsg:function(t){var t=t?t:$("#contentText"),e=t.html();return e=e.replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,""),common.isBlank(e)?(t.html(""),!1):(t.find(".txt_dia").length>0&&(t.find(".txt_dia").remove(),e=t.html()),e)},setListScroll:function(t){$(t).hasClass("mCustomScrollbar")?$(t).mCustomScrollbar("update"):$(t).mCustomScrollbar({scrollButtons:{enable:!0},theme:"dark"})},setTalkListScroll:function(t,e,s){var i=e?e:$("#chatMsgContentDiv");i.hasClass("mCustomScrollbar")?(i.mCustomScrollbar("update"),t&&i.mCustomScrollbar("scrollTo","bottom")):(i.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!0},theme:s?s:"light-2"}),i.mCustomScrollbar("scrollTo","bottom"))},getToUser:function(){var t=$("#contentText .txt_dia");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype")}:null},formatPublishTime:function(t,e,s){var i=Number(t.replace(/_.+/g,""));return common.isBlank(t)?"":e?common.formatterDateTime(i,s):common.getHHMM(i)},setDialog:function(t,e,s,i){1==s?(studioChat.fillWhBox(i,t,e,!1),studioChat.getWhBox().show(),$(".visitorDiv ul li[uid="+t+"]").click()):($("#contentText .txt_dia").remove(),$("#contentText").prepend('<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+i+'">@<label>'+e+"</label></span>"),$("#contentText").focusEnd())},setContent:function(t,e,s){var i=t.fromUser;if(e&&(i.publishTime=t.uiId),s&&$("#"+i.publishTime).length>0)return $("#"+i.publishTime+" .dcont em[class=ruleTipStyle]").remove(),void $("#"+i.publishTime+" .approve").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",i.publishTime):$("#"+t.uiId+" .dcont").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(!e&&studioChat.userInfo.userId==i.userId&&t.serverSuccess)return $("#"+t.uiId+" .dtime").html(studioChat.formatPublishTime(i.publishTime)),void $("#"+t.uiId).attr("id",i.publishTime);var a=studioChat.formatContentHtml(t,e,s),o=$("#dialog_list");o.append(a),this.formatMsgToLink(i.publishTime);var n=$(".view_select .selectlist a[class=on]").attr("t");"all"!=n&&studioChat.showViewSelect(n),!s&&$(".scrollbtn").hasClass("on")&&studioChat.setTalkListScroll(!0),$("#"+i.publishTime+" .headimg").click(function(){studioChat.openDiaLog($("#"+i.publishTime+" .dialogbtn"))}),$("#"+i.publishTime+" .uname").click(function(){var t=$("#"+i.publishTime+" .dialogbtn");studioChat.openDiaLog(t),t.css("left","62px"),t.css("top","30px")}),$("#"+i.publishTime+" .txt_dia").click(function(){$("#contentText .txt_dia").remove(),$("#contentText").prepend('<span class="txt_dia" contenteditable="false" uid="'+$(this).attr("uid")+'" utype="'+$(this).attr("utype")+'">@<label>'+$(this).find("label").text()+"</label></span>").focusEnd()}),$("#"+i.publishTime+" .approve button").click(function(){var t=[],e=[],s=$(this).parents("div");t.push(s.attr("id")),e.push(s.attr("fuId")),studioChat.socket.emit("approvalMsg",{fromUser:studioChat.userInfo,status:$(this).attr("btnType"),publishTimeArr:t,fuIdArr:e})})},openDiaLog:function(t){$(".dialogbtn").not(t).hide(),t.css("left","0");var e=t.parent();if(common.isValid(e.attr("utype"))){var s=0===e.next().size();t.parent().hasClass("analyst")?t.css("top",s?"-67px":"53px"):t.css("top",s?"-39px":"39px")}return t.is(":hidden")?(t.show(),void t.find("a").click(function(){var t=$(this).parent();studioChat.setDialog(t.attr("uId"),t.attr("nk"),$(this).attr("t"),t.attr("utype")),t.hide()})):(t.hide(),!1)},formatContentHtml:function(t,e,s){var i="dialog ",a="",o="",n="uname ",r="false",l=t.fromUser,u=t.content,d=l.nickname,h=l.toUser,c="";h&&common.isValid(h.userId)&&(c='<span class="txt_dia" uid="'+h.userId+'" utype="'+h.userType+'">@<label>'+h.nickname+"</label></span>",studioChat.userInfo.userId==h.userId&&(r="true")),a=u.value,studioChat.userInfo.userId==l.userId?(i+="mine",d="我",r="true"):(2==l.userType&&(i+="analyst"),1==l.userType&&(i+="admin"),o=studioChat.getDialogHtml(l.userId,d,l.userType),!s&&h&&studioChat.userInfo.userId==h.userId&&($(".mymsg").show(),$(".mymsg em").hide(),$(".replybtn").attr("uId",l.userId),$(".replybtn").attr("ts",h.talkStyle),$(".replybtn").attr("futype",l.userType),$(".sender").html(l.nickname),$(".xcont").html(a)));var p='<div class="'+i+'" id="'+l.publishTime+'" isMe="'+r+'" utype="'+l.userType+'" mType="'+u.msgType+'" t="header"><a href="javascript:" class="headimg" uId="'+l.userId+'">'+studioChat.getUserAImgCls(l.clientGroup,l.userType,l.avatar)+'</a><i></i><p><a href="javascript:"  class="'+n+'">'+d+'</a><span class="dtime">'+studioChat.formatPublishTime(l.publishTime)+"</span>";return 0==u.status&&(p+='<span class="approve"><input type="checkbox"/><button btnType="1">通过</button><button btnType="2">拒绝</button></span>',$("#approveAllHandler").show()),p+='<span class="dcont">'+c+a+"</span></p>"+o+"</div>"},formatMsgToLink:function(t){$("#"+t+' .dcont:contains("http:"),#'+t+' .dcont:contains("https:")').each(function(t,e){var s=$(e).html(),i=s.split(/<img src="\S+">/g),a="";for(var o in i)if(a=i[o],!common.isBlank(a)){var n=a.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+'" target="_blank" style="color:#3181c6;">'+t+"</a>"});e.innerHTML=e.innerHTML.replace(a,n)}})},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getUserAImgCls:function(t,e,s){var i="";return e&&0!=e&&common.isValid(s)?'<img src="'+s+'">':(i="vip"==t?"user_v":"real"==t?"user_r":"simulate"==t?"user_d":"register"==t?"user_m":"user_c",'<img src="/images/studio/'+i+'.png">')},getDialogHtml:function(t,e,s){if(studioChat.userInfo.userId!=t&&-1==studioChat.userInfo.userId.indexOf("visitor_")){var i=!1,a=$("#groupInfoId"),o='<div class="dialogbtn" style="display:none;" nk="'+e+'" uId="'+t+'" utype="'+s+'">';return-1==t.indexOf("visitor_")&&(o+='<a href="javascript:" class="d1" t="0"><span>@TA</span></a>',i=!0),"true"==a.attr("aw")&&common.containSplitStr(a.attr("awr"),studioChat.userInfo.userType)&&(o+='<a href="javascript:" class="d2" t="1"><span>私聊</span></a>',i=!0),i?o+"</div>":""}return""},setOnlineUser:function(t){$("#userListId li[id='"+t.userId+"']").remove();var e=studioChat.getDialogHtml(t.userId,t.nickname,t.userType),s="",i="uname",a=t.sequence;studioChat.userInfo.userId==t.userId&&(s="【我】",i+=" ume",a="0");var o=$("#userListId li"),n='<li id="'+t.userId+'" t="'+a+'" utype="'+t.userType+'">'+e+'<a href="javascript:" t="header" class="uname"><div class="headimg">'+studioChat.getUserAImgCls(t.clientGroup,t.userType,t.avatar)+"</div>"+t.nickname+s+"</a></li>";if(0==o.length)$("#userListId").append(n);else if(""!=s)o.first().before(n);else{var r=!1,l=0,u="";o.each(function(){return l=parseInt($(this).attr("t")),t.sequence<l?($(this).before(n),r=!0,!1):t.sequence==l?(u=$(this).find("a").text(),t.nickname<=u&&$(this).before(n),r=!0,!1):void 0}),r||$("#userListId").append(n)}return common.isValid(e)&&$("#userListId li[id="+t.userId+"] a[t=header]").click(function(){var t=$(this).parent();studioChat.closeWhTipMsg(t.attr("id")),$(".dialogbtn").hide(),$(".user_box li").removeClass("zin"),t.addClass("zin"),studioChat.openDiaLog($(this).prev()),$(".dialogbtn",$(this).parent()).css("left","7px")}),!0},leaveRoomTip:function(t){if("visitor"!=studioChat.userInfo.clientGroup){var e="";"roomClose"==t&&(e="房间已停用，"),"otherLogin"==t&&(e="您的账号已在其他地方进入该房间，"),"forcedOut"==t&&(e="您已被管理员强制退出房间，"),$("#tipMsgBox").fadeIn(0).delay(6e3).fadeOut(200).find("span").text("注意："+e+"正自动退出....."),window.setTimeout(function(){window.close()},3e3)}},setSocket:function(){this.socket=common.getSocket(io,this.socketUrl,this.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),studioChat.userInfo.socketId=studioChat.socket.id;var t=$("#groupInfoId");studioChat.socket.emit("login",{userInfo:studioChat.userInfo,lastPublishTime:$("#content_ul li:last").attr("id"),fUserTypeStr:t.attr("awr"),allowWhisper:t.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(t){var e=null;for(var s in t)e=t[s],studioChat.setOnlineUser(e);$("#onLineSizeNum").text($("#userListId li").length)}),this.socket.on("disconnect",function(t){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle?studioChat.setWhContent(t,!1,!1):studioChat.setContent(t,!1,!1)}),this.socket.on("notice",function(t){switch(t.type){case"onlineNum":var e=t.data,s=e.onlineUserInfo;e.online?studioChat.setOnlineUser(s):studioChat.userInfo.userId!=s.userId&&$("#userListId #"+s.userId).remove(),studioChat.setWhOnlineTip(s.userId,e.online,s),$("#onLineSizeNum").text($("#userListId li").length);break;case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),studioChat.setTalkListScroll();break;case"leaveRoom":studioChat.leaveRoomTip(t.flag);break;case"approvalResult":var e=t.data;if(e.fromUserId==studioChat.userInfo.userId)if(e.isOK){var i=e.publishTimeArr;if(2==e.status){for(var a in i)$("#"+i[a]).remove();studioChat.setTalkListScroll()}else for(var a in i)$("#"+i[a]+" .approve").remove();$("#approveCheckAll").prop("checked",!1),0==$("#dialog_list .approve").size()&&$("#approveAllHandler").hide()}else alert("操作出现异常，请重新执行！");else if(e.refuseMsg){var i=e.publishTimeArr;for(var a in i)$("#"+i[a]).remove();studioChat.setTalkListScroll()}else{for(var a in e)studioChat.formatUserToContent(e[a]);studioChat.setTalkListScroll(!0)}}}),this.socket.on("loadMsg",function(t){$(".img-loading[pf=chatMessage]").hide();var e=t.msgData,s=t.isAdd;if(s||$("#content_ul").html(""),e&&$.isArray(e)){e.reverse();for(var i in e){var a=e[i];a.content.status=a.status,studioChat.formatUserToContent(a)}studioChat.setTalkListScroll(!0)}}),this.socket.on("loadWhMsg",function(t){var e=t.data;if("offline"==t.type){if(e&&!$.isEmptyObject(e)){studioChat.setWhBox(!0);var s="";for(var i in e)s=i,studioChat.setWhVisitors(e[i].userType,i,e[i].nickname,$("#userListId li[id='"+i+"']").length>0);studioChat.setWhTipInfo(s)}}else if(e&&$.isArray(e)){e.reverse(),console.log("data.length:",e.length);for(var a in e){var o=e[a];o.content.status=o.status,studioChat.formatUserToContent(o,!0,t.toUserId)}studioChat.setTalkListScroll(!0,$("#wh_msg_"+t.toUserId+" .wh-content"),"dark")}})},formatUserToContent:function(t,e,s){var i={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,avatar:t.avatar};e?(i.toWhUserId=s,studioChat.setWhContent({fromUser:i,content:t.content},!1,!0)):studioChat.setContent({fromUser:i,content:t.content},!1,!0)}};$(function(){studioChat.init()});