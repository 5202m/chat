function openLive800Chat(t,e){var i="https://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&s=1";t?location.href=i+e:window.open(i+e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonv3(t){var e="http://crm2.qq.com/page/portalpage/wpa.php?uin=800018282&cref=&ref=&f=1&ty=1&ap=&as=";window.open(e+(t||""),"QQChatindow","height=544, width=644,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}function openQQChatByCommonjs(t){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018282";window.open(e+(t||""))}function live800Prompt(t,e){window.onbeforeunload=null;var i="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886",n="http://onlinecustomer-service.gwghk.com/live800/chatClient/chatbox.jsp?companyID=283&enterurl=http%3A%2F%2Fwww%2Egwfx%2Ecom%2F&tm=1355377642406";if(e=e||"",2==t)try{UUID.prototype.createUUID();window.open(i+e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(i+e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}else try{UUID.prototype.createUUID();window.open(n+e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(a){window.open(n+e)}}function qqPrompt(t){var e="http://wpa.b.qq.com/cgi/wpa.php?ln=2&uin=800018886";window.onbeforeunload=null;try{var i=UUID.prototype.createUUID();getGacookiesTrack(i,"2","1"),window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}catch(n){window.open(e,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}}function UUID(){this.id=this.createUUID()}function getMarketpriceCrossDomainIndex(t,e){$.ajax({type:"GET",url:t,dataType:"jsonp",success:function(t){"OK"==t.code&&parseMarketpriceIndex(t,e)},error:function(){}})}function parseMarketpriceIndex(t,e){for(var i=2,n="",a=0,s=0,o=0,r=0;r<t.listResult.length;r++){n=t.listResult[r].symbol,a=t.listResult[r].deltaPrice,o=t.listResult[r].price,s=t.listResult[r].deltaPercent,i="XAGUSD"==n||"USDJPY"==n?3:"EURUSD"==n?3:2,$("#price_"+n).html(parseFloat(o).toFixed(i));var l=$("#deltaPercent_"+n);l.text((100*s).toFixed(2)+"%"),e?a>0?"true"==l.attr("changeCss")&&l.removeClass(e.downCss).addClass(e.upCss):"true"==l.attr("changeCss")&&l.removeClass(e.upCss).addClass(e.downCss):(a>0?$("#price_"+n).parent().addClass("up"):$("#price_"+n).parent().removeClass("up"),$("#deltaPrice_"+n).html(parseFloat(a).toFixed(i)))}}function getAllMarketpriceIndex(t,e,i,n){try{window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket?pkMarketSocket?pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(e):(pkMarketSocket=new ReconnectingWebSocket(t,null,{reconnectInterval:3e3}),pkMarketSocket.onmessage=function(t){var e=JSON.parse(t.data);"OK"==e.code&&parseMarketpriceIndex(e,n)},pkMarketSocket.onopen=function(t){pkMarketSocket.readyState==WebSocket.OPEN&&pkMarketSocket.send(e)}):setInterval(function(){getMarketpriceCrossDomainIndex(i,n)},2e3)}catch(a){console.log("get price has error!")}}var common={daysCN:{0:"星期天",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},remove:function(t,e){return isNaN(e)||e>t.length?!1:void t.splice(e,1)},joinSplit:function(t){return",".concat(t).concat(",")},isBlank:function(t){return void 0==t||null==t||"undefined"==t||"null"==t||""==$.trim(t)},isValid:function(t){return!this.isBlank(t)},trim:function(t){return this.isBlank(t)?"":t.toString().replace(/(^\s*)|(\s*$)/g,"")},escapeHtml:function(t){return document.createElement("div").appendChild(document.createTextNode(t)).parentNode.innerHTML.replace(/"/g,'\\"')},encodeHtml:function(t){return this.isBlank(t)?"":t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},formatterDate:function(t,e){e||(e="-"),t instanceof Date||(t=new Date(t));var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate());return i},getHHMMSS:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return e},getMMSS:function(t){return t instanceof Date||(t=new Date(t)),(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},getHHMM:function(t){t instanceof Date||(t=new Date(t));var e=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return e},formatterDateTime:function(t,e){if(e||(e="-"),t instanceof Date||(t=new Date(t)),"Invalid Date"==t)return"";var i=t.getFullYear()+e+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+e+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());return i},longMsTimeToDateTime:function(t,e){var i=new Date(t);return this.formatterDateTime(i,e)},showBox:function(t,e){$(t).slideDown(),$(e||".layer-shadow").show()},hideBox:function(t,e){$(t).slideUp(),$(e||".layer-shadow").hide()},containSplitStr:function(t,e){return common.isBlank(t)||common.isBlank(e)?!1:-1!=(","+t+",").indexOf(","+e+",")},getJson:function(t,e,i,n,a){var s=null;return $.ajax({url:t,type:"POST",timeout:1e5,cache:!1,async:void 0!=n?n:!1,dataType:"json",data:e,success:"function"==typeof i?i:function(t){s=t},error:function(t,e){"function"==typeof a?a(e):common.isValid(t.responseText)&&"OK"!=t.statusText?alert(t.responseText):alert("请求超时,请重试!")}}),s},arraySort:function(t,e){return function(i,n){return e?i[t]<n[t]:i[t]>n[t]}},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},isMobilePhone:function(t){return/(^[0-9]{11})$|(^86(-){0,3}[0-9]{11})$/.test(t)},dateTimeWeekCheck:function(t,e,i){if(this.isBlank(t))return!!e;$.isPlainObject(t)||(t=JSON.parse(t));var n=i?new Date(i):new Date,a=!1,s=this.formatterDate(n);if(a=this.isBlank(t.beginDate)||s>=t.beginDate,a&&(a=this.isBlank(t.endDate)||s<=t.endDate),!a)return!1;var o=t.weekTime;if(this.isBlank(o))return a;var r=null,l=null,c=!1;for(var d in o)if(r=o[d],(!this.isValid(r.week)||n.getDay()==parseInt(r.week))&&(l=this.getHHMMSS(n),c=this.isBlank(r.beginTime)||l>=r.beginTime,c&&(c=this.isBlank(r.endTime)||l<=r.endTime),c))break;return c},arrayUnique:function(t){if(!t)return t;for(var e,i=[],n={},a=0;null!=(e=t[a]);a++)n[e]||(i.push(e),n[e]=!0);return i},isWebSocket:function(){return window.WebSocket},getSocket:function(t,e,i){return common.isWebSocket()?(console.log("used websocket!"),t.connect(e.webSocket+"/"+i,{transports:["websocket"]})):t.connect(e.socketIO+"/"+i)},refreshSession:function(){setInterval(function(){$.get("/refreshSession?t="+new Date,function(){})},9e5)},randomNumber:function(t){for(var e="",i=0;t>i;i++)e+=Math.floor(10*Math.random());return e},clearMsgHtml:function(t){var t=t.replace(/((^((&nbsp;)+))|\n|\t|\r)/g,"").replace(/<\/?(?!(img|IMG)\s+src="[^>"]+\/face\/[^>"]+"\s*>)[^>]*>/g,"");return t&&(t=$.trim(t)),t},formatToJson:function(t){return this.isBlank(t)?null:JSON.parse(t)},getSyllabusPlan:function(t,e){if(!t||!t.courses)return null;var i=function(t,e){if(t){var i=common.isMobile(),n=null;"object"!=typeof t&&(t=JSON.parse(t));for(var a in t)if(n=t[a],i){if(1==e&&3==n.code)return n.url}else if(n.code==e)return n.url}},n=function(e,n,a){var o=null,r=e.course;return r&&r.length>n?(o=r[n],0==o.status||common.isBlank(o.lecturerId)?null:(o.studioLink=i(t.studioLink,o.courseType),o.startTime=e.startTime,o.endTime=e.endTime,o.day=s[n].day,o.isNext=a,o)):null},a=null;a=this.isValid(t.courses)&&"object"!=typeof t.courses?JSON.parse(t.courses):t.courses;for(var s=a.days,o=a.timeBuckets,r=new Date(e).getDay(),l=common.getHHMM(e),c=null,d=!1,u=null,h=null,p=0;p<s.length;p++)if(0!=s[p].status)if(s[p].day>r){for(var m in o)if(c=o[m],h=n(c,p,!0))return h}else if(s[p].day==r)for(var m in o){if(c=o[m],c.startTime<=l&&c.endTime>=l)return d=!0,n(c,p,!1);if(!d&&c.startTime>l)return d=!0,n(c,p,!0)}else if(!u)for(var m=0;m<o.length;m++)if(h=o[m].course,h&&0!=h[p].status&&!common.isBlank(h[p].lecturerId)){u={dayIndex:p,tmIndex:m};break}return!d&&u?n(o[u.tmIndex],u.dayIndex,!0):null},formatSyllabus:function(t,e,i,n){var a={dayCN:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],indexCN:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节"],courseCls:["prev","ing","next"],tableCls:"syllabus",courseType:{0:"文字直播",1:"视频直播",2:"ONE TV"}},s=new Date(e).getDay(),o=this.getHHMM(e),r=$.extend({},a,n),l=function(t,e,i,n){var a=0,l=(t+6)%7,c=(s+6)%7;return a=l>c?2:c>l?0:n?1:o>=i?0:e>o?2:1,r.courseCls[a]},c=[];try{if(t){var d=$.isPlainObject(t)?t:JSON.parse(t),u=d.days?d.days.length:0;if(u>0)if(1===i){var h={0:"文字",1:"视频",2:"oneTV"};c.push('<div class="sy_panel">');var p=e-864e5*((s+6)%7),m=null,f=null,g=null;c.push('<div class="sy_nav">');for(var v=' style="width:'+100/u+'%;"',b=0;u>b;b++)m=new Date(p+(d.days[b].day+6)%7*864e5),f=m.getFullYear()+"-"+(m.getMonth()<9?"0":"")+(m.getMonth()+1)+"-"+(m.getDate()<10?"0":"")+m.getDate(),g=d.days[b].day==s?' class="active"':"",c.push('<a href="javascript:void(0)" d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<br/><span>"+f+'</span><em class="dir">^</em></a>');c.push("</div>"),c.push('<div class="sy_cont"><div>'),c.push('<table cellpadding="0" cellspacing="0" border="0" class="'+r.tableCls+'">');for(var I=null,k=null,b=0;u>b;b++){if(c.push('<tbody d="'+d.days[b].day+'">'),0==d.days[b].status)k=l(d.days[b].day,null,null,!0),c.push('<tr class="'+k+'" width="100%"><td>休市</td></tr>');else for(var y=0,w=d.timeBuckets.length;w>y;y++)I=d.timeBuckets[y],k=l(d.days[b].day,I.startTime,I.endTime,!1),0==I.course[b].status?(c.push('<tr class="'+k+'">'),c.push('<td width="25%">'+I.startTime+"-"+I.endTime+"</td>"),c.push('<td colspan="2" width="75%">休市</td>'),c.push("</tr>")):I.course[b].lecturer&&(c.push('<tr class="'+k+'">'),c.push('<td width="25%">'+I.startTime+"-"+I.endTime+"【"+h[I.course[b].courseType]+"】</td>"),c.push('<td width="25%">'+I.course[b].lecturer+"</td>"),c.push('<td width="50%">'+I.course[b].title+"</td>"),c.push("</tr>"));c.push("</tbody>")}c.push("</table>"),c.push("</div></div>"),c.push("</div>")}else if(2===i){c.push('<table cellpadding="0" cellspacing="1" border="0" class="'+r.tableCls+'">'),c.push("<tr>"),c.push("<th>星期\\节次</th>");for(var w=d.timeBuckets?d.timeBuckets.length:0,I=null,k=null,y=0;w>y;y++)I=d.timeBuckets[y],c.push("<th>"+r.indexCN[y]+"<br><span>("+I.startTime+"-"+I.endTime+")</span></th>");c.push("</tr>");for(var x=null,b=0,T=d.days?d.days.length:0;T>b;b++){if(x=d.days[b],c.push("<tr>"),c.push("<th>"+r.dayCN[x.day]+"</th>"),0==x.status)k=l(x.day,null,null,!0),c.push('<td class="'+k+'" colspan="'+w+'">休市</td>');else for(var y=0;w>y;y++)I=d.timeBuckets[y],k=l(x.day,I.startTime,I.endTime,!1),c.push('<td class="'+k+'">'+(0==I.course[b].status?"休市":I.course[b].lecturer)+"</td>");c.push("</tr>")}c.push("</table>")}else if(3===i){var p=o-864e5*((s+6)%7),m=null,g=null,x=null,v=' style="width:'+100/u+'%;"';c.push("<tr>");for(var b=0;u>b;b++)x=d.days[b],m=new Date(p+(d.days[b].day+6)%7*864e5),g=d.days[b].day==s?' class="active"':"",c.push('<th d="'+d.days[b].day+'"'+g+v+">"+r.dayCN[d.days[b].day]+"<i></i></th>");c.push("</tr>"),c.push('<tr><td class="space" colspan="'+u+'"></td></tr>');for(var I=null,k=null,b=0;u>b;b++){if(x=d.days[b],c.push('<tr d="'+x.day+'"><td colspan="'+u+'">'),0==x.status)k=l(x.day,null,null,!0),c.push('<p class="'+k+'">休市</p>');else for(var y=0,w=d.timeBuckets?d.timeBuckets.length:0;w>y;y++)I=d.timeBuckets[y],I.course[b].lecturer&&(k=l(x.day,I.startTime,I.endTime,!1),c.push('<p class="'+k+'">'),c.push("<span>"+I.startTime+"-"+I.endTime+"</span>"),0==I.course[b].status?c.push("<span>休市</span>"):(c.push("<span>"+r.courseType[I.course[b].courseType]+"</span>"),c.push("<span>"+I.course[b].lecturer+"</span>"),c.push('<span class="item">'+I.course[b].title+"</span>")),c.push("</p>"));c.push("</td></tr>")}}}}catch(S){return console.error("formatSyllabus->"+S),""}return c.join("")},isMobile:function(){return/(iphone|ipod|ipad|android|mobile|playbook|bb10|meego)/.test(navigator.userAgent.toLowerCase())},copyObject:function(t,e,i){if(!e)return t;for(var n in t)e.hasOwnProperty(n)&&common.isValid(e[n])&&(t[n]=e[n]);if(i)for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},isRightName:function(t){return!/^([0-9]{2,20})$/g.test(t)&&/^([\w\u4e00-\u9fa5]{2,20})$/g.test(t)},randomIndex:function(t){var e=parseInt(Math.round(Math.random()*t));return e==t&&(e=t-1),0>e?0:e},setScrollStyle:function(t){t.find(".mCSB_dragger_bar").css({background:"url(/images/studio/scroll.png) -10px 50% repeat-y",width:"6px"})},saveToDesktop:function(t,e){try{var i=new ActiveXObject("WScript.Shell"),n=i.CreateShortcut(i.SpecialFolders("Desktop")+"\\"+e+".url");n.TargetPath=t,n.Save()}catch(a){return!1}return!0}};window.console||(console=function(){function t(){}function e(){return null==i&&(i=new t),i}var i=null;return t.prototype={log:function(t){},error:function(t){}},e()}()),$.fn.focusEnd=function(){$(this).focus();var t=$("<span/>").appendTo($(this)),e=t.get(0),i=null,n=null;return document.selection?(i=document.body.createTextRange(),i.moveToElementText(e),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e),n=window.getSelection(),n.removeAllRanges(),n.addRange(i)),t.remove(),this},String.prototype.formatStr=function(){if(0==arguments.length)return this;for(var t=this,e=0;e<arguments.length;e++)t=t.replace(new RegExp("\\{"+e+"\\}","g"),arguments[e]);return t};var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-31478987-1"]),_gaq.push(["_setDomainName","24k.hk"]),_gaq.push(["_addIgnoredRef","24k.hk"]),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_addOrganic","soso","w"]),_gaq.push(["_addOrganic","sogou","query"]),_gaq.push(["_addOrganic","youdao","q"]),_gaq.push(["_addOrganic","baidu","word"]),_gaq.push(["_addOrganic","baidu","q1"]),_gaq.push(["_addOrganic","ucweb","keyword"]),_gaq.push(["_addOrganic","ucweb","word"]),_gaq.push(["_addOrganic","114so","kw"]),_gaq.push(["_addOrganic","360","q"]),_gaq.push(["_addOrganic","so","q"]),_gaq.push(["_trackPageview"]);var _hmt=_hmt||[];UUID.prototype.valueOf=function(){return this.id},UUID.prototype.toString=function(){return this.id},UUID.prototype.createUUID=function(){var t=new Date(1582,10,15,0,0,0,0),e=new Date,i=e.getTime()-t.getTime(),n=UUID.getIntegerBits(i,0,31),a=UUID.getIntegerBits(i,32,47),s=UUID.getIntegerBits(i,48,59)+"1",o=UUID.getIntegerBits(UUID.rand(4095),0,7),r=UUID.getIntegerBits(UUID.rand(4095),0,7),l=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return"G"+n+a+s+o+r+l},UUID.getIntegerBits=function(t,e,i){var n=UUID.returnBase(t,16),a=new Array,s="",o=0;for(o=0;o<n.length;o++)a.push(n.substring(o,o+1));for(o=Math.floor(e/4);o<=Math.floor(i/4);o++)s+=a[o]&&""!=a[o]?a[o]:"0";return s},UUID.returnBase=function(t,e){return t.toString(e).toUpperCase()},UUID.rand=function(t){return Math.floor(Math.random()*(t+1))};var chatAnalyze={COOKIE_NAME:"GWAFLGPHONECOOIKETRACK",localHref:window.location.href,init:function(){-1!=chatAnalyze.localHref.indexOf("pmchat.24k.hk")&&(this.setGA(),this.setBaidu())},setGA:function(){try{var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},setBaidu:function(){try{var t=document.createElement("script");t.src="//hm.baidu.com/hm.js?52a2828b884f1a2ba8a3e25efe98eb65";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}catch(i){console.log("Set GA fail!"+i)}},setUTM:function(t){try{var e=this.getCookie();(null==e||"undefined"==typeof e||""==$.trim(e))&&(e=UUID.prototype.createUUID(),this.setCookie(e));var i=t||"";_gaq.push(function(){$.getJSON("http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_="+Math.random(),function(t){var n={data:[{user_id:e,businessPlatform:"2",visit_time:new Date,behavior_type:6,ip:t.Ip,url:chatAnalyze.localHref,flag:i,gacookiesTrack:""}]},a=-1!=chatAnalyze.localHref.indexOf("pmchat.24k.hk")?"http://utm.gwfx.com/putData/ajax/ajaxTrackData":"http://testweb.gwfx.com:8088/GwUserTrackingManager_NEW/putData/ajax/ajaxTrackData";$.ajax({async:!0,url:a,cache:!1,dataType:"jsonp",data:{data:n},success:function(t){}})})})}catch(n){console.log("Set UTM fail!"+n)}},setCookie:function(t){this.setHC(this.COOKIE_NAME,t)},getCookie:function(){var t=this.getHC(this.COOKIE_NAME);return"undefined"!=typeof t&&null!=t&&""!=t&&this.setCookie(t),t},setHC:function(t,e){"undefined"!=typeof e&&(document.cookie=t+"=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/;domain=.24k.hk",document.cookie=t+"="+escape(e)+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/;domain=.24k.hk")},getHC:function(t){for(var e=document.cookie,i=e.split(/[;&]/),n=0;n<i.length;n++){var a=i[n].split("=");if($.trim(a[0])==$.trim(t))return a[1]}}};$(function(){chatAnalyze.init()});var pkMarketSocket=null,ChartFactory=window.Highcharts?function(){function t(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}function e(){var t=$(window).width();return 540>t?30:t>=540&&1080>t?40:80}var i={realtime:"1min","5min":"5min",hour:"1hour",day:"day"},n={ELEMENT_NOTFOUND:"没有指定画板元素",SERVICE_ERROR:"服务器出现错误",NOT_KEEP_WEBSOCKET_ERROR:"不支持websocket",NO_DATA:"没有数据"},a={line:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],a=n.milliseconds,s=parseFloat(n.end);0==s?e.push({x:a,y:null}):e.push({x:a,y:s})}return e},candlestick:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],a=n.milliseconds,s=parseFloat(n.high),o=parseFloat(n.low),r=parseFloat(n.end),l=parseFloat(n.begin);e.push([a,l,s,o,r])}return e}},s="",o=2;return null!=document.getElementById("symbol")&&"undefined"!=typeof document.getElementById("symbol")&&(s=document.getElementById("symbol").value),"XAGUSD"==s||"USDJPY"==s?o=3:("EURUSD"==s||"GBPUSD"==s||"AUDUSD"==s||"USDCHF"==s||"USDCAD"==s)&&(o=4),Highcharts.setOptions({global:{useUTC:!1}}),{pkSocket:null,closeSocket:function(){this.pkSocket&&this.pkSocket.close()},create:function(t,e,a){a&&a.show();var s=$.Deferred();if(!t||!t.length)return s.reject(n.ELEMENT_NOTFOUND),s.promise();var o={type:"post",dataType:"jsonp",jsonpCallback:"jsonpCallback",data:{kType:i.realtime}},r=this,l=$.extend(!0,{},o,e);return this.symbol=l.data.symbol,this.loadData(l).done(function(i){if(a&&a.hide(),!i||!i.code)return s.reject(n.SERVICE_ERROR);if("OK"!==i.code)return s.reject(n.SERVICE_ERROR);if(0==i.listResult.length)return s.reject(n.NO_DATA);var o=l.data.dataType,c=r.getChartType(o),i=r.parseData(i.listResult.reverse(),c,l);if(r.createChart(t,c,o,i),s.resolve(),e.wsUrl){if(e.wsParam+="&symbol="+e.data.symbol+"&dataType="+e.data.dataType,console.log("options.wsParam:"+e.wsParam),window.WebSocket||(window.WebSocket=window.MozWebSocket),!window.WebSocket)return s.reject(n.NOT_KEEP_WEBSOCKET_ERROR);try{ChartFactory.pkSocket?ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(e.wsParam):(ChartFactory.pkSocket=new ReconnectingWebSocket(e.wsUrl,null,{reconnectInterval:3e3}),ChartFactory.pkSocket.onmessage=function(i){var n=i.originalEvent?i.originalEvent.data:null;n&&(n=JSON.parse(n),"ok"==n.code.toLowerCase()&&n.condition&&n.condition.symbol==e.data.symbol&&n.condition.dataType==e.data.dataType&&n.listResult.length>0&&ChartFactory.add(t,n.listResult,time))},ChartFactory.pkSocket.onopen=function(t){ChartFactory.pkSocket.readyState==WebSocket.OPEN&&ChartFactory.pkSocket.send(e.wsParam)})}catch(d){console.log("get kdata price has error!"+d)}}}),s.promise()},add:function(t,e,i){var n=this.getChartType(i);e=this.parseData(e,n),"line"===n?this.addPoint(t,e):this.addPoint(t,e)},parseData:function(t,e,i){var n=i&&i.parser&&i.parser[e]||a[e];return n(t)},getChartType:function(t){return t===i.realtime?"line":"candlestick"},createChart:function(t,e,i,n){"line"===e?this.createLineChart(t,n):"candlestick"==e&&this.createCandlestickChart(t,i,n)},createLineChart:function(t,e){var i={colors:["#b59130"],chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" 1min",position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{line:{dataGrouping:{enabled:!1},cropThreshold:300}},xAxis:{type:"datetime",tickLength:0,tickPixelInterval:70},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},opposite:!1,showLastLabel:!0,tickLength:0,lineWidth:1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var t=["<span>"+Highcharts.dateFormat("%Y-%m-%d %H:%M",this.x)+"</span><br/>"];return t.push("<span>价格:<strong>"+this.y+"</strong></span><br/>"),t.join("")}},series:[{name:"价位",type:"line",data:e}]};t.highcharts("StockChart",i)},addPoint:function(t,e){var i=t.highcharts();i.series[0].addPoint(e[0],!1),i.redraw()},createCandlestickChart:function(t,e,n){var a="%Y-%m-%d";e===i["5min"]?a="%Y-%m-%d %H:%M":e===i.hour&&(a="%Y-%m-%d %H:%M");var s={chart:{marginTop:20,marginBottom:20,spacingLeft:0,spacingRight:0,spacingTop:0,spacingBottom:0,borderWidth:0,pinchType:""},credits:{enabled:!0,text:this.symbol+" "+e,position:{align:"left",verticalAlign:"top",x:70,y:35}},plotOptions:{candlestick:{upColor:"#F00",upLineColor:"#F00",color:"#00a004",lineColor:"#00a004"}},xAxis:{type:"datetime",tickPixelInterval:70,tickLength:0,dateTimeLabelFormats:{day:"%m-%d",week:"%m-%d",month:"%y-%m"}},yAxis:[{labels:{y:3,formatter:function(){return parseFloat(this.value).toFixed(o)}},lineWidth:1,opposite:!1,showLastLabel:!0,endOnTick:!1}],rangeSelector:{enabled:!1},scrollbar:{enabled:!1},navigator:{enabled:!1},tooltip:{formatter:function(){var t=this.points[0].point,e=["<span>"+Highcharts.dateFormat(a,this.x)+"</span><br/>"];return e.push("<span>开盘价:<strong>"+t.open+"</strong></span><br/>"),e.push("<span>最高价:<strong>"+t.high+"</span></span><br/>"),e.push("<span>最低价:<strong>"+t.low+"</strong></span><br/>"),e.push("<span>收盘价:<strong>"+t.close+"</strong></span><br/>"),e.join("")}},series:[{name:"价格",type:"candlestick",data:n}]};e===i.day&&(s.xAxis.datafor=[]),t.highcharts("StockChart",s)},loadData:function(n){var a=e(),s=n.data.dataType;return $.extend(n.data,{startTime:t(new Date),num:s===i.realtime?120:a,flag:0}),$.ajax(n)}}}():null;!function(t){t.fn.qqFace=function(e){var i={id:"facebox",path:"face/",assign:"content",zIndex:1e3,tip:""},n=t.extend(i,e),a=t("#"+n.assign),s=n.id,o=n.path,r=n.tip;return a.length<=0?(alert("缺少表情赋值对象。"),!1):void t(this).click(function(e){var i,a;if(t("#"+s).length<=0){if(i='<div id="'+s+'" class="facebox"><i class="arr"></i><div class="facecont">',i+='<table border="0" cellspacing="0" cellpadding="0"><tr>',navigator.userAgent&&/(iphone|ipod|ipad|android)/.test(navigator.userAgent.toLowerCase()))for(var l=1;45>=l;l++)a=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+n.assign+'" lf="'+a+'"/></td>',l%9==0&&(i+="</tr><tr>");else for(var l=1;75>=l;l++)a=o+r+l+".gif",i+='<td><img src="'+o+l+'.gif" tsg="'+n.assign+'" lf="'+a+'"/></td>',l%15==0&&(i+="</tr><tr>");i+="</tr></table></div></div>",t(this).parent().append(i),t(this).parent().find("img").click(function(){t("#"+t(this).attr("tsg")).insertAtCaret(t(this).attr("lf")),t(this).parents(".facebox").hide()})}else t("#"+s+":visible").length>0?t("#"+s).hide():t("#"+s).show();e.stopPropagation()})}}(jQuery),jQuery.fn.extend({insertAtCaret:function(t){t='<img src="'+t+'"/>';var e=$(this).get(0);e.innerHTML+=t,$(this).focusEnd()}});var indexJS={fromPlatform:null,isNeverLogin:!1,serverTime:0,towMinTime:0,socketUrl:"",userInfo:null,filePath:"",apiUrl:"",currStudioAuth:!1,visitorSpeak:!1,syllabusData:null,init:function(){this.serverTimeUp(),this.setVisitStore(),this.setEvent(),this.setAdvertisement()},setEvent:function(){$(".header-right li").hover(function(){if($(this).find(".dropcont").show(),$(this).is(".cursor")){if(1==$(this).attr("ck")||!indexJS.syllabusData)return;indexJS.fillCourse()}$(this).is(".notice")&&(0==$(".header-right ul li.user").length&&$(".notice .dropcont").css("width","450px"),indexJS.getArticleList("bulletin_system",indexJS.userInfo.groupId,1,1,1,'{"sequence":"asc"}',null,function(t){if(t&&0==t.result){var e=t.data;if(e&&e.length>0){var i=e[0].detailList[0];$("#bulletinTab").find("strong").text(i.title),$("#bulletinTab").find("p").html(i.content)}}}))},function(){$(this).find(".dropcont").hide()}),0==$(".rooms .rbox").length&&$(".changeroom").hide(),$(".changeroom").click(function(){var t=$(this);if(t.hasClass("open"))t.removeClass("open");else{t.addClass("open");var e=t.attr("tm");if(!(common.isBlank(e)||indexJS.serverTime-Number(e)>=6e4))return;t.attr("tm",indexJS.serverTime);try{$.getJSON("/studio/getRmCourseList",{roomIds:$(".rooms .rbox[rid]").map(function(){return $(this).attr("rid")}).get().join(",")},function(t){if(t&&t.isOK){var e=t.data,i=$(".rooms .rbox[rid]");i.each(function(t){t==i.length-1&&$(this).addClass("last");var n=$(this).attr("rid");if(e.hasOwnProperty(n)){var a=e[n],s=0;"true"==$(this).find(".enterbtn").attr("av")&&a.onlineNum<=200&&(s=a.onlineNum<=10?60:200/a.onlineNum*3+10,s=Math.round(s)),$(this).find(".peo_num label").text(a.onlineNum+s),$(this).find(".info .nk").text(a.name),a.isNext||$(this).addClass("on"),a.day&&$(this).find(".info .st").text(common.daysCN[a.day]+" "+a.startTime+" - "+a.endTime)}})}})}catch(i){console.error("getRmCourseList->"+i),callback(null)}}}),indexJS.setListScroll(".mod_room .cont"),$(document).click(function(t){(!$(t.target).parent().hasClass("roomctrl")&&!$(t.target).parents().parents().hasClass("rbox")||$(t.target).hasClass("enterbtn"))&&$(".changeroom").removeClass("open")}),$(".rooms .rbox[rid] .enterbtn").click(function(){var t=$(this),e=$(this).attr("cgs");return"false"==t.attr("av")&&indexJS.checkClientGroup("visitor")?($("#login_a").trigger("click",{groupId:t.attr("rid")}),!1):common.containSplitStr(e,indexJS.userInfo.clientGroup)?void common.getJson("/studio/checkGroupAuth",{groupId:t.attr("rid")},function(t){t.isOK?indexJS.toRefreshView():indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户才可进入Vip专场，您还不满足条件。如有疑问，请联系老师助理。")},!0,function(t){"success"!=t&&alert("操作失败，请联系客服！")}):(indexJS.checkClientGroup("vip")?alert("该房间仅对新客户开放，如有疑问，请联系老师助理。"):alert("已有真实账户并激活的客户才可进入Vip专场，您还不满足条件。如有疑问，请联系老师助理。"),!1)}),$(".mod_main .tabnav a").click(function(){var t=$(this).index(),e=$(".mod_main .tabcont .main_tab").eq(t);if($(".mod_main .tabnav a").removeClass("on"),$(this).addClass("on"),$(".mod_main .tabcont .main_tab").removeClass("on").eq(t).addClass("on"),1==t){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var i="information_count",n=store.get(i),a={};common.isBlank(n)?a.lastDateTime=null:a=n;var s=$("#newInfoCount").attr("pt");if($.trim(a.lastDateTime)!=$.trim(s))return a.lastDateTime=s,store.set(i,a),void $("#newInfoCount").hide();indexJS.setInformation()}2==t&&indexJS.setTradeStrategy(e.find(".scrollbox")),0==t&&chat.setTalkListScroll(!0)}),$("#qqcs").click(function(){openQQChatByCommonv3("&utm_source=studio&utm_medium=yy&utm_content=TOP&utm_campaign=qqzx_pm")}),$("#saveToDesktop").click(function(){common.saveToDesktop(window.location.href,"视频直播间-金道贵金属")?box.showMsg("直播间快捷方式已成功添加到桌面"):window.location.href="/studio/getShortCut?t="+(new Date).getTime()}),$("#modifyAvatar").click(function(){var t=$("#fileForm"),e=t.find("input[type=file]");"true"!=t.attr("hasEv")&&(t.attr("hasEv","true"),e.change(function(){var t=this,e=t.files[0];if(!e)return!1;if(0!=e.type.indexOf("image")||!e.type||!/\.(?:jpg|png|gif)$/.test(e.name.toLowerCase()))return alert("目前暂支持jpg,gif,png格式的图片！"),!1;var i=e.size;if(i>=524288)return alert("上传的图片大小不要超过512KB."),!1;try{var n=new FormData($("#fileForm")[0]);$.ajax({url:indexJS.apiUrl+"/upload/uploadFile",type:"POST",data:n,async:!1,cache:!1,contentType:!1,processData:!1,success:function(t){if(0==t.result){var e=t.data?t.data[0]:null;e&&common.getJson("/studio/modifyAvatar",{avatar:e.fileDomain+e.filePath},function(t){t.isOK?($("#avatarInfoId").attr("src",t.avatar),$("#userListId li .mynk").prev().find("img").attr("src",t.avatar),indexJS.userInfo.avatar=t.avatar):console.error("上传头像失败，请联系在线客服！")},!0,function(){alert("上传头像失败，请联系在线客服！")})}else alert("上传头像失败，请联系在线客服！")},error:function(t){console.error("error:",t)}})}catch(a){console.error("上传图片失败",a)}})),e.click()}),this.placeholderSupport()},fillCourse:function(){var t=indexJS.syllabusData&&indexJS.syllabusData.courses;if(t){for(var e,i={0:"文字直播",1:"视频直播",2:"oneTV直播"},n=t.days,a=t.timeBuckets,s=$(".course_nav").html(""),o="",r="",l=new Date(indexJS.serverTime).getDay(),c=indexJS.serverTime-864e5*((l+6)%7),d=100/n.length,u=0,h=n.length;h>u;u++){o=0==u?"fir":u==h-1?"last":"nct",r=n[u].day==l?" on":"",e=common.formatterDate(new Date(c+(n[u].day+6)%7*864e5)).substring(5),s.append('<a href="javascript:" class="'+o+r+'" t="'+u+'" style="width:'+d+'%;"><span>'+common.daysCN[n[u].day+""]+"<b>"+e+"</b></span><i></i></a>"),$(".cursor .dropcont .cont").append('<div class="course_tab'+r+'" t="'+u+'" d="'+n[u].day+'"><ul></ul></div>'),o="";var p=$(".cursor .course_tab:last ul"),m=null;if(1!=n[u].status)p.append('<li class="fir"><a href="javascript:"><span><lable>休市</lable></span></a></li>');else for(var f=0,g=a.length;g>f;f++)o=0==f?"fir":"",m=a[f].course[u],0!=m.status&&m.lecturer&&p.append('<li class="'+o+'"><a href="javascript:" st="'+a[f].startTime+'" et="'+a[f].endTime+'"><i></i><span><lable>'+a[f].startTime+"- "+a[f].endTime+"　</lable><lable>"+i[m.courseType]+"　</lable><lable>"+m.lecturer+"</lable></span><p>"+m.title+"</p></a></li>")}$(".course_nav a").click(function(){$(".course_nav a").removeClass("on"),$(".course_tab").removeClass("on"),$(this).addClass("on"),$(".course_tab[t="+$(this).attr("t")+"]").addClass("on")}),$(".header-right li.cursor").attr("ck",1)}},toRefreshView:function(){window.location.reload()},checkClientGroup:function(t){var e=this.userInfo.clientGroup,i=!1;switch(t){case"visitor":i="visitor"==e;break;case"vip":i="vip"==e||"active"==e;break;case"new":i="vip"!=e&&"active"!=e}return i},serverTimeUp:function(){indexJS.fillCourse(),videos.init().clientVideoTask(),indexJS.setInformation(),this.towMinTime=this.serverTime,setInterval(function(){indexJS.serverTime+=1e3,indexJS.serverTime-indexJS.towMinTime>=12e4&&(indexJS.towMinTime=indexJS.serverTime,videos.clientVideoTask(),indexJS.setInformation())},1e3)},refreshNickname:function(t,e){this.userInfo.isSetName=t,this.userInfo.nickname=e,$(".username").text(e),$("#userListId li .mynk").text(e+"【我】")},setVisitStore:function(){if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var t="storeInfo_"+this.userInfo.groupType,e=store.get(t),i={};if(common.isBlank(e)){var n=common.randomNumber(6);i.clientStoreId=(new Date).getTime()+"_"+n,i.userId="visitor_"+n,i.nickname="游客_"+n,i.userType=-1,store.set(t,i)}else i=e;this.userInfo.clientStoreId=i.clientStoreId,this.userInfo.visitorId=i.userId,this.userInfo.loginId=i.loginId,this.userInfo.clientGroup&&"visitor"==this.userInfo.clientGroup?(this.userInfo.nickname=i.nickname,this.userInfo.userId=i.userId,this.visitorSpeak||$("#contentText").attr("contenteditable",!1).append('<div class="lgtip d n">亲，<a href="javascript:box.openLgBox();">登录</a> 后可以发言哦~</div>')):(i.loginId=this.userInfo.userId,
store.set(t,i)),this.isNeverLogin=!common.isValid(i.loginId),common.isBlank(this.userInfo.nickname)&&"visitor"!=this.userInfo.clientGroup&&this.refreshNickname(!1,"匿名_"+this.userInfo.userId.substring(8,12))},setListScroll:function(t,e){var i="object"==typeof t?t:$(t);i.hasClass("mCustomScrollbar")?i.mCustomScrollbar("update"):(e=$.extend({scrollButtons:{enable:!1},theme:"light-2",isCustom:!0},e),i.mCustomScrollbar(e),e.isCustom&&common.setScrollStyle(i))},getArticleList:function(t,e,i,n,a,s,o,r){try{$.getJSON("/studio/getArticleList",{authorId:common.trim(o),code:t,platform:e,hasContent:i,pageNo:n,pageSize:a,orderByStr:s},function(t){r(t)})}catch(l){console.error("getArticleList->"+l),r(null)}},getArticleInfo:function(t,e){try{$.getJSON("/studio/getArticleInfo",{id:t},function(t){e(t)})}catch(i){console.error("getArticleInfo->"+i),e(null)}},setAdvertisement:function(){this.getArticleList("advertisement",indexJS.userInfo.groupId,"0",1,3,'{"sequence":"asc"}',null,function(t){if(t&&0==t.result){var e=t.data;for(var i in e)$(".ban_ul").append('<li class="swiper-slide"><a href="'+(common.isBlank(e[i].linkUrl)?"javascript:":e[i].linkUrl)+'" target="_blank"><img width="100%" alt="" src="'+e[i].mediaUrl+'"></a></li>'),e.length>1&&$("#mod_position").append('<span class="'+(0==parseInt(i)?"p-click":"")+'"></span>');e&&e.length>1&&new Swiper(".mod_banner",{pagination:"#mod_position",paginationClickable:!0,loop:!0,autoplay:5e3,autoplayDisableOnInteraction:!1})}})},setInformation:function(){var t=$(".mod_main .tabcont .main_tab").eq(1).find(".scrollbox"),e=$("#newInfoCount").attr("t");if(common.isBlank(e)||!(indexJS.serverTime-e<12e4)){var i=common.formatterDate(indexJS.serverTime,"-");if(!store.enabled)return void console.log("Local storage is not supported by your browser.");var n="information_count",a=store.get(n),s={};common.isBlank(a)?s.lastDateTime=null:(s=a,common.isBlank(s.lastDateTime)||s.lastDateTime.substring(0,10)==i||(s.lastDateTime=null)),$.getJSON(indexJS.apiUrl+"/common/getInformation?t="+indexJS.serverTime,null,function(e){if(e&&e.isOK){var i=e.data.news.item.length;null!=s.lastDateTime||common.isBlank($("#newInfoCount").attr("pt"))||($("#newInfoCount").text(i),$("#newInfoCount").hide()),$(".mod_main .message_list ul").html("");var n=null;$.each(e.data.news.item,function(t,e){null==s.lastDateTime||s.lastDateTime!=e.pubDate||common.isBlank($("#newInfoCount").attr("pt"))?null!=s.lastDateTime&&e.pubDate>s.lastDateTime&&t+1==i&&!common.isBlank($("#newInfoCount").attr("pt"))&&($("#newInfoCount").text(i),$("#newInfoCount").show()):t>0?($("#newInfoCount").text(t),$("#newInfoCount").show()):$("#newInfoCount").hide(),1>t&&(n=e.pubDate),$(".mod_main .message_list .scrollbox ul").append("<li><span><i></i><b>"+e.pubDate.substring(10)+" </b>"+e.title+"</span></li>")}),s.lastDateTime==n&&$("#newInfoCount").hide(),indexJS.setListScroll(t),$("#newInfoCount").attr("pt",n),$(".mod_main .tabcont .main_tab").eq(1).hasClass("on")&&$("#newInfoCount").attr("t",indexJS.serverTime)}})}},setTradeStrategy:function(t){this.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,100,'{"sequence":"asc"}',null,function(e){if(e&&0==e.result){var i=e.data,n=null,a="",s=indexJS.formatHtml("tradestrategy");for(var o in i){n=i[o].detailList[0];var r="",l="";if(common.isBlank(n.author))r=n.authorInfo.name,l=n.authorInfo.avatar;else{var c=n.author.split(";");r=c[0],l=c[1]}var d=common.formatterDateTime(i[o].publishStartDate,"-").substring(0,16);a+=s.formatStr(l,r,d,n.tag,n.title,n.content)}$("#guidelist ul").html(a)}else $("#guidelist ul").html("");indexJS.setListScroll(t)})},placeholderSupport:function(){var t="placeholder"in document.createElement("input");t||$(".formcont .in_line input[placeholder]").each(function(){var t=$(this).attr("placeholder");if(t){var e=$(this),i=$('<span class="placeholder">'+t+"</span>");e.before(i),i.bind("click",function(){$(this).hide(),$(this).next().focus()}),e.bind("focus",function(){$(this).prev().hide()}),e.bind("blur",function(){""===$(this).val()&&$(this).prev().show()}),""!=e[0].defaultValue&&e.prev().hide(),$(this).attr("placeholder","")}})},formatHtml:function(t){var e=[];switch(t){case"tradestrategy":e.push('<li class="guideli">'),e.push('    <div class="line1 clearfix">'),e.push('        <img class="himg" src="{0}" alt="{1}">'),e.push('        <h4 class="name">{1}<span class="timespan">{2}</span></h4>'),e.push('        <span class="tag"><i></i>{3}</span>'),e.push("    </div>"),e.push('    <h4 class="gtit"><strong><a href="" target="_blank" class="taglink"></a></strong>{4}</h4>'),e.push('    <div class="g_cont">'),e.push("    <p>{5}</p>"),e.push("    </div>"),e.push("</li>")}return e.join("")}};$(function(){indexJS.init()});var videos={blwsPlayer:null,init:function(){return this.setEvent(),this.setVideoList(null,!0),this},setVideoList:function(t,e){if(e){var i=$("#teachVideoId").children().map(function(){return $(this).attr("t")}).get();t=i[common.randomIndex(i.length)]}var n=$("#teachVideoId div[t="+t+"] ul");n.find("li").length>0||(n.html(""),indexJS.getArticleList(t,indexJS.userInfo.groupId,0,1,100,'{"sequence":"desc"}',null,function(t){if(t&&0==t.result){var i=t.data,a=null;for(var s in i)a=i[s].detailList[0],n.append('<li title="'+a.title+'"><a href="javascript:" ct="'+i[s].categoryId+'" id="'+i[s]._id+'" t="'+(common.isValid(i[s].mediaUrl)&&-1!=i[s].mediaUrl.indexOf(".mp4")?"mp4":"")+'" vUrl="'+i[s].mediaUrl+"\" onclick=\"_gaq.push(['_trackEvent', 'pmchat_studio', 'video_play',$(this).text()]);\"><i></i>"+a.title+"</a></li>");indexJS.setListScroll(n,{isCustom:!1,theme:"minimal-dark"}),$("#teachVideoId li a").click(function(){$("#teachVideoId li a.on").removeClass("on"),$(this).addClass("on"),$(".max_box").show();var t=$(".min_box").attr("vid",this.id).hide();t.find(".v_cate").text($(this).parents(".cate_box").find(".cate_name").text()),t.find(".v_name label").text($(this).text()),videos.setVideo($(this));var e=$(this).attr("id");$("#tvInfoId").attr("tid")!=e&&(indexJS.getArticleInfo(e,function(t){if(t){$("#tvInfoId").attr("tid",t._id);var e=t.detailList[0];$("#tvInfoId .intro p").text(e.remark),$("#tvInfoId .teacher-view p").text(e.seoDescription);var i=$("#tvInfoId .te_detail"),n=e.authorInfo;n&&(i.find("strong").attr("uid",n.userId).text(n.name),i.find(".rcont i").text(n.position),i.find("img").attr("src",n.avatar),i.find("img").attr("src",n.avatar))}}),indexJS.setListScroll("#tvInfoId .intro p"),indexJS.setListScroll("#tvInfoId .teacher-view p"))})}e&&videos.playVideoByDate(!0)}))},setVdTab:function(t){t?(window.SewisePlayer&&SewisePlayer.doStop(),$("#tvDivId").hide().find("iframe").remove(),$(".listcont .list_tab:first,#vdTabId a:first").addClass("on"),$(".listcont .list_tab:last,#vdTabId a:last").removeClass("on"),$("#lvDivId").show()):($(".listcont .list_tab:first,#vdTabId a:first").removeClass("on"),$(".listcont .list_tab:last,#vdTabId a:last").addClass("on"),$("#tvDivId").show(),$("#lvDivId").hide())},playMp4Vd:function(t){var e=$("#teachVideoId a[class=on]");if(t||e.length<=0){var i=$("#teachVideoId li a[t=mp4]"),n=null;i.length<=0?n=$("#teachVideoId li:first a"):(n=$(i.get(common.randomIndex(i.length))),$("#teachVideoId div[t="+n.attr("ct")+"] ul").mCustomScrollbar("scrollTo","#"+n.attr("id"))),n.click(),$("#teachVideoId .cate_box").removeClass("show"),n.parents(".cate_box").addClass("show")}else e.click()},setVdMaxBox:function(){$(".max_box").is(":hidden")||$(".max_box").slideUp(1e3,function(t){$(".min_box").fadeIn("fast")})},setEvent:function(){$(".mod_videolist .remark").css({"max-height":"200px"}),$(".mod_videolist .content").css({"max-height":"130px"}),$(".max_box").hover(function(){},function(){videos.setVdMaxBox()}),$("#vdTabId a").click(function(){$("#vdTabId a").removeClass("on"),$(this).addClass("on");var t=$(this).index();$(".listcont .list_tab").removeClass("on").eq(t).addClass("on");var e=$(".mod_video").hide().eq(t);e.show(),0==t?videos.playVideoByDate(!1):(videos.playMp4Vd(),videos.setVdMaxBox())}),$("#vdLs_min,#vdLs_max").click(function(){"vdLs_min"==this.id?($(".min_box").hide(),$(".max_box").show()):($(".max_box").hide(),$(".min_box").show())}),$("#tvDivId").hover(function(){$(".max_box").is(":hidden")&&$(".min_box,.v_cate,.v_name").show()},function(){$(".max_box,.min_box").hide()}),$("#teachVideoId .cate_name").click(function(){$("#teachVideoId .cate_box").removeClass("show"),videos.setVideoList($(this).parent().addClass("show").attr("t"))})},clientVideoTask:function(){var t=$("#lvDivId embed").attr("src");$("#lvVideoId").is(":visible")&&t&&-1==t.indexOf("yy.com")&&0==$("#lvVideoId").find("object").length&&videos.playVideoByDate(!1)},playVideoByDate:function(t){var e=common.getSyllabusPlan(indexJS.syllabusData,indexJS.serverTime);!e||0!=e.courseType&&common.isBlank(e.studioLink)||e.isNext||0==e.courseType?t?e&&!e.isNext&&0==e.courseType?(this.setVdTab(!0),this.setStudioInfo(e),this.setStudioTip(!0)):(this.setVdTab(!1),this.playMp4Vd(),this.synCourseStyle(null)):this.setStudioInfo(e):(this.setVdTab(!0),this.setStudioVideoDiv(e.studioLink),this.setStudioInfo(e),this.setStudioTip(2!=e.courseType),this.synCourseStyle(e))},synCourseStyle:function(t){$(".course_tab li a").removeClass("on"),t&&$(".course_tab[d="+t.day+"]").find('li a[st="'+t.startTime+'"][et="'+t.endTime+'"]').addClass("on")},setStudioTip:function(t){t?$(".mod_room .titbar > span i").removeClass("off").addClass("on"):$(".mod_room .titbar > span i").removeClass("on").addClass("off")},setNextCourse:function(t,e){if(t){var i="当前暂无直播，请关注下节课";t.isNext||0!=t.courseType||(i="当前正在文字直播"),$("#nextCourse").find(".ntext").text(i),$("#nextCourse .nextbox").show(),$("#nextCourse").find("img").attr("src",e.avatar),$("#nextCourse").find(".t_name").text(e.name),$("#nextCourse").find(".live_name").text(t.title),$("#nextCourse").find(".time").text(common.daysCN[t.day]+" "+t.startTime+" - "+t.endTime)}else $("#nextCourse").find(".ntext").text("当前暂无直播"),$("#nextCourse .nextbox").hide();$("#lvVideoId").hide(),$("#nextCourse").show()},getEmbedDom:function(t){return'<embed src="'+t+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'},setStudioVideoDiv:function(t){if($("#nextCourse").hide(),$("#lvVideoId").show().html(""),-1!=t.indexOf("rtmp")){var e=/(.*)\/([0-9]+)$/g.exec(t);if(!e||e.length<3)return;flowplayer("lvVideoId","/js/lib/flowplayer/flowplayer.swf",{clip:{url:e[2],provider:"rtmp",live:!0},plugins:{rtmp:{url:"/js/lib/flowplayer/flowplayer.rtmp.swf",netConnectionUrl:e[1]}},onError:function(t){}})}else $("#lvVideoId .img-loading").fadeIn(0).delay(2e3).fadeOut(200),$(videos.getEmbedDom(t)).appendTo("#lvVideoId")},setStudioInfo:function(t){if(t){var e=$("#lvInfoId").attr("dy"),i=$("#lvInfoId").attr("st"),n=$("#lvInfoId").attr("et");if(e==t.day&&i==t.startTime&&n==t.endTime)return void((t.isNext||0==t.courseType)&&videos.setNextCourse(null));$.getJSON("/studio/getCourseInfo",{day:t.day,startTime:t.startTime,endTime:t.endTime,authorId:t.lecturerId},function(e){$("#lvInfoId").attr("dy",t.day).attr("st",t.startTime).attr("et",t.endTime),$("#lvInfoId .intro p").text(e.remark),$("#lvInfoId .teacher-view p").text(""),indexJS.setListScroll("#lvInfoId .intro p");var i=$("#lvInfoId .te_list").html(""),n=e.authors,a=null;for(var s in n)a=n[s],i.append('<div class="te_detail" uid="'+a.userId+'"><img src="'+a.avatar+'" alt=""><div class="rcont"><span><strong>'+a.name+"</strong><i>"+a.position+'</i></span> <a href="javascript:" class="support" uid="'+a.userId+'"><label>'+a.praiseNum+"</label><i>+1</i></a> </div> </div>");var o=$(".te_detail .support");"true"!=o.attr("initEvent")&&o.attr("initEvent","true").click(function(){var t=$(this);try{common.getJson("/studio/setUserPraise",{clientId:indexJS.userInfo.userId,praiseId:t.attr("uid")},function(e){if(e.isOK){t.find("i").fadeIn().delay(400).fadeOut();var i=t.find("label");i.text(common.isValid(i.text())?parseInt(i.text())+1:0)}else box.showTipBox("亲，已点赞，当天只能点赞一次！");t.addClass("supported"),t.attr("title","已点赞")},!0)}catch(e){console.error("setPraise->"+e)}}),(t.isNext||0==t.courseType)&&videos.setNextCourse(t,n&&n.length>0?n[0]:{avatar:"",name:""})}),indexJS.getArticleList("trade_strategy_article",indexJS.userInfo.groupId,1,1,1,'{"createDate":"desc"}',"",function(t){if(t&&0==t.result&&t.data&&t.data.length>0){var e=t.data[0],i=e.detailList[0];$("#lvInfoId .teacher-view p").html(i.content),indexJS.setListScroll("#lvInfoId .teacher-view p")}else $("#lvInfoId .teacher-view p").html("亲，老师还未发布观点哦")})}},setVideo:function(t){try{this.setStudioTip(!1),$("#lvVideoId").html("");var e=t.attr("vUrl"),i=t.text();if(-1!=e.indexOf(".html")){window.SewisePlayer&&SewisePlayer.doStop();var n=$("#tVideoId iframe"),a=!0;n.size()>0&&(n.attr("src")==e?a=!1:n.remove()),a&&$("#tVideoId").append('<iframe frameborder=0 width="100%" height="100%" src="'+e+'" allowfullscreen></iframe>')}else if($("#tVideoId iframe").remove(),-1!=e.indexOf("type=blws")){var s=e.split("&");if(s.length>1){var o=s[1].replace(/^vid=/g,"");videos.blwsPlayer?videos.blwsPlayer.changeVid(o):videos.blwsPlayer=polyvObject("#tVideoId").videoPlayer({width:"100%",height:"100%",vid:o,flashvars:{autoplay:"0",setScreen:"fill"},onPlayOver:function(t){}})}}else if(window.SewisePlayer)SewisePlayer.toPlay(e,i,0,!0);else{var r=[];r.push("/js/lib/sewise.player.min.js?server=vod"),r.push("type="+(-1!=e.indexOf(".flv")?"flv":"mp4")),r.push("videourl="+e),r.push("autostart=true"),r.push("title="+i),r.push("buffer=5");var l=r.join("&"),c=document.createElement("script");c.type="text/javascript",c.src=l,$("#tVideoId").get(0).appendChild(c);var d=function(){return window.SewisePlayer?void SewisePlayer.onPause(function(t){if(SewisePlayer.duration()<=SewisePlayer.playTime()){var e=$("#teachVideoId li a.on"),i=e.parent().next().find("a");i.length<=0?videos.playMp4Vd(!0):i.click()}}):void window.setTimeout(d,500)};d()}}catch(u){console.error("setVideo has error:"+u)}},getEmbedDom:function(t){return'<embed src="'+t+'" autostart="true" wmode="Opaque" quality="high" width="100%" height="100%" align="middle" allowScriptAccess="never" allowFullScreen="true" mode="transparent" type="application/x-shockwave-flash"></embed>'}},chat={socket:null,whPushObj:{},whTipInterId:null,pushInfoTimeOutId:null,msgType:{text:"text",img:"img",file:"file"},init:function(){this.setEvent(),this.setSocket(),this.setTalkListScroll(!0)},setEvent:function(){$("#msgFaceBtn").qqFace({id:"faceId",assign:"contentText",path:indexJS.filePath+"/face/"}),$(document).click(function(t){$("div[id^=faceId]").hide(),$(t.target).hasClass("headimg")||$(t.target).parents().hasClass("headimg")||"header"==$(t.target).parent().attr("t")||$(t.target).hasClass("uname")||$(t.target).parents().hasClass("te_ul")||$(".dialogbtn").hide()}),$(".replybtn").click(function(){chat.setDialog($(this).attr("uId"),$(".sender").html(),$(this).attr("ts"),$(this).attr("futype")),$(".mymsg em").show()}),$("#mymsgClose").click(function(){$(".mymsg,.mymsg em").hide()}),$(".clearbtn").click(function(){$("#dialog_list").html(""),chat.setTalkListScroll()}),$(".scrollbtn").click(function(){$(this).hasClass("on")?$(this).removeClass("on"):($(this).addClass("on"),chat.setTalkListScroll(!0))}),$(".view_select").hover(function(){$(this).addClass("dw")},function(){$(this).removeClass("dw")}).find(".selectlist a").click(function(){$(this).is(".on")||($(".view_select .selectlist a").removeClass("on"),$(".view_select .selected").text($(this).text()),$(this).addClass("on"),chat.showViewSelect($(this).attr("t")),chat.setTalkListScroll(!0))}),$("#contentText").keydown(function(t){var e=$(this).html();if(13==t.keyCode)return common.isValid(e)&&($(this).html(e.replace(/<div>|<\/div>/g,"")),$(".ui-autocomplete").is(":hidden")&&$("#sendBtn").click()),!1;if(8==t.keyCode){var i=$(this).find(".txt_dia");if($.trim($(this).text())==i.text())return i.remove(),$(this).html(""),!0}}).autocomplete({source:function(t,e){/^@.*$/g.test(t.term)&&(e(chat.searchUserList(t.term.substring(1,t.term.length))),$(".ui-autocomplete").css("z-index","10000000"))},delay:500,minLength:2,position:{my:"left bottom",at:"left top"},select:function(t,e){return $("#contentText").html("").append('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+e.item.value+'" utype="'+e.item.userType+'">@<label>'+e.item.label+"</label></span>&nbsp;").focusEnd(),!1}}).autocomplete("instance")._renderItem=function(t,e){return $("<li>").attr("data-value",e.label).append("<a>"+e.label+"</a>").appendTo(t)},$("#sendBtn").click(function(){if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();if(indexJS.userInfo.isSetName===!1)return void box.openSetNameBox();var t=chat.getToUser(),e=chat.getSendMsg();if(e!==!1){var i={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:e}},n=$(".replybtn");t&&t.userId==n.attr("uid")&&t.talkStyle==n.attr("ts")&&$(".mymsg,.mymsg em").hide(),i.fromUser.toUser=t,chat.socket.emit("sendMsg",i),chat.setContent(i,!0,!1),$("#contentText").html("")}}),$(".pletter_win").draggable({handle:".wh_drag"})},getUiId:function(){var t=new Date;return t.getTime()+"_ms"},getToUser:function(){var t=$("#contentText .txt_dia");return t.length>0?{userId:t.attr("uid"),nickname:t.find("label").text(),talkStyle:0,userType:t.attr("utype")}:null},getSendMsg:function(t){var t=t?t:$("#contentText");if(t.text().length+t.find("img").size()>140)return alert("消息内容超过最大长度限制（140字以内）！"),!1;t.find(".txt_dia").length>0&&t.find(".txt_dia").remove();var e=common.clearMsgHtml(t.html());return common.isBlank(e)?(t.html(""),!1):e},setDialog:function(t,e,i,n,a){if(1==i)chat.closeWhTip(t),chat.fillWhBox(null,a,n,t,e,!1,!1);else{if(!indexJS.visitorSpeak&&indexJS.checkClientGroup("visitor"))return void box.openLgBox();$("#contentText .txt_dia").remove(),$("#contentText").html($("#contentText").html().replace(/^((&nbsp;)+)/g,"")),$("#contentText").prepend('&nbsp;<span class="txt_dia" contenteditable="false" uid="'+t+'" utype="'+n+'">@<label>'+e+"</label></span>&nbsp;").focusEnd()}},showViewSelect:function(t){"analyst"==t?($("#dialog_list").children("[utype!=2]").hide(),$("#dialog_list").children("[utype=2]").show()):"me"==t?($("#dialog_list").children("[isme='true']").show(),$("#dialog_list").children("[isme='false']").hide()):"admin"==t?$("#dialog_list").children("[utype!=1]").hide():$("#dialog_list").children().show()},setContent:function(t,e,i){var n=t.fromUser;if(e&&(n.publishTime=t.uiId),t.isVisitor)return $("#"+t.uiId).remove(),void chat.openLoginBox();if(i&&$("#"+n.publishTime).length>0)return $("#"+n.publishTime+" .dcont em[class=ruleTipStyle]").remove(),void $("#"+n.publishTime+" input").remove();if(t.rule)return void(t.value&&t.value.needApproval?$("#"+t.uiId).attr("id",n.publishTime):$("#"+t.uiId+" .dcont").append('<em class="ruleTipStyle">'+t.value.tip+"</em>"));if(!e&&indexJS.userInfo.userId==n.userId&&t.serverSuccess)return $("#"+t.uiId+" .dtime").html(chat.formatPublishTime(n.publishTime)),void $("#"+t.uiId).attr("id",n.publishTime);var a=chat.formatContentHtml(t,e,i),s=$("#dialog_list");s.append(a),this.formatMsgToLink(n.publishTime);var o=$(".view_select .selectlist a[class=on]").attr("t");if("all"!=o&&chat.showViewSelect(o),!i){var r=$("#userListId li[id="+n.userId+"]"),l=null;n.avatar&&r.length>0&&n.avatar!=(l=r.find(".headimg img")).attr("src")&&l.attr("src",n.avatar),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}$("#"+n.publishTime+" .headimg").click(function(){chat.openDiaLog($("#"+n.publishTime+" .dialogbtn").attr("avs",$(this).find("img").attr("src")))}),$("#"+n.publishTime+" .txt_dia").click(function(){(indexJS.visitorSpeak||!indexJS.checkClientGroup("visitor"))&&chat.setDialog($(this).attr("uid"),$(this).find("label").text(),0,$(this).attr("utype"))}),$("#"+n.publishTime+" .uname").click(function(){var t=$("#"+n.publishTime+" .dialogbtn");t.attr("avs",$(this).parent().parent().find(".headimg img").attr("src")),chat.openDiaLog(t)})},openDiaLog:function(t){if($(".dialogbtn").not(t).hide(),!t.is(":hidden"))return t.hide(),!1;var e=t.parent(),i=t.is(".bot");e.next().size()<=0?i||t.addClass("bot"):i&&t.removeClass("bot"),t.show();var n=t.find("a"),a=t.attr("avs");common.isValid(a)?(n.attr("avs",a),t.attr("avs","")):n.attr("avs",""),n.unbind("click"),n.click(function(){var t=$(this).parent();chat.setDialog(t.attr("uid"),t.attr("nk"),$(this).attr("t"),t.attr("utype"),$(this).attr("avs")),t.hide()})},formatPublishTime:function(t,e,i){var n=Number(t.replace(/_.+/g,""));return common.isBlank(t)?"":e?common.formatterDateTime(n,i):common.getHHMM(n)},formatContentHtml:function(t,e,i){var n="dialog ",a="",s="",o="false",r="",l=t.fromUser,c=t.content,d=l.nickname,u=l.toUser,h="";u&&common.isValid(u.userId)&&(h='<span class="txt_dia" uid="'+u.userId+'" utype="'+u.userType+'">@<label>'+u.nickname+"</label></span>",indexJS.userInfo.userId==u.userId&&(o="true")),a=c.value,indexJS.userInfo.userId==l.userId?(n+="mine ",o="true",r='<span class="dtime">'+chat.formatPublishTime(l.publishTime)+'</span><a href="javascript:" class="uname">我</a>'):(3==l.userType&&(d+="&nbsp;（助理）"),r='<a href="javascript:" class="uname">'+d+'</a><span class="dtime">'+chat.formatPublishTime(l.publishTime)+"</span>",s=chat.getDialogHtml(l.userId,d,l.userType),!i&&u&&indexJS.userInfo.userId==u.userId&&($(".mymsg").show(),$(".mymsg em").hide(),$(".replybtn").attr("uid",l.userId),$(".replybtn").attr("ts",u.talkStyle),$(".replybtn").attr("futype",l.userType),$(".sender").html(l.nickname),$(".xcont").html(a)));var p=chat.getAImgOrLevel(l.userId,l.clientGroup,l.userType,l.avatar),m=[];return m.push('<div class="'+n+p.level+'" id="'+l.publishTime+'"  utype="'+l.userType+'" mtype="'+c.msgType+'" isme="'+o+'">'),m.push('<a href="javascript:" class="headimg">'+p.aImg+"<b></b></a>"),m.push('<div class="dialog_top">'+r+"</div>"),m.push('<p><i></i><span class="dcont">'+h+a+"</span></p>"),m.push(s+"</div>"),m.join("")},formatMsgToLink:function(t){$("#"+t+' .dcont:contains("http:"),#'+t+' .dcont:contains("https:")').each(function(t,e){var i=$(e).html(),n=i.split(/<img src="\S+">/g),a="";for(var s in n)if(a=n[s],!common.isBlank(a)){var o=a.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\\&|-)+)(:\d+)?(\/|\S)+/g,function(t){return'<a href="'+t+'" target="_blank" style="color:#3181c6;">'+t+"</a>"});e.innerHTML=e.innerHTML.replace(a,o)}})},removeLoadDom:function(t){$("#"+t+" .img-loading,#"+t+" .img-load-gan,#"+t+" .shadow-box,#"+t+" .shadow-conut").remove()},getAImgOrLevel:function(t,e,i,n){var a={aImg:common.isValid(n)?'<img src="'+n+'">':'<img src="/images/studio/user.png">',level:""};if(common.isValid(i)&&i>0)a.level="admin";else if("vip"==e)a.level="level4";else if("active"==e||"notActive"==e)a.level="level3";else if("simulate"==e)a.level="level2";else if("register"==e)a.level="level1";else if("visitor"==e||-1==i){t=t||"";var s=parseInt(t.substring(t.length-2),10);isNaN(s)&&(s=100),s=(s+17)%39,a.aImg='<img src="'+indexJS.filePath+"/upload/pic/header/chat/visitor/"+s+'.png">',a.level="visitor"}else a.level="visitor";return a},getDialogHtml:function(t,e,i){if(t&&indexJS.userInfo.userId!=t){var n=$("#roomInfoId"),a="",s=0;return(indexJS.visitorSpeak||-1==indexJS.userInfo.userId.indexOf("visitor_")&&-1==t.indexOf("visitor_"))&&(a+='<a href="javascript:" class="d1" t="0"><b></b><span>@TA</span></a>',s++),"true"==n.attr("aw")&&common.containSplitStr(n.attr("awr"),i)&&(a+='<a href="javascript:"'+(0==s?' class="d1"':"")+' t="1"><b></b><span>私聊</span></a>',s++),'<div class="dialogbtn'+(1==s?" one":"")+'"  nk="'+e+'" uid="'+t+'" utype="'+i+'">'+a+"</div>"}return'<div class="dialogbtn'+(1==s?" one":"")+'"  nk="'+e+'" uid="'+t+'" utype="'+i+'"></div>'},setOnlineUser:function(t){$("#userListId li[id='"+t.userId+"']").remove();var e=chat.getDialogHtml(t.userId,t.nickname,t.userType),i="",n="",a=t.sequence,s="";if(indexJS.userInfo.userId==t.userId&&(i="【我】",a="0",s="mynk"),3==t.userType){var o=$("#roomInfoId");"true"==o.attr("aw")&&common.containSplitStr(o.attr("awr"),t.userType)&&(n="<em>私聊</em>"),i="&nbsp;（助理）"}var r=chat.getAImgOrLevel(t.userId,t.clientGroup,t.userType,t.avatar),l=$("#userListId li"),c='<li id="'+t.userId+'" cg="'+(common.isBlank(t.clientGroup)?"":t.clientGroup)+'" t="'+a+'" utype="'+t.userType+'" class="'+r.level+'" >'+e+'<a href="javascript:" t="header" class="uname"><div class="headimg">'+r.aImg+'<b></b></div><span class="'+s+'">'+t.nickname+i+"<i></i></span>"+n+"</a></li>";if(0==l.length)$("#userListId").append(c);else if("0"==a)l.first().before(c);else{var d=!1,u=0,h="";l.each(function(){return u=parseInt($(this).attr("t")),t.sequence<u?($(this).before(c),d=!0,!1):t.sequence==u&&(h=$(this).find("a span").text(),t.nickname<=h)?($(this).before(c),d=!0,!1):void 0}),d||$("#userListId").append(c)}common.isValid(e)&&($("#userListId").contextmenu(function(){return!1}),$("#userListId li[id="+t.userId+"] a[t=header]").click(function(t){if("0"==$(this).attr("t"))$(".user_box li").removeClass("zin");else{$(".user_box li").removeClass("zin"),$(this).parent().addClass("zin");var e=$(this).prev();e.attr("avs",$(this).find(".headimg img").attr("src")),chat.openDiaLog(e)}}).dblclick(function(){$(this).find("em").trigger("click")}).find("em").click(function(t){var e=$(this).parents("[utype]"),i=e.attr("id");return chat.closeWhTip(i),chat.fillWhBox(e.attr("cg"),e.find(".headimg img").attr("src"),e.attr("utype"),i,e.find(".uname span").text(),!1,!1),!1}))},leaveRoomTip:function(t,e){if("forcedOut"!=t){if("roomClose"==t)$(".blackbg").children().hide(),box.showTipBox("注意：房间已停用，正自动登出..."),"visitor"==indexJS.userInfo.clientGroup?window.setTimeout(function(){indexJS.toRefreshView()},1200):window.setTimeout(function(){$(".logout").trigger("click")},1200);else if("otherLogin"==t){if("visitor"==indexJS.userInfo.clientGroup)return;chat.socket.disconnect(),$(".blackbg").children().hide(),box.showMsg({closeable:!1,title:"登出提示",msg:"注意：您的账号已在其他地方登陆，被踢出！",btns:[{txt:"重新登录",fn:function(){indexJS.toRefreshView()}},{txt:"注销",fn:function(){$(".logout").trigger("click")}}]})}}else if(e)for(var i in e)$("#userListId li[id='"+e[i]+"']").remove()},setWhOnlineTip:function(t,e){var i=$("#wh_msg_"+t+" .tit strong");if(0!=i.length){var n=$("#wh_msg_"+t+" .tit strong"),a=$(".mult_dialog a[uid="+t+"]").find("img"),s=$("#userListId li[t=3][uid="+t+"] .headimg");e?(n.text("在线"),a.removeClass("have_op"),s.removeClass("have_op")):(n.text("离线"),a.addClass("have_op"),s.addClass("have_op"))}},sendWhMsg:function(t){var e=chat.getSendMsg(t);if(e!==!1){var i={uiId:chat.getUiId(),fromUser:indexJS.userInfo,content:{msgType:chat.msgType.text,value:e}},n=$(".mult_dialog a[class=on]"),a=n.attr("uid");i.fromUser.toUser={userId:a,nickname:n.find("label").text(),talkStyle:1,userType:n.attr("utype")};var s=$("#wh_msg_"+a+" .dialog:last"),o=s.find(".whblt");o.length>0&&(i.fromUser.toUser.question=o.html(),i.fromUser.toUser.questionId=o.attr("rid"),i.fromUser.toUser.publishTime=s.attr("id")),chat.socket.emit("sendMsg",i),chat.setWhContent(i,!0,!1),t.html("")}},setWhVisitors:function(t,e,i,n,a,s,o){if(0==$(".mult_dialog a[uid="+i+"]").length){var r=this.getAImgOrLevel(i,t?t:$("#userListId li[id='"+i+"']").attr("cg"),e,a);$(".mult_dialog").append('<a href="javascript:" uid="'+i+'" utype="'+e+'" class="on"><div class="headimg '+r.level+'">'+r.aImg+"<b></b></div><label>"+n+'</label><i class="num dn" t="0"></i><i class="close"></i></a>');var l=$(".mult_dialog a[uid="+i+"]");if(o){var c=l.find(".num"),d=parseInt(c.attr("t"))+1;c.attr("t",d).text(d).show()}l.find(".close").click(function(){var t=$(this).parent();t.remove(),$("#wh_msg_"+t.attr("uid")).remove(),0==$(".mult_dialog a").length?($(".pletter_win .cont[id]").remove(),$(".pletter_win").hide()):$(".mult_dialog a:last").click()}),l.click(function(){$(".mult_dialog a").removeClass("on"),$(this).addClass("on"),$(this).find(".num").attr("t",0).text("").hide();var t=$(this).attr("uid"),e="wh_msg_"+t,i=$(this).attr("utype");if(chat.closeWhTip(t),$(".pletter_win .cont[id]").hide(),0==$("#"+e).length){var n="whTxt_"+t;$(".pletter_win").append($("#wh_content_tmp").html()),$(".pletter_win .cont:last").attr("id",e).find(".ctextarea").attr("id",n),$("#"+e).find(".facebtn").qqFace({id:"faceId_"+t,zIndex:1e6,assign:n,path:indexJS.filePath+"/face/"}),$("#"+e).find(".ctextarea").keydown(function(t){return 13==t.keyCode?(chat.sendWhMsg($(this)),!1):void 0}),$("#"+e).find(".sendbtn").click(function(t){chat.sendWhMsg($(this).parents(".cont").find(".ctextarea"))}),$("#"+e).find(".pop_close").click(function(){$(".pletter_win .cont[id],.pletter_win .mult_dialog a[uid]").remove(),$(".pletter_win").hide()}),$("#"+e).find(".pop_small").click(function(){$(".pletter_win").hide()}),chat.socket.emit("getWhMsg",{clientStoreId:indexJS.userInfo.clientStoreId,userType:indexJS.userInfo.userType,groupId:indexJS.userInfo.groupId,groupType:indexJS.userInfo.groupType,userId:indexJS.userInfo.userId,toUser:{userId:t,userType:i}})}$("#"+e).show().find(".wh_nk").text($(this).find("label").text()),$("#"+e).find(".ctextarea").focus(),chat.setTalkListScroll(!0,$("#"+e+" .wh-content"),"dark"),chat.setWhOnlineTip(t,$("#userListId li[id='"+t+"']").length>0)})}},setWhTip:function(t){if($(".pletter_win").is(":hidden")){var e=$("#userListId li[id="+t+"] a.uname span i"),i=0;e.length>0&&(i=e.text(),i=common.isValid(i)?i:0,$("#userListId li[id="+t+"] a.uname span i").text(parseInt(i)+1)),$("#userListId li[id="+t+"]").attr("k",1),this.whTipInterId=setInterval(function(){$("#userListId li[k=1]").toggleClass("tip_mrg")},1e3)}},closeWhTip:function(t){$("#userListId li[id="+t+"]").attr("k",0).removeClass("tip_mrg").find("a.uname span i").text(""),0==$("#userListId[k=1]").length&&this.whTipInterId&&(clearInterval(this.whTipInterId),this.whTipInterId=null)},fillWhBox:function(t,e,i,n,a,s,o){var r=$(".mult_dialog a[uid="+n+"]");if(0==r.length)chat.setWhVisitors(t,i,n,a,e,!0,o);else if(o&&!r.hasClass("on")){var l=r.find(".num"),c=parseInt(l.attr("t"))+1;l.attr("t",c).text(c).show()}return s?(this.setWhTip(n),!1):($(".pletter_win").show(),$(".mult_dialog a[uid="+n+"]").click(),!0)},setWhContent:function(t,e,i,n){var a=t.fromUser,s="dialog ",o=t.content,r="";if(t.rule)return void $("#"+t.uiId+" .dcont").append('<em class="ruleTipStyle">'+t.value.tip+"</em>");if(i||(a.toWhUserId=a.userId),indexJS.userInfo.userId==a.userId||"0"==indexJS.userInfo.userType&&"-1"==a.userType||"-1"==indexJS.userInfo.userType&&"0"==a.userType){if(e&&(a.publishTime=t.uiId,a.toWhUserId=a.toUser.userId),t.serverSuccess)return $("#"+t.uiId+" .dtime").html(chat.formatPublishTime(a.publishTime)),void $("#"+t.uiId).attr("id",a.publishTime);s+="mine",r='<span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+'</span><a href="javascript:" class="uname">我</a>'}else{if(!i&&!n){var l=this.fillWhBox(a.clientGroup,a.avatar,a.userType,a.userId,a.nickname,!0,!0);if(l)return}var c="3"==a.userType?"&nbsp;（助理）":"";r='<a href="javascript:" class="uname">'+a.nickname+c+'</a><span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+"</span>"}if(common.isBlank(a.toWhUserId))return void console.error("setWhContent->fromUser toWhUserId is null,please check!");var d="",u=$("#wh_msg_"+a.toWhUserId+" .dialoglist"),h="";if(o.msgType==chat.msgType.img)d=o.needMax?'<p><i></i><a href="/studio/getBigImg?publishTime='+a.publishTime+"&userId="+a.userId+'" class="swipebox" ><img src="'+o.value+'" alt="图片"/></a></p>':'<p><i></i><a href="'+o.value+'" class="swipebox" ><img src="'+o.value+'" alt="图片" /></a></p>';else if(n)d='<div class="whcls"><i></i><div class="whblt" rid="'+o.infoId+'">'+o.value+"</div></div>";else{if(!e&&common.isValid(a.toUser.question)){var p='<a href="javascript:" class="uname">'+a.toUser.nickname+'</a><span class="dtime">'+chat.formatPublishTime(a.publishTime,i,"/")+"</span>";h='<div class="dialog" id="'+a.publishTime+'"><div class="dialog_top">'+p+'</div><div class="whcls"><i></i><div class="whblt">'+a.toUser.question+"</div></div></div>",
u.append(h)}d='<p><i></i><span class="dcont">'+o.value+"</span></p>"}if(h='<div class="'+s+'" id="'+a.publishTime+'" utype="'+a.userType+'" mType="'+o.msgType+'"><div class="dialog_top">'+r+"</div>"+d+"</div>",u.append(h),this.formatMsgToLink(a.publishTime),!i){var m=u.parents(".wh-content");m.hasClass("mCustomScrollbar")&&chat.setTalkListScroll(!0,m,"dark")}},setOnlineNum:function(){$(".mod_userlist .titbar label").text($("#userListId li").length)},searchUserList:function(t){var e=$("#userListId li[t!=14][t!=0]").map(function(){var e=$(this).find(".uname span").text();return-1!=e.indexOf(t)?{value:e,label:e,userType:$(this).attr("utype")}:null}).get(),i=$("#teacherListId li").map(function(){var e=$(this).find("strong").text();return-1!=e.indexOf(t)?{value:e,label:e,userType:$(this).attr("utype")}:null}).get();return e.concat(i)},setSocket:function(){this.socket=common.getSocket(io,indexJS.socketUrl,indexJS.userInfo.groupType),this.socket.on("connect",function(){console.log("connected to server!"),indexJS.userInfo.socketId=chat.socket.id;var t=$("#roomInfoId");chat.socket.emit("login",{userInfo:indexJS.userInfo,lastPublishTime:$("#dialog_list>div:last").attr("id"),fUserTypeStr:t.attr("awr"),allowWhisper:t.attr("aw")}),$(".img-loading[pf=chatMessage]").show()}),this.socket.on("onlineUserList",function(t,e){if($("#userListId").html(""),"true"==$("#roomInfoId").attr("av")&&200>=e)for(var i=0,n=10>=e?60:200/e*3+10,a=0;n>a;a++)i=common.randomNumber(6),t["visitor_"+i]={userId:"visitor_"+i,clientGroup:"visitor",nickname:"游客_"+i,sequence:14,userType:-1};var s=null;for(var a in t)s=t[a],chat.setOnlineUser(s);chat.setOnlineNum(),indexJS.setListScroll(".user_box")}),this.socket.on("disconnect",function(t){console.log("disconnect")}),this.socket.on("error",function(t){console.error("e:"+t)}),this.socket.on("sendMsg",function(t){t.fromUser.toUser&&1==t.fromUser.toUser.talkStyle?chat.setWhContent(t,!1,!1):chat.setContent(t,!1,!1)}),this.socket.on("notice",function(t){switch(t.type){case"onlineNum":var e=t.data,i=e.onlineUserInfo;e.online?chat.setOnlineUser(i):indexJS.userInfo.userId!=i.userId&&($("#userListId #"+i.userId).remove(),indexJS.setListScroll(".user_box")),chat.setOnlineNum(),3==i.userType&&chat.setWhOnlineTip(i.userId,e.online);break;case"removeMsg":$("#"+t.data.replace(/,/g,",#")).remove(),chat.setTalkListScroll();break;case"leaveRoom":chat.leaveRoomTip(t.flag,t.userIds);break;case"pushInfo":var e=t.data;1==e.position?(chat.whPushObj={info:e.content,publishTime:e.publishTime,infoId:e.contentId},chat.pushInfoTimeOutId=window.setTimeout(function(){var t=$("#userListId li[t=3] a .headimg:not(.have_op)");$(t.get(common.randomIndex(t.length))).parent().find("em").click(),$("#main_ad_box .pop_close").click()},60*e.timeOut*1e3)):3==e.position&&chat.talkBoxPush.initTBP(e.infos);break;case"approvalResult":var e=t.data;if(e.refuseMsg){var n=e.publishTimeArr;for(var a in n)$("#"+n[a]+" .dcont em[class=ruleTipStyle]").html("已拒绝")}else{for(var a in e)chat.formatUserToContent(e[a]);chat.setTalkListScroll(!0)}}}),this.socket.on("loadMsg",function(t){$(".img-loading[pf=chatMessage]").hide();var e=t.msgData;if(e&&$.isArray(e)){e.reverse();for(var i in e)chat.formatUserToContent(e[i])}chat.setTalkListScroll(!0)}),this.socket.on("loadWhMsg",function(t){var e=t.data;if("offline"==t.type){if(e&&!$.isEmptyObject(e))for(var i in e)chat.setWhVisitors(e[i].clientGroup,e[i].userType,i,e[i].nickname,$("#userListId li[id='"+i+"']").length>0)}else if(e&&$.isArray(e)){var n=0,a=null;e.reverse();var s=0,o=$(".mult_dialog a[uid="+t.toUserId+"]");for(var r in e)a=e[r],3==a.userType&&chat.setWhPushInfo(o,a.publishTime)&&s++,chat.formatUserToContent(a,!0,t.toUserId),a.content.msgType==chat.msgType.img&&n++;0==s&&chat.setWhPushInfo(o,null),n>0&&$(".swipebox").swipebox(),chat.setTalkListScroll(!0,$("#wh_msg_"+t.toUserId+" .wh-content"),"dark")}})},setTalkListScroll:function(t,e,i){var n=e?e:$("#chatMsgContentDiv");n.hasClass("mCustomScrollbar")?(n.mCustomScrollbar("update"),t&&n.mCustomScrollbar("scrollTo","bottom")):(n.mCustomScrollbar({scrollInertia:1,scrollButtons:{enable:!1},theme:i?i:"light-2"}),common.setScrollStyle(n),n.mCustomScrollbar("scrollTo","bottom"))},setWhPushInfo:function(t,e){if($.isEmptyObject(chat.whPushObj))return!1;if(e&&e<chat.whPushObj.publishTime)return!1;var i=t.attr("uid"),n=t.find("label").text().replace(/\s（助理）$/,"");if($("#wh_msg_"+i+" div[id="+chat.whPushObj.publishTime+"]").length>0)return!1;var a={fromUser:{publishTime:chat.whPushObj.publishTime,userId:i,nickname:n,userType:3},content:{msgType:chat.msgType.text,value:chat.whPushObj.info,infoId:chat.whPushObj.infoId}};return chat.setWhContent(a,!1,!1,!0),chat.whPushObj={},window.clearTimeout(chat.pushInfoTimeOutId),!0},formatUserToContent:function(t,e,i){var n={userId:t.userId,nickname:t.nickname,avatar:t.avatar,userType:t.userType,groupId:t.groupId,clientGroup:t.clientGroup,publishTime:t.publishTime,toUser:t.toUser,avatar:t.avatar,position:t.position};e?(n.toWhUserId=i,chat.setWhContent({fromUser:n,content:t.content},!1,!0)):chat.setContent({fromUser:n,content:t.content},!1,!0)},talkBoxPush:{talkPushList:[],talkPushInterval:null,initTBP:function(t){this.clear(),this.talkPushList=t,this.start()},clear:function(){chat.talkBoxPush.talkPushInterval&&(window.clearInterval(chat.talkBoxPush.talkPushInterval),chat.talkBoxPush.talkPushInterval=null);for(var t=chat.talkBoxPush.talkPushList,e=null,i=0,n=t.length;n>i;i++)e=t[i],e.timeoutId&&window.clearTimeout(e.timeoutId),e.intervalId&&window.clearInterval(e.intervalId)},start:function(){var t=chat.talkBoxPush.talkPushList;t&&t.length>0&&(chat.talkBoxPush.talkPushInterval=window.setInterval(function(){chat.talkBoxPush.check()},1e4))},check:function(){for(var t=chat.talkBoxPush.talkPushList,e=null,i=0,n=t.length;n>i;i++)e=t[i],e.startFlag||common.dateTimeWeekCheck(e.pushDate,!1,indexJS.serverTime)&&(e.startFlag=!0,e.timeoutId=window.setTimeout(chat.talkBoxPush.delayStartTask(e),60*(e.onlineMin||0)*1e3))},delayStartTask:function(t){return function(){chat.talkBoxPush.showMsg(t),t.intervalMin&&t.intervalMin>0&&(t.intervalId=window.setInterval(chat.talkBoxPush.startTask(t),60*t.intervalMin*1e3))}},startTask:function(t){return function(){common.dateTimeWeekCheck(t.pushDate,!1,indexJS.serverTime)?chat.talkBoxPush.showMsg(t):(window.clearInterval(t.intervalId),t.startFlag=!1)}},showMsg:function(t){var e=[];e.push('<div class="dialog push">'),e.push(t.content),e.push("</div>"),$("#dialog_list").append(e.join("")),$(".scrollbtn").hasClass("on")&&chat.setTalkListScroll(!0)}}};$(function(){chat.init()});var box={verifyCodeIntId:null,toRoomId:null,init:function(){this.setEvent()},setEvent:function(){$(".popup_box .pop_close,.formbtn[t=close]").click(function(){$(this).parent().parent().hide(),$(".blackbg").hide(),$(".blackbg form").each(function(){this.reset()})}),this.loginEvent(),this.upgradeEvent(),this.expertMailEvent()},upgradeEvent:function(){$("#tipbtnId").hover(function(){$(".upg_tip").show()},function(){$(".upg_tip").hide()}),$(".upgradebtn").click(function(){try{$(".upgrade,#up_loading").show(),$.getJSON("/studio/getClientGroupList",null,function(t){if($("#up_loading").hide(),t){$("#upg_tbody_id").html("");var e="",i=0,n=null,a="";for(var s in t)t[s].clientGroupId==indexJS.userInfo.clientGroup&&(i=t[s].sequence);for(var o=0;o<t.length;o++)if(n=t[o],a="",n.clientGroupId==indexJS.userInfo.clientGroup?(e="当前级别",a="current"):e="visitor"!=n.clientGroupId&&i<n.sequence?"vip"==n.clientGroupId?"联系客服升级":'<a href="javascript:" t="'+n.clientGroupId+'">升级</a>':"---",!common.isBlank(common.trim(n.remark))){var r=[];r.push('<tr class="'+a+'"><td>'+box.getUserLevelShortName(n.clientGroupId)+"</td><td>"+common.trim(n.remark)+"</td><td><p>"+common.trim(n.authorityDes)+"</p></td><td>"+e+"</td></tr>"),$("#upg_tbody_id").append(r.join(""))}$("#upg_tbody_id a").click(function(){var t=$(this),e=t.attr("t");common.getJson("/studio/upgrade",{clientGroup:e},function(i){if(t.attr("disabled",!1),i.isOK)"active"===i.clientGroup&&"notActive"===e?$("#studioUpgA").show():$("#studioUpgA").hide(),$(".upgrade,.upgrade_result .fail").hide(),$(".upgrade_result,.upgrade_result .succ").show();else{var n="";"active"===e?n="很遗憾，您未激活金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"notActive"===e?n="很遗憾，您未开通金道真实交易账户，升级失败！<br>如有疑问请联系客服！":"simulate"===e&&(n="很遗憾，您未开通金道模拟交易账户，升级失败！<br>如有疑问请联系客服！"),$(".upgrade_result .succ").hide(),$(".upgrade_result,.upgrade_result .fail").show().find("span").html(n)}},!0,function(e){t.attr("disabled",!1)})})}})}catch(t){$("#up_loading").hide(),console.error("getClientGroupList->"+t)}})},forceLogin:function(t){var e=LoginAuto.get();return"boolean"!=typeof t?e&&1==e.forceLogin:e?(e.forceLogin=t,LoginAuto.set(e)&&t):!1},loginEvent:function(){$("#login_a").bind("click",function(t,e){e=e||{},box.toRoomId=e.groupId,box.openLgBox(e.closeable,e.showTip),common.isValid($(this).attr("tp"))&&_gaq.push(["_trackEvent","pmchat_studio","login",$(this).attr("tp"),1,!0])}),"visitor"==indexJS.userInfo.clientGroup&&(indexJS.currStudioAuth?this.forceLogin()?$("#login_a").trigger("click",{closeable:!1,showTip:!0}):(window.setTimeout(function(){"visitor"==indexJS.userInfo.clientGroup&&(box.forceLogin(!0),$("#login_a").trigger("click",{closeable:!1,showTip:!0}))},18e4),indexJS.userInfo.isLogin||($(".blackbg,#main_ad_box").show(),window.setTimeout(function(){$(".blackbg").is(":hidden")&&$(".blackbg,#main_ad_box").show()},3e5),$("#mainAdBtn1").click(function(){$("#main_ad_box .pop_close").trigger("click"),$(".rooms .enterbtn:first").trigger("click")}),$("#mainAdBtn2").click(function(){$("#main_ad_box .pop_close").trigger("click"),$("#login_a").trigger("click")}))):$("#login_a").trigger("click",{closeable:!1})),$(".logout").bind("click",function(){LoginAuto.setAutoLogin(!1),window.location.href="/studio/logout?platform="+indexJS.fromPlatform}),$("#loginForm input[name=mobilePhone],#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").bind("input propertychange",function(){common.isValid(this.value)&&$(".popup_box .error").hide()}),$("#loginForm .rbtn").click(function(){if(!$(this).hasClass("pressed")){var t=$("#loginForm input[name=mobilePhone]").val();if(!common.isMobilePhone(t))return void $("#loginForm .error").html("<i></i>手机号码有误，请重新输入！").show();$(this).addClass("pressed").html("发送中...");try{$.getJSON("/studio/getMobileVerifyCode?t="+(new Date).getTime(),{mobilePhone:t,useType:$(this).attr("ut")},function(t){t&&0==t.result?($("#loginForm .error").hide(),box.setVerifyCodeTime("#loginForm .rbtn")):("1005"==t.errcode?$("#loginForm .error").html("<i></i>"+t.errmsg).show():console.error("提取数据有误！"),box.resetVerifyCode())})}catch(e){box.resetVerifyCode(),console.error("setMobileVerifyCode->"+e)}}}),$("#loginForm input[name=verifyCode],#setNkForm input[name=nickname]").keydown(function(t){return 13==t.keyCode?($(this).parents("form").find(".set_submit").click(),!1):void 0}),$("#logBtnSub").click(function(){if($("#loginForm input[name=clientStoreId]").val(indexJS.userInfo.clientStoreId),box.checkFormInput("#loginForm")){$(this).attr("disabled",!0);var t=this;$("#formBtnLoad").show(),common.getJson("/studio/login",$("#loginForm").serialize(),function(e){return $("#loginForm .error").hide(),$(t).attr("disabled",!1),$("#formBtnLoad").hide(),e.isOK?($(".blackbg,#loginBox").hide(),LoginAuto.setAutoLogin($("#autoLogin").prop("checked")),indexJS.userInfo.clientGroup=e.userInfo.clientGroup,box.toRoomId?common.getJson("/studio/checkGroupAuth",{groupId:box.toRoomId},function(t){t.isOK||(indexJS.checkClientGroup("vip")?alert("您已具备进入Vip专场的条件，我们将为您自动进入VIP专场。"):alert("已有真实账户并激活的客户才可进入Vip专场，您还不满足条件。我们将为您自动进入新手专场。")),indexJS.toRefreshView()},!0,function(t){"success"!=t&&(box.preGroupId=null,alert("操作失败，请联系客服！"))}):(indexJS.checkClientGroup("vip")&&alert("您已具备进入Vip专场的条件，我们将为您自动进入VIP专场。"),indexJS.toRefreshView()),void 0):($("#loginForm .error").html("<i></i>"+e.error.errmsg).show(),!1)},!0,function(e){$(t).attr("disabled",!1),$("#formBtnLoad").hide()})}}),$("#setNkBtn").click(function(){if(box.checkFormInput("#setNkForm")){$(this).prop("disabled",!0);var t=this;$("#setNkLoad").show(),common.getJson("/studio/modifyName",$("#setNkForm").serialize(),function(e){return $("#setNkForm .error").hide(),$(t).attr("disabled",!1),$("#setNkLoad").hide(),e.isOK?($("#setNkForm").parent().find(".pop_close").click(),indexJS.refreshNickname(!0,e.nickname),$("#sendBtn").click(),void 0):($("#setNkForm .error").html("<i></i>"+(e.msg?e.msg:"修改失败，请联系客服！")).show(),!1)},!0,function(e){$(t).attr("disabled",!1),$("#setNkLoad").hide()})}})},getUserLevelShortName:function(t){var e="";switch(t){case"vip":e="[V]";break;case"real":e="[R]";break;case"active":e="[A]";break;case"notActive":e="[N]";break;case"simulate":e="[D]";break;case"register":e="[M]";break;default:e="游客"}return e},checkFormInput:function(t,e){var i=!0;return e||(e=$(t+" .error")),e.attr("tId","").hide(),$(t+" input").each(function(){return common.isBlank($(this).val())?("mobilePhone"==this.name&&e.attr("tId",this.name).html("<i></i>手机号码不能为空！").show(),"verifyCode"==this.name&&e.attr("tId",this.name).html("<i></i>验证码不能为空！").show(),"nickname"==this.name&&e.attr("tId",this.name).html("<i></i>昵称不能为空！").show(),i=!1):"mobilePhone"!=this.name||($(this).val($.trim($(this).val())),common.isMobilePhone(this.value))?"nickname"!=this.name||common.isRightName(this.value)?void 0:(e.attr("tId",this.name).html("<i></i>昵称为2至10位字符(数字/英文/中文/下划线)，不能全数字!").show(),i=!1):(e.attr("tId",this.name).html("<i></i>手机号码输入有误！").show(),i=!1)}),i},setVerifyCodeTime:function(t){var e=parseInt($(t).attr("t"))||60;this.verifyCodeIntId||(this.verifyCodeIntId=setInterval("box.setVerifyCodeTime('"+t+"')",1e3)),e>1?$(t).attr("t",e-1).html(e-1+"秒后重新获取"):(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId="",$(t).attr("t",60).html("获取验证码").removeClass("pressed"))},resetVerifyCode:function(){this.verifyCodeIntId&&(clearInterval(this.verifyCodeIntId),this.verifyCodeIntId=""),$("#loginForm .rbtn").attr("t",60).html("获取验证码").removeClass("pressed")},openLgBox:function(t,e){t===!1?$("#loginBox .pop_close").hide():$("#loginBox .pop_close").show(),e?$("#login_tip").show():$("#login_tip").hide(),$(".popup_box").hide(),$("#loginBox,.blackbg").show()},openSetNameBox:function(){$(".nk_box,.blackbg").show()},expertMailEvent:function(){$(".expert_box .error").hide(),$("#expert").click(function(){$(".expert,.blackbg").removeClass("dn").show()}),$("#btnSendMail").click(function(){if(""==$.trim($("#mailFrom").val()))$(".expert_box .error").html("<i></i>发件人不能为空！").show();else if(""==$.trim($("#mailContent").val()))$(".expert_box .error").html("<i></i>输入内容有误，请重新输入！").show();else{$(".expert_box .error").hide();var t={};t.content=$.trim($("#mailContent").val()),t.email=$.trim($("#mailFrom").val()),common.getJson("/studio/email",{key:"studio",data:JSON.stringify(t)},function(t){t.isOK?(box.showMsg(t.msg),$(".expert,.blackbg").hide(),$("#mailFrom,#mailContent").val("")):box.showMsg(t.msg)})}}),$("#btnSendMail").keydown(function(t){return 13==t.keyCode?($("#btnSendMail").click(),!1):void 0})},hideMsg:function(){$("#popMsgBox").is(":visible")&&$("#popMsgBox").fadeOut("normal","swing",function(){$(".blackbg").hide()})},showMsg:function(t){"string"==typeof t&&(t={msg:t}),t=$.extend({closeable:!0,title:"",msg:"",modal:!0,delay:0,btns:[{txt:"确定",fn:function(){box.hideMsg()}}]},t),$("#popMsgTit").text(t.title||""),$("#popMsgTxt").text(t.msg);var e=$("#popMsgCont");e.find("a.yesbtn").remove();for(var i=null,n=null,a=0,s=t.btns?t.btns.length:0;s>a;a++)i=t.btns[a],n=$('<a class="yesbtn" href="javascript:void(0)">'+i.txt+"</a>"),e.append(n),n.click(i.fn);t.closeable?$("#popMsgClo").show():$("#popMsgClo").hide(),$("#popMsgBox").show(),t.modal&&$(".blackbg").show(),t.delay&&window.setTimeout(function(){box.hideMsg()},t.delay)},showTipBox:function(t){$(".tipsbox").fadeIn().delay(1e3).fadeOut(200).find(".cont").text(t)}};$(function(){box.init()});var tool={financeShowIntervalId:null,financeHideIntervalId:null,init:function(){this.setEvent()},setEvent:function(){$(".mod_menu li").hover(function(){$(this).hasClass("entered")||(tool.loadFun($(this).attr("class")),$(".dr3").hasClass("on")&&clearTimeout(tool.financeHideIntervalId)),$(this).addClass("on entered"),$(this).find(".dropcont").show()},function(){$(this).removeClass("on"),$(this).find(".dropcont").hide(),$(".dr3").hasClass("on")||(clearInterval(tool.financeShowIntervalId),tool.financeHideIntervalId=window.setTimeout("tool.clearCls('.dr3','entered')",6e4)),!$(".dr2").hasClass("on")&&pkMarketSocket&&pkMarketSocket.close()}),$(".hqchart .hqtabnav a").click(function(){$(".hqchart .hqtabnav a").removeClass("on"),$(".hqchart .votebox a").removeClass("on"),$(this).addClass("on"),$($(".hqchart .votebox a")[0]).addClass("on");var t=$(this).attr("symbol");tool.setQuotesVote(t,"")}),$(".hqchart .votebox a").click(function(){$(".hqchart .votebox a").removeClass("on"),$(this).addClass("on")}),$(".votebtn").click(function(){var t=$(".hqchart .hqtabnav a.on").attr("symbol"),e=$(".hqchart .votebox a.on").attr("highslows");$(this).attr(t)!=t?tool.quotesVote(t,e):box.showMsg("已投过票了")}),$("#calendarFinance").val(common.formatterDate(indexJS.serverTime,"-")),$("#calendarFinance").change(function(){var t=$(this).val();tool.setFinanceData(t,1)}),$(".dr3 .date_select a").click(function(){$("#calendarFinance").trigger("click")}),$(".calc_box .calc_tabnav a").click(function(){$(this).hasClass("clicked")||tool.setPivotCalc($(this).attr("symbol")),$(".calc_box .calc_tabnav a").removeClass("on"),$(".calc_box .calc_tab").removeClass("on"),$(this).addClass("on clicked"),$($(".calc_box .calc_tab")[$(this).index()]).addClass("on")})},loadFun:function(t){switch(t){case"dropitem dr2":getAllMarketpriceIndex("ws://kdata.gwfx.com:8087/websocket.do","service=HqDataWebSocketService&method=pushMarketprice&symbol=XAGUSD|XAUUSD|USDX|CLWTI&dataType=simpleMarketPrice","http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getMarkrtPriceDataFromCache",null),tool.initEasyPieChart(function(){tool.setQuotesVote("Gold",""),$(".dr2").addClass("initEasyPieChart")});break;case"dropitem dr3":tool.initCalendar(function(){tool.setFinanceData("",1),$(".dr3").addClass("initCalendar"),tool.financeShowIntervalId=window.setInterval("tool.setFinanceData('',1)",6e4)});break;case"dropitem dr4":tool.setCftcCot();break;case"dropitem dr5":tool.setPivotCalc("LLG");break;case"dropitem dr6":tool.setDownloadPPT()}},initEasyPieChart:function(t){if($(".dr2").hasClass("initEasyPieChart"))t();else{var e=[];$.browser.msie&&e.push("/js/lib/excanvas.compiled.js"),e.push("/js/lib/jquery.easy-pie-chart.min.js"),LazyLoad.js(e,function(){$(".percentage").easyPieChart({barColor:"#66ab4a",trackColor:"#f15f5f",scaleColor:!1,lineCap:"square",lineWidth:12,animate:1e3,size:114}),t()})}},quotesVote:function(t,e){common.getJson("/studio/highsLowsVote",{symbol:t,highslows:e},function(e){var i=0;if(e.isOK){var n=e.data.highs,a=e.data.lows,s=parseInt(n)+parseInt(a);i=Math.round(parseInt(n)/s*100),$("#data_percent_1").attr("data-percent",i),$(".hqchart .datashow .fr").html("看涨<br>"+i+"%"),$(".hqchart .datashow .fl").html("看跌<br>"+Math.round(parseInt(a)/s*100)+"%"),$(".votebtn").attr(t,t)}else $("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%");$(".percentage").data("easyPieChart").update(i)})},setQuotesVote:function(t,e){$.getJSON("/studio/getHighsLowsVote",{symbol:t,highslows:e},function(t){var e=0;if(t.isOK){var i=t.data.highs,n=t.data.lows,a=parseInt(i)+parseInt(n);e=Math.round(parseInt(i)/a*100),common.isBlank(e)||isNaN(e)?($("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%")):($("#data_percent_1").attr("data-percent",e),$(".hqchart .datashow .fr").html("看涨<br>"+e+"%"),$(".hqchart .datashow .fl").html("看跌<br>"+Math.round(parseInt(n)/a*100)+"%"))}else $("#data_percent_1").attr("data-percent",0),$(".hqchart .datashow .fr").html("看涨<br>0%"),$(".hqchart .datashow .fl").html("看跌<br>0%");$(".percentage").data("easyPieChart").update(e)})},initCalendar:function(t){$(".dr3").hasClass("initCalendar")?t():LazyLoad.js(["/js/lib/pikaday/moment.min.js","/js/lib/pikaday/pikaday.min.js"],function(){var e=tool.currentDate(),i={previousMonth:"上个月",nextMonth:"下个月",months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdays:["周日","周一","周二","周三","周四","周五","周六"],weekdaysShort:["日","一","二","三","四","五","六"]};new Pikaday({field:$("#calendarFinance")[0],firstDay:1,container:$("#calendarContainer")[0],defaultDate:e,i18n:i,minDate:new Date(2e3,0,1),maxDate:new Date(2050,12,31),yearRange:[2e3,2050],onSelect:function(){var t=document.createTextNode(this.getMoment().format("YYYY-MM-DD")+" ");$("#calendarFinance").append(t)}});t()})},setFinanceData:function(t,e){common.isBlank(t)&&(t=tool.currentDate()),common.getJson("/studio/getFinancData",{releaseTime:t,dataTypeCon:e},function(t){if(0==t.result){var e={"德国":"Germany","法国":"France","欧元区":"EUR","加拿大":"CAD","美国":"USD","澳大利亚":"AUD","日本":"JPY","瑞士":"CHF","意大利":"Italy","英国":"GBP","中国":"CNY","新西兰":"NZD","韩国":"SK","香港":"HKD","西班牙":"Spain","台湾":"Taiwan","印度":"INR","新加坡":"Singapore"},i="",n=tool.formatHtml("finance");$.each(t.data.financeData,function(t,a){i+=n.formatStr(a.time.substring(0,5),common.isBlank(e[a.country])?"none":e[a.country],a.country,tool.importanceLevel(a.importanceLevel),a.name,common.isBlank(a.lastValue)?"---":a.lastValue,common.isBlank(a.predictValue)?"---":a.predictValue,common.isBlank(a.value)?"---":a.value)}),$(".dr3 .calendar_ul ul").html(i),indexJS.setListScroll(".calendar_ul.scrollbox2",{isCustom:!1,scrollbarPosition:"outside"})}})},setCftcCot:function(){$.getJSON("/studio/get24kCftc",null,function(t){var e={gold:"纽约期金",silver:"纽约期银",usd:"美元指数",oil:"纽约原油",cu:"纽约期铜"};if(null!=t&&t){var i="",n="",a=tool.formatHtml("cftcperc"),s=tool.formatHtml("cftcdata");$.each(e,function(e,o){var r=t[e]["long"],l=t[e]["short"],c=parseInt(r)+parseInt(l),d=Math.round(parseInt(r)/c*100),u=Math.round(parseInt(l)/c*100);i+=a.formatStr(o,d,u),n+=s.formatStr(o,r,l,t[e].updatetime)}),$(".dr4 .percent_list .perc_table").html(i),$(".dr4 .perc_data .data_table tbody").html(n)}})},getOAUrl:function(){var t=window.location.host;return t=t.indexOf("localhost")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":t.indexOf("testweb1.24k.hk")>=0?"http://testweb.gwfx.com:9001/gateway.do?service=HqDataService&method=getPivotPointData&symbol=":"http://kdata.gwfx.com:8099/gateway.do?service=HqDataService&method=getPivotPointData&symbol="},setPivotCalc:function(t){$.post(tool.getOAUrl()+t,{},function(t){var e=["d","w"];if("true"===t.sucess.toLowerCase())for(var i=t.msg.length,n=0;i>n;n++)$.inArray(t.msg[n].pivotType,e)>-1&&($("#r3_"+t.msg[n].symbol+"_"+t.msg[n].pivotType).text(t.msg[n].resistance3),$("#r2_"+t.msg[n].symbol+"_"+t.msg[n].pivotType).text(t.msg[n].resistance2),$("#r1_"+t.msg[n].symbol+"_"+t.msg[n].pivotType).text(t.msg[n].resistance1),$("#p_"+t.msg[n].symbol+"_"+t.msg[n].pivotType).text(t.msg[n].pivotPoint),$("#s3_"+t.msg[n].symbol+"_"+t.msg[n].pivotType).text(t.msg[n].support3),$("#s2_"+t.msg[n].symbol+"_"+t.msg[n].pivotType).text(t.msg[n].support2),$("#s1_"+t.msg[n].symbol+"_"+t.msg[n].pivotType).text(t.msg[n].support1))},"json")},setDownloadPPT:function(){var t={pptx:"",ppt:"",pdf:' class="pdf"',docx:' class="word"',doc:' class="word"'};indexJS.getArticleList("download",indexJS.userInfo.groupId,1,1,100,'{"sequence":"asc"}',null,function(e){if(e&&0==e.result){var i,n=e.data,a=null,s="",o=tool.formatHtml("download");for(var r in n){i=0==r?' class="fir"':"",a=n[r].detailList[0];var l=n[r].mediaUrl.substring(n[r].mediaUrl.lastIndexOf(".")+1).toLowerCase(),c=a.title+"."+l,d=common.formatterDate(n[r].publishStartDate,"-").replace("-","/").replace("-","/");s+=o.formatStr(i,t[l],a.title,a.authorInfo?a.authorInfo.name:"",d,n[r].mediaUrl,c,"")}$(".dr6 .ppt_list ul").html(s),indexJS.setListScroll(".ppt_list",{isCustom:!1,scrollbarPosition:"outside"})}else $(".dr6 .ppt_list ul").html("")})},currentDate:function(){return common.formatterDate(indexJS.serverTime,"-")},clearCls:function(t,e){$(t).removeClass(e)},formatHtml:function(t){var e=[];switch(t){case"finance":e.push("<li>"),e.push('   <table cellpadding="0" cellspacing="0" border="0" width="100%" class="calendar_table">'),e.push("       <tr>"),e.push('           <td width="98"><span class="time">{0}</span></td>'),e.push('           <td><img src="http://www.24k.hk/public/economicCalenda/images/country/{1}.png" width="23">{2}</td>'),e.push('           <td width="80"><div class="stars">{3}</div></td>'),e.push("       </tr>"),e.push("       <tr>"),e.push('           <td colspan="3"><span class="tit">{4}</span></td>'),e.push("       </tr>"),e.push("       <tr>"),e.push("           <td>前值:<strong>{5}</strong></td>"),e.push("           <td>预测值:<strong>{6}</strong></td>"),e.push("           <td>公布值:<strong>{7}</strong></td>"),e.push("       </tr>"),e.push("   </table>"),e.push("</li>");break;case"cftcperc":e.push("<tr>"),e.push('   <td width="53"><strong>{0}</strong></td>'),e.push('   <td width="30">{1}%</td>'),e.push('   <td><div class="perc_box"><b style="width:{1}%"></b></div></td>'),e.push('   <td width="30" class="align_r">{2}%</td>'),e.push("</tr>");break;case"cftcdata":e.push("<tr>"),e.push("   <td>{0}</td>"),e.push('   <td align="right">{1}</td>'),e.push('   <td align="right">{2}</td>'),e.push("   <td></td>"),e.push('   <td align="center">{3}</td>'),e.push("</tr>");break;case"download":e.push("<li{0}>"),e.push("   <i{1}></i>"),e.push('   <div class="detail">'),e.push("       <strong>{2}</strong>"),e.push("       <span>{3}<b>{4}</b></span>"),e.push('       <a href="{5}" target="download" download="{6}" class="downbtn" onclick="_gaq.push([\'_trackEvent\', \'pmchat_studio\', \'file_download\',$(this).prev().prev().text()]);"><i></i><span>下载<b>{7}</b></span></a>'),e.push("   </div>"),e.push("</li>")}return e.join("")},importanceLevel:function(t){var e="";switch(t){case 1:e='<span class="bling">★</span><span>★</span><span>★</span><span>★</span><span>★</span>';break;case 2:e='<span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span><span>★</span>';break;case 3:e='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span><span>★</span>';break;case 4:e='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span>★</span>';break;case 5:e='<span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span><span class="bling">★</span>';break;default:e="<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>"}return e}};$(function(){tool.init()});